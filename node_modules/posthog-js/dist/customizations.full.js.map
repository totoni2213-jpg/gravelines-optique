{"version":3,"file":"customizations.full.js","sources":["../src/utils/globals.ts","../src/config.ts","../../core/dist/utils/string-utils.mjs","../../core/dist/utils/type-utils.mjs","../../core/dist/utils/number-utils.mjs","../../core/dist/utils/bucketed-rate-limiter.mjs","../../core/dist/utils/user-agent-utils.mjs","../src/utils/logger.ts","../src/utils/index.ts","../src/utils/request-utils.ts","../src/uuidv7.ts","../src/storage.ts","../src/utils/event-utils.ts","../src/extensions/sampling.ts","../src/customizations/before-send.ts","../src/customizations/posthogReduxLogger.ts","../src/customizations/setAllPersonProfilePropertiesAsPersonPropertiesForFlags.ts","../src/entrypoints/customizations.full.ts"],"sourcesContent":["import type { PostHog } from '../posthog-core'\nimport { SessionIdManager } from '../sessionid'\nimport {\n    DeadClicksAutoCaptureConfig,\n    ExternalIntegrationKind,\n    Properties,\n    RemoteConfig,\n    SiteAppLoader,\n    SessionStartReason,\n} from '../types'\nimport type {\n    ConversationsRemoteConfig,\n    GetMessagesResponse,\n    GetTicketsOptions,\n    GetTicketsResponse,\n    MarkAsReadResponse,\n    RestoreFromTokenResponse,\n    RequestRestoreLinkResponse,\n    SendMessageResponse,\n    UserProvidedTraits,\n} from '../posthog-conversations-types'\n// only importing types here, so won't affect the bundle\n// eslint-disable-next-line posthog-js/no-external-replay-imports\nimport type { SessionRecordingStatus, TriggerType } from '../extensions/replay/external/triggerMatching'\nimport { eventWithTime } from '../extensions/replay/types/rrweb-types'\nimport { ErrorTracking } from '@posthog/core'\n\n/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nexport type AssignableWindow = Window &\n    typeof globalThis & {\n        /*\n         * Main PostHog instance\n         */\n        posthog: any\n\n        /*\n         * This is our contract between (potentially) lazily loaded extensions and the SDK\n         */\n        __PosthogExtensions__?: PostHogExtensions\n\n        /**\n         * When loading remote config, we assign it to this global configuration\n         * for ease of sharing it with the rest of the SDK\n         */\n        _POSTHOG_REMOTE_CONFIG?: Record<\n            string,\n            {\n                config: RemoteConfig\n                siteApps: SiteAppLoader[]\n            }\n        >\n\n        /**\n         * If this is set on the window, our logger will log to the console\n         * for ease of debugging. Used for testing purposes only.\n         *\n         * @see {Config.DEBUG} from config.ts\n         */\n        POSTHOG_DEBUG: any\n\n        // Exposed by the browser\n        doNotTrack: any\n\n        // See entrypoints/customizations.full.ts\n        posthogCustomizations: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/exception-autocapture.ts\n         *\n         * @deprecated use `__PosthogExtensions__.errorWrappingFunctions` instead\n         */\n        posthogErrorWrappingFunctions: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrweb` instead\n         */\n        rrweb: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrwebConsoleRecord` instead\n         */\n        rrwebConsoleRecord: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.getRecordNetworkPlugin` instead\n         */\n        getRecordNetworkPlugin: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/web-vitals.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogWebVitalsCallbacks` instead\n         */\n        postHogWebVitalsCallbacks: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/tracing-headers.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogTracingHeadersPatchFns` instead\n         */\n        postHogTracingHeadersPatchFns: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/surveys.ts\n         *\n         * @deprecated use `__PosthogExtensions__.generateSurveys` instead\n         */\n        extendPostHogWithSurveys: any\n\n        /*\n         * These are used to handle our toolbar state.\n         * @see {Toolbar} from extensions/toolbar.ts\n         */\n        ph_load_toolbar: any\n        ph_load_editor: any\n        ph_toolbar_state: any\n    } & Record<`__$$ph_site_app_${string}`, any>\n\n/**\n * This is our contract between (potentially) lazily loaded extensions and the SDK\n * changes to this interface can be breaking changes for users of the SDK\n */\n\nexport type ExternalExtensionKind = 'intercom-integration' | 'crisp-chat-integration'\n\nexport type PostHogExtensionKind =\n    | 'toolbar'\n    | 'exception-autocapture'\n    | 'web-vitals'\n    | 'web-vitals-with-attribution'\n    | 'recorder'\n    | 'lazy-recorder'\n    | 'tracing-headers'\n    | 'surveys'\n    | 'logs'\n    | 'conversations'\n    | 'product-tours'\n    | 'dead-clicks-autocapture'\n    | 'remote-config'\n    | ExternalExtensionKind\n\nexport interface LazyLoadedSessionRecordingInterface {\n    start: (startReason?: SessionStartReason) => void\n    stop: () => void\n    sessionId: string\n    status: SessionRecordingStatus\n    onRRwebEmit: (rawEvent: eventWithTime) => void\n    log: (message: string, level: 'log' | 'warn' | 'error') => void\n    sdkDebugProperties: Properties\n    overrideLinkedFlag: () => void\n    overrideSampling: () => void\n    overrideTrigger: (triggerType: TriggerType) => void\n    isStarted: boolean\n    tryAddCustomEvent(tag: string, payload: any): boolean\n}\n\nexport interface LazyLoadedDeadClicksAutocaptureInterface {\n    start: (observerTarget: Node) => void\n    stop: () => void\n}\n\nexport interface LazyLoadedConversationsInterface {\n    // Widget control\n    show: () => void\n    hide: () => void\n    isVisible: () => boolean\n\n    // Lifecycle\n    reset: () => void\n\n    // API methods\n    sendMessage: (message: string, userTraits?: UserProvidedTraits, newTicket?: boolean) => Promise<SendMessageResponse>\n    getMessages: (ticketId?: string, after?: string) => Promise<GetMessagesResponse>\n    markAsRead: (ticketId?: string) => Promise<MarkAsReadResponse>\n    getTickets: (options?: GetTicketsOptions) => Promise<GetTicketsResponse>\n    requestRestoreLink: (email: string) => Promise<RequestRestoreLinkResponse>\n    restoreFromToken: (restoreToken: string) => Promise<RestoreFromTokenResponse>\n    restoreFromUrlToken: () => Promise<RestoreFromTokenResponse | null>\n    getCurrentTicketId: () => string | null\n    getWidgetSessionId: () => string\n}\n\ninterface PostHogExtensions {\n    loadExternalDependency?: (\n        posthog: PostHog,\n        kind: PostHogExtensionKind,\n        callback: (error?: string | Event, event?: Event) => void\n    ) => void\n\n    loadSiteApp?: (posthog: PostHog, appUrl: string, callback: (error?: string | Event, event?: Event) => void) => void\n\n    errorWrappingFunctions?: {\n        wrapOnError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapUnhandledRejection: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapConsoleError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n    }\n    rrweb?: { record: any; version: string; wasMaxDepthReached?: () => boolean; resetMaxDepthState?: () => void }\n    rrwebPlugins?: { getRecordConsolePlugin: any; getRecordNetworkPlugin?: any }\n    generateSurveys?: (posthog: PostHog, isSurveysEnabled: boolean) => any | undefined\n    generateProductTours?: (posthog: PostHog, isEnabled: boolean) => any | undefined\n    logs?: {\n        initializeLogs?: (posthog: PostHog) => any | undefined\n    }\n    postHogWebVitalsCallbacks?: {\n        onLCP: (metric: any) => void\n        onCLS: (metric: any) => void\n        onFCP: (metric: any) => void\n        onINP: (metric: any) => void\n    }\n    /**\n     * @deprecated\n     *\n     * this was introduced briefly, it is now always a no-op and only kept for backwards compatibility\n     */\n    loadWebVitalsCallbacks?: (useAttribution?: boolean) => PostHogExtensions['postHogWebVitalsCallbacks']\n    tracingHeadersPatchFns?: {\n        _patchFetch: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n        _patchXHR: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n    }\n    initDeadClicksAutocapture?: (\n        ph: PostHog,\n        config: DeadClicksAutoCaptureConfig\n    ) => LazyLoadedDeadClicksAutocaptureInterface\n    integrations?: {\n        [K in ExternalIntegrationKind]?: { start: (posthog: PostHog) => void; stop: () => void }\n    }\n    initSessionRecording?: (ph: PostHog) => LazyLoadedSessionRecordingInterface\n    initConversations?: (config: ConversationsRemoteConfig, posthog: PostHog) => LazyLoadedConversationsInterface\n}\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\n// React Native polyfills for posthog-js compatibility\nif (typeof self === 'undefined') {\n    ;(global as any).self = global\n}\nif (typeof File === 'undefined') {\n    ;(global as any).File = function () {}\n}\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nexport const navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest =\n    global?.XMLHttpRequest && 'withCredentials' in new global.XMLHttpRequest() ? global.XMLHttpRequest : undefined\nexport const AbortController = global?.AbortController\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: AssignableWindow = win ?? ({} as any)\n\nexport { win as window }\n","import packageInfo from '../package.json'\n\n// overridden in posthog-core,\n// e.g.     Config.DEBUG = Config.DEBUG || instance.config.debug\nconst Config = {\n    DEBUG: false,\n    LIB_VERSION: packageInfo.version,\n}\n\nexport default Config\n","function includes(str, needle) {\n    return -1 !== str.indexOf(needle);\n}\nconst trim = function(str) {\n    return str.trim();\n};\nconst stripLeadingDollar = function(s) {\n    return s.replace(/^\\$/, '');\n};\nfunction isDistinctIdStringLike(value) {\n    return [\n        'distinct_id',\n        'distinctid'\n    ].includes(value.toLowerCase());\n}\nfunction deepSortKeys(value) {\n    if (null === value || 'object' != typeof value) return value;\n    if (Array.isArray(value)) return value.map(deepSortKeys);\n    return Object.keys(value).sort().reduce((acc, key)=>{\n        acc[key] = deepSortKeys(value[key]);\n        return acc;\n    }, {});\n}\nfunction getPersonPropertiesHash(distinct_id, userPropertiesToSet, userPropertiesToSetOnce) {\n    return JSON.stringify({\n        distinct_id,\n        userPropertiesToSet: userPropertiesToSet ? deepSortKeys(userPropertiesToSet) : void 0,\n        userPropertiesToSetOnce: userPropertiesToSetOnce ? deepSortKeys(userPropertiesToSetOnce) : void 0\n    });\n}\nexport { getPersonPropertiesHash, includes, isDistinctIdStringLike, stripLeadingDollar, trim };\n","import { knownUnsafeEditableEvent } from \"../types.mjs\";\nimport { includes } from \"./string-utils.mjs\";\nconst nativeIsArray = Array.isArray;\nconst ObjProto = Object.prototype;\nconst type_utils_hasOwnProperty = ObjProto.hasOwnProperty;\nconst type_utils_toString = ObjProto.toString;\nconst isArray = nativeIsArray || function(obj) {\n    return '[object Array]' === type_utils_toString.call(obj);\n};\nconst isFunction = (x)=>'function' == typeof x;\nconst isNativeFunction = (x)=>isFunction(x) && -1 !== x.toString().indexOf('[native code]');\nconst isObject = (x)=>x === Object(x) && !isArray(x);\nconst isEmptyObject = (x)=>{\n    if (isObject(x)) {\n        for(const key in x)if (type_utils_hasOwnProperty.call(x, key)) return false;\n        return true;\n    }\n    return false;\n};\nconst isUndefined = (x)=>void 0 === x;\nconst isString = (x)=>'[object String]' == type_utils_toString.call(x);\nconst isEmptyString = (x)=>isString(x) && 0 === x.trim().length;\nconst isNull = (x)=>null === x;\nconst isNullish = (x)=>isUndefined(x) || isNull(x);\nconst isNumber = (x)=>'[object Number]' == type_utils_toString.call(x) && x === x;\nconst isPositiveNumber = (value)=>isNumber(value) && value > 0;\nconst isBoolean = (x)=>'[object Boolean]' === type_utils_toString.call(x);\nconst isFormData = (x)=>x instanceof FormData;\nconst isFile = (x)=>x instanceof File;\nconst isPlainError = (x)=>x instanceof Error;\nconst isKnownUnsafeEditableEvent = (x)=>includes(knownUnsafeEditableEvent, x);\nfunction isPrimitive(value) {\n    return null === value || 'object' != typeof value;\n}\nfunction isBuiltin(candidate, className) {\n    return Object.prototype.toString.call(candidate) === `[object ${className}]`;\n}\nfunction isError(candidate) {\n    switch(Object.prototype.toString.call(candidate)){\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n        case '[object DOMError]':\n        case '[object WebAssembly.Exception]':\n            return true;\n        default:\n            return isInstanceOf(candidate, Error);\n    }\n}\nfunction isErrorEvent(event) {\n    return isBuiltin(event, 'ErrorEvent');\n}\nfunction isEvent(candidate) {\n    return !isUndefined(Event) && isInstanceOf(candidate, Event);\n}\nfunction isPlainObject(candidate) {\n    return isBuiltin(candidate, 'Object');\n}\nfunction isInstanceOf(candidate, base) {\n    try {\n        return candidate instanceof base;\n    } catch  {\n        return false;\n    }\n}\nconst yesLikeValues = [\n    true,\n    'true',\n    1,\n    '1',\n    'yes'\n];\nconst isYesLike = (val)=>includes(yesLikeValues, val);\nconst noLikeValues = [\n    false,\n    'false',\n    0,\n    '0',\n    'no'\n];\nconst isNoLike = (val)=>includes(noLikeValues, val);\nexport { type_utils_hasOwnProperty as hasOwnProperty, isArray, isBoolean, isBuiltin, isEmptyObject, isEmptyString, isError, isErrorEvent, isEvent, isFile, isFormData, isFunction, isKnownUnsafeEditableEvent, isNativeFunction, isNoLike, isNull, isNullish, isNumber, isObject, isPlainError, isPlainObject, isPositiveNumber, isPrimitive, isString, isUndefined, isYesLike, noLikeValues, yesLikeValues };\n","import { isNumber } from \"./type-utils.mjs\";\nfunction clampToRange(value, min, max, logger, fallbackValue) {\n    if (min > max) {\n        logger.warn('min cannot be greater than max.');\n        min = max;\n    }\n    if (isNumber(value)) if (value > max) {\n        logger.warn(' cannot be  greater than max: ' + max + '. Using max value instead.');\n        return max;\n    } else {\n        if (!(value < min)) return value;\n        logger.warn(' cannot be less than min: ' + min + '. Using min value instead.');\n        return min;\n    }\n    logger.warn(' must be a number. using max or fallback. max: ' + max + ', fallback: ' + fallbackValue);\n    return clampToRange(fallbackValue || max, min, max, logger);\n}\nexport { clampToRange };\n","import { clampToRange } from \"./number-utils.mjs\";\nconst ONE_DAY_IN_MS = 86400000;\nclass BucketedRateLimiter {\n    constructor(options){\n        this._buckets = {};\n        this._onBucketRateLimited = options._onBucketRateLimited;\n        this._bucketSize = clampToRange(options.bucketSize, 0, 100, options._logger);\n        this._refillRate = clampToRange(options.refillRate, 0, this._bucketSize, options._logger);\n        this._refillInterval = clampToRange(options.refillInterval, 0, ONE_DAY_IN_MS, options._logger);\n    }\n    _applyRefill(bucket, now) {\n        const elapsedMs = now - bucket.lastAccess;\n        const refillIntervals = Math.floor(elapsedMs / this._refillInterval);\n        if (refillIntervals > 0) {\n            const tokensToAdd = refillIntervals * this._refillRate;\n            bucket.tokens = Math.min(bucket.tokens + tokensToAdd, this._bucketSize);\n            bucket.lastAccess = bucket.lastAccess + refillIntervals * this._refillInterval;\n        }\n    }\n    consumeRateLimit(key) {\n        const now = Date.now();\n        const keyStr = String(key);\n        let bucket = this._buckets[keyStr];\n        if (bucket) this._applyRefill(bucket, now);\n        else {\n            bucket = {\n                tokens: this._bucketSize,\n                lastAccess: now\n            };\n            this._buckets[keyStr] = bucket;\n        }\n        if (0 === bucket.tokens) return true;\n        bucket.tokens--;\n        if (0 === bucket.tokens) this._onBucketRateLimited?.(key);\n        return 0 === bucket.tokens;\n    }\n    stop() {\n        this._buckets = {};\n    }\n}\nexport { BucketedRateLimiter };\n","import { includes } from \"./string-utils.mjs\";\nimport { isFunction, isUndefined } from \"./type-utils.mjs\";\nconst FACEBOOK = 'Facebook';\nconst MOBILE = 'Mobile';\nconst IOS = 'iOS';\nconst ANDROID = 'Android';\nconst TABLET = 'Tablet';\nconst ANDROID_TABLET = ANDROID + ' ' + TABLET;\nconst IPAD = 'iPad';\nconst APPLE = 'Apple';\nconst APPLE_WATCH = APPLE + ' Watch';\nconst SAFARI = 'Safari';\nconst BLACKBERRY = 'BlackBerry';\nconst SAMSUNG = 'Samsung';\nconst SAMSUNG_BROWSER = SAMSUNG + 'Browser';\nconst SAMSUNG_INTERNET = SAMSUNG + ' Internet';\nconst CHROME = 'Chrome';\nconst CHROME_OS = CHROME + ' OS';\nconst CHROME_IOS = CHROME + ' ' + IOS;\nconst INTERNET_EXPLORER = 'Internet Explorer';\nconst INTERNET_EXPLORER_MOBILE = INTERNET_EXPLORER + ' ' + MOBILE;\nconst OPERA = 'Opera';\nconst OPERA_MINI = OPERA + ' Mini';\nconst EDGE = 'Edge';\nconst MICROSOFT_EDGE = 'Microsoft ' + EDGE;\nconst FIREFOX = 'Firefox';\nconst FIREFOX_IOS = FIREFOX + ' ' + IOS;\nconst NINTENDO = 'Nintendo';\nconst PLAYSTATION = 'PlayStation';\nconst XBOX = 'Xbox';\nconst ANDROID_MOBILE = ANDROID + ' ' + MOBILE;\nconst MOBILE_SAFARI = MOBILE + ' ' + SAFARI;\nconst WINDOWS = 'Windows';\nconst WINDOWS_PHONE = WINDOWS + ' Phone';\nconst NOKIA = 'Nokia';\nconst OUYA = 'Ouya';\nconst GENERIC = 'Generic';\nconst GENERIC_MOBILE = GENERIC + ' ' + MOBILE.toLowerCase();\nconst GENERIC_TABLET = GENERIC + ' ' + TABLET.toLowerCase();\nconst KONQUEROR = 'Konqueror';\nconst BROWSER_VERSION_REGEX_SUFFIX = '(\\\\d+(\\\\.\\\\d+)?)';\nconst DEFAULT_BROWSER_VERSION_REGEX = new RegExp('Version/' + BROWSER_VERSION_REGEX_SUFFIX);\nconst XBOX_REGEX = new RegExp(XBOX, 'i');\nconst PLAYSTATION_REGEX = new RegExp(PLAYSTATION + ' \\\\w+', 'i');\nconst NINTENDO_REGEX = new RegExp(NINTENDO + ' \\\\w+', 'i');\nconst BLACKBERRY_REGEX = new RegExp(BLACKBERRY + '|PlayBook|BB10', 'i');\nconst windowsVersionMap = {\n    'NT3.51': 'NT 3.11',\n    'NT4.0': 'NT 4.0',\n    '5.0': '2000',\n    '5.1': 'XP',\n    '5.2': 'XP',\n    '6.0': 'Vista',\n    '6.1': '7',\n    '6.2': '8',\n    '6.3': '8.1',\n    '6.4': '10',\n    '10.0': '10'\n};\nfunction isSafari(userAgent) {\n    return includes(userAgent, SAFARI) && !includes(userAgent, CHROME) && !includes(userAgent, ANDROID);\n}\nconst safariCheck = (ua, vendor)=>vendor && includes(vendor, APPLE) || isSafari(ua);\nconst detectBrowser = function(user_agent, vendor) {\n    vendor = vendor || '';\n    if (includes(user_agent, ' OPR/') && includes(user_agent, 'Mini')) return OPERA_MINI;\n    if (includes(user_agent, ' OPR/')) return OPERA;\n    if (BLACKBERRY_REGEX.test(user_agent)) return BLACKBERRY;\n    if (includes(user_agent, 'IE' + MOBILE) || includes(user_agent, 'WPDesktop')) return INTERNET_EXPLORER_MOBILE;\n    if (includes(user_agent, SAMSUNG_BROWSER)) return SAMSUNG_INTERNET;\n    else if (includes(user_agent, EDGE) || includes(user_agent, 'Edg/')) return MICROSOFT_EDGE;\n    else if (includes(user_agent, 'FBIOS')) return FACEBOOK + ' ' + MOBILE;\n    else if (includes(user_agent, 'UCWEB') || includes(user_agent, 'UCBrowser')) return 'UC Browser';\n    else if (includes(user_agent, 'CriOS')) return CHROME_IOS;\n    else if (includes(user_agent, 'CrMo')) return CHROME;\n    else if (includes(user_agent, CHROME)) return CHROME;\n    else if (includes(user_agent, ANDROID) && includes(user_agent, SAFARI)) return ANDROID_MOBILE;\n    else if (includes(user_agent, 'FxiOS')) return FIREFOX_IOS;\n    else if (includes(user_agent.toLowerCase(), KONQUEROR.toLowerCase())) return KONQUEROR;\n    else if (safariCheck(user_agent, vendor)) return includes(user_agent, MOBILE) ? MOBILE_SAFARI : SAFARI;\n    else if (includes(user_agent, FIREFOX)) return FIREFOX;\n    else if (includes(user_agent, 'MSIE') || includes(user_agent, 'Trident/')) return INTERNET_EXPLORER;\n    else if (includes(user_agent, 'Gecko')) return FIREFOX;\n    return '';\n};\nconst versionRegexes = {\n    [INTERNET_EXPLORER_MOBILE]: [\n        new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [MICROSOFT_EDGE]: [\n        new RegExp(EDGE + '?\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [CHROME]: [\n        new RegExp('(' + CHROME + '|CrMo)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [CHROME_IOS]: [\n        new RegExp('CriOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    'UC Browser': [\n        new RegExp('(UCBrowser|UCWEB)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [SAFARI]: [\n        DEFAULT_BROWSER_VERSION_REGEX\n    ],\n    [MOBILE_SAFARI]: [\n        DEFAULT_BROWSER_VERSION_REGEX\n    ],\n    [OPERA]: [\n        new RegExp('(' + OPERA + '|OPR)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [FIREFOX]: [\n        new RegExp(FIREFOX + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [FIREFOX_IOS]: [\n        new RegExp('FxiOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [KONQUEROR]: [\n        new RegExp('Konqueror[:/]?' + BROWSER_VERSION_REGEX_SUFFIX, 'i')\n    ],\n    [BLACKBERRY]: [\n        new RegExp(BLACKBERRY + ' ' + BROWSER_VERSION_REGEX_SUFFIX),\n        DEFAULT_BROWSER_VERSION_REGEX\n    ],\n    [ANDROID_MOBILE]: [\n        new RegExp('android\\\\s' + BROWSER_VERSION_REGEX_SUFFIX, 'i')\n    ],\n    [SAMSUNG_INTERNET]: [\n        new RegExp(SAMSUNG_BROWSER + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    [INTERNET_EXPLORER]: [\n        new RegExp('(rv:|MSIE )' + BROWSER_VERSION_REGEX_SUFFIX)\n    ],\n    Mozilla: [\n        new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)\n    ]\n};\nconst detectBrowserVersion = function(userAgent, vendor) {\n    const browser = detectBrowser(userAgent, vendor);\n    const regexes = versionRegexes[browser];\n    if (isUndefined(regexes)) return null;\n    for(let i = 0; i < regexes.length; i++){\n        const regex = regexes[i];\n        const matches = userAgent.match(regex);\n        if (matches) return parseFloat(matches[matches.length - 2]);\n    }\n    return null;\n};\nconst osMatchers = [\n    [\n        new RegExp(XBOX + '; ' + XBOX + ' (.*?)[);]', 'i'),\n        (match)=>[\n                XBOX,\n                match && match[1] || ''\n            ]\n    ],\n    [\n        new RegExp(NINTENDO, 'i'),\n        [\n            NINTENDO,\n            ''\n        ]\n    ],\n    [\n        new RegExp(PLAYSTATION, 'i'),\n        [\n            PLAYSTATION,\n            ''\n        ]\n    ],\n    [\n        BLACKBERRY_REGEX,\n        [\n            BLACKBERRY,\n            ''\n        ]\n    ],\n    [\n        new RegExp(WINDOWS, 'i'),\n        (_, user_agent)=>{\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) return [\n                WINDOWS_PHONE,\n                ''\n            ];\n            if (new RegExp(MOBILE).test(user_agent) && !/IEMobile\\b/.test(user_agent)) return [\n                WINDOWS + ' ' + MOBILE,\n                ''\n            ];\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent);\n            if (match && match[1]) {\n                const version = match[1];\n                let osVersion = windowsVersionMap[version] || '';\n                if (/arm/i.test(user_agent)) osVersion = 'RT';\n                return [\n                    WINDOWS,\n                    osVersion\n                ];\n            }\n            return [\n                WINDOWS,\n                ''\n            ];\n        }\n    ],\n    [\n        /((iPhone|iPad|iPod).*?OS (\\d+)_(\\d+)_?(\\d+)?|iPhone)/,\n        (match)=>{\n            if (match && match[3]) {\n                const versionParts = [\n                    match[3],\n                    match[4],\n                    match[5] || '0'\n                ];\n                return [\n                    IOS,\n                    versionParts.join('.')\n                ];\n            }\n            return [\n                IOS,\n                ''\n            ];\n        }\n    ],\n    [\n        /(watch.*\\/(\\d+\\.\\d+\\.\\d+)|watch os,(\\d+\\.\\d+),)/i,\n        (match)=>{\n            let version = '';\n            if (match && match.length >= 3) version = isUndefined(match[2]) ? match[3] : match[2];\n            return [\n                'watchOS',\n                version\n            ];\n        }\n    ],\n    [\n        new RegExp('(' + ANDROID + ' (\\\\d+)\\\\.(\\\\d+)\\\\.?(\\\\d+)?|' + ANDROID + ')', 'i'),\n        (match)=>{\n            if (match && match[2]) {\n                const versionParts = [\n                    match[2],\n                    match[3],\n                    match[4] || '0'\n                ];\n                return [\n                    ANDROID,\n                    versionParts.join('.')\n                ];\n            }\n            return [\n                ANDROID,\n                ''\n            ];\n        }\n    ],\n    [\n        /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i,\n        (match)=>{\n            const result = [\n                'Mac OS X',\n                ''\n            ];\n            if (match && match[1]) {\n                const versionParts = [\n                    match[1],\n                    match[2],\n                    match[3] || '0'\n                ];\n                result[1] = versionParts.join('.');\n            }\n            return result;\n        }\n    ],\n    [\n        /Mac/i,\n        [\n            'Mac OS X',\n            ''\n        ]\n    ],\n    [\n        /CrOS/,\n        [\n            CHROME_OS,\n            ''\n        ]\n    ],\n    [\n        /Linux|debian/i,\n        [\n            'Linux',\n            ''\n        ]\n    ]\n];\nconst detectOS = function(user_agent) {\n    for(let i = 0; i < osMatchers.length; i++){\n        const [rgex, resultOrFn] = osMatchers[i];\n        const match = rgex.exec(user_agent);\n        const result = match && (isFunction(resultOrFn) ? resultOrFn(match, user_agent) : resultOrFn);\n        if (result) return result;\n    }\n    return [\n        '',\n        ''\n    ];\n};\nconst detectDevice = function(user_agent) {\n    if (NINTENDO_REGEX.test(user_agent)) return NINTENDO;\n    if (PLAYSTATION_REGEX.test(user_agent)) return PLAYSTATION;\n    if (XBOX_REGEX.test(user_agent)) return XBOX;\n    if (new RegExp(OUYA, 'i').test(user_agent)) return OUYA;\n    if (new RegExp('(' + WINDOWS_PHONE + '|WPDesktop)', 'i').test(user_agent)) return WINDOWS_PHONE;\n    else if (/iPad/.test(user_agent)) return IPAD;\n    else if (/iPod/.test(user_agent)) return 'iPod Touch';\n    else if (/iPhone/.test(user_agent)) return 'iPhone';\n    else if (/(watch)(?: ?os[,/]|\\d,\\d\\/)[\\d.]+/i.test(user_agent)) return APPLE_WATCH;\n    else if (BLACKBERRY_REGEX.test(user_agent)) return BLACKBERRY;\n    else if (/(kobo)\\s(ereader|touch)/i.test(user_agent)) return 'Kobo';\n    else if (new RegExp(NOKIA, 'i').test(user_agent)) return NOKIA;\n    else if (/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\\))/i.test(user_agent) || /(kf[a-z]+)( bui|\\)).+silk\\//i.test(user_agent)) return 'Kindle Fire';\n    else if (/(Android|ZTE)/i.test(user_agent)) if (!(!new RegExp(MOBILE).test(user_agent) || /(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(user_agent))) return ANDROID;\n    else {\n        if (/pixel[\\daxl ]{1,6}/i.test(user_agent) && !/pixel c/i.test(user_agent) || /(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(user_agent) || /lmy47v/i.test(user_agent) && !/QTAQZ3/i.test(user_agent)) return ANDROID;\n        return ANDROID_TABLET;\n    }\n    else if (new RegExp('(pda|' + MOBILE + ')', 'i').test(user_agent)) return GENERIC_MOBILE;\n    else if (new RegExp(TABLET, 'i').test(user_agent) && !new RegExp(TABLET + ' pc', 'i').test(user_agent)) return GENERIC_TABLET;\n    else return '';\n};\nconst detectDeviceType = function(user_agent) {\n    const device = detectDevice(user_agent);\n    if (device === IPAD || device === ANDROID_TABLET || 'Kobo' === device || 'Kindle Fire' === device || device === GENERIC_TABLET) return TABLET;\n    if (device === NINTENDO || device === XBOX || device === PLAYSTATION || device === OUYA) return 'Console';\n    if (device === APPLE_WATCH) return 'Wearable';\n    if (device) return MOBILE;\n    return 'Desktop';\n};\nexport { detectBrowser, detectBrowserVersion, detectDevice, detectDeviceType, detectOS };\n","import Config from '../config'\nimport { isUndefined } from '@posthog/core'\nimport { assignableWindow, window } from './globals'\nimport type { Logger } from '@posthog/core'\n\ntype CreateLoggerOptions = {\n    debugEnabled?: boolean\n}\n\ntype PosthogJsLogger = Omit<Logger, 'createLogger'> & {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => void\n    uninitializedWarning: (methodName: string) => void\n    createLogger: (prefix: string, options?: CreateLoggerOptions) => PosthogJsLogger\n}\n\nconst _createLogger = (prefix: string, { debugEnabled }: CreateLoggerOptions = {}): PosthogJsLogger => {\n    const logger: PosthogJsLogger = {\n        _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n            if (\n                window &&\n                (Config.DEBUG || assignableWindow.POSTHOG_DEBUG || debugEnabled) &&\n                !isUndefined(window.console) &&\n                window.console\n            ) {\n                const consoleLog =\n                    '__rrweb_original__' in window.console[level]\n                        ? (window.console[level] as any)['__rrweb_original__']\n                        : window.console[level]\n\n                // eslint-disable-next-line no-console\n                consoleLog(prefix, ...args)\n            }\n        },\n\n        info: (...args: any[]) => {\n            logger._log('log', ...args)\n        },\n\n        warn: (...args: any[]) => {\n            logger._log('warn', ...args)\n        },\n\n        error: (...args: any[]) => {\n            logger._log('error', ...args)\n        },\n\n        critical: (...args: any[]) => {\n            // Critical errors are always logged to the console\n            // eslint-disable-next-line no-console\n            console.error(prefix, ...args)\n        },\n\n        uninitializedWarning: (methodName: string) => {\n            logger.error(`You must initialize PostHog before calling ${methodName}`)\n        },\n\n        createLogger: (additionalPrefix: string, options?: CreateLoggerOptions) =>\n            _createLogger(`${prefix} ${additionalPrefix}`, options),\n    }\n    return logger\n}\n\nexport const logger = _createLogger('[PostHog.js]')\n\nexport const createLogger = logger.createLogger\n","import { Breaker, Properties } from '../types'\nimport { nativeForEach, nativeIndexOf } from './globals'\nimport { logger } from './logger'\nimport { isFormData, isNull, isNullish, isNumber, isString, hasOwnProperty, isArray } from '@posthog/core'\n\nconst breaker: Breaker = {}\n\nexport function eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (isNullish(obj)) {\n        return\n    }\n    if (isArray(obj)) {\n        return eachArray(obj, iterator, thisArg)\n    }\n    if (isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const extendArray = function <T>(obj: T[], ...args: T[][]): T[] {\n    eachArray(args, function (source) {\n        eachArray(source, function (item) {\n            obj.push(item)\n        })\n    })\n    return obj\n}\n\nexport const include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const trySafe = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch {\n        return undefined\n    }\n}\n\nexport const safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport const safewrapClass = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const stripEmptyProperties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    each(p, function (v, k) {\n        if ((isString(v) && v.length > 0) || isNumber(v)) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (isArray(value)) {\n            result = [] as any as T\n            eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (isString(value) && !isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\n// NOTE: Update PostHogConfig docs if you change this list\n// We will not try to catch all bullets here, but we should make an effort to catch the most common ones\n// You should be highly against adding more to this list, because ultimately customers can configure\n// their `cross_subdomain_cookie` setting to anything they want.\nconst EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE = ['herokuapp.com', 'vercel.app', 'netlify.app']\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    const lastTwoParts = hostname.split('.').slice(-2).join('.')\n\n    for (const excluded of EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE) {\n        if (lastTwoParts === excluded) {\n            return false\n        }\n    }\n\n    return true\n}\n\nexport function find<T>(value: T[], predicate: (value: T) => boolean): T | undefined {\n    for (let i = 0; i < value.length; i++) {\n        if (predicate(value[i])) {\n            return value[i]\n        }\n    }\n    return undefined\n}\n\n// Use this instead of element.addEventListener to avoid eslint errors\n// this properly implements the default options for passive event listeners\nexport function addEventListener(\n    element: Window | Document | Element | undefined,\n    event: string,\n    callback: EventListener,\n    options?: AddEventListenerOptions\n): void {\n    const { capture = false, passive = true } = options ?? {}\n\n    // This is the only place where we are allowed to call this function\n    // because the whole idea is that we should be calling this instead of the built-in one\n    // eslint-disable-next-line posthog-js/no-add-event-listener\n    element?.addEventListener(event, callback, { capture, passive })\n}\n\n/**\n * Helper to migrate deprecated config fields to new field names with appropriate warnings\n * @param config - The config object to check\n * @param newField - The new field name to use\n * @param oldField - The deprecated field name to check for\n * @param defaultValue - The default value if neither field is set\n * @param loggerInstance - Optional logger instance for deprecation warnings\n * @returns The value to use (new field takes precedence over old field)\n */\nexport function migrateConfigField<T>(\n    config: Record<string, any>,\n    newField: string,\n    oldField: string,\n    defaultValue: T,\n    loggerInstance?: { warn: (message: string) => void }\n): T {\n    const hasNewField = newField in config && !isNullish(config[newField])\n    const hasOldField = oldField in config && !isNullish(config[oldField])\n\n    if (hasNewField) {\n        return config[newField]\n    }\n\n    if (hasOldField) {\n        if (loggerInstance) {\n            loggerInstance.warn(\n                `Config field '${oldField}' is deprecated. Please use '${newField}' instead. ` +\n                    `The old field will be removed in a future major version.`\n            )\n        }\n        return config[oldField]\n    }\n\n    return defaultValue\n}\n","import { each } from './'\n\nimport { isArray, isFile, isUndefined } from '@posthog/core'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (isUndefined(val) || isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\n// NOTE: Once we get rid of IE11/op_mini we can start using URLSearchParams\nexport const getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n\n    // Split only on the first ? to sort problem out for those with multiple ?s\n    // and then remove them\n    const queryParams: string = withoutHash.split(/\\?(.*)/)[1] || ''\n    const cleanedQueryParams = queryParams.replace(/^\\?+/g, '')\n\n    const queryParts = cleanedQueryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\n// replace any query params in the url with the provided mask value. Tries to keep the URL as instant as possible,\n// including preserving malformed text in most cases\nexport const maskQueryParams = function <T extends string | undefined>(\n    url: T,\n    maskedParams: string[] | undefined,\n    mask: string\n): T extends string ? string : undefined {\n    if (!url || !maskedParams || !maskedParams.length) {\n        return url as any\n    }\n\n    const splitHash = url.split('#')\n    const withoutHash: string = splitHash[0] || ''\n    const hash = splitHash[1]\n\n    const splitQuery: string[] = withoutHash.split('?')\n    const queryString: string = splitQuery[1]\n    const urlWithoutQueryAndHash: string = splitQuery[0]\n    const queryParts = (queryString || '').split('&')\n\n    // use an array of strings rather than an object to preserve ordering and duplicates\n    const paramStrings: string[] = []\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const keyValuePair = queryParts[i].split('=')\n        if (!isArray(keyValuePair)) {\n            continue\n        } else if (maskedParams.includes(keyValuePair[0])) {\n            paramStrings.push(keyValuePair[0] + '=' + mask)\n        } else {\n            paramStrings.push(queryParts[i])\n        }\n    }\n\n    let result = urlWithoutQueryAndHash\n    if (queryString != null) {\n        result += '?' + paramStrings.join('&')\n    }\n    if (hash != null) {\n        result += '#' + hash\n    }\n\n    return result as any\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nimport { window } from './utils/globals'\n\nimport { isNumber, isUndefined } from '@posthog/core'\n\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return isNumber(value) && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private _timestamp = 0\n    private _counter = 0\n    private readonly _random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (!isUndefined(value)) {\n            return value\n        } else {\n            // reset state and resume\n            this._timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (isUndefined(valueAfterReset)) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this._timestamp) {\n            this._timestamp = ts\n            this._resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this._timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this._counter++\n            if (this._counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this._timestamp++\n                this._resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this._timestamp,\n            Math.trunc(this._counter / 2 ** 30),\n            this._counter & (2 ** 30 - 1),\n            this._random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private _resetCounter(): void {\n        this._counter = this._random.nextUint32() * 0x400 + (this._random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    // TRICKY: don't use the isUndefined method here as can't pass the reference\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (window && !isUndefined(window.crypto) && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly _buffer = new Uint32Array(8)\n    private _cursor = Infinity\n    nextUint32(): number {\n        if (this._cursor >= this._buffer.length) {\n            getRandomValues(this._buffer)\n            this._cursor = 0\n        }\n        return this._buffer[this._cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n\nexport const uuid7ToTimestampMs = (uuid: string): number => {\n    // remove hyphens\n    const hex = uuid.replace(/-/g, '')\n    // ensure that it's a version 7 UUID\n    if (hex.length !== 32) {\n        throw new Error('Not a valid UUID')\n    }\n    if (hex[12] !== '7') {\n        throw new Error('Not a UUIDv7')\n    }\n    // the first 6 bytes are the timestamp, which means that we can read only the first 12 hex characters\n    return parseInt(hex.substring(0, 12), 16)\n}\n","import { extend } from './utils'\nimport { PersistentStore, Properties } from './types'\nimport {\n    DEVICE_ID,\n    DISTINCT_ID,\n    ENABLE_PERSON_PROCESSING,\n    INITIAL_PERSON_INFO,\n    SESSION_ID,\n    SESSION_RECORDING_IS_SAMPLED,\n} from './constants'\n\nimport { isNull, isUndefined } from '@posthog/core'\nimport { logger } from './utils/logger'\nimport { window, document } from './utils/globals'\nimport { uuidv7 } from './uuidv7'\n\n// we store the discovered subdomain in memory because it might be read multiple times\nlet firstNonPublicSubDomain = ''\n\n// helper to allow tests to clear this \"cache\"\nexport const resetSubDomainCache = () => {\n    firstNonPublicSubDomain = ''\n}\n\n/**\n * Browsers don't offer a way to check if something is a public suffix\n * e.g. `.com.au`, `.io`, `.org.uk`\n *\n * But they do reject cookies set on public suffixes\n * Setting a cookie on `.co.uk` would mean it was sent for every `.co.uk` site visited\n *\n * So, we can use this to check if a domain is a public suffix\n * by trying to set a cookie on a subdomain of the provided hostname\n * until the browser accepts it\n *\n * inspired by https://github.com/AngusFu/browser-root-domain\n */\nexport function seekFirstNonPublicSubDomain(hostname: string, cookieJar = document): string {\n    if (firstNonPublicSubDomain) {\n        return firstNonPublicSubDomain\n    }\n\n    if (!cookieJar) {\n        return ''\n    }\n    if (['localhost', '127.0.0.1'].includes(hostname)) return ''\n\n    const list = hostname.split('.')\n    let len = Math.min(list.length, 8) // paranoia - we know this number should be small\n    const key = 'dmn_chk_' + uuidv7()\n\n    while (!firstNonPublicSubDomain && len--) {\n        const candidate = list.slice(len).join('.')\n        const candidateCookieValue = key + '=1;domain=.' + candidate + ';path=/'\n\n        // try to set cookie, include a short expiry in seconds since we'll check immediately\n        cookieJar.cookie = candidateCookieValue + ';max-age=3'\n\n        if (cookieJar.cookie.includes(key)) {\n            // the cookie was accepted by the browser, remove the test cookie\n            cookieJar.cookie = candidateCookieValue + ';max-age=0'\n            firstNonPublicSubDomain = candidate\n        }\n    }\n\n    return firstNonPublicSubDomain\n}\n\nconst DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z]{2,}$/i\nconst originalCookieDomainFn = (hostname: string): string => {\n    const matches = hostname.match(DOMAIN_MATCH_REGEX)\n    return matches ? matches[0] : ''\n}\n\nexport function chooseCookieDomain(hostname: string, cross_subdomain: boolean | undefined): string {\n    if (cross_subdomain) {\n        // NOTE: Could we use this for cross domain tracking?\n        let matchedSubDomain = seekFirstNonPublicSubDomain(hostname)\n\n        if (!matchedSubDomain) {\n            const originalMatch = originalCookieDomainFn(hostname)\n            if (originalMatch !== matchedSubDomain) {\n                logger.info('Warning: cookie subdomain discovery mismatch', originalMatch, matchedSubDomain)\n            }\n            matchedSubDomain = originalMatch\n        }\n\n        return matchedSubDomain ? '; domain=.' + matchedSubDomain : ''\n    }\n    return ''\n}\n\n// Methods partially borrowed from quirksmode.org/js/cookies.html\nexport const cookieStore: PersistentStore = {\n    _is_supported: () => !!document,\n\n    _error: function (msg) {\n        logger.error('cookieStore error: ' + msg)\n    },\n\n    _get: function (name) {\n        if (!document) {\n            return\n        }\n\n        try {\n            const nameEQ = name + '='\n            const ca = document.cookie.split(';').filter((x) => x.length)\n            for (let i = 0; i < ca.length; i++) {\n                let c = ca[i]\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length)\n                }\n                if (c.indexOf(nameEQ) === 0) {\n                    return decodeURIComponent(c.substring(nameEQ.length, c.length))\n                }\n            }\n        } catch {}\n        return null\n    },\n\n    _parse: function (name) {\n        let cookie\n        try {\n            cookie = JSON.parse(cookieStore._get(name)) || {}\n        } catch {\n            // noop\n        }\n        return cookie\n    },\n\n    _set: function (name, value, days, cross_subdomain, is_secure) {\n        if (!document) {\n            return\n        }\n        try {\n            let expires = '',\n                secure = ''\n\n            const cdomain = chooseCookieDomain(document.location.hostname, cross_subdomain)\n\n            if (days) {\n                const date = new Date()\n                date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)\n                expires = '; expires=' + date.toUTCString()\n            }\n\n            if (is_secure) {\n                secure = '; secure'\n            }\n\n            const new_cookie_val =\n                name +\n                '=' +\n                encodeURIComponent(JSON.stringify(value)) +\n                expires +\n                '; SameSite=Lax; path=/' +\n                cdomain +\n                secure\n\n            // 4096 bytes is the size at which some browsers (e.g. firefox) will not store a cookie, warn slightly before that\n            if (new_cookie_val.length > 4096 * 0.9) {\n                logger.warn('cookieStore warning: large cookie, len=' + new_cookie_val.length)\n            }\n\n            document.cookie = new_cookie_val\n            return new_cookie_val\n        } catch {\n            return\n        }\n    },\n\n    _remove: function (name, cross_subdomain) {\n        if (!document?.cookie) {\n            return\n        }\n        try {\n            cookieStore._set(name, '', -1, cross_subdomain)\n        } catch {\n            return\n        }\n    },\n}\n\nlet _localStorage_supported: boolean | null = null\nexport const resetLocalStorageSupported = () => {\n    _localStorage_supported = null\n}\n\nexport const localStore: PersistentStore = {\n    _is_supported: function () {\n        if (!isNull(_localStorage_supported)) {\n            return _localStorage_supported\n        }\n\n        let supported = true\n        if (!isUndefined(window)) {\n            try {\n                const key = '__mplssupport__',\n                    val = 'xyz'\n                localStore._set(key, val)\n                if (localStore._get(key) !== '\"xyz\"') {\n                    supported = false\n                }\n                localStore._remove(key)\n            } catch {\n                supported = false\n            }\n        } else {\n            supported = false\n        }\n        if (!supported) {\n            logger.error('localStorage unsupported; falling back to cookie store')\n        }\n\n        _localStorage_supported = supported\n        return supported\n    },\n\n    _error: function (msg) {\n        logger.error('localStorage error: ' + msg)\n    },\n\n    _get: function (name) {\n        try {\n            return window?.localStorage.getItem(name)\n        } catch (err) {\n            localStore._error(err)\n        }\n        return null\n    },\n\n    _parse: function (name) {\n        try {\n            return JSON.parse(localStore._get(name)) || {}\n        } catch {\n            // noop\n        }\n        return null\n    },\n\n    _set: function (name, value) {\n        try {\n            window?.localStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            localStore._error(err)\n        }\n    },\n\n    _remove: function (name) {\n        try {\n            window?.localStorage.removeItem(name)\n        } catch (err) {\n            localStore._error(err)\n        }\n    },\n}\n\n// Use localstorage for most data but still use cookie for COOKIE_PERSISTED_PROPERTIES\n// This solves issues with cookies having too much data in them causing headers too large\n// Also makes sure we don't have to send a ton of data to the server\nconst COOKIE_PERSISTED_PROPERTIES = [\n    DEVICE_ID,\n    DISTINCT_ID,\n    SESSION_ID,\n    SESSION_RECORDING_IS_SAMPLED,\n    ENABLE_PERSON_PROCESSING,\n    INITIAL_PERSON_INFO,\n]\n\n/**\n * Creates a localPlusCookieStore instance with custom cookie-persisted properties\n */\nexport const createLocalPlusCookieStore = (customCookieProperties: readonly string[] = []): PersistentStore => {\n    const cookiePropertiesToPersist = [...COOKIE_PERSISTED_PROPERTIES, ...customCookieProperties]\n\n    return {\n        ...localStore,\n        _parse: function (name) {\n            try {\n                let cookieProperties: Properties = {}\n                try {\n                    // See if there's a cookie stored with data.\n                    cookieProperties = cookieStore._parse(name) || {}\n                } catch {}\n                const value = extend(cookieProperties, JSON.parse(localStore._get(name) || '{}'))\n                localStore._set(name, value)\n                return value\n            } catch {\n                // noop\n            }\n            return null\n        },\n\n        _set: function (name, value, days, cross_subdomain, is_secure, debug) {\n            try {\n                localStore._set(name, value, undefined, undefined, debug)\n                const cookiePersistedProperties: Record<string, any> = {}\n                cookiePropertiesToPersist.forEach((key) => {\n                    if (value[key]) {\n                        cookiePersistedProperties[key] = value[key]\n                    }\n                })\n\n                if (Object.keys(cookiePersistedProperties).length) {\n                    cookieStore._set(name, cookiePersistedProperties, days, cross_subdomain, is_secure, debug)\n                }\n            } catch (err) {\n                localStore._error(err)\n            }\n        },\n\n        _remove: function (name, cross_subdomain) {\n            try {\n                window?.localStorage.removeItem(name)\n                cookieStore._remove(name, cross_subdomain)\n            } catch (err) {\n                localStore._error(err)\n            }\n        },\n    }\n}\n\nconst memoryStorage: Properties = {}\n\n// Storage that only lasts the length of the pageview if we don't want to use cookies\nexport const memoryStore: PersistentStore = {\n    _is_supported: function () {\n        return true\n    },\n\n    _error: function (msg) {\n        logger.error('memoryStorage error: ' + msg)\n    },\n\n    _get: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    _parse: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    _set: function (name, value) {\n        memoryStorage[name] = value\n    },\n\n    _remove: function (name) {\n        delete memoryStorage[name]\n    },\n}\n\nlet sessionStorageSupported: boolean | null = null\nexport const resetSessionStorageSupported = () => {\n    sessionStorageSupported = null\n}\n// Storage that only lasts the length of a tab/window. Survives page refreshes\nexport const sessionStore: PersistentStore = {\n    _is_supported: function () {\n        if (!isNull(sessionStorageSupported)) {\n            return sessionStorageSupported\n        }\n        sessionStorageSupported = true\n        if (!isUndefined(window)) {\n            try {\n                const key = '__support__',\n                    val = 'xyz'\n                sessionStore._set(key, val)\n                if (sessionStore._get(key) !== '\"xyz\"') {\n                    sessionStorageSupported = false\n                }\n                sessionStore._remove(key)\n            } catch {\n                sessionStorageSupported = false\n            }\n        } else {\n            sessionStorageSupported = false\n        }\n        return sessionStorageSupported\n    },\n\n    _error: function (msg) {\n        logger.error('sessionStorage error: ', msg)\n    },\n\n    _get: function (name) {\n        try {\n            return window?.sessionStorage.getItem(name)\n        } catch (err) {\n            sessionStore._error(err)\n        }\n        return null\n    },\n\n    _parse: function (name) {\n        try {\n            return JSON.parse(sessionStore._get(name)) || null\n        } catch {\n            // noop\n        }\n        return null\n    },\n\n    _set: function (name, value) {\n        try {\n            window?.sessionStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            sessionStore._error(err)\n        }\n    },\n\n    _remove: function (name) {\n        try {\n            window?.sessionStorage.removeItem(name)\n        } catch (err) {\n            sessionStore._error(err)\n        }\n    },\n}\n","import { convertToURL, getQueryParam, maskQueryParams } from './request-utils'\nimport { isNull, stripLeadingDollar } from '@posthog/core'\nimport { Properties } from '../types'\nimport Config from '../config'\nimport { each, extend, extendArray, stripEmptyProperties } from './index'\nimport { document, location, userAgent, window } from './globals'\nimport { detectBrowser, detectBrowserVersion, detectDevice, detectDeviceType, detectOS } from '@posthog/core'\nimport { cookieStore } from '../storage'\n\nconst URL_REGEX_PREFIX = 'https?://(.*)'\n\n// CAMPAIGN_PARAMS and EVENT_TO_PERSON_PROPERTIES should be kept in sync with\n// https://github.com/PostHog/posthog/blob/master/plugin-server/src/utils/db/utils.ts#L60\n\n// The list of campaign parameters that could be considered personal data under e.g. GDPR.\n// These can be masked in URLs and properties before being sent to posthog.\nexport const PERSONAL_DATA_CAMPAIGN_PARAMS = [\n    'gclid', // google ads\n    'gclsrc', // google ads 360\n    'dclid', // google display ads\n    'gbraid', // google ads, web to app\n    'wbraid', // google ads, app to web\n    'fbclid', // facebook\n    'msclkid', // microsoft\n    'twclid', // twitter\n    'li_fat_id', // linkedin\n    'igshid', // instagram\n    'ttclid', // tiktok\n    'rdt_cid', // reddit\n    'epik', // pinterest\n    'qclid', // quora\n    'sccid', // snapchat\n    'irclid', // impact\n    '_kx', // klaviyo\n]\n\nexport const CAMPAIGN_PARAMS = extendArray(\n    [\n        'utm_source',\n        'utm_medium',\n        'utm_campaign',\n        'utm_content',\n        'utm_term',\n        'gad_source', // google ads source\n        'mc_cid', // mailchimp campaign id\n    ],\n    PERSONAL_DATA_CAMPAIGN_PARAMS\n)\n\nexport const EVENT_TO_PERSON_PROPERTIES = [\n    // mobile params\n    '$app_build',\n    '$app_name',\n    '$app_namespace',\n    '$app_version',\n    // web params\n    '$browser',\n    '$browser_version',\n    '$device_type',\n    '$current_url',\n    '$pathname',\n    '$os',\n    '$os_name', // $os_name is a special case, it's treated as an alias of $os!\n    '$os_version',\n    '$referring_domain',\n    '$referrer',\n    '$screen_height',\n    '$screen_width',\n    '$viewport_height',\n    '$viewport_width',\n    '$raw_user_agent',\n]\n\nexport const MASKED = '<masked>'\n\n// Campaign params that can be read from the cookie store\nexport const COOKIE_CAMPAIGN_PARAMS = [\n    'li_fat_id', // linkedin\n]\n\nexport function getCampaignParams(\n    customTrackedParams?: string[],\n    maskPersonalDataProperties?: boolean,\n    customPersonalDataProperties?: string[] | undefined\n): Record<string, string> {\n    if (!document) {\n        return {}\n    }\n\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n\n    // Initially get campaign params from the URL\n    const urlCampaignParams = _getCampaignParamsFromUrl(\n        maskQueryParams(document.URL, paramsToMask, MASKED),\n        customTrackedParams\n    )\n\n    // But we can also get some of them from the cookie store\n    // For example: https://learn.microsoft.com/en-us/linkedin/marketing/conversions/enabling-first-party-cookies?view=li-lms-2025-05#reading-li_fat_id-from-cookies\n    const cookieCampaignParams = _getCampaignParamsFromCookie()\n\n    // Prefer the values found in the urlCampaignParams if possible\n    // `extend` will override the values if found in the second argument\n    return extend(cookieCampaignParams, urlCampaignParams)\n}\n\nfunction _getCampaignParamsFromUrl(url: string, customParams?: string[]): Record<string, string> {\n    const campaign_keywords = CAMPAIGN_PARAMS.concat(customParams || [])\n\n    const params: Record<string, any> = {}\n    each(campaign_keywords, function (kwkey) {\n        const kw = getQueryParam(url, kwkey)\n        params[kwkey] = kw ? kw : null\n    })\n\n    return params\n}\n\nfunction _getCampaignParamsFromCookie(): Record<string, string> {\n    const params: Record<string, any> = {}\n    each(COOKIE_CAMPAIGN_PARAMS, function (kwkey) {\n        const kw = cookieStore._get(kwkey)\n        params[kwkey] = kw ? kw : null\n    })\n\n    return params\n}\n\nfunction _getSearchEngine(referrer: string): string | null {\n    if (!referrer) {\n        return null\n    } else {\n        if (referrer.search(URL_REGEX_PREFIX + 'google.([^/?]*)') === 0) {\n            return 'google'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'bing.com') === 0) {\n            return 'bing'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'yahoo.com') === 0) {\n            return 'yahoo'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'duckduckgo.com') === 0) {\n            return 'duckduckgo'\n        } else {\n            return null\n        }\n    }\n}\n\nfunction _getSearchInfoFromReferrer(referrer: string): Record<string, any> {\n    const search = _getSearchEngine(referrer)\n    const param = search != 'yahoo' ? 'q' : 'p'\n    const ret: Record<string, any> = {}\n\n    if (!isNull(search)) {\n        ret['$search_engine'] = search\n\n        const keyword = document ? getQueryParam(document.referrer, param) : ''\n        if (keyword.length) {\n            ret['ph_keyword'] = keyword\n        }\n    }\n\n    return ret\n}\n\nexport function getSearchInfo(): Record<string, any> {\n    const referrer = document?.referrer\n    if (!referrer) {\n        return {}\n    }\n    return _getSearchInfoFromReferrer(referrer)\n}\n\nexport function getBrowserLanguage(): string | undefined {\n    return (\n        navigator.language || // Any modern browser\n        (navigator as Record<string, any>).userLanguage // IE11\n    )\n}\n\nexport function getBrowserLanguagePrefix(): string | undefined {\n    const lang = getBrowserLanguage()\n    return typeof lang === 'string' ? lang.split('-')[0] : undefined\n}\n\nexport function getReferrer(): string {\n    return document?.referrer || '$direct'\n}\n\nexport function getReferringDomain(): string {\n    if (!document?.referrer) {\n        return '$direct'\n    }\n    return convertToURL(document.referrer)?.host || '$direct'\n}\n\nexport function getReferrerInfo(): Record<string, any> {\n    return {\n        $referrer: getReferrer(),\n        $referring_domain: getReferringDomain(),\n    }\n}\n\nexport function getPersonInfo(maskPersonalDataProperties?: boolean, customPersonalDataProperties?: string[]) {\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n    const url = location?.href.substring(0, 1000)\n    // we're being a bit more economical with bytes here because this is stored in the cookie\n    return {\n        r: getReferrer().substring(0, 1000),\n        u: url ? maskQueryParams(url, paramsToMask, MASKED) : undefined,\n    }\n}\n\nexport function getPersonPropsFromInfo(info: Record<string, any>): Record<string, any> {\n    const { r: referrer, u: url } = info\n    const referring_domain =\n        referrer == null ? undefined : referrer == '$direct' ? '$direct' : convertToURL(referrer)?.host\n\n    const props: Record<string, string | undefined> = {\n        $referrer: referrer,\n        $referring_domain: referring_domain,\n    }\n    if (url) {\n        props['$current_url'] = url\n        const location = convertToURL(url)\n        props['$host'] = location?.host\n        props['$pathname'] = location?.pathname\n        const campaignParams = _getCampaignParamsFromUrl(url)\n        extend(props, campaignParams)\n    }\n    if (referrer) {\n        const searchInfo = _getSearchInfoFromReferrer(referrer)\n        extend(props, searchInfo)\n    }\n    return props\n}\n\nexport function getInitialPersonPropsFromInfo(info: Record<string, any>): Record<string, any> {\n    const personProps = getPersonPropsFromInfo(info)\n    const props: Record<string, any> = {}\n    each(personProps, function (val: any, key: string) {\n        props[`$initial_${stripLeadingDollar(key)}`] = val\n    })\n    return props\n}\n\nexport function getTimezone(): string | undefined {\n    try {\n        return Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch {\n        return undefined\n    }\n}\n\nexport function getTimezoneOffset(): number | undefined {\n    try {\n        return new Date().getTimezoneOffset()\n    } catch {\n        return undefined\n    }\n}\n\nexport function getEventProperties(\n    maskPersonalDataProperties?: boolean,\n    customPersonalDataProperties?: string[]\n): Properties {\n    if (!userAgent) {\n        return {}\n    }\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n    const [os_name, os_version] = detectOS(userAgent)\n    return extend(\n        stripEmptyProperties({\n            $os: os_name,\n            $os_version: os_version,\n            $browser: detectBrowser(userAgent, navigator.vendor),\n            $device: detectDevice(userAgent),\n            $device_type: detectDeviceType(userAgent),\n            $timezone: getTimezone(),\n            $timezone_offset: getTimezoneOffset(),\n        }),\n        {\n            $current_url: maskQueryParams(location?.href, paramsToMask, MASKED),\n            $host: location?.host,\n            $pathname: location?.pathname,\n            $raw_user_agent: userAgent.length > 1000 ? userAgent.substring(0, 997) + '...' : userAgent,\n            $browser_version: detectBrowserVersion(userAgent, navigator.vendor),\n            $browser_language: getBrowserLanguage(),\n            $browser_language_prefix: getBrowserLanguagePrefix(),\n            $screen_height: window?.screen.height,\n            $screen_width: window?.screen.width,\n            $viewport_height: window?.innerHeight,\n            $viewport_width: window?.innerWidth,\n            $lib: 'web',\n            $lib_version: Config.LIB_VERSION,\n            $insert_id: Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n            $time: Date.now() / 1000, // epoch time in seconds\n        }\n    )\n}\n","import { isArray, isUndefined, clampToRange } from '@posthog/core'\nimport { logger } from '../utils/logger'\n\nexport function appendArray(currentValue: string[] | undefined, sampleType: string | string[]): string[] {\n    return [...(currentValue ? currentValue : []), ...(isArray(sampleType) ? sampleType : [sampleType])]\n}\n\nexport function updateThreshold(currentValue: number | undefined, percent: number): number {\n    return (isUndefined(currentValue) ? 1 : currentValue) * percent\n}\n\nexport function simpleHash(str: string) {\n    let hash = 0\n    for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) - hash + str.charCodeAt(i) // (hash * 31) + char code\n        hash |= 0 // Convert to 32bit integer\n    }\n    return Math.abs(hash)\n}\n\n/*\n * receives percent as a number between 0 and 1\n */\nexport function sampleOnProperty(prop: string, percent: number): boolean {\n    return simpleHash(prop) % 100 < clampToRange(percent * 100, 0, 100, logger)\n}\n","import { BeforeSendFn, CaptureResult, KnownEventName } from '../types'\nimport { includes, clampToRange } from '@posthog/core'\nimport { appendArray, sampleOnProperty, updateThreshold } from '../extensions/sampling'\nimport { logger } from '../utils/logger'\n\n/**\n * Provides an implementation of sampling that samples based on the distinct ID.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * Setting 0.5 will cause roughly 50% of distinct ids to have events sent.\n * Not 50% of events for each distinct id.\n *\n * @param percent a number from 0 to 1, 1 means always send and, 0 means never send the event\n */\nexport function sampleByDistinctId(percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        return sampleOnProperty(captureResult.properties.distinct_id, percent)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: ['sampleByDistinctId'],\n                      $sample_threshold: percent,\n                  },\n              }\n            : null\n    }\n}\n\n/**\n * Provides an implementation of sampling that samples based on the session ID.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * Setting 0.5 will cause roughly 50% of sessions to have events sent.\n * Not 50% of events for each session.\n *\n * @param percent a number from 0 to 1, 1 means always send and, 0 means never send the event\n */\nexport function sampleBySessionId(percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        return sampleOnProperty(captureResult.properties.$session_id, percent)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: appendArray(captureResult.properties.$sample_type, 'sampleBySessionId'),\n                      $sample_threshold: updateThreshold(captureResult.properties.$sample_threshold, percent),\n                  },\n              }\n            : null\n    }\n}\n\n/**\n * Provides an implementation of sampling that samples based on the event name.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * @param eventNames an array of event names to sample, sampling is applied across events not per event name\n * @param percent a number from 0 to 1, 1 means always send, 0 means never send the event\n */\nexport function sampleByEvent(eventNames: (KnownEventName | string)[], percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        if (!includes(eventNames, captureResult.event)) {\n            return captureResult\n        }\n\n        const number = Math.random()\n        return number * 100 < clampToRange(percent * 100, 0, 100, logger)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: appendArray(captureResult.properties?.$sample_type, 'sampleByEvent'),\n                      $sample_threshold: updateThreshold(captureResult.properties?.$sample_threshold, percent),\n                      $sampled_events: appendArray(captureResult.properties?.$sampled_events, eventNames),\n                  },\n              }\n            : null\n    }\n}\n\nexport const printAndDropEverything: BeforeSendFn = (result) => {\n    // eslint-disable-next-line no-console\n    console.log('Would have sent event:', result)\n    return null\n}\n","import { BucketedRateLimiter, isEmptyObject, isNullish, isObject, isUndefined, Logger } from '@posthog/core'\nimport { createLogger } from '../utils/logger'\nimport type { PostHog } from '../posthog-core'\n\n// types copied from redux toolkit so we can avoid taking a dependency in the library and confusing people using the SDK\n\n/**\n * An *unknown* action.\n * This is the most minimal possible shape for an action.\n * Allows for type-safe usage of actions without dependencies.\n */\nexport interface UnknownAction {\n    type: string\n    [extraProps: string]: unknown\n}\n\n/**\n * A *dispatching function* (or simply *dispatch function*) is a function that\n * accepts an action or an async action; it then may or may not dispatch one\n * or more actions to the store.\n */\nexport interface Dispatch<A extends UnknownAction = UnknownAction> {\n    <T extends A>(action: T): T\n}\n\n/**\n * A middleware is a higher-order function that composes a dispatch function\n * to return a new dispatch function. It often turns async actions into\n * actions.\n *\n * This matches Redux Toolkit's Middleware interface for compatibility.\n */\nexport interface ReduxMiddleware<\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-object-type\n    _DispatchExt = {},\n    S = any,\n    D extends Dispatch = Dispatch,\n> {\n    (api: MiddlewareAPI<D, S>): (next: (action: unknown) => unknown) => (action: unknown) => unknown\n}\n\n/**\n * A middleware API is an object containing the store's dispatch function and getState function.\n * A middleware is given the middleware API as its first parameter.\n */\nexport interface MiddlewareAPI<D extends Dispatch = Dispatch, S = any> {\n    dispatch: D\n    getState(): S\n}\n\n// end of copied types\n\nexport interface StateEvent {\n    type: string\n    payload?: any\n    timestamp: number\n    executionTimeMs?: number\n    prevState: any\n    nextState: any\n    changedState: any\n}\n\nexport type PostHogStateLogger = (title: string, stateEvent: StateEvent) => void\n\nexport interface PostHogStateLoggerConfig<S = any> {\n    maskAction?: (action: UnknownAction) => UnknownAction | null\n    maskState?: (state: S, action?: UnknownAction) => S\n    titleFunction?: (stateEvent: StateEvent) => string\n    logger?: PostHogStateLogger\n    /**\n     * actions logging is token bucket rate limited to avoid flooding\n     * this controls the rate limiter's refill rate, see BucketedRateLimiter docs for details\n     * normally this is only changed with posthog support assistance\n     */\n    rateLimiterRefillRate?: number\n    /**\n     * actions logging is token bucket rate limited to avoid flooding\n     * this controls the rate limiter's bucket size, see BucketedRateLimiter docs for details\n     * normally this is only changed with posthog support assistance\n     */\n    rateLimiterBucketSize?: number\n    /**\n     * Controls how many levels deep the state diffing goes when looking for changed keys\n     * Defaults to 5\n     * Increase this if you have nested state changes that are not being captured\n     * Decrease this if you are seeing too much state in the diffs and want to reduce noise\n     * Note that increasing this will increase the CPU cost of diffing, so use with caution\n     * and only increase if necessary\n     * Normally this is only changed with posthog support assistance\n     */\n    __stateComparisonDepth?: number\n    /**\n     * Which parts of the state event to include in the logged event\n     * By default we include, previous and changed keys only\n     *\n     * NB the more you include the more likely a log will be dropped by rate limiting or max size limits\n     */\n    include?: {\n        prevState?: boolean\n        nextState?: boolean\n        changedState?: boolean\n    }\n}\n\n/**\n * Default title function for Redux events\n */\nfunction defaultTitleFunction(stateEvent: StateEvent): string {\n    const { type, executionTimeMs } = stateEvent\n    const timeText = isNullish(executionTimeMs) ? '' : ` (${executionTimeMs.toFixed(2)}ms)`\n    return `${type}${timeText}`\n}\n\n// we need a posthog logger for the rate limiter\nconst phConsoleLogger: Logger = createLogger('[PostHog Action RateLimiting]')\n\nexport function browserConsoleLogger(title: string, stateEvent: StateEvent): void {\n    // but the posthog logger swallows messages unless debug is on\n    // so we don't want to use it in this default logger\n    // eslint-disable-next-line no-console\n    console.log(title, stateEvent)\n}\n\n/**\n * Logger that sends state events to PostHog session recordings\n * Requires that the loaded posthog instance is provided\n * And returns the function to use as the logger\n *\n * e.g. const config = { logger: sessionRecordingLoggerForPostHogInstance(posthog) }\n */\nexport const sessionRecordingLoggerForPostHogInstance: (posthog: PostHog) => PostHogStateLogger =\n    (postHogInstance: PostHog) =>\n    (title: string, stateEvent: StateEvent): void => {\n        postHogInstance?.sessionRecording?.tryAddCustomEvent('app-state', { title, stateEvent })\n    }\n\n/**\n * Get only the changed keys from two states\n * NB exported for testing purposes only, not part of the public API and may change without warning\n *\n * Returns { prevState: changedKeysOnly, nextState: changedKeysOnly }\n */\nexport function getChangedState<S>(prevState: S, nextState: S, maxDepth: number = 5): Partial<S> {\n    // Fast bailouts\n    if (typeof prevState !== 'object' || typeof nextState !== 'object') return {}\n    if (prevState === nextState) return {}\n    // all keys changed when no previous state\n    if (!prevState && nextState) return nextState\n    // something weird has happened, return empty\n    if (!nextState || !prevState) return {}\n\n    const changed: any = {}\n    const allKeys = new Set([...Object.keys(prevState), ...Object.keys(nextState)])\n\n    for (const key of allKeys) {\n        const prevValue = (prevState as any)[key]\n        const nextValue = (nextState as any)[key]\n\n        // Key exists in only one object\n        if (isUndefined(prevValue)) {\n            changed[key] = nextValue\n            continue\n        }\n        if (isUndefined(nextValue)) {\n            changed[key] = prevValue\n            continue\n        }\n\n        // Same value\n        if (prevValue === nextValue) {\n            continue\n        }\n\n        // Both null/undefined\n        if (isNullish(prevValue) && isNullish(nextValue)) {\n            continue\n        }\n\n        // Primitive or one is null\n        if (!isObject(prevValue) || !isObject(nextValue)) {\n            changed[key] = nextValue\n            continue\n        }\n\n        // Both are objects, recurse if under max depth\n        if (maxDepth > 1) {\n            const childChanged = getChangedState(prevValue, nextValue, maxDepth - 1)\n            if (!isEmptyObject(childChanged)) {\n                changed[key] = childChanged\n            }\n        } else {\n            changed[key] = `max depth reached, checking for changed value`\n        }\n    }\n\n    return changed\n}\n\n// Debounced logger for rate limit messages\nconst createDebouncedActionRateLimitedLogger = () => {\n    let timeout: ReturnType<typeof setTimeout> | null = null\n    let ignoredCount = 0\n    let lastActionType: string | null = null\n\n    return {\n        info: (actionType: string) => {\n            if (lastActionType !== actionType) {\n                // Reset counter when action type changes\n                ignoredCount = 0\n                lastActionType = actionType\n            }\n\n            ignoredCount++\n\n            if (timeout) {\n                clearTimeout(timeout)\n            }\n\n            timeout = setTimeout(() => {\n                const count = ignoredCount\n\n                if (count === 1) {\n                    phConsoleLogger.info(`action \"${actionType}\" has been rate limited`)\n                } else {\n                    phConsoleLogger.info(`action \"${actionType}\" has been rate limited (${count} times)`)\n                }\n\n                ignoredCount = 0\n                timeout = null\n            }, 1000)\n        },\n    }\n}\n\nconst debouncedActionRateLimitedLogger = createDebouncedActionRateLimitedLogger()\n\n/**\n * Creates a Kea plugin that logs actions and state changes to a provided logger\n * This can be used as a plugin in any Kea setup to capture state changes\n */\nexport function posthogKeaLogger<S = any>(config: PostHogStateLoggerConfig<S> = {}) {\n    const middleware = posthogReduxLogger(config)\n\n    return {\n        name: 'posthog-kea-logger',\n        events: {\n            beforeReduxStore(options: any) {\n                options.middleware.push(middleware)\n            },\n        },\n    }\n}\n\n/**\n * Creates a Redux middleware that logs actions and state changes to a provided logger\n * This can be used as middleware in any Redux store to capture state changes\n *\n * The logging uses token-bucket rate limiting to avoid flooding the logging with many changes\n * by default logging rate limiting captures ten action instances before rate limiting by action type\n * refills at a rate of one token / 1-second period\n * e.g. will capture 1 rate limited action every 1 second until the burst ends\n */\nexport function posthogReduxLogger<S = any>(\n    config: PostHogStateLoggerConfig<S> = {}\n    // the empty object is the recommended typing from redux docs\n    //eslint-disable-next-line @typescript-eslint/no-empty-object-type\n): ReduxMiddleware<{}, S> {\n    const {\n        maskAction,\n        maskState,\n        titleFunction = defaultTitleFunction,\n        logger = browserConsoleLogger,\n        include = {\n            prevState: true,\n            nextState: false,\n            changedState: true,\n        },\n        rateLimiterRefillRate = 1,\n        rateLimiterBucketSize = 10,\n        __stateComparisonDepth,\n    } = config\n\n    const rateLimiter: BucketedRateLimiter<string> = new BucketedRateLimiter({\n        refillRate: rateLimiterRefillRate,\n        bucketSize: rateLimiterBucketSize,\n        refillInterval: 1000, // one second in milliseconds,\n        _logger: phConsoleLogger,\n    })\n\n    return (store: MiddlewareAPI<Dispatch, S>) =>\n        (next: (action: unknown) => unknown) =>\n        (action: unknown): unknown => {\n            const typedAction = action as UnknownAction\n            // Get the state before the action\n            const prevState = store.getState()\n\n            // Track execution time\n            // eslint-disable-next-line compat/compat\n            const startTime = performance.now()\n\n            const result = next(typedAction)\n\n            // eslint-disable-next-line compat/compat\n            const endTime = performance.now()\n            const executionTimeMs = endTime - startTime\n\n            // Get the state after the action\n            const nextState = store.getState()\n\n            const maskedAction = maskAction ? maskAction(typedAction) : typedAction\n\n            if (!maskedAction) {\n                return result\n            }\n\n            const isRateLimited = rateLimiter.consumeRateLimit(typedAction.type)\n\n            if (isRateLimited) {\n                debouncedActionRateLimitedLogger.info(typedAction.type)\n            } else {\n                // Apply masking to states\n                try {\n                    const maskedPrevState = maskState ? maskState(prevState, maskedAction) : prevState\n                    const maskedNextState = maskState ? maskState(nextState, maskedAction) : nextState\n                    const changedState = include.changedState\n                        ? getChangedState(maskedPrevState, maskedNextState, __stateComparisonDepth ?? 5)\n                        : undefined\n                    const { type, ...actionData } = maskedAction\n\n                    const reduxEvent: StateEvent = {\n                        type,\n                        payload: actionData,\n                        timestamp: Date.now(),\n                        executionTimeMs,\n                        prevState: include.prevState ? maskedPrevState : undefined,\n                        nextState: include.nextState ? maskedNextState : undefined,\n                        changedState: include.changedState ? changedState : undefined,\n                    }\n\n                    const title = titleFunction(reduxEvent)\n                    logger(title, reduxEvent)\n                } catch (e: any) {\n                    // logging should never throw errors and break someone's app\n                    phConsoleLogger.error('Error logging state:', e)\n                }\n            }\n\n            return result\n        }\n}\n","import { PostHog } from '../posthog-core'\nimport {\n    CAMPAIGN_PARAMS,\n    getCampaignParams,\n    EVENT_TO_PERSON_PROPERTIES,\n    getEventProperties,\n    getReferrerInfo,\n} from '../utils/event-utils'\nimport { each, extend } from '../utils'\nimport { includes } from '@posthog/core'\n\nexport const setAllPersonProfilePropertiesAsPersonPropertiesForFlags = (posthog: PostHog): void => {\n    const allProperties = extend(\n        {},\n        getEventProperties(\n            posthog.config.mask_personal_data_properties,\n            posthog.config.custom_personal_data_properties\n        ),\n        getCampaignParams(\n            posthog.config.custom_campaign_params,\n            posthog.config.mask_personal_data_properties,\n            posthog.config.custom_personal_data_properties\n        ),\n        getReferrerInfo()\n    )\n    const personProperties: Record<string, string> = {}\n    each(allProperties, function (v, k: string) {\n        if (includes(CAMPAIGN_PARAMS, k) || includes(EVENT_TO_PERSON_PROPERTIES, k)) {\n            personProperties[k] = v\n        }\n    })\n\n    posthog.setPersonPropertiesForFlags(personProperties)\n}\n","// this file is called customizations.full.ts because it includes all customizations\n// this naming scheme allows us to create a lighter version in the future with only the most popular customizations\n// without breaking backwards compatibility\n\nimport * as customizations from '../customizations'\nimport { assignableWindow } from '../utils/globals'\nassignableWindow.posthogCustomizations = customizations\n"],"names":["win","window","undefined","global","globalThis","self","File","nativeForEach","Array","prototype","forEach","navigator","document","location","fetch","XMLHttpRequest","AbortController","userAgent","assignableWindow","Config","LIB_VERSION","includes","str","needle","indexOf","nativeIsArray","isArray","ObjProto","Object","type_utils_hasOwnProperty","hasOwnProperty","type_utils_toString","toString","obj","call","isObject","x","isEmptyObject","key","isUndefined","isNullish","isNull","isNumber","isFormData","FormData","clampToRange","value","min","max","logger","fallbackValue","warn","BucketedRateLimiter","constructor","options","this","_buckets","_onBucketRateLimited","_bucketSize","bucketSize","_logger","_refillRate","refillRate","_refillInterval","refillInterval","_applyRefill","bucket","now","elapsedMs","lastAccess","refillIntervals","Math","floor","tokensToAdd","tokens","consumeRateLimit","_this$_onBucketRateLi","Date","keyStr","String","stop","MOBILE","IOS","ANDROID","TABLET","ANDROID_TABLET","IPAD","APPLE","APPLE_WATCH","SAFARI","BLACKBERRY","SAMSUNG","SAMSUNG_BROWSER","SAMSUNG_INTERNET","CHROME","CHROME_OS","CHROME_IOS","INTERNET_EXPLORER","INTERNET_EXPLORER_MOBILE","OPERA","OPERA_MINI","EDGE","MICROSOFT_EDGE","FIREFOX","FIREFOX_IOS","NINTENDO","PLAYSTATION","XBOX","ANDROID_MOBILE","MOBILE_SAFARI","WINDOWS","WINDOWS_PHONE","NOKIA","OUYA","GENERIC","GENERIC_MOBILE","toLowerCase","GENERIC_TABLET","KONQUEROR","BROWSER_VERSION_REGEX_SUFFIX","DEFAULT_BROWSER_VERSION_REGEX","RegExp","XBOX_REGEX","PLAYSTATION_REGEX","NINTENDO_REGEX","BLACKBERRY_REGEX","windowsVersionMap","safariCheck","ua","vendor","isSafari","detectBrowser","user_agent","test","FACEBOOK","versionRegexes","Mozilla","detectBrowserVersion","browser","regexes","i","length","regex","matches","match","parseFloat","osMatchers","_","exec","version","osVersion","versionParts","join","result","detectDevice","_createLogger","prefix","_temp","debugEnabled","_log","level","POSTHOG_DEBUG","console","consoleLog","_len","arguments","args","_key","info","_len2","_key2","_len3","_key3","error","_len4","_key4","critical","_len5","_key5","uninitializedWarning","methodName","createLogger","additionalPrefix","breaker","eachArray","iterator","thisArg","l","each","pair","entries","extend","source","prop","extendArray","item","push","stripEmptyProperties","p","ret","v","k","convertToURL","url","createElement","href","getQueryParam","param","keyValuePair","queryParts","split","replace","parts","decodeURIComponent","_unused","maskQueryParams","maskedParams","mask","splitHash","withoutHash","hash","splitQuery","queryString","urlWithoutQueryAndHash","paramStrings","trunc","ceil","Number","isInteger","isFinite","DIGITS","UUID","bytes","TypeError","fromFieldsV7","unixTsMs","randA","randBHi","randBLo","RangeError","Uint8Array","pow","text","charAt","Error","clone","slice","equals","other","compareTo","diff","sign","V7Generator","_timestamp","_counter","_random","DefaultRandom","generate","generateOrAbort","valueAfterReset","ts","_resetCounter","nextUint32","defaultGenerator","getRandomValues","buffer","UUIDV7_DENY_WEAK_RNG","random","crypto","_buffer","Uint32Array","_cursor","Infinity","uuidv7","uuidv7obj","firstNonPublicSubDomain","DOMAIN_MATCH_REGEX","chooseCookieDomain","hostname","cross_subdomain","matchedSubDomain","cookieJar","list","len","candidate","candidateCookieValue","cookie","seekFirstNonPublicSubDomain","originalMatch","originalCookieDomainFn","cookieStore","_is_supported","_error","msg","_get","name","nameEQ","ca","filter","c","substring","_parse","JSON","parse","_unused2","_set","days","is_secure","expires","secure","cdomain","date","setTime","getTime","toUTCString","new_cookie_val","encodeURIComponent","stringify","_unused3","_remove","_unused4","PERSONAL_DATA_CAMPAIGN_PARAMS","CAMPAIGN_PARAMS","EVENT_TO_PERSON_PROPERTIES","MASKED","COOKIE_CAMPAIGN_PARAMS","getCampaignParams","customTrackedParams","maskPersonalDataProperties","customPersonalDataProperties","customParams","campaign_keywords","params","paramsToMask","urlCampaignParams","URL","concat","kwkey","kw","cookieCampaignParams","_getCampaignParamsFromCookie","getBrowserLanguage","language","userLanguage","getTimezone","Intl","DateTimeFormat","resolvedOptions","timeZone","getTimezoneOffset","getEventProperties","lang","device","os_name","os_version","rgex","resultOrFn","detectOS","$os","$os_version","$browser","$device","$device_type","$timezone","$timezone_offset","$current_url","$host","host","$pathname","pathname","$raw_user_agent","$browser_version","$browser_language","$browser_language_prefix","$screen_height","screen","height","$screen_width","width","$viewport_height","innerHeight","$viewport_width","innerWidth","$lib","$lib_version","$insert_id","$time","appendArray","currentValue","sampleType","updateThreshold","percent","sampleOnProperty","charCodeAt","abs","simpleHash","defaultTitleFunction","stateEvent","type","executionTimeMs","toFixed","phConsoleLogger","browserConsoleLogger","title","log","getChangedState","prevState","nextState","maxDepth","changed","allKeys","Set","keys","prevValue","nextValue","childChanged","timeout","ignoredCount","lastActionType","debouncedActionRateLimitedLogger","actionType","clearTimeout","setTimeout","count","posthogReduxLogger","config","maskAction","maskState","titleFunction","include","changedState","rateLimiterRefillRate","rateLimiterBucketSize","__stateComparisonDepth","rateLimiter","store","next","action","typedAction","getState","startTime","performance","maskedAction","maskedPrevState","maskedNextState","reduxEvent","payload","_objectWithoutPropertiesLoose","_excluded","timestamp","e","middleware","events","beforeReduxStore","captureResult","properties","distinct_id","_extends","$sample_type","$sample_threshold","eventNames","_captureResult$proper","_captureResult$proper2","_captureResult$proper3","event","$sampled_events","$session_id","postHogInstance","_postHogInstance$sess","sessionRecording","tryAddCustomEvent","posthog","_convertToURL","allProperties","mask_personal_data_properties","custom_personal_data_properties","custom_campaign_params","$referrer","referrer","$referring_domain","personProperties","setPersonPropertiesForFlags","posthogCustomizations","customizations"],"mappings":"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"}