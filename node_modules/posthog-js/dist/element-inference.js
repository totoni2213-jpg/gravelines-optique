function r(r,i,t){return void 0===i&&(i=document),void 0===t&&(t=null),function(r,i,t,o){void 0===o&&(o=null);return r=function(r){function n(){u&&(o.length>0&&/^[~+>]$/.test(o[o.length-1])&&o.push(" "),o.push(u))}var e,u,i,t,o=[],l=[0],f=0,a=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,v=/^\s+$/,c=[/\s+|\/\*|["'>~+[(]/g,/\s+|\/\*|["'[\]()]/g,/\s+|\/\*|["'[\]()]/g,null,/\*\//g];for(r=r.trim();;){if(u="",(i=c[l[l.length-1]]).lastIndex=f,!(e=i.exec(r))){u=r.substr(f),n();break}if((t=f)<(f=i.lastIndex)-e[0].length&&(u=r.substring(t,f-e[0].length)),l[l.length-1]<3){if(n(),"["===e[0])l.push(1);else if("("===e[0])l.push(2);else if(/^["']$/.test(e[0]))l.push(3),c[3]=new RegExp(e[0],"g");else if("/*"===e[0])l.push(4);else if(/^[\])]$/.test(e[0])&&l.length>0)l.pop();else if(/^(?:\s+|[~+>])$/.test(e[0])&&(o.length>0&&!v.test(o[o.length-1])&&0===l[l.length-1]&&o.push(" "),1===l[l.length-1]&&5===o.length&&"="===o[2].charAt(o[2].length-1)&&(o[4]=" "+o[4]),v.test(e[0])))continue;o.push(e[0])}else o[o.length-1]+=u,a.test(o[o.length-1])&&(4===l[l.length-1]&&(o.length<2||v.test(o[o.length-2])?o.pop():o[o.length-1]=" ",e[0]=""),l.pop()),o[o.length-1]+=e[0]}return o.join("").trim()}(r),t.querySelector(r),document.head.createShadowRoot||document.head.attachShadow?n(r,",").reduce(((r,i)=>{var l=n(i.replace(/^\s+/g,"").replace(/\s*([>+~]+)\s*/g,"$1")," ").filter((r=>!!r)).map((r=>n(r,">"))),f=l.length-1,a=function(r,n,e){void 0===r&&(r=null);void 0===e&&(e=null);var u=[];if(e)u=e;else{var i=function(r){for(var n=0;n<r.length;n++){var e=r[n];u.push(e),e.shadowRoot&&i(e.shadowRoot.querySelectorAll("*"))}};n.shadowRoot&&i(n.shadowRoot.querySelectorAll("*")),i(n.querySelectorAll("*"))}return r?u.filter((n=>n.matches(r))):u}(l[f][l[f].length-1],t,o),v=function(r,n,i){return t=>{for(var o=n,l=t,f=!1;l&&!e(l);){var a=!0;if(1===r[o].length)a=l.matches(r[o]);else{var v=[].concat(r[o]).reverse(),c=l;for(var d of v){if(!c||!c.matches(d)){a=!1;break}c=u(c,i)}}if(a&&0===o){f=!0;break}a&&o--,l=u(l,i)}return f}}(l,f,t);return r=r.concat(a.filter(v))}),[]):t.querySelectorAll(r)}(r,0,i,t)}function n(r,n){return r.match(/\\?.|^$/g).reduce(((r,e)=>('"'!==e||r.sQuote?"'"!==e||r.quote?r.quote||r.sQuote||e!==n?r.a[r.a.length-1]+=e:r.a.push(""):(r.sQuote^=1,r.a[r.a.length-1]+=e):(r.quote^=1,r.a[r.a.length-1]+=e),r)),{a:[""]}).a}function e(r){return r.nodeType===Node.DOCUMENT_FRAGMENT_NODE||r.nodeType===Node.DOCUMENT_NODE}function u(r,n){var e=r.parentNode;return e&&e.host&&11===e.nodeType?e.host:e===n?null:e}var i="undefined"!=typeof window?window:void 0,t="undefined"!=typeof globalThis?globalThis:i;"undefined"==typeof self&&(t.self=t),"undefined"==typeof File&&(t.File=function(){});var o=null==t?void 0:t.navigator;null==t||t.document,null==t||t.location,null==t||t.fetch,null!=t&&t.XMLHttpRequest&&"withCredentials"in new t.XMLHttpRequest&&t.XMLHttpRequest,null==t||t.AbortController,null==o||o.userAgent;var l=Array.isArray,f=Object.prototype.toString,a=l||function(r){return"[object Array]"===f.call(r)},v=r=>void 0===r;var c=(r,n,e)=>{function u(u){for(var i=arguments.length,t=new Array(i>1?i-1:0),o=1;o<i;o++)t[o-1]=arguments[o];n((()=>{(0,e[u])(r,...t)}))}return{info:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("log",...n)},warn:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("warn",...n)},error:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("error",...n)},critical:function(){for(var n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];e.error(r,...u)},createLogger:u=>c(r+" "+u,n,e)}};var d,s,g=i,w=(void 0===d&&(d=r=>r()),c("[Element Inference]",d,(void 0===s&&(s=console),{log:s.log.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),debug:s.debug.bind(s)})));function y(r,n){try{var e=n.get(r);if(!v(e))return e;if(r.checkVisibility){var u=r.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0});return n.set(r,u),u}var i=g.getComputedStyle(r);if("none"===i.display||"hidden"===i.visibility||0===parseFloat(i.opacity))return n.set(r,!1),!1;for(var t=r.parentElement;t;){var o=n.get(t);if(v(o)){var l=g.getComputedStyle(t),f="none"!==l.display&&"hidden"!==l.visibility;if(n.set(t,f),!f)return!1;t=t.parentElement}else{if(!o)return!1;t=t.parentElement}}var a=r.getBoundingClientRect(),c=a.width>0||a.height>0||r.getClientRects().length>0;return n.set(r,c),c}catch(r){return!0}}function h(r,n){var e=function(r){var n,e=null==(n=r.innerText)?void 0:n.trim();return!e||e.length>250?null:e}(r);return(null==e?void 0:e.toLowerCase())===n.toLowerCase()}function*p(n,e,u){var i;try{i=r(n)}catch(r){return}for(var t of i){var o=t;e&&!h(o,e)||y(o,u)&&(yield o)}}function b(r,n){var e=0;for(var u of r){if(e===n)return u;e++}return null}function A(r){try{var n=JSON.parse(r.autoData);if(!a(null==n?void 0:n.textGroups)||!a(null==n?void 0:n.notextGroups))return w.error("Invalid autoData structure:",n),null;var{text:e,excludeText:u,precision:i=1}=r,t=null!=e&&!u,o=(t?n.textGroups:n.notextGroups).sort(((r,n)=>r.cardinality-n.cardinality));if(0===o.length)return null;for(var l=Math.max(1,Math.ceil((1-i)*o.length)),f=new WeakMap,v=0;v<l;v++){var c=o[v],d=new Map,s=null,g=0;for(var{css:y,offset:h}of c.cssSelectors){var A,k=b(p(y,t?e:null,f),h);if(k){var m=(null!==(A=d.get(k))&&void 0!==A?A:0)+1;if(d.set(k,m),m>g&&(g=m,s=k,m>=Math.ceil(c.cssSelectors.length/2)))return s}}if(s)return s}return null}catch(r){return w.error("Error finding element:",r),null}}function k(r,n){if(void 0===n&&(n=4),!r)return null;for(var e=[],u=r;u&&e.length<n&&"BODY"!==u.tagName;){var i=u.tagName.toLowerCase();u.id?i+="#"+u.id:u.classList.length&&(i+="."+u.classList[0]),e.unshift(i),u=u.parentElement}return e.join(" > ")}export{y as elementIsVisible,A as findElement,k as getElementPath};
//# sourceMappingURL=element-inference.js.map
