{"version":3,"file":"conversations.js","sources":["../../../node_modules/.pnpm/preact@10.28.2/node_modules/preact/dist/preact.module.js","../../core/dist/utils/type-utils.mjs","../src/utils/globals.ts","../src/utils/logger.ts","../src/uuidv7.ts","../src/extensions/conversations/external/persistence.ts","../src/extensions/conversations/external/components/styles.ts","../src/constants.ts","../src/extensions/conversations/external/components/OpenChatButton.tsx","../src/extensions/conversations/external/components/CloseChatButton.tsx","../src/extensions/conversations/external/components/utils.ts","../src/extensions/conversations/external/components/TicketListItem.tsx","../src/extensions/conversations/external/components/TicketListView.tsx","../src/extensions/conversations/external/components/IdentificationFormView.tsx","../src/extensions/conversations/external/components/RestoreRequestView.tsx","../src/extensions/conversations/external/components/SendMessageButton.tsx","../../../node_modules/.pnpm/preact@10.28.2/node_modules/preact/hooks/dist/hooks.module.js","../src/extensions/conversations/external/components/RichContent.tsx","../src/extensions/conversations/external/components/MessagesView.tsx","../src/extensions/conversations/external/components/ConversationsWidget.tsx","../src/utils/index.ts","../src/utils/request-utils.ts","../src/extensions/conversations/external/url-utils.ts","../src/extensions/conversations/external/index.tsx","../src/entrypoints/conversations.ts"],"sourcesContent":["var n,l,u,t,i,o,r,e,f,c,s,a,h,p={},v=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,d=Array.isArray;function w(n,l){for(var u in l)n[u]=l[u];return n}function g(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _(l,u,t){var i,o,r,e={};for(r in u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:e[r]=u[r];if(arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):t),\"function\"==typeof l&&null!=l.defaultProps)for(r in l.defaultProps)void 0===e[r]&&(e[r]=l.defaultProps[r]);return m(l,e,i,o,null)}function m(n,t,i,o,r){var e={type:n,props:t,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==r?++u:r,__i:-1,__u:0};return null==r&&null!=l.vnode&&l.vnode(e),e}function b(){return{current:null}}function k(n){return n.children}function x(n,l){this.props=n,this.context=l}function S(n,l){if(null==l)return n.__?S(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?S(n):null}function C(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return C(n)}}function M(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!$.__r++||o!=l.debounceRendering)&&((o=l.debounceRendering)||r)($)}function $(){for(var n,u,t,o,r,f,c,s=1;i.length;)i.length>s&&i.sort(e),n=i.shift(),s=i.length,n.__d&&(t=void 0,o=void 0,r=(o=(u=n).__v).__e,f=[],c=[],u.__P&&((t=w({},o)).__v=o.__v+1,l.vnode&&l.vnode(t),O(u.__P,t,o,u.__n,u.__P.namespaceURI,32&o.__u?[r]:null,f,null==r?S(o):r,!!(32&o.__u),c),t.__v=o.__v,t.__.__k[t.__i]=t,N(f,t,c),o.__e=o.__=null,t.__e!=r&&C(t)));$.__r=0}function I(n,l,u,t,i,o,r,e,f,c,s){var a,h,y,d,w,g,_,m=t&&t.__k||v,b=l.length;for(f=P(u,l,m,f,b),a=0;a<b;a++)null!=(y=u.__k[a])&&(h=-1==y.__i?p:m[y.__i]||p,y.__i=a,g=O(n,y,h,i,o,r,e,f,c,s),d=y.__e,y.ref&&h.ref!=y.ref&&(h.ref&&B(h.ref,null,y),s.push(y.ref,y.__c||d,y)),null==w&&null!=d&&(w=d),(_=!!(4&y.__u))||h.__k===y.__k?f=A(y,f,n,_):\"function\"==typeof y.type&&void 0!==g?f=g:d&&(f=d.nextSibling),y.__u&=-7);return u.__e=w,f}function P(n,l,u,t,i){var o,r,e,f,c,s=u.length,a=s,h=0;for(n.__k=new Array(i),o=0;o<i;o++)null!=(r=l[o])&&\"boolean\"!=typeof r&&\"function\"!=typeof r?(\"string\"==typeof r||\"number\"==typeof r||\"bigint\"==typeof r||r.constructor==String?r=n.__k[o]=m(null,r,null,null,null):d(r)?r=n.__k[o]=m(k,{children:r},null,null,null):void 0===r.constructor&&r.__b>0?r=n.__k[o]=m(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):n.__k[o]=r,f=o+h,r.__=n,r.__b=n.__b+1,e=null,-1!=(c=r.__i=L(r,u,f,a))&&(a--,(e=u[c])&&(e.__u|=2)),null==e||null==e.__v?(-1==c&&(i>s?h--:i<s&&h++),\"function\"!=typeof r.type&&(r.__u|=4)):c!=f&&(c==f-1?h--:c==f+1?h++:(c>f?h--:h++,r.__u|=4))):n.__k[o]=null;if(a)for(o=0;o<s;o++)null!=(e=u[o])&&0==(2&e.__u)&&(e.__e==t&&(t=S(e)),D(e,e));return t}function A(n,l,u,t){var i,o;if(\"function\"==typeof n.type){for(i=n.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=n,l=A(i[o],l,u,t));return l}n.__e!=l&&(t&&(l&&n.type&&!l.parentNode&&(l=S(n)),u.insertBefore(n.__e,l||null)),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8==l.nodeType);return l}function H(n,l){return l=l||[],null==n||\"boolean\"==typeof n||(d(n)?n.some(function(n){H(n,l)}):l.push(n)),l}function L(n,l,u,t){var i,o,r,e=n.key,f=n.type,c=l[u],s=null!=c&&0==(2&c.__u);if(null===c&&null==e||s&&e==c.key&&f==c.type)return u;if(t>(s?1:0))for(i=u-1,o=u+1;i>=0||o<l.length;)if(null!=(c=l[r=i>=0?i--:o++])&&0==(2&c.__u)&&e==c.key&&f==c.type)return r;return-1}function T(n,l,u){\"-\"==l[0]?n.setProperty(l,null==u?\"\":u):n[l]=null==u?\"\":\"number\"!=typeof u||y.test(l)?u:u+\"px\"}function j(n,l,u,t,i){var o,r;n:if(\"style\"==l)if(\"string\"==typeof u)n.style.cssText=u;else{if(\"string\"==typeof t&&(n.style.cssText=t=\"\"),t)for(l in t)u&&l in u||T(n.style,l,\"\");if(u)for(l in u)t&&u[l]==t[l]||T(n.style,l,u[l])}else if(\"o\"==l[0]&&\"n\"==l[1])o=l!=(l=l.replace(f,\"$1\")),r=l.toLowerCase(),l=r in n||\"onFocusOut\"==l||\"onFocusIn\"==l?r.slice(2):l.slice(2),n.l||(n.l={}),n.l[l+o]=u,u?t?u.u=t.u:(u.u=c,n.addEventListener(l,o?a:s,o)):n.removeEventListener(l,o?a:s,o);else{if(\"http://www.w3.org/2000/svg\"==i)l=l.replace(/xlink(H|:h)/,\"h\").replace(/sName$/,\"s\");else if(\"width\"!=l&&\"height\"!=l&&\"href\"!=l&&\"list\"!=l&&\"form\"!=l&&\"tabIndex\"!=l&&\"download\"!=l&&\"rowSpan\"!=l&&\"colSpan\"!=l&&\"role\"!=l&&\"popover\"!=l&&l in n)try{n[l]=null==u?\"\":u;break n}catch(n){}\"function\"==typeof u||(null==u||!1===u&&\"-\"!=l[4]?n.removeAttribute(l):n.setAttribute(l,\"popover\"==l&&1==u?\"\":u))}}function F(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=c++;else if(u.t<t.u)return;return t(l.event?l.event(u):u)}}}function O(n,u,t,i,o,r,e,f,c,s){var a,h,p,v,y,_,m,b,S,C,M,$,P,A,H,L,T,j=u.type;if(void 0!==u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),r=[f=u.__e=t.__e]),(a=l.__b)&&a(u);n:if(\"function\"==typeof j)try{if(b=u.props,S=\"prototype\"in j&&j.prototype.render,C=(a=j.contextType)&&i[a.__c],M=a?C?C.props.value:a.__:i,t.__c?m=(h=u.__c=t.__c).__=h.__E:(S?u.__c=h=new j(b,M):(u.__c=h=new x(b,M),h.constructor=j,h.render=E),C&&C.sub(h),h.state||(h.state={}),h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),S&&null==h.__s&&(h.__s=h.state),S&&null!=j.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=w({},h.__s)),w(h.__s,j.getDerivedStateFromProps(b,h.__s))),v=h.props,y=h.state,h.__v=u,p)S&&null==j.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),S&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(S&&null==j.getDerivedStateFromProps&&b!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,M),u.__v==t.__v||!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,M)){for(u.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.some(function(n){n&&(n.__=u)}),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,M),S&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,y,_)})}if(h.context=M,h.props=b,h.__P=n,h.__e=!1,P=l.__r,A=0,S){for(h.state=h.__s,h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=w(w({},i),h.getChildContext())),S&&!p&&null!=h.getSnapshotBeforeUpdate&&(_=h.getSnapshotBeforeUpdate(v,y)),L=a,null!=a&&a.type===k&&null==a.key&&(L=V(a.props.children)),f=I(n,d(L)?L:[L],u,t,i,o,r,e,f,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&e.push(h),m&&(h.__E=h.__=null)}catch(n){if(u.__v=null,c||null!=r)if(n.then){for(u.__u|=c?160:128;f&&8==f.nodeType&&f.nextSibling;)f=f.nextSibling;r[r.indexOf(f)]=null,u.__e=f}else{for(T=r.length;T--;)g(r[T]);z(u)}else u.__e=t.__e,u.__k=t.__k,n.then||z(u);l.__e(n,u,t)}else null==r&&u.__v==t.__v?(u.__k=t.__k,u.__e=t.__e):f=u.__e=q(t.__e,u,t,i,o,r,e,c,s);return(a=l.diffed)&&a(u),128&u.__u?void 0:f}function z(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(z)}function N(n,u,t){for(var i=0;i<t.length;i++)B(t[i],t[++i],t[++i]);l.__c&&l.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l.__e(n,u.__v)}})}function V(n){return\"object\"!=typeof n||null==n||n.__b&&n.__b>0?n:d(n)?n.map(V):w({},n)}function q(u,t,i,o,r,e,f,c,s){var a,h,v,y,w,_,m,b=i.props||p,k=t.props,x=t.type;if(\"svg\"==x?r=\"http://www.w3.org/2000/svg\":\"math\"==x?r=\"http://www.w3.org/1998/Math/MathML\":r||(r=\"http://www.w3.org/1999/xhtml\"),null!=e)for(a=0;a<e.length;a++)if((w=e[a])&&\"setAttribute\"in w==!!x&&(x?w.localName==x:3==w.nodeType)){u=w,e[a]=null;break}if(null==u){if(null==x)return document.createTextNode(k);u=document.createElementNS(r,x,k.is&&k),c&&(l.__m&&l.__m(t,e),c=!1),e=null}if(null==x)b===k||c&&u.data==k||(u.data=k);else{if(e=e&&n.call(u.childNodes),!c&&null!=e)for(b={},a=0;a<u.attributes.length;a++)b[(w=u.attributes[a]).name]=w.value;for(a in b)if(w=b[a],\"children\"==a);else if(\"dangerouslySetInnerHTML\"==a)v=w;else if(!(a in k)){if(\"value\"==a&&\"defaultValue\"in k||\"checked\"==a&&\"defaultChecked\"in k)continue;j(u,a,null,w,r)}for(a in k)w=k[a],\"children\"==a?y=w:\"dangerouslySetInnerHTML\"==a?h=w:\"value\"==a?_=w:\"checked\"==a?m=w:c&&\"function\"!=typeof w||b[a]===w||j(u,a,w,b[a],r);if(h)c||v&&(h.__html==v.__html||h.__html==u.innerHTML)||(u.innerHTML=h.__html),t.__k=[];else if(v&&(u.innerHTML=\"\"),I(\"template\"==t.type?u.content:u,d(y)?y:[y],t,i,o,\"foreignObject\"==x?\"http://www.w3.org/1999/xhtml\":r,e,f,e?e[0]:i.__k&&S(i,0),c,s),null!=e)for(a=e.length;a--;)g(e[a]);c||(a=\"value\",\"progress\"==x&&null==_?u.removeAttribute(\"value\"):null!=_&&(_!==u[a]||\"progress\"==x&&!_||\"option\"==x&&_!=b[a])&&j(u,a,_,b[a],r),a=\"checked\",null!=m&&m!=u[a]&&j(u,a,m,b[a],r))}return u}function B(n,u,t){try{if(\"function\"==typeof n){var i=\"function\"==typeof n.__u;i&&n.__u(),i&&null==u||(n.__u=n(u))}else n.current=u}catch(n){l.__e(n,t)}}function D(n,u,t){var i,o;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||B(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(o=0;o<i.length;o++)i[o]&&D(i[o],u,t||\"function\"!=typeof n.type);t||g(n.__e),n.__c=n.__=n.__e=void 0}function E(n,l,u){return this.constructor(n,u)}function G(u,t,i){var o,r,e,f;t==document&&(t=document.documentElement),l.__&&l.__(u,t),r=(o=\"function\"==typeof i)?null:i&&i.__k||t.__k,e=[],f=[],O(t,u=(!o&&i||t).__k=_(k,null,[u]),r||p,p,t.namespaceURI,!o&&i?[i]:r?null:t.firstChild?n.call(t.childNodes):null,e,!o&&i?i:r?r.__e:t.firstChild,o,f),N(e,u,f)}function J(n,l){G(n,l,J)}function K(l,u,t){var i,o,r,e,f=w({},l.props);for(r in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:f[r]=void 0===u[r]&&null!=e?e[r]:u[r];return arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):t),m(l.type,f,i||l.key,o||l.ref,null)}function Q(n){function l(n){var u,t;return this.getChildContext||(u=new Set,(t={})[l.__c]=this,this.getChildContext=function(){return t},this.componentWillUnmount=function(){u=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&u.forEach(function(n){n.__e=!0,M(n)})},this.sub=function(n){u.add(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u&&u.delete(n),l&&l.call(n)}}),n.children}return l.__c=\"__cC\"+h++,l.__=n,l.Provider=l.__l=(l.Consumer=function(n,l){return n.children(l)}).contextType=l,l}n=v.slice,l={__e:function(n,l,u,t){for(var i,o,r;l=l.__;)if((i=l.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(n)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),r=i.__d),r)return i.__E=i}catch(l){n=l}throw n}},u=0,t=function(n){return null!=n&&void 0===n.constructor},x.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=w({},this.state),\"function\"==typeof n&&(n=n(w({},u),this.props)),n&&w(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),M(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),M(this))},x.prototype.render=k,i=[],r=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=function(n,l){return n.__v.__b-l.__v.__b},$.__r=0,f=/(PointerCapture)$|Capture$/i,c=0,s=F(!1),a=F(!0),h=0;export{x as Component,k as Fragment,K as cloneElement,Q as createContext,_ as createElement,b as createRef,_ as h,J as hydrate,t as isValidElement,l as options,G as render,H as toChildArray};\n//# sourceMappingURL=preact.module.js.map\n","import { knownUnsafeEditableEvent } from \"../types.mjs\";\nimport { includes } from \"./string-utils.mjs\";\nconst nativeIsArray = Array.isArray;\nconst ObjProto = Object.prototype;\nconst type_utils_hasOwnProperty = ObjProto.hasOwnProperty;\nconst type_utils_toString = ObjProto.toString;\nconst isArray = nativeIsArray || function(obj) {\n    return '[object Array]' === type_utils_toString.call(obj);\n};\nconst isFunction = (x)=>'function' == typeof x;\nconst isNativeFunction = (x)=>isFunction(x) && -1 !== x.toString().indexOf('[native code]');\nconst isObject = (x)=>x === Object(x) && !isArray(x);\nconst isEmptyObject = (x)=>{\n    if (isObject(x)) {\n        for(const key in x)if (type_utils_hasOwnProperty.call(x, key)) return false;\n        return true;\n    }\n    return false;\n};\nconst isUndefined = (x)=>void 0 === x;\nconst isString = (x)=>'[object String]' == type_utils_toString.call(x);\nconst isEmptyString = (x)=>isString(x) && 0 === x.trim().length;\nconst isNull = (x)=>null === x;\nconst isNullish = (x)=>isUndefined(x) || isNull(x);\nconst isNumber = (x)=>'[object Number]' == type_utils_toString.call(x) && x === x;\nconst isPositiveNumber = (value)=>isNumber(value) && value > 0;\nconst isBoolean = (x)=>'[object Boolean]' === type_utils_toString.call(x);\nconst isFormData = (x)=>x instanceof FormData;\nconst isFile = (x)=>x instanceof File;\nconst isPlainError = (x)=>x instanceof Error;\nconst isKnownUnsafeEditableEvent = (x)=>includes(knownUnsafeEditableEvent, x);\nfunction isPrimitive(value) {\n    return null === value || 'object' != typeof value;\n}\nfunction isBuiltin(candidate, className) {\n    return Object.prototype.toString.call(candidate) === `[object ${className}]`;\n}\nfunction isError(candidate) {\n    switch(Object.prototype.toString.call(candidate)){\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n        case '[object DOMError]':\n        case '[object WebAssembly.Exception]':\n            return true;\n        default:\n            return isInstanceOf(candidate, Error);\n    }\n}\nfunction isErrorEvent(event) {\n    return isBuiltin(event, 'ErrorEvent');\n}\nfunction isEvent(candidate) {\n    return !isUndefined(Event) && isInstanceOf(candidate, Event);\n}\nfunction isPlainObject(candidate) {\n    return isBuiltin(candidate, 'Object');\n}\nfunction isInstanceOf(candidate, base) {\n    try {\n        return candidate instanceof base;\n    } catch  {\n        return false;\n    }\n}\nconst yesLikeValues = [\n    true,\n    'true',\n    1,\n    '1',\n    'yes'\n];\nconst isYesLike = (val)=>includes(yesLikeValues, val);\nconst noLikeValues = [\n    false,\n    'false',\n    0,\n    '0',\n    'no'\n];\nconst isNoLike = (val)=>includes(noLikeValues, val);\nexport { type_utils_hasOwnProperty as hasOwnProperty, isArray, isBoolean, isBuiltin, isEmptyObject, isEmptyString, isError, isErrorEvent, isEvent, isFile, isFormData, isFunction, isKnownUnsafeEditableEvent, isNativeFunction, isNoLike, isNull, isNullish, isNumber, isObject, isPlainError, isPlainObject, isPositiveNumber, isPrimitive, isString, isUndefined, isYesLike, noLikeValues, yesLikeValues };\n","import type { PostHog } from '../posthog-core'\nimport { SessionIdManager } from '../sessionid'\nimport {\n    DeadClicksAutoCaptureConfig,\n    ExternalIntegrationKind,\n    Properties,\n    RemoteConfig,\n    SiteAppLoader,\n    SessionStartReason,\n} from '../types'\nimport type {\n    ConversationsRemoteConfig,\n    GetMessagesResponse,\n    GetTicketsOptions,\n    GetTicketsResponse,\n    MarkAsReadResponse,\n    RestoreFromTokenResponse,\n    RequestRestoreLinkResponse,\n    SendMessageResponse,\n    UserProvidedTraits,\n} from '../posthog-conversations-types'\n// only importing types here, so won't affect the bundle\n// eslint-disable-next-line posthog-js/no-external-replay-imports\nimport type { SessionRecordingStatus, TriggerType } from '../extensions/replay/external/triggerMatching'\nimport { eventWithTime } from '../extensions/replay/types/rrweb-types'\nimport { ErrorTracking } from '@posthog/core'\n\n/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nexport type AssignableWindow = Window &\n    typeof globalThis & {\n        /*\n         * Main PostHog instance\n         */\n        posthog: any\n\n        /*\n         * This is our contract between (potentially) lazily loaded extensions and the SDK\n         */\n        __PosthogExtensions__?: PostHogExtensions\n\n        /**\n         * When loading remote config, we assign it to this global configuration\n         * for ease of sharing it with the rest of the SDK\n         */\n        _POSTHOG_REMOTE_CONFIG?: Record<\n            string,\n            {\n                config: RemoteConfig\n                siteApps: SiteAppLoader[]\n            }\n        >\n\n        /**\n         * If this is set on the window, our logger will log to the console\n         * for ease of debugging. Used for testing purposes only.\n         *\n         * @see {Config.DEBUG} from config.ts\n         */\n        POSTHOG_DEBUG: any\n\n        // Exposed by the browser\n        doNotTrack: any\n\n        // See entrypoints/customizations.full.ts\n        posthogCustomizations: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/exception-autocapture.ts\n         *\n         * @deprecated use `__PosthogExtensions__.errorWrappingFunctions` instead\n         */\n        posthogErrorWrappingFunctions: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrweb` instead\n         */\n        rrweb: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrwebConsoleRecord` instead\n         */\n        rrwebConsoleRecord: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.getRecordNetworkPlugin` instead\n         */\n        getRecordNetworkPlugin: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/web-vitals.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogWebVitalsCallbacks` instead\n         */\n        postHogWebVitalsCallbacks: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/tracing-headers.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogTracingHeadersPatchFns` instead\n         */\n        postHogTracingHeadersPatchFns: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/surveys.ts\n         *\n         * @deprecated use `__PosthogExtensions__.generateSurveys` instead\n         */\n        extendPostHogWithSurveys: any\n\n        /*\n         * These are used to handle our toolbar state.\n         * @see {Toolbar} from extensions/toolbar.ts\n         */\n        ph_load_toolbar: any\n        ph_load_editor: any\n        ph_toolbar_state: any\n    } & Record<`__$$ph_site_app_${string}`, any>\n\n/**\n * This is our contract between (potentially) lazily loaded extensions and the SDK\n * changes to this interface can be breaking changes for users of the SDK\n */\n\nexport type ExternalExtensionKind = 'intercom-integration' | 'crisp-chat-integration'\n\nexport type PostHogExtensionKind =\n    | 'toolbar'\n    | 'exception-autocapture'\n    | 'web-vitals'\n    | 'web-vitals-with-attribution'\n    | 'recorder'\n    | 'lazy-recorder'\n    | 'tracing-headers'\n    | 'surveys'\n    | 'logs'\n    | 'conversations'\n    | 'product-tours'\n    | 'dead-clicks-autocapture'\n    | 'remote-config'\n    | ExternalExtensionKind\n\nexport interface LazyLoadedSessionRecordingInterface {\n    start: (startReason?: SessionStartReason) => void\n    stop: () => void\n    sessionId: string\n    status: SessionRecordingStatus\n    onRRwebEmit: (rawEvent: eventWithTime) => void\n    log: (message: string, level: 'log' | 'warn' | 'error') => void\n    sdkDebugProperties: Properties\n    overrideLinkedFlag: () => void\n    overrideSampling: () => void\n    overrideTrigger: (triggerType: TriggerType) => void\n    isStarted: boolean\n    tryAddCustomEvent(tag: string, payload: any): boolean\n}\n\nexport interface LazyLoadedDeadClicksAutocaptureInterface {\n    start: (observerTarget: Node) => void\n    stop: () => void\n}\n\nexport interface LazyLoadedConversationsInterface {\n    // Widget control\n    show: () => void\n    hide: () => void\n    isVisible: () => boolean\n\n    // Lifecycle\n    reset: () => void\n\n    // API methods\n    sendMessage: (message: string, userTraits?: UserProvidedTraits, newTicket?: boolean) => Promise<SendMessageResponse>\n    getMessages: (ticketId?: string, after?: string) => Promise<GetMessagesResponse>\n    markAsRead: (ticketId?: string) => Promise<MarkAsReadResponse>\n    getTickets: (options?: GetTicketsOptions) => Promise<GetTicketsResponse>\n    requestRestoreLink: (email: string) => Promise<RequestRestoreLinkResponse>\n    restoreFromToken: (restoreToken: string) => Promise<RestoreFromTokenResponse>\n    restoreFromUrlToken: () => Promise<RestoreFromTokenResponse | null>\n    getCurrentTicketId: () => string | null\n    getWidgetSessionId: () => string\n}\n\ninterface PostHogExtensions {\n    loadExternalDependency?: (\n        posthog: PostHog,\n        kind: PostHogExtensionKind,\n        callback: (error?: string | Event, event?: Event) => void\n    ) => void\n\n    loadSiteApp?: (posthog: PostHog, appUrl: string, callback: (error?: string | Event, event?: Event) => void) => void\n\n    errorWrappingFunctions?: {\n        wrapOnError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapUnhandledRejection: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapConsoleError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n    }\n    rrweb?: { record: any; version: string; wasMaxDepthReached?: () => boolean; resetMaxDepthState?: () => void }\n    rrwebPlugins?: { getRecordConsolePlugin: any; getRecordNetworkPlugin?: any }\n    generateSurveys?: (posthog: PostHog, isSurveysEnabled: boolean) => any | undefined\n    generateProductTours?: (posthog: PostHog, isEnabled: boolean) => any | undefined\n    logs?: {\n        initializeLogs?: (posthog: PostHog) => any | undefined\n    }\n    postHogWebVitalsCallbacks?: {\n        onLCP: (metric: any) => void\n        onCLS: (metric: any) => void\n        onFCP: (metric: any) => void\n        onINP: (metric: any) => void\n    }\n    /**\n     * @deprecated\n     *\n     * this was introduced briefly, it is now always a no-op and only kept for backwards compatibility\n     */\n    loadWebVitalsCallbacks?: (useAttribution?: boolean) => PostHogExtensions['postHogWebVitalsCallbacks']\n    tracingHeadersPatchFns?: {\n        _patchFetch: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n        _patchXHR: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n    }\n    initDeadClicksAutocapture?: (\n        ph: PostHog,\n        config: DeadClicksAutoCaptureConfig\n    ) => LazyLoadedDeadClicksAutocaptureInterface\n    integrations?: {\n        [K in ExternalIntegrationKind]?: { start: (posthog: PostHog) => void; stop: () => void }\n    }\n    initSessionRecording?: (ph: PostHog) => LazyLoadedSessionRecordingInterface\n    initConversations?: (config: ConversationsRemoteConfig, posthog: PostHog) => LazyLoadedConversationsInterface\n}\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\n// React Native polyfills for posthog-js compatibility\nif (typeof self === 'undefined') {\n    ;(global as any).self = global\n}\nif (typeof File === 'undefined') {\n    ;(global as any).File = function () {}\n}\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nexport const navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest =\n    global?.XMLHttpRequest && 'withCredentials' in new global.XMLHttpRequest() ? global.XMLHttpRequest : undefined\nexport const AbortController = global?.AbortController\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: AssignableWindow = win ?? ({} as any)\n\nexport { win as window }\n","import Config from '../config'\nimport { isUndefined } from '@posthog/core'\nimport { assignableWindow, window } from './globals'\nimport type { Logger } from '@posthog/core'\n\ntype CreateLoggerOptions = {\n    debugEnabled?: boolean\n}\n\ntype PosthogJsLogger = Omit<Logger, 'createLogger'> & {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => void\n    uninitializedWarning: (methodName: string) => void\n    createLogger: (prefix: string, options?: CreateLoggerOptions) => PosthogJsLogger\n}\n\nconst _createLogger = (prefix: string, { debugEnabled }: CreateLoggerOptions = {}): PosthogJsLogger => {\n    const logger: PosthogJsLogger = {\n        _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n            if (\n                window &&\n                (Config.DEBUG || assignableWindow.POSTHOG_DEBUG || debugEnabled) &&\n                !isUndefined(window.console) &&\n                window.console\n            ) {\n                const consoleLog =\n                    '__rrweb_original__' in window.console[level]\n                        ? (window.console[level] as any)['__rrweb_original__']\n                        : window.console[level]\n\n                // eslint-disable-next-line no-console\n                consoleLog(prefix, ...args)\n            }\n        },\n\n        info: (...args: any[]) => {\n            logger._log('log', ...args)\n        },\n\n        warn: (...args: any[]) => {\n            logger._log('warn', ...args)\n        },\n\n        error: (...args: any[]) => {\n            logger._log('error', ...args)\n        },\n\n        critical: (...args: any[]) => {\n            // Critical errors are always logged to the console\n            // eslint-disable-next-line no-console\n            console.error(prefix, ...args)\n        },\n\n        uninitializedWarning: (methodName: string) => {\n            logger.error(`You must initialize PostHog before calling ${methodName}`)\n        },\n\n        createLogger: (additionalPrefix: string, options?: CreateLoggerOptions) =>\n            _createLogger(`${prefix} ${additionalPrefix}`, options),\n    }\n    return logger\n}\n\nexport const logger = _createLogger('[PostHog.js]')\n\nexport const createLogger = logger.createLogger\n","/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nimport { window } from './utils/globals'\n\nimport { isNumber, isUndefined } from '@posthog/core'\n\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return isNumber(value) && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private _timestamp = 0\n    private _counter = 0\n    private readonly _random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (!isUndefined(value)) {\n            return value\n        } else {\n            // reset state and resume\n            this._timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (isUndefined(valueAfterReset)) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this._timestamp) {\n            this._timestamp = ts\n            this._resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this._timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this._counter++\n            if (this._counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this._timestamp++\n                this._resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this._timestamp,\n            Math.trunc(this._counter / 2 ** 30),\n            this._counter & (2 ** 30 - 1),\n            this._random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private _resetCounter(): void {\n        this._counter = this._random.nextUint32() * 0x400 + (this._random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    // TRICKY: don't use the isUndefined method here as can't pass the reference\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (window && !isUndefined(window.crypto) && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly _buffer = new Uint32Array(8)\n    private _cursor = Infinity\n    nextUint32(): number {\n        if (this._cursor >= this._buffer.length) {\n            getRandomValues(this._buffer)\n            this._cursor = 0\n        }\n        return this._buffer[this._cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n\nexport const uuid7ToTimestampMs = (uuid: string): number => {\n    // remove hyphens\n    const hex = uuid.replace(/-/g, '')\n    // ensure that it's a version 7 UUID\n    if (hex.length !== 32) {\n        throw new Error('Not a valid UUID')\n    }\n    if (hex[12] !== '7') {\n        throw new Error('Not a UUIDv7')\n    }\n    // the first 6 bytes are the timestamp, which means that we can read only the first 12 hex characters\n    return parseInt(hex.substring(0, 12), 16)\n}\n","import { PostHog } from '../../../posthog-core'\nimport { UserProvidedTraits } from '../../../posthog-conversations-types'\nimport { createLogger } from '../../../utils/logger'\nimport { window } from '../../../utils/globals'\nimport { uuidv7 } from '../../../uuidv7'\n\nconst logger = createLogger('[ConversationsPersistence]')\n\n// Old persistence keys (in PostHog's main persistence blob).\n// Kept for one-time migration to dedicated storage.\nconst LEGACY_WIDGET_SESSION_ID = '$conversations_widget_session_id'\nconst LEGACY_TICKET_ID = '$conversations_ticket_id'\nconst LEGACY_WIDGET_STATE = '$conversations_widget_state'\nconst LEGACY_USER_TRAITS = '$conversations_user_traits'\n\ninterface ConversationsStorageData {\n    widgetSessionId?: string\n    ticketId?: string | null\n    widgetState?: 'open' | 'closed'\n    userTraits?: UserProvidedTraits | null\n}\n\n/**\n * Dedicated localStorage key scoped to the PostHog project token.\n * Format: `ph_conv_<token>`\n */\nfunction storageKey(posthog: PostHog): string | null {\n    const token = posthog.config?.token\n    return token ? 'ph_conv_' + token : null\n}\n\n/**\n * ConversationsPersistence manages conversation data in its own dedicated\n * localStorage entry, independent of PostHog's core persistence layer.\n *\n * This avoids a known issue where PostHog's persistence.props can lose data\n * when the cookie+localStorage merge in _parse() fails on large entries.\n *\n * Pattern follows toolbar and surveys extensions which also use dedicated\n * localStorage keys.\n */\nexport class ConversationsPersistence {\n    private _cachedWidgetSessionId: string | null = null\n    private _storageKey: string | null\n\n    constructor(private readonly _posthog: PostHog) {\n        this._storageKey = storageKey(_posthog)\n        this._migrateFromLegacyPersistence()\n    }\n\n    /**\n     * Get or create the widget session ID (random UUID for access control).\n     * This ID is generated once per browser and persists across sessions.\n     * It is NOT tied to distinct_id - it stays the same even when user identifies.\n     *\n     * SECURITY: This is the key for access control. Only the browser that created\n     * the widget_session_id can access tickets associated with it.\n     */\n    getOrCreateWidgetSessionId(): string {\n        if (this._cachedWidgetSessionId) {\n            return this._cachedWidgetSessionId\n        }\n\n        let sessionId = this._read()?.widgetSessionId\n\n        if (!sessionId) {\n            sessionId = uuidv7()\n            this._write({ widgetSessionId: sessionId })\n        }\n\n        this._cachedWidgetSessionId = sessionId\n        return sessionId\n    }\n\n    /**\n     * Overwrite the widget session ID (used by restore flow).\n     */\n    setWidgetSessionId(id: string): void {\n        this._cachedWidgetSessionId = id\n        const data = this._read() || {}\n        this._write({ ...data, widgetSessionId: id })\n    }\n\n    /**\n     * Clear the widget session ID (called on posthog.reset()).\n     * This will create a new session and lose access to previous tickets.\n     */\n    clearWidgetSessionId(): void {\n        this._cachedWidgetSessionId = null\n        const data = this._read()\n        if (data) {\n            delete data.widgetSessionId\n            this._write(data)\n        }\n    }\n\n    saveTicketId(ticketId: string): void {\n        const data = this._read() || {}\n        this._write({ ...data, ticketId })\n    }\n\n    loadTicketId(): string | null {\n        return this._read()?.ticketId || null\n    }\n\n    clearTicketId(): void {\n        const data = this._read()\n        if (data) {\n            delete data.ticketId\n            this._write(data)\n        }\n    }\n\n    saveWidgetState(state: 'open' | 'closed'): void {\n        const data = this._read() || {}\n        this._write({ ...data, widgetState: state })\n    }\n\n    loadWidgetState(): 'open' | 'closed' | null {\n        const state = this._read()?.widgetState\n        return state === 'open' || state === 'closed' ? state : null\n    }\n\n    saveUserTraits(traits: UserProvidedTraits): void {\n        const data = this._read() || {}\n        this._write({ ...data, userTraits: traits })\n    }\n\n    loadUserTraits(): UserProvidedTraits | null {\n        const traits = this._read()?.userTraits\n        return traits && (traits.name || traits.email) ? traits : null\n    }\n\n    clearUserTraits(): void {\n        const data = this._read()\n        if (data) {\n            delete data.userTraits\n            this._write(data)\n        }\n    }\n\n    clearAll(): void {\n        this._cachedWidgetSessionId = null\n        if (this._storageKey) {\n            try {\n                window?.localStorage?.removeItem(this._storageKey)\n            } catch {\n                logger.error('Failed to remove localStorage item')\n            }\n        }\n    }\n\n    private _read(): ConversationsStorageData | null {\n        if (!this._storageKey) {\n            return null\n        }\n        try {\n            const raw = window?.localStorage?.getItem(this._storageKey)\n            return raw ? (JSON.parse(raw) as ConversationsStorageData) : null\n        } catch {\n            return null\n        }\n    }\n\n    private _write(data: ConversationsStorageData): void {\n        if (!this._storageKey) {\n            return\n        }\n        try {\n            window?.localStorage?.setItem(this._storageKey, JSON.stringify(data))\n        } catch (error) {\n            logger.error('Failed to write to localStorage', error)\n        }\n    }\n\n    /**\n     * One-time migration: copy conversations data from PostHog's main\n     * persistence blob into the dedicated localStorage key, then remove\n     * the old keys from PostHog persistence so they stop bloating it.\n     */\n    private _migrateFromLegacyPersistence(): void {\n        if (!this._storageKey || this._read()?.widgetSessionId) {\n            return\n        }\n\n        try {\n            const persistence = this._posthog.persistence\n            if (!persistence || persistence.isDisabled?.()) {\n                return\n            }\n\n            const widgetSessionId = persistence.get_property(LEGACY_WIDGET_SESSION_ID)\n            if (!widgetSessionId) {\n                // persistence.props may be empty (the bug) â€” try raw localStorage\n                const legacyFromRaw = this._readLegacyFromRawStorage()\n                if (legacyFromRaw) {\n                    this._write(legacyFromRaw)\n                    logger.info('Migrated conversations data from raw localStorage')\n                }\n                return\n            }\n\n            const data: ConversationsStorageData = { widgetSessionId }\n\n            const ticketId = persistence.get_property(LEGACY_TICKET_ID)\n            if (ticketId) {\n                data.ticketId = ticketId\n            }\n\n            const widgetState = persistence.get_property(LEGACY_WIDGET_STATE)\n            if (widgetState === 'open' || widgetState === 'closed') {\n                data.widgetState = widgetState\n            }\n\n            const userTraits = persistence.get_property(LEGACY_USER_TRAITS) as UserProvidedTraits | undefined\n            if (userTraits) {\n                data.userTraits = userTraits\n            }\n\n            this._write(data)\n\n            persistence.unregister(LEGACY_WIDGET_SESSION_ID)\n            persistence.unregister(LEGACY_TICKET_ID)\n            persistence.unregister(LEGACY_WIDGET_STATE)\n            persistence.unregister(LEGACY_USER_TRAITS)\n\n            logger.info('Migrated conversations data to dedicated storage')\n        } catch (error) {\n            logger.error('Migration from legacy persistence failed', error)\n        }\n    }\n\n    /**\n     * Fallback for migration: read legacy keys directly from raw localStorage\n     * when PostHog persistence.props didn't load them (the original bug).\n     */\n    private _readLegacyFromRawStorage(): ConversationsStorageData | null {\n        try {\n            const token = this._posthog.config?.token\n            if (!token) {\n                return null\n            }\n            const key = (this._posthog.config as any).persistence_name\n                ? 'ph_' + (this._posthog.config as any).persistence_name\n                : 'ph_' + token + '_posthog'\n\n            const raw = window?.localStorage?.getItem(key)\n            if (!raw) {\n                return null\n            }\n\n            const parsed = JSON.parse(raw)\n            const widgetSessionId = parsed?.[LEGACY_WIDGET_SESSION_ID]\n            if (typeof widgetSessionId !== 'string' || !widgetSessionId) {\n                return null\n            }\n\n            const data: ConversationsStorageData = { widgetSessionId }\n\n            const ticketId = parsed?.[LEGACY_TICKET_ID]\n            if (ticketId) {\n                data.ticketId = ticketId\n            }\n\n            const widgetState = parsed?.[LEGACY_WIDGET_STATE]\n            if (widgetState === 'open' || widgetState === 'closed') {\n                data.widgetState = widgetState\n            }\n\n            const userTraits = parsed?.[LEGACY_USER_TRAITS]\n            if (userTraits) {\n                data.userTraits = userTraits\n            }\n\n            return data\n        } catch {\n            return null\n        }\n    }\n}\n","// Inline styles following PostHog design system\n\nimport type { WidgetPosition } from '../../../../posthog-conversations-types'\nimport { Z_INDEX_CONVERSATIONS } from '../../../../constants'\n\n/**\n * Calculate contrasting text color (black or white) based on background brightness\n * Uses HSP (Highly Sensitive Purity) brightness formula\n */\nfunction getContrastTextColor(hexColor: string): string {\n    const hex = hexColor.replace(/^#/, '')\n    const fullHex = hex.length === 3 ? hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2] : hex\n\n    const r = parseInt(fullHex.slice(0, 2), 16)\n    const g = parseInt(fullHex.slice(2, 4), 16)\n    const b = parseInt(fullHex.slice(4, 6), 16)\n\n    // HSP brightness formula\n    const hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b))\n    return hsp > 127.5 ? '#020617' : 'white'\n}\n\nexport const getStyles = (primaryColor: string, position: WidgetPosition = 'bottom_right') => {\n    const isLeft = position.includes('left')\n    const isTop = position.includes('top')\n\n    return {\n        widget: {\n            position: 'fixed' as const,\n            ...(isTop ? { top: '20px' } : { bottom: '20px' }),\n            ...(isLeft ? { left: '20px' } : { right: '20px' }),\n            zIndex: Z_INDEX_CONVERSATIONS,\n            fontFamily:\n                '-apple-system, BlinkMacSystemFont, \"Inter\", \"Segoe UI\", \"Roboto\", Helvetica, Arial, sans-serif',\n        },\n        buttonContainer: {\n            position: 'relative' as const,\n        },\n        button: {\n            width: '50px',\n            height: '50px',\n            borderRadius: '50%',\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            border: 'none',\n            cursor: 'pointer',\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            transition: 'transform 0.2s ease-out, box-shadow 0.2s ease-out',\n        },\n        unreadBadge: {\n            position: 'absolute' as const,\n            ...(isTop ? { bottom: '-4px' } : { top: '-4px' }),\n            ...(isLeft ? { left: '-4px' } : { right: '-4px' }),\n            minWidth: '20px',\n            height: '20px',\n            borderRadius: '10px',\n            background: '#ef4444',\n            color: 'white',\n            fontSize: '11px',\n            fontWeight: 600,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '0 5px',\n            boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',\n            border: '2px solid white',\n            boxSizing: 'border-box' as const,\n        },\n        window: {\n            position: 'absolute' as const,\n            ...(isTop ? { top: 0 } : { bottom: 0 }),\n            ...(isLeft ? { left: 0 } : { right: 0 }),\n            background: 'white',\n            borderRadius: '10px',\n            boxShadow: '0 10px 25px -3px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.10)',\n            display: 'flex',\n            flexDirection: 'column' as const,\n            overflow: 'hidden',\n            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n            //border: '1px solid #dcdcdc',\n            border: 'none',\n        },\n        windowOpen: {\n            width: '400px',\n            maxWidth: 'calc(100vw - 40px)',\n            height: '600px',\n            maxHeight: 'calc(100vh - 100px)',\n        },\n        header: {\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            padding: '8px 12px',\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            flexShrink: 0,\n        },\n        headerTitle: {\n            fontWeight: 500,\n            fontSize: '14px',\n        },\n        headerActions: {\n            display: 'flex',\n            gap: '4px',\n            alignItems: 'center',\n        },\n        headerLinkButton: {\n            background: 'transparent',\n            border: 'none',\n            color: getContrastTextColor(primaryColor),\n            cursor: 'pointer',\n            padding: '6px 8px',\n            fontSize: '12px',\n            borderRadius: '4px',\n            opacity: 0.9,\n        },\n        headerButton: {\n            background: 'transparent',\n            border: 'none',\n            color: getContrastTextColor(primaryColor),\n            cursor: 'pointer',\n            padding: '6px 8px',\n            fontSize: '16px',\n            lineHeight: 1,\n            borderRadius: '4px',\n            transition: 'background 0.2s ease-out',\n            opacity: 0.9,\n        },\n        messages: {\n            flex: 1,\n            overflowY: 'auto' as const,\n            padding: '14px',\n            display: 'flex',\n            flexDirection: 'column' as const,\n            gap: '8px',\n            background: 'white',\n        },\n        message: {\n            display: 'flex',\n            flexDirection: 'column' as const,\n            maxWidth: '85%',\n            animation: 'fadeIn 0.2s ease-out',\n        },\n        messageCustomer: {\n            alignSelf: 'flex-end',\n            alignItems: 'flex-end',\n        },\n        messageAgent: {\n            alignSelf: 'flex-start',\n            alignItems: 'flex-start',\n        },\n        messageAuthor: {\n            fontSize: '10px',\n            color: '#939393',\n            marginBottom: '4px',\n            fontWeight: 500,\n        },\n        messageContent: {\n            padding: '8px 12px',\n            borderRadius: '8px',\n            fontSize: '12px',\n            lineHeight: 1.5,\n            wordWrap: 'break-word' as const,\n            whiteSpace: 'pre-wrap' as const,\n        },\n        messageContentCustomer: {\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            borderBottomRightRadius: '2px',\n        },\n        messageContentAgent: {\n            background: 'white',\n            color: '#020617',\n            border: '1.5px solid #dcdcdc',\n            borderBottomLeftRadius: '2px',\n        },\n        messageTime: {\n            fontSize: '10px',\n            color: '#939393',\n            marginTop: '4px',\n            opacity: 0.8,\n        },\n        error: {\n            padding: '10px 16px',\n            background: '#fee2e2',\n            color: '#991b1b',\n            fontSize: '13px',\n            borderTop: '1px solid #fecaca',\n            borderBottom: '1px solid #fecaca',\n            textAlign: 'center' as const,\n            fontWeight: 500,\n        },\n        inputContainer: {\n            padding: '8px 12px',\n            background: 'white',\n            borderTop: '1px solid #dcdcdc',\n            display: 'flex',\n            gap: '8px',\n            alignItems: 'center', // Changed from flex-end to center to vertically align input and sendButton\n            flexShrink: 0,\n        },\n        input: {\n            flex: 1,\n            maxHeight: '120px',\n            fontSize: '14px',\n            resize: 'vertical',\n            fontFamily: 'inherit',\n            lineHeight: 1.5,\n            color: '#020617',\n            background: 'white',\n            border: 'none',\n            outline: 'none',\n            transition: 'border-color 0.2s ease-out, box-shadow 0.2s ease-out',\n            display: 'flex',\n            alignItems: 'center',\n            fieldSizing: 'content',\n        },\n        sendButton: {\n            width: '33px',\n            height: '33px', // Match input minHeight for vertical alignment\n            borderRadius: '10px',\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            border: 'none',\n            cursor: 'pointer',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            transition: 'all 0.2s ease-out',\n            boxShadow: '0 2px 0 rgba(0, 0, 0, 0.045)',\n            fontWeight: 700,\n            flexShrink: 0,\n        },\n        // Identification form styles\n        identificationForm: {\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column' as const,\n            padding: '24px',\n            background: '#eeeded',\n            overflowY: 'auto' as const,\n        },\n        formTitle: {\n            fontSize: '18px',\n            fontWeight: 600,\n            color: '#020617',\n            marginBottom: '8px',\n        },\n        formDescription: {\n            fontSize: '14px',\n            color: '#64748b',\n            marginBottom: '24px',\n            lineHeight: 1.5,\n        },\n        recoverFooter: {\n            padding: '10px 14px',\n            borderTop: '1px solid #e5e7eb',\n            fontSize: '12px',\n            color: '#64748b',\n            lineHeight: 1.5,\n            flexShrink: 0,\n            textAlign: 'center',\n        },\n        recoverFooterLink: {\n            background: 'none',\n            border: 'none',\n            padding: 0,\n            color: '#64748b',\n            cursor: 'pointer',\n            fontSize: '12px',\n            fontFamily: 'inherit',\n            textDecoration: 'underline',\n        },\n        formField: {\n            marginBottom: '16px',\n        },\n        formLabel: {\n            display: 'block',\n            fontSize: '13px',\n            fontWeight: 500,\n            color: '#020617',\n            marginBottom: '6px',\n        },\n        formInput: {\n            width: '100%',\n            padding: '10px 12px',\n            border: '1px solid #dcdcdc',\n            borderRadius: '6px',\n            fontSize: '14px',\n            fontFamily: 'inherit',\n            color: '#020617',\n            background: 'white',\n            transition: 'border-color 0.2s ease-out, box-shadow 0.2s ease-out',\n            boxSizing: 'border-box' as const,\n        },\n        formInputError: {\n            borderColor: '#ef4444',\n        },\n        formError: {\n            fontSize: '12px',\n            color: '#ef4444',\n            marginTop: '4px',\n        },\n        formSubmitButton: {\n            width: '100%',\n            padding: '12px 16px',\n            borderRadius: '6px',\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            border: 'none',\n            cursor: 'pointer',\n            fontSize: '14px',\n            fontWeight: 600,\n            transition: 'all 0.2s ease-out',\n            marginTop: '8px',\n        },\n        formOptional: {\n            fontSize: '12px',\n            color: '#939393',\n            fontWeight: 400,\n        },\n        restoreRequestSuccess: {\n            marginTop: '12px',\n            fontSize: '12px',\n            color: '#166534',\n            background: '#dcfce7',\n            border: '1px solid #86efac',\n            borderRadius: '6px',\n            padding: '10px 12px',\n            lineHeight: 1.4,\n        },\n        // Ticket list styles\n        ticketListContainer: {\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column' as const,\n            background: 'white',\n            overflowY: 'auto' as const,\n        },\n        ticketList: {\n            flex: 1,\n            overflowY: 'auto' as const,\n        },\n        ticketItem: {\n            padding: '14px 16px',\n            borderBottom: '1px solid #f1f1f1',\n            cursor: 'pointer',\n            transition: 'background 0.15s ease-out',\n            background: 'white',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '12px',\n        },\n        ticketItemUnread: {\n            background: '#fafafa',\n        },\n        ticketItemContent: {\n            display: 'flex',\n            flexDirection: 'column' as const,\n            gap: '6px',\n            flex: 1,\n            minWidth: 0, // Allow text truncation\n        },\n        ticketItemArrow: {\n            color: '#939393',\n            flexShrink: 0,\n            display: 'flex',\n            alignItems: 'center',\n        },\n        ticketItemHeader: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-start',\n            gap: '8px',\n        },\n        ticketPreview: {\n            fontSize: '13px',\n            color: '#020617',\n            lineHeight: 1.4,\n            flex: 1,\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap' as const,\n        },\n        ticketPreviewUnread: {\n            fontSize: '13px',\n            color: '#020617',\n            lineHeight: 1.4,\n            flex: 1,\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap' as const,\n            fontWeight: 600,\n        },\n        ticketUnreadBadge: {\n            minWidth: '18px',\n            height: '18px',\n            borderRadius: '9px',\n            background: '#ef4444',\n            color: 'white',\n            fontSize: '10px',\n            fontWeight: 600,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '0 5px',\n            flexShrink: 0,\n        },\n        ticketMeta: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: '8px',\n        },\n        ticketTime: {\n            fontSize: '11px',\n            color: '#939393',\n        },\n        ticketStatus: {\n            fontSize: '10px',\n            color: '#64748b',\n            background: '#f1f5f9',\n            padding: '2px 6px',\n            borderRadius: '4px',\n            textTransform: 'uppercase' as const,\n            letterSpacing: '0.3px',\n        },\n        newConversationButton: {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            margin: '12px 16px',\n            padding: '10px 16px',\n            borderRadius: '8px',\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            border: 'none',\n            cursor: 'pointer',\n            fontSize: '13px',\n            fontWeight: 500,\n            transition: 'all 0.2s ease-out',\n        },\n        // Ticket list loading state\n        ticketListLoading: {\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column' as const,\n            alignItems: 'center',\n            justifyContent: 'center',\n            gap: '12px',\n            color: '#64748b',\n            fontSize: '13px',\n        },\n        loadingSpinner: {\n            width: '24px',\n            height: '24px',\n            border: '2px solid #e2e8f0',\n            borderTop: `2px solid ${primaryColor}`,\n            borderRadius: '50%',\n            animation: 'spin 0.8s linear infinite',\n        },\n        // Ticket list empty state\n        ticketListEmpty: {\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column' as const,\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '32px 24px',\n            textAlign: 'center' as const,\n        },\n        emptyStateIcon: {\n            color: '#cbd5e1',\n            marginBottom: '16px',\n        },\n        emptyStateTitle: {\n            fontSize: '16px',\n            fontWeight: 600,\n            color: '#020617',\n            marginBottom: '8px',\n        },\n        emptyStateDescription: {\n            fontSize: '13px',\n            color: '#64748b',\n            lineHeight: 1.5,\n            marginBottom: '20px',\n        },\n        newConversationButtonLarge: {\n            padding: '12px 24px',\n            borderRadius: '8px',\n            background: primaryColor,\n            color: getContrastTextColor(primaryColor),\n            border: 'none',\n            cursor: 'pointer',\n            fontSize: '14px',\n            fontWeight: 600,\n            transition: 'all 0.2s ease-out',\n        },\n        fetchPreviousButton: {\n            marginTop: '10px',\n            background: 'transparent',\n            border: 'none',\n            color: primaryColor,\n            cursor: 'pointer',\n            fontSize: '13px',\n            textDecoration: 'underline',\n            opacity: 1,\n        },\n        // Back button for message view header\n        backButton: {\n            background: 'transparent',\n            border: 'none',\n            color: getContrastTextColor(primaryColor),\n            cursor: 'pointer',\n            padding: '6px 0px',\n            marginRight: '4px',\n            fontSize: '16px',\n            lineHeight: 1,\n            borderRadius: '4px',\n            transition: 'background 0.2s ease-out',\n            opacity: 0.9,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n        },\n        // Header with back button layout\n        headerWithBack: {\n            display: 'flex',\n            alignItems: 'center',\n        },\n    }\n}\n","/*\n * Constants\n */\n\n/* PROPERTY KEYS */\n\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\nexport const PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id'\nexport const DISTINCT_ID = 'distinct_id'\nexport const DEVICE_ID = '$device_id'\nexport const ALIAS_ID_KEY = '__alias'\nexport const CAMPAIGN_IDS_KEY = '__cmpns'\nexport const EVENT_TIMERS_KEY = '__timers'\nexport const AUTOCAPTURE_DISABLED_SERVER_SIDE = '$autocapture_disabled_server_side'\nexport const HEATMAPS_ENABLED_SERVER_SIDE = '$heatmaps_enabled_server_side'\nexport const EXCEPTION_CAPTURE_ENABLED_SERVER_SIDE = '$exception_capture_enabled_server_side'\nexport const ERROR_TRACKING_SUPPRESSION_RULES = '$error_tracking_suppression_rules'\nexport const ERROR_TRACKING_CAPTURE_EXTENSION_EXCEPTIONS = '$error_tracking_capture_extension_exceptions'\nexport const WEB_VITALS_ENABLED_SERVER_SIDE = '$web_vitals_enabled_server_side'\nexport const DEAD_CLICKS_ENABLED_SERVER_SIDE = '$dead_clicks_enabled_server_side'\nexport const PRODUCT_TOURS_ENABLED_SERVER_SIDE = '$product_tours_enabled_server_side'\nexport const WEB_VITALS_ALLOWED_METRICS = '$web_vitals_allowed_metrics'\nexport const SESSION_RECORDING_REMOTE_CONFIG = '$session_recording_remote_config'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_ENABLED_SERVER_SIDE = '$session_recording_enabled_server_side'\n// @deprecated can be removed along with eager loaded replay\nexport const CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE = '$console_log_recording_enabled_server_side'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE = '$session_recording_network_payload_capture'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_MASKING = '$session_recording_masking'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_CANVAS_RECORDING = '$session_recording_canvas_recording'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_SAMPLE_RATE = '$replay_sample_rate'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_MINIMUM_DURATION = '$replay_minimum_duration'\n// @deprecated can be removed along with eager loaded replay\nexport const SESSION_RECORDING_SCRIPT_CONFIG = '$replay_script_config'\nexport const SESSION_RECORDING_OVERRIDE_SAMPLING = '$replay_override_sampling'\nexport const SESSION_RECORDING_OVERRIDE_LINKED_FLAG = '$replay_override_linked_flag'\nexport const SESSION_RECORDING_OVERRIDE_URL_TRIGGER = '$replay_override_url_trigger'\nexport const SESSION_RECORDING_OVERRIDE_EVENT_TRIGGER = '$replay_override_event_trigger'\nexport const SESSION_ID = '$sesid'\nexport const SESSION_RECORDING_IS_SAMPLED = '$session_is_sampled'\nexport const SESSION_RECORDING_PAST_MINIMUM_DURATION = '$session_past_minimum_duration'\nexport const SESSION_RECORDING_URL_TRIGGER_ACTIVATED_SESSION = '$session_recording_url_trigger_activated_session'\nexport const SESSION_RECORDING_EVENT_TRIGGER_ACTIVATED_SESSION = '$session_recording_event_trigger_activated_session'\nexport const SESSION_RECORDING_FIRST_FULL_SNAPSHOT_TIMESTAMP = '$debug_first_full_snapshot_timestamp'\nexport const ENABLED_FEATURE_FLAGS = '$enabled_feature_flags'\nexport const PERSISTENCE_EARLY_ACCESS_FEATURES = '$early_access_features'\nexport const PERSISTENCE_FEATURE_FLAG_DETAILS = '$feature_flag_details'\nexport const STORED_PERSON_PROPERTIES_KEY = '$stored_person_properties'\nexport const STORED_GROUP_PROPERTIES_KEY = '$stored_group_properties'\nexport const SURVEYS = '$surveys'\nexport const SURVEYS_ACTIVATED = '$surveys_activated'\nexport const PRODUCT_TOURS_ACTIVATED = '$product_tours_activated'\nexport const CONVERSATIONS = '$conversations'\nexport const FLAG_CALL_REPORTED = '$flag_call_reported'\nexport const PERSISTENCE_FEATURE_FLAG_ERRORS = '$feature_flag_errors'\nexport const USER_STATE = '$user_state'\nexport const CLIENT_SESSION_PROPS = '$client_session_props'\nexport const CAPTURE_RATE_LIMIT = '$capture_rate_limit'\n\n/** @deprecated Delete this when INITIAL_PERSON_INFO has been around for long enough to ignore backwards compat */\nexport const INITIAL_CAMPAIGN_PARAMS = '$initial_campaign_params'\n/** @deprecated Delete this when INITIAL_PERSON_INFO has been around for long enough to ignore backwards compat */\nexport const INITIAL_REFERRER_INFO = '$initial_referrer_info'\nexport const INITIAL_PERSON_INFO = '$initial_person_info'\nexport const ENABLE_PERSON_PROCESSING = '$epp'\nexport const TOOLBAR_ID = '__POSTHOG_TOOLBAR__'\nexport const TOOLBAR_CONTAINER_CLASS = 'toolbar-global-fade-container'\n\n/**\n * PREVIEW - MAY CHANGE WITHOUT WARNING - DO NOT USE IN PRODUCTION\n * Sentinel value for distinct id, device id, session id. Signals that the server should generate the value\n * */\nexport const COOKIELESS_SENTINEL_VALUE = '$posthog_cookieless'\nexport const COOKIELESS_MODE_FLAG_PROPERTY = '$cookieless_mode'\n\nexport const WEB_EXPERIMENTS = '$web_experiments'\n\n// These are properties that are reserved and will not be automatically included in events\nexport const PERSISTENCE_RESERVED_PROPERTIES = [\n    PEOPLE_DISTINCT_ID_KEY,\n    ALIAS_ID_KEY,\n    CAMPAIGN_IDS_KEY,\n    EVENT_TIMERS_KEY,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    HEATMAPS_ENABLED_SERVER_SIDE,\n    SESSION_ID,\n    ENABLED_FEATURE_FLAGS,\n    ERROR_TRACKING_SUPPRESSION_RULES,\n    USER_STATE,\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    PERSISTENCE_FEATURE_FLAG_DETAILS,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    SURVEYS,\n    FLAG_CALL_REPORTED,\n    PERSISTENCE_FEATURE_FLAG_ERRORS,\n    CLIENT_SESSION_PROPS,\n    CAPTURE_RATE_LIMIT,\n    INITIAL_CAMPAIGN_PARAMS,\n    INITIAL_REFERRER_INFO,\n    ENABLE_PERSON_PROCESSING,\n    INITIAL_PERSON_INFO,\n]\n\nexport const SURVEYS_REQUEST_TIMEOUT_MS = 10000\n\n/* Z-INDEX HIERARCHY: tours > surveys > support */\nexport const Z_INDEX_TOURS = 2147483646\nexport const Z_INDEX_SURVEYS = 2147483645\nexport const Z_INDEX_CONVERSATIONS = 2147483644\n","import type { WidgetPosition } from '../../../../posthog-conversations-types'\nimport { getStyles } from './styles'\n\ninterface OpenChatButtonProps {\n    primaryColor: string\n    position?: WidgetPosition\n    handleToggleOpen: () => void\n    unreadCount?: number\n}\n\nexport const OpenChatButton = ({\n    primaryColor,\n    position = 'bottom_right',\n    handleToggleOpen,\n    unreadCount = 0,\n}: OpenChatButtonProps) => {\n    const styles = getStyles(primaryColor, position)\n    const displayCount = unreadCount > 99 ? '99+' : unreadCount.toString()\n\n    return (\n        <div style={styles.widget}>\n            <div style={styles.buttonContainer}>\n                <button\n                    style={styles.button}\n                    onClick={handleToggleOpen}\n                    aria-label={unreadCount > 0 ? `Open chat (${unreadCount} unread)` : 'Open chat'}\n                    onMouseEnter={(e) => {\n                        e.currentTarget.style.transform = 'scale(1.05)'\n                        e.currentTarget.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.2)'\n                    }}\n                    onMouseLeave={(e) => {\n                        e.currentTarget.style.transform = 'scale(1)'\n                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)'\n                    }}\n                >\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path\n                            d=\"M12 2C6.48 2 2 6.48 2 12C2 13.93 2.6 15.71 3.64 17.18L2.5 21.5L7.04 20.42C8.46 21.28 10.17 21.75 12 21.75C17.52 21.75 22 17.27 22 11.75C22 6.23 17.52 2 12 2Z\"\n                            fill=\"currentColor\"\n                        />\n                    </svg>\n                </button>\n                {unreadCount > 0 && <div style={styles.unreadBadge}>{displayCount}</div>}\n            </div>\n        </div>\n    )\n}\n","import { getStyles } from './styles'\n\ninterface CloseChatButtonProps {\n    primaryColor: string\n    handleClose: () => void\n}\n\nexport const CloseChatButton = ({ primaryColor, handleClose }: CloseChatButtonProps) => {\n    const styles = getStyles(primaryColor)\n    return (\n        <button\n            style={styles.headerButton}\n            onClick={handleClose}\n            aria-label=\"Close\"\n            onMouseEnter={(e) => {\n                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.15)'\n                e.currentTarget.style.opacity = '1'\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'transparent'\n                e.currentTarget.style.opacity = '0.9'\n            }}\n        >\n            âœ•\n        </button>\n    )\n}\n","/**\n * Format a timestamp to a relative time string\n */\nexport function formatRelativeTime(isoString: string | undefined): string {\n    if (!isoString) {\n        return ''\n    }\n\n    const date = new Date(isoString)\n    const now = new Date()\n    const diffMs = now.getTime() - date.getTime()\n    const diffMins = Math.floor(diffMs / 60000)\n    const diffHours = Math.floor(diffMins / 60)\n    const diffDays = Math.floor(diffHours / 24)\n\n    if (diffMins < 1) {\n        return 'Just now'\n    } else if (diffMins < 60) {\n        return `${diffMins}m ago`\n    } else if (diffHours < 24) {\n        return `${diffHours}h ago`\n    } else if (diffDays === 1) {\n        return 'Yesterday'\n    } else if (diffDays < 7) {\n        return `${diffDays}d ago`\n    } else {\n        return date.toLocaleDateString()\n    }\n}\n\n/**\n * Truncate text to a maximum length with ellipsis\n */\nexport function truncateText(text: string | undefined, maxLength: number): string {\n    if (!text) {\n        return 'No messages yet'\n    }\n    if (text.length <= maxLength) {\n        return text\n    }\n    return text.substring(0, maxLength - 3) + '...'\n}\n\n/**\n * Strip markdown formatting from text for plain text display\n * Lightweight regex-based approach without external dependencies\n */\nexport function stripMarkdown(text: string | undefined): string {\n    if (!text) {\n        return ''\n    }\n\n    return (\n        text\n            // Remove code blocks first (before other processing)\n            .replace(/```[\\s\\S]*?```/g, '')\n            // Remove inline code\n            .replace(/`([^`]+)`/g, '$1')\n            // Remove images\n            .replace(/!\\[([^\\]]*)\\]\\([^)]+\\)/g, '')\n            // Convert links to just text\n            .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1')\n            // Remove headers\n            .replace(/^#{1,6}\\s+/gm, '')\n            // Remove blockquotes\n            .replace(/^>\\s*/gm, '')\n            // Remove horizontal rules (must be before list markers to avoid conflicts)\n            .replace(/^[-*_]{3,}\\s*$/gm, '')\n            // Remove list markers (must be before bold/italic to avoid conflicts with *)\n            .replace(/^[\\s]*[-*+]\\s+/gm, '')\n            .replace(/^[\\s]*\\d+\\.\\s+/gm, '')\n            // Remove bold/italic (order matters: ** before *)\n            .replace(/\\*\\*([^*]+)\\*\\*/g, '$1')\n            .replace(/\\*([^*]+)\\*/g, '$1')\n            .replace(/__([^_]+)__/g, '$1')\n            .replace(/_([^_]+)_/g, '$1')\n            // Remove strikethrough\n            .replace(/~~([^~]+)~~/g, '$1')\n            // Remove HTML tags entirely, then strip any remaining angle brackets for security\n            .replace(/<[^>]*>/g, '')\n            .replace(/[<>]/g, '')\n            // Collapse multiple newlines\n            .replace(/\\n{2,}/g, '\\n')\n            // Trim whitespace\n            .trim()\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, FunctionComponent } from 'preact'\nimport { Ticket, TicketStatus } from '../../../../posthog-conversations-types'\nimport { getStyles } from './styles'\nimport { formatRelativeTime, truncateText, stripMarkdown } from './utils'\n\ninterface TicketListItemProps {\n    ticket: Ticket\n    styles: ReturnType<typeof getStyles>\n    onClick: (ticketId: string) => void\n}\n\n/**\n * Get a human-readable status label\n * Matches the display logic in PostHog main app\n */\nfunction getStatusLabel(status: TicketStatus): string {\n    if (status === 'on_hold') {\n        return 'On hold'\n    }\n    // Capitalize first letter: 'new' -> 'New', 'open' -> 'Open', etc.\n    return status.charAt(0).toUpperCase() + status.slice(1)\n}\n\n/**\n * A single ticket item in the ticket list\n */\nexport const TicketListItem: FunctionComponent<TicketListItemProps> = ({ ticket, styles, onClick }) => {\n    const hasUnread = (ticket.unread_count || 0) > 0\n    const statusLabel = getStatusLabel(ticket.status)\n\n    const handleClick = () => {\n        onClick(ticket.id)\n    }\n\n    const itemStyle = {\n        ...styles.ticketItem,\n        ...(hasUnread ? styles.ticketItemUnread : {}),\n    }\n\n    return (\n        <div\n            style={itemStyle}\n            onClick={handleClick}\n            onKeyDown={(e) => {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault()\n                    handleClick()\n                }\n            }}\n            role=\"button\"\n            tabIndex={0}\n        >\n            <div style={styles.ticketItemContent}>\n                <div style={styles.ticketItemHeader}>\n                    <span style={hasUnread ? styles.ticketPreviewUnread : styles.ticketPreview}>\n                        {truncateText(stripMarkdown(ticket.last_message), 60)}\n                    </span>\n                    {hasUnread && <span style={styles.ticketUnreadBadge}>{ticket.unread_count}</span>}\n                </div>\n                <div style={styles.ticketMeta}>\n                    <span style={styles.ticketTime}>\n                        {formatRelativeTime(ticket.last_message_at || ticket.created_at)}\n                    </span>\n                    <span style={styles.ticketStatus}>{statusLabel}</span>\n                </div>\n            </div>\n            {/* Right arrow indicator */}\n            <div style={styles.ticketItemArrow}>\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <polyline points=\"9 18 15 12 9 6\" />\n                </svg>\n            </div>\n        </div>\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, FunctionComponent } from 'preact'\nimport { Ticket } from '../../../../posthog-conversations-types'\nimport { getStyles } from './styles'\nimport { TicketListItem } from './TicketListItem'\n\ninterface TicketListViewProps {\n    tickets: Ticket[]\n    isLoading: boolean\n    styles: ReturnType<typeof getStyles>\n    onSelectTicket: (ticketId: string) => void\n    onNewConversation: () => void\n    onOpenRestoreRequest: () => void\n}\n\n/**\n * Loading state component\n */\nconst LoadingState: FunctionComponent<{ styles: ReturnType<typeof getStyles> }> = ({ styles }) => (\n    <div style={styles.ticketListLoading}>\n        <div style={styles.loadingSpinner} />\n        <span>Loading conversations...</span>\n    </div>\n)\n\n/**\n * Empty state component when there are no tickets\n */\nconst EmptyState: FunctionComponent<{\n    styles: ReturnType<typeof getStyles>\n    onNewConversation: () => void\n    onOpenRestoreRequest: () => void\n}> = ({ styles, onNewConversation, onOpenRestoreRequest }) => (\n    <div style={styles.ticketListEmpty}>\n        <div style={styles.emptyStateIcon}>\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n                <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n            </svg>\n        </div>\n        <div style={styles.emptyStateTitle}>No conversations yet</div>\n        <div style={styles.emptyStateDescription}>Start a new conversation to get help from our team.</div>\n        <button\n            style={styles.newConversationButtonLarge}\n            onClick={onNewConversation}\n            onMouseEnter={(e) => {\n                e.currentTarget.style.opacity = '0.9'\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.opacity = '1'\n            }}\n        >\n            Start a conversation\n        </button>\n        <button\n            style={styles.fetchPreviousButton}\n            onClick={onOpenRestoreRequest}\n            onMouseEnter={(e) => {\n                e.currentTarget.style.opacity = '0.8'\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.opacity = '1'\n            }}\n        >\n            Fetch previous conversations\n        </button>\n    </div>\n)\n\n/**\n * Ticket list view showing all user's tickets\n */\nexport const TicketListView: FunctionComponent<TicketListViewProps> = ({\n    tickets,\n    isLoading,\n    styles,\n    onSelectTicket,\n    onNewConversation,\n    onOpenRestoreRequest,\n}) => {\n    // Show loading state\n    if (isLoading && tickets.length === 0) {\n        return <LoadingState styles={styles} />\n    }\n\n    // Show empty state when no tickets\n    if (tickets.length === 0) {\n        return (\n            <EmptyState\n                styles={styles}\n                onNewConversation={onNewConversation}\n                onOpenRestoreRequest={onOpenRestoreRequest}\n            />\n        )\n    }\n\n    // Show ticket list\n    return (\n        <div style={styles.ticketListContainer}>\n            {/* Ticket list - sorted by most recent activity */}\n            <div style={styles.ticketList}>\n                {[...tickets]\n                    .sort((a, b) => {\n                        const dateA = new Date(a.last_message_at || a.created_at).getTime()\n                        const dateB = new Date(b.last_message_at || b.created_at).getTime()\n                        return dateB - dateA // Descending order (newest first)\n                    })\n                    .map((ticket) => (\n                        <TicketListItem\n                            key={`${ticket.id}-${ticket.last_message_at || ticket.created_at}-${ticket.unread_count}`}\n                            ticket={ticket}\n                            styles={styles}\n                            onClick={onSelectTicket}\n                        />\n                    ))}\n            </div>\n\n            {/* New conversation button at bottom */}\n            <button\n                style={styles.newConversationButton}\n                onClick={onNewConversation}\n                onMouseEnter={(e) => {\n                    e.currentTarget.style.opacity = '0.9'\n                }}\n                onMouseLeave={(e) => {\n                    e.currentTarget.style.opacity = '1'\n                }}\n            >\n                <svg\n                    width=\"16\"\n                    height=\"16\"\n                    viewBox=\"0 0 24 24\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    style={{ marginRight: '8px' }}\n                >\n                    <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n                    <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n                </svg>\n                New conversation\n            </button>\n        </div>\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h } from 'preact'\nimport { ConversationsRemoteConfig } from '../../../../posthog-conversations-types'\nimport { getStyles } from './styles'\n\ninterface IdentificationFormViewProps {\n    config: ConversationsRemoteConfig\n    styles: ReturnType<typeof getStyles>\n    formName: string\n    formEmail: string\n    formEmailError: string | null\n    onNameChange: (e: Event) => void\n    onEmailChange: (e: Event) => void\n    onSubmit: (e: Event) => void\n}\n\nexport function IdentificationFormView({\n    config,\n    styles,\n    formName,\n    formEmail,\n    formEmailError,\n    onNameChange,\n    onEmailChange,\n    onSubmit,\n}: IdentificationFormViewProps) {\n    const title = config.identificationFormTitle || 'Before we start...'\n    const description = config.identificationFormDescription || 'Please provide your details so we can help you better.'\n    const showNameField = config.collectName !== false\n\n    return (\n        <div style={styles.identificationForm}>\n            <div style={styles.formTitle}>{title}</div>\n            <div style={styles.formDescription}>{description}</div>\n\n            <form onSubmit={onSubmit}>\n                {showNameField && (\n                    <div style={styles.formField}>\n                        <label style={styles.formLabel}>\n                            Name <span style={styles.formOptional}>(optional)</span>\n                        </label>\n                        <input\n                            type=\"text\"\n                            style={styles.formInput}\n                            value={formName}\n                            onInput={onNameChange}\n                            placeholder=\"Your name\"\n                            autoComplete=\"name\"\n                        />\n                    </div>\n                )}\n\n                <div style={styles.formField}>\n                    <label style={styles.formLabel}>\n                        Email {!config.requireEmail && <span style={styles.formOptional}>(optional)</span>}\n                    </label>\n                    <input\n                        type=\"email\"\n                        style={{\n                            ...styles.formInput,\n                            ...(formEmailError ? styles.formInputError : {}),\n                        }}\n                        value={formEmail}\n                        onInput={onEmailChange}\n                        placeholder=\"you@example.com\"\n                        autoComplete=\"email\"\n                    />\n                    {formEmailError && <div style={styles.formError}>{formEmailError}</div>}\n                </div>\n\n                <button\n                    type=\"submit\"\n                    style={styles.formSubmitButton}\n                    onMouseEnter={(e) => {\n                        e.currentTarget.style.opacity = '0.9'\n                    }}\n                    onMouseLeave={(e) => {\n                        e.currentTarget.style.opacity = '1'\n                    }}\n                >\n                    Start Chat\n                </button>\n            </form>\n        </div>\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h } from 'preact'\nimport { getStyles } from './styles'\n\ninterface RestoreRequestViewProps {\n    styles: ReturnType<typeof getStyles>\n    restoreEmail: string\n    restoreEmailError: string | null\n    restoreRequestLoading: boolean\n    restoreRequestSuccess: boolean\n    onEmailChange: (e: Event) => void\n    onSubmit: (e: Event) => void\n}\n\nexport function RestoreRequestView({\n    styles,\n    restoreEmail,\n    restoreEmailError,\n    restoreRequestLoading,\n    restoreRequestSuccess,\n    onEmailChange,\n    onSubmit,\n}: RestoreRequestViewProps) {\n    return (\n        <div style={styles.identificationForm}>\n            <div style={styles.formTitle}>Restore conversations</div>\n            <div style={styles.formDescription}>\n                Don't see your previous conversations? Maybe you use another browser or computer. Enter your email and\n                we will send a secure restore link if matching conversations exist.\n            </div>\n\n            <form onSubmit={onSubmit}>\n                <div style={styles.formField}>\n                    <label style={styles.formLabel}>Email</label>\n                    <input\n                        type=\"email\"\n                        style={{\n                            ...styles.formInput,\n                            ...(restoreEmailError ? styles.formInputError : {}),\n                        }}\n                        value={restoreEmail}\n                        onInput={onEmailChange}\n                        placeholder=\"you@example.com\"\n                        autoComplete=\"email\"\n                        disabled={restoreRequestLoading}\n                    />\n                    {restoreEmailError && <div style={styles.formError}>{restoreEmailError}</div>}\n                </div>\n\n                <button type=\"submit\" style={styles.formSubmitButton} disabled={restoreRequestLoading}>\n                    {restoreRequestLoading ? 'Sending...' : 'Send restore link'}\n                </button>\n            </form>\n\n            {restoreRequestSuccess && (\n                <div style={styles.restoreRequestSuccess}>\n                    Check your email for a secure restore link. If an account is found, we sent it.\n                </div>\n            )}\n        </div>\n    )\n}\n","import { getStyles } from './styles'\n\ninterface SendMessageButtonProps {\n    primaryColor: string\n    inputValue: string\n    isLoading: boolean\n    handleSendMessage: () => void\n}\n\nexport const SendMessageButton = ({\n    primaryColor,\n    inputValue,\n    isLoading,\n    handleSendMessage,\n}: SendMessageButtonProps) => {\n    const styles = getStyles(primaryColor)\n    return (\n        <button\n            style={{\n                ...styles.sendButton,\n                opacity: !inputValue.trim() || isLoading ? 0.6 : 1,\n                cursor: !inputValue.trim() || isLoading ? 'not-allowed' : 'pointer',\n            }}\n            onClick={handleSendMessage}\n            disabled={!inputValue.trim() || isLoading}\n            aria-label=\"Send message\"\n            onMouseEnter={(e) => {\n                if (!e.currentTarget.disabled) {\n                    e.currentTarget.style.transform = 'scale(1.02)'\n                    e.currentTarget.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)'\n                }\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'scale(1)'\n                e.currentTarget.style.boxShadow = '0 2px 0 rgba(0, 0, 0, 0.045)'\n            }}\n        >\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path\n                    d=\"M2 10L18 2L10 18L8 11L2 10Z\"\n                    fill=\"currentColor\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinejoin=\"round\"\n                />\n            </svg>\n        </button>\n    )\n}\n","import{options as n}from\"preact\";var t,r,u,i,o=0,f=[],c=n,e=c.__b,a=c.__r,v=c.diffed,l=c.__c,m=c.unmount,s=c.__;function p(n,t){c.__h&&c.__h(r,n,o||t),o=0;var u=r.__H||(r.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({}),u.__[n]}function d(n){return o=1,h(D,n)}function h(n,u,i){var o=p(t++,2);if(o.t=n,!o.__c&&(o.__=[i?i(u):D(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.__f)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(n){return!!n.__c});if(u.every(function(n){return!n.__N}))return!c||c.call(this,n,t,r);var i=o.__c.props!==n;return u.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),c&&c.call(this,n,t,r)||i};r.__f=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r.shouldComponentUpdate=f}return o.__N||o.__}function y(n,u){var i=p(t++,3);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__H.__h.push(i))}function _(n,u){var i=p(t++,4);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__h.push(i))}function A(n){return o=5,T(function(){return{current:n}},[])}function F(n,t,r){o=6,_(function(){if(\"function\"==typeof n){var r=n(t());return function(){n(null),r&&\"function\"==typeof r&&r()}}if(n)return n.current=t(),function(){return n.current=null}},null==r?r:r.concat(n))}function T(n,r){var u=p(t++,7);return C(u.__H,r)&&(u.__=n(),u.__H=r,u.__h=n),u.__}function q(n,t){return o=8,T(function(){return n},t)}function x(n){var u=r.context[n.__c],i=p(t++,9);return i.c=n,u?(null==i.__&&(i.__=!0,u.sub(r)),u.props.value):n.__}function P(n,t){c.useDebugValue&&c.useDebugValue(t?t(n):n)}function b(n){var u=p(t++,10),i=d();return u.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,t){u.__&&u.__(n,t),i[1](n)}),[i[0],function(){i[1](void 0)}]}function g(){var n=p(t++,11);if(!n.__){for(var u=r.__v;null!==u&&!u.__m&&null!==u.__;)u=u.__;var i=u.__m||(u.__m=[0,0]);n.__=\"P\"+i[0]+\"-\"+i[1]++}return n.__}function j(){for(var n;n=f.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(z),n.__H.__h.forEach(B),n.__H.__h=[]}catch(t){n.__H.__h=[],c.__e(t,n.__v)}}c.__b=function(n){r=null,e&&e(n)},c.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),s&&s(n,t)},c.__r=function(n){a&&a(n),t=0;var i=(r=n.__c).__H;i&&(u===r?(i.__h=[],r.__h=[],i.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(i.__h.forEach(z),i.__h.forEach(B),i.__h=[],t=0)),u=r},c.diffed=function(n){v&&v(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==f.push(t)&&i===c.requestAnimationFrame||((i=c.requestAnimationFrame)||w)(j)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),u=r=null},c.__c=function(n,t){t.some(function(n){try{n.__h.forEach(z),n.__h=n.__h.filter(function(n){return!n.__||B(n)})}catch(r){t.some(function(n){n.__h&&(n.__h=[])}),t=[],c.__e(r,n.__v)}}),l&&l(n,t)},c.unmount=function(n){m&&m(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{z(n)}catch(n){t=n}}),r.__H=void 0,t&&c.__e(t,r.__v))};var k=\"function\"==typeof requestAnimationFrame;function w(n){var t,r=function(){clearTimeout(u),k&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,35);k&&(t=requestAnimationFrame(r))}function z(n){var t=r,u=n.__c;\"function\"==typeof u&&(n.__c=void 0,u()),r=t}function B(n){var t=r;n.__c=n.__(),r=t}function C(n,t){return!n||n.length!==t.length||t.some(function(t,r){return t!==n[r]})}function D(n,t){return\"function\"==typeof t?t(n):t}export{q as useCallback,x as useContext,P as useDebugValue,y as useEffect,b as useErrorBoundary,g as useId,F as useImperativeHandle,_ as useLayoutEffect,T as useMemo,h as useReducer,A as useRef,d as useState};\n//# sourceMappingURL=hooks.module.js.map\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, Fragment } from 'preact'\nimport { useMemo } from 'preact/hooks'\nimport { isUndefined, isNumber, isArray } from '@posthog/core'\nimport { TipTapDoc, TipTapNode, TipTapMark } from '../../../../posthog-conversations-types'\n\ninterface RichContentProps {\n    /** Rich content in TipTap JSON format (preferred) */\n    richContent?: TipTapDoc\n    /** Plain text fallback if rich_content is missing or invalid */\n    content: string\n    /** Whether message is from customer (affects styling) */\n    isCustomer: boolean\n    /** Primary color for links */\n    primaryColor: string\n}\n\n/**\n * Sanitize URL to prevent javascript: and other dangerous protocols.\n * Only allows http:, https:, mailto:, tel:, and relative URLs.\n *\n * Security measures:\n * - Removes ASCII control characters (0x00-0x1F, 0x7F) that could obfuscate protocols\n * - Removes Unicode whitespace and zero-width characters\n * - Collapses whitespace when checking protocols to prevent \"java script:\" bypasses\n * - Blocks javascript:, vbscript:, data:, and file: protocols\n * - Blocks protocol-relative URLs (//example.com)\n */\nfunction sanitizeUrl(url: string): string | undefined {\n    if (!url || typeof url !== 'string') {\n        return undefined\n    }\n\n    // Remove ASCII control characters (0x00-0x1F, 0x7F DEL) that could obfuscate protocols\n    // Also remove zero-width characters (U+200B-U+200D, U+FEFF) that could be used for obfuscation\n    // eslint-disable-next-line no-control-regex\n    const cleanedUrl = url.replace(/[\\x00-\\x1f\\x7f\\u200b-\\u200d\\ufeff]/g, '')\n    const trimmedUrl = cleanedUrl.trim()\n    if (!trimmedUrl) {\n        return undefined\n    }\n\n    // Collapse all whitespace (including Unicode whitespace) when checking protocol\n    // This prevents bypasses like \"java script:\" or \"java\\u00A0script:\" (non-breaking space)\n    const normalizedForCheck = trimmedUrl.replace(/\\s+/g, '').toLowerCase()\n\n    // Block dangerous protocols\n    if (\n        normalizedForCheck.startsWith('javascript:') ||\n        normalizedForCheck.startsWith('vbscript:') ||\n        normalizedForCheck.startsWith('data:') ||\n        normalizedForCheck.startsWith('file:')\n    ) {\n        return undefined\n    }\n\n    // Allow relative URLs (check against trimmed URL, not normalized)\n    // Note: We explicitly check for '//' first to block protocol-relative URLs (e.g., //evil.com)\n    // which could be used to load content from attacker-controlled domains\n    if (trimmedUrl.startsWith('//')) {\n        return undefined\n    }\n    if (\n        trimmedUrl.startsWith('/') ||\n        trimmedUrl.startsWith('./') ||\n        trimmedUrl.startsWith('../') ||\n        trimmedUrl.startsWith('#')\n    ) {\n        return trimmedUrl\n    }\n\n    // Allow safe absolute URLs\n    const lowerUrl = trimmedUrl.toLowerCase()\n    if (\n        lowerUrl.startsWith('http://') ||\n        lowerUrl.startsWith('https://') ||\n        lowerUrl.startsWith('mailto:') ||\n        lowerUrl.startsWith('tel:')\n    ) {\n        return trimmedUrl\n    }\n\n    return undefined\n}\n\n/** Maximum recursion depth to prevent stack overflow */\nconst MAX_DEPTH = 20\n\nfunction getStyles(isCustomer: boolean, primaryColor: string) {\n    return {\n        code: {\n            fontFamily: 'ui-monospace, SFMono-Regular, \"SF Mono\", Menlo, Consolas, \"Liberation Mono\", monospace',\n            fontSize: '0.9em',\n            padding: '2px 4px',\n            borderRadius: '3px',\n            background: isCustomer ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.06)',\n        },\n        codeBlock: {\n            fontFamily: 'ui-monospace, SFMono-Regular, \"SF Mono\", Menlo, Consolas, \"Liberation Mono\", monospace',\n            fontSize: '0.85em',\n            padding: '8px 10px',\n            borderRadius: '6px',\n            background: isCustomer ? 'rgba(255, 255, 255, 0.15)' : '#f4f4f5',\n            overflowX: 'auto' as const,\n            whiteSpace: 'pre-wrap' as const,\n            wordWrap: 'break-word' as const,\n            wordBreak: 'break-word' as const,\n            margin: '8px 0',\n            display: 'block',\n            lineHeight: 1.5,\n            border: isCustomer ? 'none' : '1px solid #e4e4e7',\n        },\n        link: {\n            color: isCustomer ? 'white' : primaryColor,\n            textDecoration: 'underline',\n        },\n        image: {\n            maxWidth: '100%',\n            borderRadius: '4px',\n            marginTop: '4px',\n            marginBottom: '4px',\n            display: 'block',\n        },\n    }\n}\n\n/**\n * Render a text node with its marks (bold, italic, underline, etc.)\n * Marks are applied by wrapping the content in nested elements.\n */\nfunction renderTextWithMarks(\n    text: string,\n    marks: TipTapMark[] | undefined,\n    styles: ReturnType<typeof getStyles>,\n    key: string\n): preact.JSX.Element {\n    if (!marks || marks.length === 0) {\n        return <span key={key}>{text}</span>\n    }\n\n    // Build the element by wrapping with marks from inside out\n    let element: preact.JSX.Element = <>{text}</>\n\n    for (const mark of marks) {\n        switch (mark.type) {\n            case 'bold':\n                element = <strong style={{ fontWeight: 700 }}>{element}</strong>\n                break\n            case 'italic':\n                element = <em style={{ fontStyle: 'italic' }}>{element}</em>\n                break\n            case 'underline':\n                element = <u style={{ textDecoration: 'underline' }}>{element}</u>\n                break\n            case 'strike':\n                element = <s style={{ textDecoration: 'line-through' }}>{element}</s>\n                break\n            case 'code':\n                element = <code style={styles.code}>{element}</code>\n                break\n            case 'link': {\n                const href = mark.attrs?.href\n                const safeUrl = typeof href === 'string' ? sanitizeUrl(href) : undefined\n                if (safeUrl) {\n                    element = (\n                        <a\n                            href={safeUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            referrerPolicy=\"no-referrer\"\n                            style={styles.link}\n                        >\n                            {element}\n                        </a>\n                    )\n                }\n                break\n            }\n            // Ignore unknown mark types for safety\n        }\n    }\n\n    return <span key={key}>{element}</span>\n}\n\n/**\n * Recursively render a TipTap node and its children\n */\nfunction renderNode(\n    node: TipTapNode | TipTapDoc,\n    styles: ReturnType<typeof getStyles>,\n    depth: number,\n    key: string\n): preact.JSX.Element | null {\n    // Safety: prevent infinite recursion\n    if (depth > MAX_DEPTH) {\n        return null\n    }\n\n    // Text node with optional marks\n    if (node.type === 'text' && !isUndefined(node.text)) {\n        return renderTextWithMarks(node.text, node.marks, styles, key)\n    }\n\n    // Render children recursively\n    const children = node.content?.map((child, index) => renderNode(child, styles, depth + 1, `${key}-${index}`)) || []\n\n    switch (node.type) {\n        case 'doc':\n            return <>{children}</>\n\n        case 'paragraph':\n            return (\n                <p key={key} style={{ margin: '0 0 8px 0' }}>\n                    {children.length > 0 ? children : <br />}\n                </p>\n            )\n\n        case 'hardBreak':\n            return <br key={key} />\n\n        case 'codeBlock': {\n            // Code blocks store text in content[0].text\n            const codeText = node.content?.[0]?.text || ''\n            return (\n                <pre key={key} style={styles.codeBlock}>\n                    <code>{codeText}</code>\n                </pre>\n            )\n        }\n\n        case 'image': {\n            const src = node.attrs?.src\n            const alt = node.attrs?.alt\n            const safeUrl = typeof src === 'string' ? sanitizeUrl(src) : undefined\n            if (!safeUrl) {\n                return null\n            }\n            return (\n                <img\n                    key={key}\n                    src={safeUrl}\n                    alt={typeof alt === 'string' ? alt : ''}\n                    style={styles.image}\n                    onError={(e) => {\n                        ;(e.target as HTMLImageElement).style.display = 'none'\n                    }}\n                />\n            )\n        }\n\n        case 'bulletList':\n            return (\n                <ul key={key} style={{ margin: '8px 0', paddingLeft: '24px' }}>\n                    {children}\n                </ul>\n            )\n\n        case 'orderedList':\n            return (\n                <ol key={key} style={{ margin: '8px 0', paddingLeft: '24px' }}>\n                    {children}\n                </ol>\n            )\n\n        case 'listItem':\n            return (\n                <li key={key} style={{ margin: '4px 0' }}>\n                    {children}\n                </li>\n            )\n\n        case 'blockquote':\n            return (\n                <blockquote\n                    key={key}\n                    style={{\n                        margin: '8px 0',\n                        paddingLeft: '12px',\n                        borderLeft: '3px solid #e4e4e7',\n                        color: '#71717a',\n                    }}\n                >\n                    {children}\n                </blockquote>\n            )\n\n        case 'heading': {\n            const rawLevel = node.attrs?.level\n            const level = isNumber(rawLevel) ? rawLevel : 1\n            const HeadingTag = `h${Math.min(Math.max(level, 1), 6)}` as 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6'\n            return (\n                <HeadingTag key={key} style={{ margin: '12px 0 8px 0' }}>\n                    {children}\n                </HeadingTag>\n            )\n        }\n\n        case 'horizontalRule':\n            return <hr key={key} style={{ margin: '12px 0', border: 'none', borderTop: '1px solid #e4e4e7' }} />\n\n        default:\n            // Unknown node types: render children if any, otherwise ignore\n            if (children.length > 0) {\n                return <span key={key}>{children}</span>\n            }\n            return null\n    }\n}\n\n/**\n * Validate that the content looks like a valid TipTap document\n */\nfunction isValidTipTapDoc(doc: unknown): doc is TipTapDoc {\n    if (!doc || typeof doc !== 'object') {\n        return false\n    }\n    const d = doc as TipTapDoc\n    return d.type === 'doc' && (isUndefined(d.content) || isArray(d.content))\n}\n\n/**\n * Render plain text with line breaks preserved\n */\nfunction renderPlainText(text: string): preact.JSX.Element {\n    if (!text) {\n        return <></>\n    }\n    const lines = text.split('\\n')\n    return (\n        <>\n            {lines.map((line, index) => (\n                <Fragment key={index}>\n                    {line}\n                    {index < lines.length - 1 && <br />}\n                </Fragment>\n            ))}\n        </>\n    )\n}\n\n/**\n * RichContent component - renders TipTap JSON content with plain text fallback\n *\n * Rendering logic:\n * 1. If richContent is present and valid, render as TipTap tree\n * 2. If richContent is missing or invalid, fall back to plain text content\n * 3. Wrap TipTap rendering in try/catch for safety\n */\nexport function RichContent({ richContent, content, isCustomer, primaryColor }: RichContentProps) {\n    const styles = useMemo(() => getStyles(isCustomer, primaryColor), [isCustomer, primaryColor])\n\n    // Try to render rich content if available\n    if (richContent) {\n        try {\n            if (isValidTipTapDoc(richContent)) {\n                const rendered = renderNode(richContent, styles, 0, 'root')\n                if (rendered) {\n                    return rendered\n                }\n            }\n        } catch {\n            // Fall through to plain text on any error\n        }\n    }\n\n    // Fallback: render plain text content\n    return renderPlainText(content)\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, Fragment } from 'preact'\nimport { Message } from '../../../../posthog-conversations-types'\nimport { getStyles } from './styles'\nimport { SendMessageButton } from './SendMessageButton'\nimport { RichContent } from './RichContent'\nimport { formatRelativeTime } from './utils'\n\ninterface MessagesViewProps {\n    styles: ReturnType<typeof getStyles>\n    primaryColor: string\n    placeholderText: string\n    messages: Message[]\n    inputValue: string\n    isLoading: boolean\n    error: string | null\n    onInputChange: (e: Event) => void\n    onKeyDown: (e: KeyboardEvent) => void\n    onSendMessage: () => void\n    messagesEndRef: (el: HTMLDivElement | null) => void\n    inputRef: (el: HTMLTextAreaElement | null) => void\n}\n\nfunction MessageBubble({\n    message,\n    styles,\n    primaryColor,\n}: {\n    message: Message\n    styles: ReturnType<typeof getStyles>\n    primaryColor: string\n}) {\n    const isCustomer = message.author_type === 'customer'\n    const messageStyle = {\n        ...styles.message,\n        ...(isCustomer ? styles.messageCustomer : styles.messageAgent),\n    }\n    const contentStyle = {\n        ...styles.messageContent,\n        ...(isCustomer ? styles.messageContentCustomer : styles.messageContentAgent),\n    }\n\n    return (\n        <div key={message.id} style={messageStyle}>\n            {!isCustomer && message.author_name && <div style={styles.messageAuthor}>{message.author_name}</div>}\n            <div style={contentStyle}>\n                <RichContent\n                    richContent={message.rich_content}\n                    content={message.content}\n                    isCustomer={isCustomer}\n                    primaryColor={primaryColor}\n                />\n            </div>\n            <div style={styles.messageTime}>{formatRelativeTime(message.created_at)}</div>\n        </div>\n    )\n}\n\nexport function MessagesView({\n    styles,\n    primaryColor,\n    placeholderText,\n    messages,\n    inputValue,\n    isLoading,\n    error,\n    onInputChange,\n    onKeyDown,\n    onSendMessage,\n    messagesEndRef,\n    inputRef,\n}: MessagesViewProps) {\n    return (\n        <>\n            <div style={styles.messages}>\n                {messages.map((message) => (\n                    <MessageBubble key={message.id} message={message} styles={styles} primaryColor={primaryColor} />\n                ))}\n                <div ref={messagesEndRef} />\n            </div>\n\n            {error && <div style={styles.error}>{error}</div>}\n\n            <div style={styles.inputContainer}>\n                <textarea\n                    ref={inputRef}\n                    style={styles.input}\n                    placeholder={placeholderText}\n                    value={inputValue}\n                    onInput={onInputChange}\n                    onKeyDown={onKeyDown}\n                    rows={1}\n                    disabled={isLoading}\n                />\n                <SendMessageButton\n                    primaryColor={primaryColor}\n                    inputValue={inputValue}\n                    isLoading={isLoading}\n                    handleSendMessage={onSendMessage}\n                />\n            </div>\n        </>\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, Component } from 'preact'\nimport {\n    ConversationsRemoteConfig,\n    Message,\n    ConversationsWidgetState,\n    RequestRestoreLinkResponse,\n    UserProvidedTraits,\n    Ticket,\n} from '../../../../posthog-conversations-types'\nimport { createLogger } from '../../../../utils/logger'\nimport { getStyles } from './styles'\nimport { OpenChatButton } from './OpenChatButton'\nimport { CloseChatButton } from './CloseChatButton'\nimport { TicketListView } from './TicketListView'\nimport { IdentificationFormView } from './IdentificationFormView'\nimport { RestoreRequestView } from './RestoreRequestView'\nimport { MessagesView } from './MessagesView'\n\nconst logger = createLogger('[ConversationsWidget]')\n\n/**\n * Type for the current view in the widget\n */\nexport type WidgetView = 'tickets' | 'messages' | 'restore_request' | 'identification'\n\ninterface WidgetProps {\n    config: ConversationsRemoteConfig\n    initialState?: ConversationsWidgetState\n    initialUserTraits?: UserProvidedTraits | null\n    isUserIdentified?: boolean\n    initialView?: WidgetView\n    initialTickets?: Ticket[]\n    hasMultipleTickets?: boolean\n    onSendMessage: (message: string) => Promise<void>\n    onStateChange?: (state: ConversationsWidgetState) => void\n    onIdentify?: (traits: UserProvidedTraits) => void\n    onRequestRestoreLink?: (email: string) => Promise<RequestRestoreLinkResponse>\n    onSelectTicket?: (ticketId: string) => void\n    onNewConversation?: () => void\n    onBackToTickets?: () => void\n    onViewChange?: (view: WidgetView) => void\n}\n\ninterface WidgetState {\n    state: ConversationsWidgetState\n    view: WidgetView\n    messages: Message[]\n    tickets: Ticket[]\n    ticketsLoading: boolean\n    inputValue: string\n    isLoading: boolean\n    error: string | null\n    formName: string\n    formEmail: string\n    formEmailError: string | null\n    userTraits: UserProvidedTraits | null\n    unreadCount: number\n    hasMultipleTickets: boolean\n    restoreEmail: string\n    restoreEmailError: string | null\n    restoreRequestLoading: boolean\n    restoreRequestSuccess: boolean\n}\n\nexport class ConversationsWidget extends Component<WidgetProps, WidgetState> {\n    private _messagesEndRef: HTMLDivElement | null = null\n    private _inputRef: HTMLTextAreaElement | null = null\n\n    constructor(props: WidgetProps) {\n        super(props)\n\n        // Determine if we need to show the identification form\n        const userTraits = props.initialUserTraits || null\n        const needsIdentification = this._needsIdentification(props.config, userTraits, props.isUserIdentified)\n\n        // If identification is needed, start with that view; otherwise use the provided initial view\n        const initialView = needsIdentification ? 'identification' : props.initialView || 'messages'\n\n        this.state = {\n            state: props.initialState || 'closed',\n            view: initialView,\n            messages: [],\n            tickets: props.initialTickets || [],\n            ticketsLoading: false,\n            inputValue: '',\n            isLoading: false,\n            error: null,\n            formName: userTraits?.name || '',\n            formEmail: userTraits?.email || '',\n            formEmailError: null,\n            userTraits,\n            unreadCount: 0,\n            hasMultipleTickets: props.hasMultipleTickets || false,\n            restoreEmail: userTraits?.email || '',\n            restoreEmailError: null,\n            restoreRequestLoading: false,\n            restoreRequestSuccess: false,\n        }\n    }\n\n    /**\n     * Check if we need to show the identification form\n     */\n    private _needsIdentification(\n        config: ConversationsRemoteConfig,\n        traits: UserProvidedTraits | null,\n        isUserIdentified?: boolean\n    ): boolean {\n        // If user is already identified via PostHog, no form needed\n        // They've called posthog.identify() so we have their identity\n        if (isUserIdentified) {\n            return false\n        }\n\n        // If requireEmail is not set, no identification needed\n        if (!config.requireEmail) {\n            return false\n        }\n\n        // If we already have an email, no form needed\n        if (traits?.email) {\n            return false\n        }\n\n        return true\n    }\n\n    componentDidMount() {\n        // Add greeting message if no messages exist and we're in message view\n        if (this.state.view === 'messages' && this.state.messages.length === 0 && this.props.config.greetingText) {\n            this._addGreetingMessage()\n        }\n    }\n\n    componentDidUpdate(_prevProps: WidgetProps, prevState: WidgetState) {\n        // Scroll to bottom when messages change\n        if (this.state.messages.length !== prevState.messages.length) {\n            this._scrollToBottom()\n        }\n\n        // Notify parent of state changes\n        if (this.state.state !== prevState.state && this.props.onStateChange) {\n            this.props.onStateChange(this.state.state)\n        }\n\n        // Focus input and scroll to bottom when opening\n        if (this.state.state === 'open' && prevState.state !== 'open') {\n            this._focusInput()\n            this._scrollToBottom()\n        }\n    }\n\n    private _addGreetingMessage() {\n        const greetingMessage: Message = {\n            id: 'greeting',\n            content: this.props.config.greetingText || 'Hi! How can we help?',\n            author_type: 'AI',\n            author_name: 'Support',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n        this.setState({ messages: [greetingMessage] })\n    }\n\n    private _scrollToBottom() {\n        if (this._messagesEndRef) {\n            this._messagesEndRef.scrollIntoView({ behavior: 'smooth' })\n        }\n    }\n\n    private _focusInput() {\n        if (this._inputRef) {\n            this._inputRef.focus()\n        }\n    }\n\n    private _handleToggleOpen = () => {\n        this.setState((prevState) => ({\n            state: prevState.state === 'open' ? 'closed' : 'open',\n        }))\n    }\n\n    private _handleClose = () => {\n        this.setState({ state: 'closed' })\n    }\n\n    private _handleSelectTicket = (ticketId: string) => {\n        if (this.props.onSelectTicket) {\n            this.props.onSelectTicket(ticketId)\n        }\n    }\n\n    private _handleNewConversation = () => {\n        if (this.props.onNewConversation) {\n            this.props.onNewConversation()\n        }\n    }\n\n    private _handleBackToTickets = () => {\n        if (this.props.onBackToTickets) {\n            this.props.onBackToTickets()\n        }\n    }\n\n    private _handleOpenRestoreRequest = () => {\n        this.setState((prevState) => ({\n            view: 'restore_request',\n            restoreEmail: prevState.restoreEmail || prevState.userTraits?.email || '',\n            restoreEmailError: null,\n            restoreRequestSuccess: false,\n        }))\n        if (this.props.onViewChange) {\n            this.props.onViewChange('restore_request')\n        }\n    }\n\n    private _handleCloseRestoreRequest = () => {\n        const returnView = this.state.hasMultipleTickets ? 'tickets' : 'messages'\n        this.setState({ view: returnView, restoreEmailError: null, restoreRequestSuccess: false })\n        if (this.props.onViewChange) {\n            this.props.onViewChange(returnView)\n        }\n    }\n\n    private _handleInputChange = (e: Event) => {\n        const target = e.target as HTMLTextAreaElement\n        this.setState({ inputValue: target.value })\n    }\n\n    private _handleKeyPress = (e: KeyboardEvent) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault()\n            this._handleSendMessage()\n        }\n    }\n\n    // Identification form handlers\n    private _handleFormNameChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formName: target.value })\n    }\n\n    private _handleFormEmailChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formEmail: target.value, formEmailError: null })\n    }\n\n    private _handleRestoreEmailChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({\n            restoreEmail: target.value,\n            restoreEmailError: null,\n            restoreRequestSuccess: false,\n        })\n    }\n\n    private _validateEmail(email: string): boolean {\n        // Basic email validation\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n        return emailRegex.test(email)\n    }\n\n    private _handleFormSubmit = (e: Event) => {\n        e.preventDefault()\n\n        const { formEmail, formName } = this.state\n        const { config, onIdentify } = this.props\n\n        // Validate email if required\n        if (config.requireEmail && !formEmail.trim()) {\n            this.setState({ formEmailError: 'Email is required' })\n            return\n        }\n\n        if (formEmail.trim() && !this._validateEmail(formEmail.trim())) {\n            this.setState({ formEmailError: 'Please enter a valid email address' })\n            return\n        }\n\n        // Create traits object\n        const traits: UserProvidedTraits = {}\n        if (formName.trim()) {\n            traits.name = formName.trim()\n        }\n        if (formEmail.trim()) {\n            traits.email = formEmail.trim()\n        }\n\n        // Navigate to appropriate view after identification\n        const nextView = this.state.hasMultipleTickets ? 'tickets' : 'messages'\n\n        // Update state and notify parent\n        this.setState({\n            userTraits: traits,\n            view: nextView,\n        })\n\n        if (onIdentify) {\n            onIdentify(traits)\n        }\n\n        if (this.props.onViewChange) {\n            this.props.onViewChange(nextView)\n        }\n    }\n\n    private _handleRestoreRequestSubmit = async (e: Event) => {\n        e.preventDefault()\n\n        if (!this.props.onRequestRestoreLink) {\n            return\n        }\n\n        const email = this.state.restoreEmail.trim()\n        if (!email) {\n            this.setState({ restoreEmailError: 'Email is required' })\n            return\n        }\n\n        if (!this._validateEmail(email)) {\n            this.setState({ restoreEmailError: 'Please enter a valid email address' })\n            return\n        }\n\n        this.setState({\n            restoreRequestLoading: true,\n            restoreEmailError: null,\n        })\n\n        try {\n            await this.props.onRequestRestoreLink(email)\n            this.setState({\n                restoreRequestLoading: false,\n                restoreRequestSuccess: true,\n            })\n        } catch (error) {\n            logger.error('Failed to request restore link', error)\n            this.setState({\n                restoreRequestLoading: false,\n                restoreEmailError: error instanceof Error ? error.message : 'Failed to request restore link',\n            })\n        }\n    }\n\n    private _handleSendMessage = async () => {\n        const { inputValue } = this.state\n        const trimmedMessage = inputValue.trim()\n\n        if (!trimmedMessage) {\n            return\n        }\n\n        // Add user message to UI immediately\n        const userMessage: Message = {\n            id: `temp-${Date.now()}`,\n            content: trimmedMessage,\n            author_type: 'customer',\n            author_name: 'You',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n\n        this.setState({\n            messages: [...this.state.messages, userMessage],\n            inputValue: '',\n            isLoading: true,\n            error: null,\n        })\n\n        try {\n            await this.props.onSendMessage(trimmedMessage)\n            // Success - message will be updated via addMessage()\n            this.setState({ isLoading: false })\n        } catch (error) {\n            logger.error('Failed to send message', error)\n            this.setState((prevState) => ({\n                isLoading: false,\n                error: error instanceof Error ? error.message : 'Failed to send message',\n                messages: prevState.messages.filter((m) => m.id !== userMessage.id),\n            }))\n        }\n    }\n\n    /**\n     * Public method to add messages from outside\n     */\n    addMessages(messages: Message[]) {\n        this.setState((prevState) => {\n            // Filter out duplicates\n            const existingIds = new Set(prevState.messages.map((m) => m.id))\n            const newMessages = messages.filter((m) => !existingIds.has(m.id))\n\n            if (newMessages.length > 0) {\n                return {\n                    messages: [...prevState.messages, ...newMessages],\n                }\n            }\n            return null\n        })\n    }\n\n    /**\n     * Public method to show the widget\n     */\n    show() {\n        this.setState({ state: 'open' })\n    }\n\n    /**\n     * Public method to hide the widget\n     */\n    hide() {\n        this.setState({ state: 'closed' })\n    }\n\n    /**\n     * Get user traits (either provided via form or from props)\n     */\n    getUserTraits(): UserProvidedTraits | null {\n        return this.state.userTraits\n    }\n\n    /**\n     * Called when user identifies via posthog.identify()\n     * Navigates away from identification form since we now know who they are\n     */\n    setUserIdentified(): void {\n        if (this.state.view === 'identification') {\n            const nextView = this.state.hasMultipleTickets ? 'tickets' : 'messages'\n            this.setState({ view: nextView })\n            if (this.props.onViewChange) {\n                this.props.onViewChange(nextView)\n            }\n        }\n    }\n\n    /**\n     * Set the unread message count (called by manager)\n     */\n    setUnreadCount(count: number): void {\n        this.setState({ unreadCount: count })\n    }\n\n    /**\n     * Update the tickets list (called by manager during polling)\n     */\n    updateTickets(tickets: Ticket[]): void {\n        this.setState({\n            tickets,\n            ticketsLoading: false,\n            hasMultipleTickets: tickets.length > 1,\n        })\n    }\n\n    /**\n     * Set the current view (tickets list or messages)\n     */\n    setView(view: WidgetView): void {\n        this.setState({ view })\n        if (this.props.onViewChange) {\n            this.props.onViewChange(view)\n        }\n    }\n\n    /**\n     * Get the current view\n     */\n    getView(): WidgetView {\n        return this.state.view\n    }\n\n    /**\n     * Set tickets loading state\n     */\n    setTicketsLoading(loading: boolean): void {\n        this.setState({ ticketsLoading: loading })\n    }\n\n    /**\n     * Clear messages (used when switching tickets or starting new conversation)\n     * @param addGreeting - If true, adds the greeting message after clearing\n     */\n    clearMessages(addGreeting: boolean = false): void {\n        this.setState({ messages: [] }, () => {\n            if (addGreeting && this.props.config.greetingText) {\n                this._addGreetingMessage()\n            }\n        })\n    }\n\n    private _renderIdentificationForm(styles: ReturnType<typeof getStyles>) {\n        return (\n            <IdentificationFormView\n                config={this.props.config}\n                styles={styles}\n                formName={this.state.formName}\n                formEmail={this.state.formEmail}\n                formEmailError={this.state.formEmailError}\n                onNameChange={this._handleFormNameChange}\n                onEmailChange={this._handleFormEmailChange}\n                onSubmit={this._handleFormSubmit}\n            />\n        )\n    }\n\n    private _renderBackButton(styles: ReturnType<typeof getStyles>) {\n        const onClick =\n            this.state.view === 'restore_request' ? this._handleCloseRestoreRequest : this._handleBackToTickets\n        return (\n            <button style={styles.backButton} onClick={onClick} aria-label=\"Back to conversations\">\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <polyline points=\"15 18 9 12 15 6\" />\n                </svg>\n            </button>\n        )\n    }\n\n    private _renderTicketList(styles: ReturnType<typeof getStyles>) {\n        const { tickets, ticketsLoading } = this.state\n\n        return (\n            <TicketListView\n                tickets={tickets}\n                isLoading={ticketsLoading}\n                styles={styles}\n                onSelectTicket={this._handleSelectTicket}\n                onNewConversation={this._handleNewConversation}\n                onOpenRestoreRequest={this._handleOpenRestoreRequest}\n            />\n        )\n    }\n\n    private _renderMessages(styles: ReturnType<typeof getStyles>, primaryColor: string, placeholderText: string) {\n        return (\n            <MessagesView\n                styles={styles}\n                primaryColor={primaryColor}\n                placeholderText={placeholderText}\n                messages={this.state.messages}\n                inputValue={this.state.inputValue}\n                isLoading={this.state.isLoading}\n                error={this.state.error}\n                onInputChange={this._handleInputChange}\n                onKeyDown={this._handleKeyPress}\n                onSendMessage={this._handleSendMessage}\n                messagesEndRef={(el) => {\n                    this._messagesEndRef = el\n                }}\n                inputRef={(el) => {\n                    this._inputRef = el\n                }}\n            />\n        )\n    }\n\n    private _renderRestoreRequestView(styles: ReturnType<typeof getStyles>) {\n        return (\n            <RestoreRequestView\n                styles={styles}\n                restoreEmail={this.state.restoreEmail}\n                restoreEmailError={this.state.restoreEmailError}\n                restoreRequestLoading={this.state.restoreRequestLoading}\n                restoreRequestSuccess={this.state.restoreRequestSuccess}\n                onEmailChange={this._handleRestoreEmailChange}\n                onSubmit={this._handleRestoreRequestSubmit}\n            />\n        )\n    }\n\n    /**\n     * Get the title for the current view\n     */\n    private _getTitle(view: WidgetView): string {\n        switch (view) {\n            case 'tickets':\n                return 'Conversations'\n            case 'restore_request':\n                return 'Restore conversations'\n            case 'identification':\n                return 'Support Chat'\n            case 'messages':\n                return 'Support Chat'\n        }\n    }\n\n    /**\n     * Render the content for the current view\n     */\n    private _renderViewContent(\n        styles: ReturnType<typeof getStyles>,\n        primaryColor: string,\n        placeholderText: string\n    ): h.JSX.Element {\n        switch (this.state.view) {\n            case 'identification':\n                return this._renderIdentificationForm(styles)\n            case 'restore_request':\n                return this._renderRestoreRequestView(styles)\n            case 'tickets':\n                return this._renderTicketList(styles)\n            case 'messages':\n                return this._renderMessages(styles, primaryColor, placeholderText)\n        }\n    }\n\n    render() {\n        const { config } = this.props\n        const { state, view } = this.state\n        const primaryColor = config.color || '#5375ff'\n        const widgetPosition = config.widgetPosition || 'bottom_right'\n        const placeholderText = config.placeholderText || 'Type your message...'\n        const styles = getStyles(primaryColor, widgetPosition)\n\n        // Button only (closed state)\n        if (state === 'closed') {\n            return (\n                <OpenChatButton\n                    primaryColor={primaryColor}\n                    position={widgetPosition}\n                    handleToggleOpen={this._handleToggleOpen}\n                    unreadCount={this.state.unreadCount}\n                />\n            )\n        }\n\n        // Open state\n        const windowStyle = {\n            ...styles.window,\n            ...styles.windowOpen,\n        }\n\n        // Show back button in message view when there are multiple tickets or in restore request view\n        const showBackButton = (view === 'messages' && this.state.hasMultipleTickets) || view === 'restore_request'\n\n        // Show recover footer only in tickets and messages views\n        const showRecoverFooter = view === 'tickets' || view === 'messages'\n\n        return (\n            <div style={styles.widget}>\n                <div style={windowStyle}>\n                    <div style={styles.header}>\n                        <div style={showBackButton ? styles.headerWithBack : styles.headerTitle}>\n                            {showBackButton && this._renderBackButton(styles)}\n                            <span style={styles.headerTitle}>{this._getTitle(view)}</span>\n                        </div>\n                        <div style={styles.headerActions}>\n                            <CloseChatButton primaryColor={primaryColor} handleClose={this._handleClose} />\n                        </div>\n                    </div>\n\n                    {this._renderViewContent(styles, primaryColor, placeholderText)}\n\n                    {showRecoverFooter && (\n                        <div style={styles.recoverFooter}>\n                            Don't see your previous tickets?{' '}\n                            <button\n                                type=\"button\"\n                                style={styles.recoverFooterLink}\n                                onClick={this._handleOpenRestoreRequest}\n                            >\n                                Recover them here\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </div>\n        )\n    }\n}\n","import { Breaker, Properties } from '../types'\nimport { nativeForEach, nativeIndexOf } from './globals'\nimport { logger } from './logger'\nimport { isFormData, isNull, isNullish, isNumber, isString, hasOwnProperty, isArray } from '@posthog/core'\n\nconst breaker: Breaker = {}\n\nexport function eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (isNullish(obj)) {\n        return\n    }\n    if (isArray(obj)) {\n        return eachArray(obj, iterator, thisArg)\n    }\n    if (isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const extendArray = function <T>(obj: T[], ...args: T[][]): T[] {\n    eachArray(args, function (source) {\n        eachArray(source, function (item) {\n            obj.push(item)\n        })\n    })\n    return obj\n}\n\nexport const include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const trySafe = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch {\n        return undefined\n    }\n}\n\nexport const safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport const safewrapClass = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const stripEmptyProperties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    each(p, function (v, k) {\n        if ((isString(v) && v.length > 0) || isNumber(v)) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (isArray(value)) {\n            result = [] as any as T\n            eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (isString(value) && !isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\n// NOTE: Update PostHogConfig docs if you change this list\n// We will not try to catch all bullets here, but we should make an effort to catch the most common ones\n// You should be highly against adding more to this list, because ultimately customers can configure\n// their `cross_subdomain_cookie` setting to anything they want.\nconst EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE = ['herokuapp.com', 'vercel.app', 'netlify.app']\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    const lastTwoParts = hostname.split('.').slice(-2).join('.')\n\n    for (const excluded of EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE) {\n        if (lastTwoParts === excluded) {\n            return false\n        }\n    }\n\n    return true\n}\n\nexport function find<T>(value: T[], predicate: (value: T) => boolean): T | undefined {\n    for (let i = 0; i < value.length; i++) {\n        if (predicate(value[i])) {\n            return value[i]\n        }\n    }\n    return undefined\n}\n\n// Use this instead of element.addEventListener to avoid eslint errors\n// this properly implements the default options for passive event listeners\nexport function addEventListener(\n    element: Window | Document | Element | undefined,\n    event: string,\n    callback: EventListener,\n    options?: AddEventListenerOptions\n): void {\n    const { capture = false, passive = true } = options ?? {}\n\n    // This is the only place where we are allowed to call this function\n    // because the whole idea is that we should be calling this instead of the built-in one\n    // eslint-disable-next-line posthog-js/no-add-event-listener\n    element?.addEventListener(event, callback, { capture, passive })\n}\n\n/**\n * Helper to migrate deprecated config fields to new field names with appropriate warnings\n * @param config - The config object to check\n * @param newField - The new field name to use\n * @param oldField - The deprecated field name to check for\n * @param defaultValue - The default value if neither field is set\n * @param loggerInstance - Optional logger instance for deprecation warnings\n * @returns The value to use (new field takes precedence over old field)\n */\nexport function migrateConfigField<T>(\n    config: Record<string, any>,\n    newField: string,\n    oldField: string,\n    defaultValue: T,\n    loggerInstance?: { warn: (message: string) => void }\n): T {\n    const hasNewField = newField in config && !isNullish(config[newField])\n    const hasOldField = oldField in config && !isNullish(config[oldField])\n\n    if (hasNewField) {\n        return config[newField]\n    }\n\n    if (hasOldField) {\n        if (loggerInstance) {\n            loggerInstance.warn(\n                `Config field '${oldField}' is deprecated. Please use '${newField}' instead. ` +\n                    `The old field will be removed in a future major version.`\n            )\n        }\n        return config[oldField]\n    }\n\n    return defaultValue\n}\n","import { each } from './'\n\nimport { isArray, isFile, isUndefined } from '@posthog/core'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (isUndefined(val) || isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\n// NOTE: Once we get rid of IE11/op_mini we can start using URLSearchParams\nexport const getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n\n    // Split only on the first ? to sort problem out for those with multiple ?s\n    // and then remove them\n    const queryParams: string = withoutHash.split(/\\?(.*)/)[1] || ''\n    const cleanedQueryParams = queryParams.replace(/^\\?+/g, '')\n\n    const queryParts = cleanedQueryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\n// replace any query params in the url with the provided mask value. Tries to keep the URL as instant as possible,\n// including preserving malformed text in most cases\nexport const maskQueryParams = function <T extends string | undefined>(\n    url: T,\n    maskedParams: string[] | undefined,\n    mask: string\n): T extends string ? string : undefined {\n    if (!url || !maskedParams || !maskedParams.length) {\n        return url as any\n    }\n\n    const splitHash = url.split('#')\n    const withoutHash: string = splitHash[0] || ''\n    const hash = splitHash[1]\n\n    const splitQuery: string[] = withoutHash.split('?')\n    const queryString: string = splitQuery[1]\n    const urlWithoutQueryAndHash: string = splitQuery[0]\n    const queryParts = (queryString || '').split('&')\n\n    // use an array of strings rather than an object to preserve ordering and duplicates\n    const paramStrings: string[] = []\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const keyValuePair = queryParts[i].split('=')\n        if (!isArray(keyValuePair)) {\n            continue\n        } else if (maskedParams.includes(keyValuePair[0])) {\n            paramStrings.push(keyValuePair[0] + '=' + mask)\n        } else {\n            paramStrings.push(queryParts[i])\n        }\n    }\n\n    let result = urlWithoutQueryAndHash\n    if (queryString != null) {\n        result += '?' + paramStrings.join('&')\n    }\n    if (hash != null) {\n        result += '#' + hash\n    }\n\n    return result as any\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","import { createLogger } from '../../../utils/logger'\nimport { window } from '../../../utils/globals'\n\nconst logger = createLogger('[ConversationsManager]')\n\nexport const RESTORE_QUERY_PARAM = 'ph_conv_restore'\n\n/**\n * Extract hostname from a domain string (handles URLs and plain hostnames)\n */\nfunction extractHostname(domain: string): string | null {\n    let hostname = domain.replace(/^https?:\\/\\//, '')\n    hostname = hostname.split('/')[0].split('?')[0].split(':')[0]\n    return hostname || null\n}\n\n/**\n * Check if the current domain matches the allowed domains list.\n * Returns true if:\n * - domains is empty or not present (no restriction)\n * - current hostname matches any allowed domain\n */\nexport function isCurrentDomainAllowed(domains: string[] | undefined): boolean {\n    if (!domains || domains.length === 0) {\n        return true\n    }\n\n    const currentHostname = window?.location?.hostname\n    if (!currentHostname) {\n        return true\n    }\n\n    return domains.some((domain) => {\n        const allowedHostname = extractHostname(domain)\n        if (!allowedHostname) {\n            return false\n        }\n\n        if (allowedHostname.startsWith('*.')) {\n            const pattern = allowedHostname.slice(2)\n            return currentHostname.endsWith(`.${pattern}`) || currentHostname === pattern\n        }\n\n        return currentHostname === allowedHostname\n    })\n}\n\nexport function getRestoreTokenFromUrl(): string | null {\n    if (!window?.location?.search) {\n        return null\n    }\n\n    try {\n        // eslint-disable-next-line compat/compat\n        const params = new URLSearchParams(window.location.search)\n        const token = params.get(RESTORE_QUERY_PARAM)\n        return token?.trim() || null\n    } catch (error) {\n        logger.warn('Failed to parse restore token from URL', error)\n        return null\n    }\n}\n\nexport function clearRestoreTokenFromUrl(): void {\n    if (!window?.location || !window?.history?.replaceState) {\n        return\n    }\n\n    try {\n        // eslint-disable-next-line compat/compat\n        const url = new URL(window.location.href)\n        url.searchParams.delete(RESTORE_QUERY_PARAM)\n        const newUrl = `${url.pathname}${url.search}${url.hash}`\n        window.history.replaceState(window.history.state, '', newUrl)\n    } catch (error) {\n        logger.warn('Failed to clear restore token from URL', error)\n    }\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { render, h } from 'preact'\nimport { isNumber } from '@posthog/core'\nimport {\n    ConversationsRemoteConfig,\n    ConversationsWidgetState,\n    UserProvidedTraits,\n    SendMessageResponse,\n    SendMessagePayload,\n    GetMessagesResponse,\n    MarkAsReadResponse,\n    GetTicketsOptions,\n    GetTicketsResponse,\n    Ticket,\n    RestoreFromTokenPayload,\n    RestoreFromTokenResponse,\n    RequestRestoreLinkPayload,\n    RequestRestoreLinkResponse,\n} from '../../../posthog-conversations-types'\nimport { PostHog } from '../../../posthog-core'\nimport { ConversationsManager as ConversationsManagerInterface } from '../posthog-conversations'\nimport { ConversationsPersistence } from './persistence'\nimport { ConversationsWidget, WidgetView } from './components/ConversationsWidget'\nimport { createLogger } from '../../../utils/logger'\nimport { document, window } from '../../../utils/globals'\nimport { formDataToQuery } from '../../../utils/request-utils'\nimport { isCurrentDomainAllowed, getRestoreTokenFromUrl, clearRestoreTokenFromUrl } from './url-utils'\n\nconst logger = createLogger('[ConversationsManager]')\n\nconst WIDGET_CONTAINER_ID = 'ph-conversations-widget-container'\nconst POLL_INTERVAL_MS = 5000 // 5 seconds\nconst RESTORE_EXCHANGE_ENDPOINT = '/api/conversations/v1/widget/restore'\nconst RESTORE_REQUEST_ENDPOINT = '/api/conversations/v1/widget/restore/request'\n\n// Singleton guard: only one ConversationsManager per page, regardless of PostHog instance count.\n// Multiple PostHog instances (e.g. toolbar + main app) share the same DOM and script tags,\n// so we enforce a single manager to avoid duplicate widgets and mismatched widget_session_ids.\nlet _activeManager: ConversationsManager | null = null\n\nexport class ConversationsManager implements ConversationsManagerInterface {\n    private _config: ConversationsRemoteConfig\n    private _persistence: ConversationsPersistence\n    private _widgetRef: ConversationsWidget | null = null\n    private _containerElement: HTMLDivElement | null = null\n    private _currentTicketId: string | null = null\n    private _pollIntervalId: number | null = null\n    private _lastMessageTimestamp: string | null = null\n    private _isPollingMessages: boolean = false\n    private _isPollingTickets: boolean = false\n    private _unsubscribeIdentifyListener: (() => void) | null = null\n    private _unreadCount: number = 0\n    // SECURITY: widget_session_id is the key for access control\n    // This is a random UUID that only this browser knows\n    private _widgetSessionId: string\n    private _isWidgetEnabled: boolean\n    private _isDomainAllowed: boolean\n    private _widgetState: ConversationsWidgetState = 'closed'\n    private _isWidgetRendered: boolean = false\n    private _hasProcessedRestoreToken: boolean = false\n    private _initializeWidgetPromise: Promise<void> | null = null\n    // View state management for ticket list vs message view\n    private _currentView: WidgetView = 'messages'\n    private _tickets: Ticket[] = []\n    private _hasMultipleTickets: boolean = false\n\n    constructor(\n        config: ConversationsRemoteConfig,\n        private readonly _posthog: PostHog\n    ) {\n        this._config = config\n        this._persistence = new ConversationsPersistence(_posthog)\n\n        this._widgetSessionId = this._persistence.getOrCreateWidgetSessionId()\n\n        // Determine if widget should be shown based on config and domain\n        this._isWidgetEnabled = config.widgetEnabled === true\n        this._isDomainAllowed = isCurrentDomainAllowed(config.domains)\n\n        logger.info('ConversationsManager initialized', {\n            config,\n            widgetSessionId: this._widgetSessionId,\n            isWidgetEnabled: this._isWidgetEnabled,\n            isDomainAllowed: this._isDomainAllowed,\n        })\n\n        this._initialize()\n    }\n\n    /**\n     * Send a message programmatically via the API\n     * Creates a new ticket if none exists or if newTicket is true\n     *\n     * @param message - The message text to send\n     * @param userTraits - Optional user identification data (name, email)\n     * @param newTicket - If true, forces creation of a new ticket (ignores current ticket)\n     * @returns Promise with the response including ticket_id and message_id\n     */\n    async sendMessage(\n        message: string,\n        userTraits?: UserProvidedTraits,\n        newTicket?: boolean\n    ): Promise<SendMessageResponse> {\n        // Determine which ticket to use\n        // If newTicket is true, force creation of new ticket by sending null\n        // Otherwise use current ticket ID (which may be null if no ticket exists yet)\n        const ticketId = newTicket ? null : this._currentTicketId\n\n        // Track if this is creating a new ticket\n        const isNewTicket = !ticketId\n\n        const token = this._config.token\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            const distinctId = this._posthog.get_distinct_id()\n            const personProperties = this._posthog.persistence?.props || {}\n\n            // Priority for traits:\n            // 1. User-provided traits from the widget form\n            // 2. PostHog person properties\n            const name = userTraits?.name || personProperties.$name || personProperties.name || null\n            const email = userTraits?.email || personProperties.$email || personProperties.email || null\n\n            const payload: Partial<SendMessagePayload> = {\n                widget_session_id: this._widgetSessionId,\n                // distinct_id is only used for Person linking, not access control\n                distinct_id: distinctId,\n                message: message.trim(),\n                traits: {\n                    name,\n                    email,\n                },\n                ticket_id: ticketId,\n            }\n\n            try {\n                // Capture session ID - sent with every message\n                const capturedSessionId = this._posthog.get_session_id()\n                if (capturedSessionId) {\n                    payload.session_id = capturedSessionId\n                }\n\n                // Capture session replay URL with timestamp - sent with every message\n                const replayUrl = this._posthog.get_session_replay_url({\n                    withTimestamp: true,\n                    timestampLookBack: 30,\n                })\n\n                // Capture current URL - only for new tickets to record where user started\n                const currentUrl = isNewTicket ? window?.location?.href : undefined\n\n                if (replayUrl || currentUrl) {\n                    payload.session_context = {\n                        session_replay_url: replayUrl || undefined,\n                        current_url: currentUrl || undefined,\n                    }\n                }\n            } catch (error) {\n                // Log error but don't fail message sending\n                logger.warn('Failed to capture session context', error)\n            }\n\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor('api', '/api/conversations/v1/widget/message'),\n                method: 'POST',\n                data: payload,\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200 && response.statusCode !== 201) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to send message'\n                        logger.error('Failed to send message', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as SendMessageResponse\n\n                    // Update current ticket ID if this was a new ticket\n                    // This happens when: 1) No ticket existed, or 2) User forced new ticket creation\n                    if (isNewTicket && data.ticket_id) {\n                        this._currentTicketId = data.ticket_id\n                        this._persistence.saveTicketId(data.ticket_id)\n                        logger.info('New ticket created', {\n                            ticketId: data.ticket_id,\n                            forced: newTicket === true,\n                        })\n                    }\n\n                    // Track message sent\n                    this._posthog.capture('$conversations_message_sent', {\n                        ticketId: data.ticket_id,\n                        isNewTicket: isNewTicket,\n                        messageLength: message.length,\n                    })\n\n                    // Update last message timestamp\n                    this._lastMessageTimestamp = data.created_at\n\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /**\n     * Switch to a different ticket if an explicit ticketId is provided\n     * This ensures subsequent operations (sendMessage, etc.) use the correct ticket\n     */\n    private _switchToTicketIfNeeded(ticketId: string | undefined): void {\n        if (ticketId && ticketId !== this._currentTicketId) {\n            this._currentTicketId = ticketId\n            this._persistence.saveTicketId(ticketId)\n            // Reset last message timestamp when switching tickets\n            this._lastMessageTimestamp = null\n        }\n    }\n\n    /** Fetch messages via the API */\n    async getMessages(ticketId?: string, after?: string): Promise<GetMessagesResponse> {\n        // Use provided ticketId or fall back to current ticket\n        const targetTicketId = ticketId || this._currentTicketId\n\n        if (!targetTicketId) {\n            throw new Error('No ticket ID provided and no active conversation')\n        }\n\n        // Switch to this ticket if explicitly provided\n        this._switchToTicketIfNeeded(ticketId)\n\n        const token = this._config.token\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            // SECURITY: widget_session_id is required for access control\n            // distinct_id is NOT sent for getMessages - access is controlled by widget_session_id only\n            const queryParams: Record<string, string> = {\n                widget_session_id: this._widgetSessionId,\n                limit: '50',\n            }\n\n            if (after) {\n                queryParams.after = after\n            }\n\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/messages/${targetTicketId}?${formDataToQuery(queryParams)}`\n                ),\n                method: 'GET',\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to fetch messages'\n                        logger.error('Failed to fetch messages', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as GetMessagesResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /** Mark messages as read via the API */\n    async markAsRead(ticketId?: string): Promise<MarkAsReadResponse> {\n        // Use provided ticketId or fall back to current ticket\n        const targetTicketId = ticketId || this._currentTicketId\n\n        if (!targetTicketId) {\n            throw new Error('No ticket ID provided and no active conversation')\n        }\n\n        // Switch to this ticket if explicitly provided\n        this._switchToTicketIfNeeded(ticketId)\n\n        const token = this._config.token\n\n        logger.info('Marking messages as read', { ticketId: targetTicketId })\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/messages/${targetTicketId}/read`\n                ),\n                method: 'POST',\n                data: {\n                    widget_session_id: this._widgetSessionId,\n                },\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg =\n                            response.json?.detail || response.json?.message || 'Failed to mark messages as read'\n                        logger.error('Failed to mark messages as read', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as MarkAsReadResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /**\n     * Initialize the conversations manager.\n     * Always initializes persistence and event listeners for API usage.\n     * Only renders the widget if widgetEnabled is true AND domain is allowed.\n     */\n    private _initialize(): void {\n        if (!document || !window) {\n            logger.info('Conversations not available: Document or window not available')\n            return\n        }\n\n        const restoreToken = getRestoreTokenFromUrl()\n        if (restoreToken && !this._hasProcessedRestoreToken) {\n            this._hasProcessedRestoreToken = true\n\n            // Clear the token from the URL immediately, then again after a tick and\n            // after the restore completes.  SPA routers (Next.js, React Router, etc.)\n            // maintain their own URL state and can overwrite a single replaceState call.\n            clearRestoreTokenFromUrl()\n            setTimeout(clearRestoreTokenFromUrl, 0)\n\n            this._restoreFromTokenWithRetry(restoreToken)\n                .catch((error) => {\n                    logger.warn('Failed to restore conversations from URL token', error)\n                })\n                .finally(() => {\n                    clearRestoreTokenFromUrl()\n                    this._completeInitialization()\n                })\n            return\n        }\n\n        this._completeInitialization()\n    }\n\n    private _completeInitialization(): void {\n        this._hasProcessedRestoreToken = true\n\n        // Load any existing ticket ID from localStorage\n        this._currentTicketId = this._persistence.loadTicketId()\n        logger.info('Loaded ticket ID from storage', { ticketId: this._currentTicketId })\n\n        // Track conversations API loaded (separate from widget loaded)\n        this._posthog.capture('$conversations_loaded', {\n            hasExistingTicket: !!this._currentTicketId,\n            widgetEnabled: this._isWidgetEnabled,\n            domainAllowed: this._isDomainAllowed,\n        })\n\n        // Only render widget if both widgetEnabled and domain is allowed\n        if (this._isWidgetEnabled && this._isDomainAllowed) {\n            this._initializeWidget()\n        } else {\n            logger.info('Widget not rendered', {\n                widgetEnabled: this._isWidgetEnabled,\n                domainAllowed: this._isDomainAllowed,\n            })\n        }\n\n        // Listen for identify events to hide identification form when user identifies\n        this._setupIdentifyListener()\n    }\n\n    private async _restoreFromTokenWithRetry(restoreToken: string): Promise<RestoreFromTokenResponse> {\n        try {\n            return await this._restoreFromToken(restoreToken)\n        } catch (error) {\n            logger.warn('Restore token exchange failed, retrying once', error)\n            return await this._restoreFromToken(restoreToken)\n        }\n    }\n\n    private async _restoreFromToken(restoreToken: string): Promise<RestoreFromTokenResponse> {\n        const token = this._config.token\n\n        const payload: RestoreFromTokenPayload = {\n            restore_token: restoreToken,\n            widget_session_id: this._widgetSessionId,\n            distinct_id: this._posthog.get_distinct_id(),\n            current_url: window?.location?.href,\n        }\n\n        // eslint-disable-next-line compat/compat\n        const data = await new Promise<RestoreFromTokenResponse>((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor('api', RESTORE_EXCHANGE_ENDPOINT),\n                method: 'POST',\n                data: payload,\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg =\n                            response.json?.error ||\n                            response.json?.detail ||\n                            response.json?.message ||\n                            'Failed to restore conversations'\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    resolve(response.json as RestoreFromTokenResponse)\n                },\n            })\n        })\n\n        if (data.status !== 'success') {\n            logger.info('Restore token was not accepted', { status: data.status, code: data.code })\n            return data\n        }\n\n        this._lastMessageTimestamp = null\n        this._unreadCount = 0\n\n        // Apply the canonical widget_session_id from the server if provided\n        if (data.widget_session_id) {\n            this._widgetSessionId = data.widget_session_id\n            this._persistence.setWidgetSessionId(data.widget_session_id)\n        }\n\n        if (data.migrated_ticket_ids?.length) {\n            this._currentTicketId = data.migrated_ticket_ids[0]\n            this._persistence.saveTicketId(this._currentTicketId)\n            // Poll straight away so messages and ticket list are fresh\n            void this._pollMessages()\n            void this._pollTickets()\n        } else {\n            this._currentTicketId = null\n            this._persistence.clearTicketId()\n        }\n\n        return data\n    }\n\n    /**\n     * Initialize and render the widget UI\n     * Uses a promise guard to prevent race conditions from concurrent calls\n     */\n    private _initializeWidget(): Promise<void> {\n        if (this._isWidgetRendered) {\n            return Promise.resolve()\n        }\n        if (this._initializeWidgetPromise) {\n            return this._initializeWidgetPromise\n        }\n        this._initializeWidgetPromise = this._doInitializeWidget()\n        return this._initializeWidgetPromise\n    }\n\n    private async _doInitializeWidget(): Promise<void> {\n        const savedState = this._persistence.loadWidgetState()\n        const initialState: ConversationsWidgetState = savedState === 'open' ? 'open' : 'closed'\n        this._widgetState = initialState\n\n        // Get initial user traits (from PostHog person properties or saved)\n        const initialUserTraits = this._getInitialUserTraits()\n\n        // Determine initial view based on ticket count\n        const { view: initialView, tickets } = await this._determineInitialView()\n        this._currentView = initialView\n\n        // Render the widget with initial view\n        this._renderWidget(initialState, initialUserTraits, initialView, tickets)\n        this._isWidgetRendered = true\n\n        this._posthog.capture('$conversations_widget_loaded', {\n            hasExistingTicket: !!this._currentTicketId,\n            initialState: initialState,\n            initialView: initialView,\n            ticketCount: tickets.length,\n            hasUserTraits: !!initialUserTraits,\n        })\n\n        // Start polling â€” the first poll fires immediately and loads messages or tickets\n        this._startPolling()\n    }\n\n    /**\n     * Get initial user traits from PostHog or localStorage\n     */\n    private _getInitialUserTraits(): UserProvidedTraits | null {\n        // First, check PostHog's person properties\n        const personProperties = this._posthog.persistence?.props || {}\n        const posthogName = personProperties.$name || personProperties.name\n        const posthogEmail = personProperties.$email || personProperties.email\n\n        // If we have traits from PostHog, use those\n        if (posthogName || posthogEmail) {\n            return {\n                name: posthogName || undefined,\n                email: posthogEmail || undefined,\n            }\n        }\n\n        // Otherwise, check localStorage for previously saved traits\n        const savedTraits = this._persistence.loadUserTraits()\n        if (savedTraits && (savedTraits.name || savedTraits.email)) {\n            return savedTraits\n        }\n\n        return null\n    }\n\n    /**\n     * Handle user identification from the widget form\n     */\n    private _handleIdentify = (traits: UserProvidedTraits): void => {\n        // Save traits to localStorage\n        this._persistence.saveUserTraits(traits)\n\n        // Track identification\n        this._posthog.capture('$conversations_user_identified', {\n            hasName: !!traits.name,\n            hasEmail: !!traits.email,\n        })\n    }\n\n    private _handleRequestRestoreLink = async (email: string): Promise<RequestRestoreLinkResponse> => {\n        const response = await this.requestRestoreLink(email)\n        this._posthog.capture('$conversations_restore_link_requested', {\n            hasEmail: !!email,\n        })\n        return response\n    }\n\n    /**\n     * Handle sending a message from the widget\n     */\n    private _handleSendMessage = async (message: string): Promise<void> => {\n        // Get user traits from the widget\n        const userTraits = this._widgetRef?.getUserTraits() || undefined\n\n        try {\n            // Call the public API method (which handles tracking and state updates)\n            await this.sendMessage(message, userTraits)\n\n            // Poll for response immediately\n            setTimeout(() => this._pollMessages(), 1000)\n        } catch (error) {\n            logger.error('Failed to send message', error)\n            throw error\n        }\n    }\n\n    /**\n     * Handle widget state changes\n     */\n    private _handleStateChange = (state: ConversationsWidgetState): void => {\n        this._widgetState = state\n        logger.info('Widget state changed', { state, view: this._currentView })\n\n        this._posthog.capture('$conversations_widget_state_changed', {\n            state: state,\n            view: this._currentView,\n            ticketId: this._currentTicketId,\n        })\n\n        this._persistence.saveWidgetState(state)\n\n        // Mark messages as read when widget opens (only if in message view with a ticket)\n        if (state === 'open') {\n            if (this._currentView === 'messages' && this._unreadCount > 0 && this._currentTicketId) {\n                this._markMessagesAsRead()\n            }\n        }\n    }\n\n    /**\n     * Mark messages as read\n     */\n    private async _markMessagesAsRead(): Promise<void> {\n        if (!this._currentTicketId) {\n            return\n        }\n\n        try {\n            const response = await this.markAsRead(this._currentTicketId)\n            this._unreadCount = response.unread_count\n            // Update the widget to reflect the new unread count\n            this._widgetRef?.setUnreadCount(0)\n            logger.info('Messages marked as read', { unreadCount: response.unread_count })\n        } catch (error) {\n            logger.error('Failed to mark messages as read', error)\n        }\n    }\n\n    /**\n     * Load messages for the current ticket\n     */\n    private async _loadMessages(): Promise<void> {\n        if (!this._currentTicketId) {\n            return\n        }\n\n        try {\n            const response = await this.getMessages(this._currentTicketId, this._lastMessageTimestamp || undefined)\n\n            // Update unread count from response\n            if (isNumber(response.unread_count)) {\n                this._unreadCount = response.unread_count\n                this._widgetRef?.setUnreadCount(response.unread_count)\n\n                // If widget is open and there are unread messages, mark them as read\n                if (response.unread_count > 0 && this._isWidgetOpen()) {\n                    this._markMessagesAsRead()\n                }\n            }\n\n            if (response.messages.length > 0) {\n                this._widgetRef?.addMessages(response.messages)\n                // Update last message timestamp\n                const lastMessage = response.messages[response.messages.length - 1]\n                this._lastMessageTimestamp = lastMessage.created_at\n            }\n        } catch (error) {\n            logger.error('Failed to load messages', error)\n        }\n    }\n\n    private _isWidgetOpen(): boolean {\n        return this._widgetState === 'open'\n    }\n\n    /**\n     * Poll for new messages\n     */\n    private _pollMessages = async (): Promise<void> => {\n        if (this._isPollingMessages || !this._currentTicketId) {\n            return\n        }\n\n        this._isPollingMessages = true\n        try {\n            await this._loadMessages()\n        } finally {\n            this._isPollingMessages = false\n        }\n    }\n\n    /**\n     * Poll for tickets list\n     */\n    private _pollTickets = async (): Promise<void> => {\n        if (this._isPollingTickets) {\n            return\n        }\n\n        this._isPollingTickets = true\n        try {\n            await this._loadTickets()\n        } finally {\n            this._isPollingTickets = false\n        }\n    }\n\n    /**\n     * Load tickets list from API\n     */\n    private async _loadTickets(): Promise<void> {\n        try {\n            const response = await this.getTickets()\n            this._tickets = response.results\n            this._hasMultipleTickets = response.results.length > 1\n            this._widgetRef?.updateTickets(response.results)\n\n            // Calculate total unread across all tickets\n            const totalUnread = response.results.reduce((sum, t) => sum + (t.unread_count || 0), 0)\n            this._unreadCount = totalUnread\n            this._widgetRef?.setUnreadCount(totalUnread)\n\n            logger.info('Tickets loaded', { count: response.results.length, totalUnread })\n        } catch (error) {\n            logger.error('Failed to load tickets', error)\n        }\n    }\n\n    /**\n     * Main poll function that polls based on current view\n     */\n    private _poll = async (): Promise<void> => {\n        if (this._currentView === 'restore_request') {\n            return\n        }\n\n        if (this._currentView === 'messages') {\n            await this._pollMessages()\n        } else {\n            await this._pollTickets()\n        }\n    }\n\n    /**\n     * Handle view changes from the widget\n     */\n    private _handleViewChange = (view: WidgetView): void => {\n        logger.info('View changed', { from: this._currentView, to: view })\n        this._currentView = view\n    }\n\n    /**\n     * Handle ticket selection from the list\n     */\n    private _handleSelectTicket = async (ticketId: string): Promise<void> => {\n        // Switch to this ticket\n        this._switchToTicketIfNeeded(ticketId)\n\n        // Clear messages and reset timestamp\n        this._lastMessageTimestamp = null\n        this._widgetRef?.clearMessages()\n\n        // Switch view to messages\n        this._currentView = 'messages'\n        this._widgetRef?.setView('messages')\n\n        // Load messages for the selected ticket\n        await this._loadMessages()\n\n        // Mark as read if widget is open\n        if (this._isWidgetOpen() && this._unreadCount > 0) {\n            this._markMessagesAsRead()\n        }\n    }\n\n    /**\n     * Handle new conversation request\n     */\n    private _handleNewConversation = (): void => {\n        logger.info('New conversation requested')\n\n        // Clear current ticket\n        this._currentTicketId = null\n        this._persistence.clearTicketId()\n\n        // Reset timestamp\n        this._lastMessageTimestamp = null\n\n        // Switch view to messages\n        this._currentView = 'messages'\n        this._widgetRef?.setView('messages')\n\n        // Clear messages and add greeting\n        this._widgetRef?.clearMessages(true)\n    }\n\n    /**\n     * Handle back to tickets request\n     */\n    private _handleBackToTickets = async (): Promise<void> => {\n        logger.info('Back to tickets requested')\n\n        // Switch view to tickets\n        this._currentView = 'tickets'\n        this._widgetRef?.setView('tickets')\n\n        // Load tickets\n        this._widgetRef?.setTicketsLoading(true)\n        await this._loadTickets()\n\n        // Track back to tickets\n        this._posthog.capture('$conversations_back_to_tickets')\n    }\n\n    /**\n     * Determine initial view based on ticket count\n     */\n    private async _determineInitialView(): Promise<{ view: WidgetView; tickets: Ticket[] }> {\n        try {\n            const response = await this.getTickets()\n            this._tickets = response.results\n            this._hasMultipleTickets = response.results.length > 1\n\n            // Calculate total unread\n            const totalUnread = response.results.reduce((sum, t) => sum + (t.unread_count || 0), 0)\n            this._unreadCount = totalUnread\n\n            // If 2+ tickets, show ticket list; otherwise show messages\n            if (response.results.length >= 2) {\n                return { view: 'tickets', tickets: response.results }\n            }\n\n            // If exactly 1 ticket, set it as current\n            if (response.results.length === 1) {\n                this._currentTicketId = response.results[0].id\n                this._persistence.saveTicketId(response.results[0].id)\n            }\n\n            return { view: 'messages', tickets: response.results }\n        } catch (error) {\n            logger.error('Failed to determine initial view', error)\n            return { view: 'messages', tickets: [] }\n        }\n    }\n\n    /**\n     * Start polling based on current view\n     */\n    private _startPolling(): void {\n        if (this._pollIntervalId) {\n            return // Already polling\n        }\n\n        // Poll immediately\n        this._poll()\n\n        // Set up interval\n        this._pollIntervalId = window?.setInterval(() => {\n            this._poll()\n        }, POLL_INTERVAL_MS) as unknown as number\n\n        logger.info('Started polling', { view: this._currentView })\n    }\n\n    /**\n     * Stop polling for new messages\n     */\n    private _stopPolling(): void {\n        if (this._pollIntervalId) {\n            window?.clearInterval(this._pollIntervalId)\n            this._pollIntervalId = null\n            logger.info('Stopped polling for messages')\n        }\n    }\n\n    /**\n     * Setup listener for identify events.\n     * When user calls posthog.identify(), hide the identification form\n     * since we now know who they are.\n     */\n    private _setupIdentifyListener(): void {\n        this._unsubscribeIdentifyListener = this._posthog.on('eventCaptured', (event: any) => {\n            if (event.event === '$identify') {\n                // User just identified - hide the identification form if it's showing\n                this._widgetRef?.setUserIdentified()\n            }\n        })\n    }\n\n    /**\n     * Show the widget (render it to DOM).\n     * The widget respects its saved state (open/closed).\n     * Note: Domain restrictions still apply - widget won't render on disallowed domains.\n     */\n    show(): void {\n        // Check domain restrictions - don't render on disallowed domains\n        if (!this._isDomainAllowed) {\n            logger.warn('Cannot show widget: current domain is not allowed')\n            return\n        }\n\n        // If widget isn't rendered yet, render it now\n        if (!this._isWidgetRendered) {\n            this._initializeWidget()\n        }\n    }\n\n    /**\n     * Hide and remove the widget from the DOM.\n     * Conversation data is preserved - call show() to re-render.\n     */\n    hide(): void {\n        // Stop polling when widget is hidden (save resources)\n        this._stopPolling()\n\n        if (this._containerElement) {\n            render(null, this._containerElement)\n            this._containerElement.remove()\n            this._containerElement = null\n        }\n        this._widgetRef = null\n        this._isWidgetRendered = false\n        this._initializeWidgetPromise = null\n\n        // Reset timestamp so show() will re-fetch all messages\n        this._lastMessageTimestamp = null\n    }\n\n    /**\n     * Check if the widget is currently visible (rendered in DOM)\n     */\n    isVisible(): boolean {\n        return this._isWidgetRendered\n    }\n\n    /** Get tickets list for the current widget session */\n    async getTickets(options?: GetTicketsOptions): Promise<GetTicketsResponse> {\n        const token = this._config.token\n\n        const queryParams: Record<string, string> = {\n            widget_session_id: this._widgetSessionId,\n            limit: String(options?.limit ?? 20),\n            offset: String(options?.offset ?? 0),\n        }\n\n        if (options?.status) {\n            queryParams.status = options.status\n        }\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/tickets?${formDataToQuery(queryParams)}`\n                ),\n                method: 'GET',\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to fetch tickets'\n                        logger.error('Failed to fetch tickets', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as GetTicketsResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    async requestRestoreLink(email: string): Promise<RequestRestoreLinkResponse> {\n        const normalizedEmail = email.trim().toLowerCase()\n        if (!normalizedEmail) {\n            throw new Error('Email is required')\n        }\n\n        const token = this._config.token\n        const payload: RequestRestoreLinkPayload = {\n            email: normalizedEmail,\n            request_url: window?.location?.href || '',\n        }\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor('api', RESTORE_REQUEST_ENDPOINT),\n                method: 'POST',\n                data: payload,\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg =\n                            response.json?.error ||\n                            response.json?.detail ||\n                            response.json?.message ||\n                            'Failed to request restore link'\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    resolve({ ok: true })\n                },\n            })\n        })\n    }\n\n    async restoreFromToken(restoreToken: string): Promise<RestoreFromTokenResponse> {\n        const normalizedToken = restoreToken.trim()\n        if (!normalizedToken) {\n            throw new Error('Restore token is required')\n        }\n        try {\n            return await this._restoreFromTokenWithRetry(normalizedToken)\n        } finally {\n            clearRestoreTokenFromUrl()\n        }\n    }\n\n    async restoreFromUrlToken(): Promise<RestoreFromTokenResponse | null> {\n        const restoreToken = getRestoreTokenFromUrl()\n        if (!restoreToken) {\n            return null\n        }\n\n        try {\n            return await this.restoreFromToken(restoreToken)\n        } finally {\n            clearRestoreTokenFromUrl()\n        }\n    }\n\n    /**\n     * Get the current active ticket ID\n     * Returns null if no conversation has been started yet\n     */\n    getCurrentTicketId(): string | null {\n        return this._currentTicketId\n    }\n\n    /**\n     * Get the widget session ID (persistent browser identifier)\n     * This ID is used for access control and stays the same across page loads\n     */\n    getWidgetSessionId(): string {\n        return this._widgetSessionId\n    }\n\n    /**\n     * Clean up the widget\n     */\n    destroy(): void {\n        this._stopPolling()\n\n        // Unsubscribe from identify events\n        if (this._unsubscribeIdentifyListener) {\n            this._unsubscribeIdentifyListener()\n            this._unsubscribeIdentifyListener = null\n        }\n\n        if (this._containerElement) {\n            render(null, this._containerElement)\n            this._containerElement.remove()\n            this._containerElement = null\n        }\n\n        this._widgetRef = null\n\n        if (_activeManager === this) {\n            _activeManager = null\n        }\n        logger.info('Widget destroyed')\n    }\n\n    /**\n     * Reset all conversation data and destroy the widget.\n     * Called on posthog.reset() to start fresh.\n     */\n    reset(): void {\n        // Clear all persisted conversation data\n        this._persistence.clearAll()\n\n        // Reset local state\n        this._currentTicketId = null\n        this._lastMessageTimestamp = null\n        this._unreadCount = 0\n\n        // Destroy the widget\n        this.destroy()\n\n        logger.info('Conversations reset')\n    }\n\n    /**\n     * Render the widget to the DOM\n     */\n    private _renderWidget(\n        initialState: ConversationsWidgetState,\n        initialUserTraits: UserProvidedTraits | null,\n        initialView: WidgetView = 'messages',\n        initialTickets: Ticket[] = []\n    ): void {\n        if (!document) {\n            logger.info('Conversations widget not rendered: Document not available')\n            return\n        }\n\n        // Create container if it doesn't exist\n        let container = document.getElementById(WIDGET_CONTAINER_ID) as HTMLDivElement\n        if (!container) {\n            if (!document.body) {\n                logger.info('Conversations widget not rendered: Document body not available yet')\n                return\n            }\n            container = document.createElement('div')\n            container.id = WIDGET_CONTAINER_ID\n            document.body.appendChild(container)\n        }\n        this._containerElement = container\n\n        // Render widget with ref\n        render(\n            <ConversationsWidget\n                ref={(ref: ConversationsWidget | null) => {\n                    this._widgetRef = ref\n                }}\n                config={this._config}\n                initialState={initialState}\n                initialUserTraits={initialUserTraits}\n                isUserIdentified={this._posthog._isIdentified()}\n                initialView={initialView}\n                initialTickets={initialTickets}\n                hasMultipleTickets={this._hasMultipleTickets}\n                onSendMessage={this._handleSendMessage}\n                onStateChange={this._handleStateChange}\n                onIdentify={this._handleIdentify}\n                onRequestRestoreLink={this._handleRequestRestoreLink}\n                onSelectTicket={this._handleSelectTicket}\n                onNewConversation={this._handleNewConversation}\n                onBackToTickets={this._handleBackToTickets}\n                onViewChange={this._handleViewChange}\n            />,\n            container\n        )\n    }\n}\n\n/**\n * Initialize the conversations widget.\n * This is the entry point called from the lazy-loaded bundle.\n *\n * Uses a singleton guard: multiple PostHog instances on the same page\n * (e.g. toolbar + main app) share the same DOM and script tags.\n * Only one ConversationsManager is created; subsequent calls return the existing one.\n */\nexport function initConversations(config: ConversationsRemoteConfig, posthog: PostHog): ConversationsManager {\n    if (_activeManager) {\n        logger.info('ConversationsManager already exists, reusing singleton')\n        return _activeManager\n    }\n\n    logger.info('initConversations called', { hasConfig: !!config, hasPosthog: !!posthog })\n    _activeManager = new ConversationsManager(config, posthog)\n    return _activeManager\n}\n","import { initConversations } from '../extensions/conversations/external'\nimport { assignableWindow } from '../utils/globals'\n\nassignableWindow.__PosthogExtensions__ = assignableWindow.__PosthogExtensions__ || {}\nassignableWindow.__PosthogExtensions__.initConversations = initConversations\n\nexport default initConversations\n"],"names":["p","v","y","nativeIsArray","Array","isArray","ObjProto","Object","prototype","type_utils_hasOwnProperty","hasOwnProperty","type_utils_toString","toString","obj","call","isUndefined","x","isNumber","win","window","undefined","global","globalThis","self","File","nativeForEach","forEach","navigator","document","location","fetch","XMLHttpRequest","AbortController","userAgent","assignableWindow","_createLogger","prefix","_temp","debugEnabled","logger","_log","level","POSTHOG_DEBUG","console","consoleLog","_len","arguments","length","args","_key","info","_len2","_key2","warn","_len3","_key3","error","_len4","_key4","critical","_len5","_key5","uninitializedWarning","methodName","createLogger","additionalPrefix","options","Math","trunc","ceil","floor","Number","isInteger","value","isFinite","DIGITS","UUID","constructor","bytes","this","TypeError","fromFieldsV7","unixTsMs","randA","randBHi","randBLo","RangeError","Uint8Array","pow","text","i","charAt","Error","clone","slice","equals","other","compareTo","diff","sign","V7Generator","_timestamp","_counter","_random","DefaultRandom","generate","generateOrAbort","valueAfterReset","ts","Date","now","_resetCounter","nextUint32","defaultGenerator","getRandomValues","buffer","UUIDV7_DENY_WEAK_RNG","random","crypto","_buffer","Uint32Array","_cursor","Infinity","uuidv7obj","LEGACY_WIDGET_SESSION_ID","LEGACY_TICKET_ID","LEGACY_WIDGET_STATE","LEGACY_USER_TRAITS","ConversationsPersistence","_posthog","_cachedWidgetSessionId","_storageKey","posthog","_posthog$config","token","config","storageKey","_migrateFromLegacyPersistence","getOrCreateWidgetSessionId","_this$_read","sessionId","_read","widgetSessionId","_write","setWidgetSessionId","id","data","_extends","clearWidgetSessionId","saveTicketId","ticketId","loadTicketId","_this$_read2","clearTicketId","saveWidgetState","state","widgetState","loadWidgetState","_this$_read3","saveUserTraits","traits","userTraits","loadUserTraits","_this$_read4","name","email","clearUserTraits","clearAll","_window$localStorage","localStorage","removeItem","_unused","_window$localStorage2","raw","getItem","JSON","parse","_unused2","_window$localStorage3","setItem","stringify","_this$_read5","persistence","isDisabled","get_property","legacyFromRaw","_readLegacyFromRawStorage","unregister","_this$_posthog$config","_window$localStorage4","key","persistence_name","parsed","_unused3","getContrastTextColor","hexColor","hex","replace","fullHex","r","parseInt","g","b","sqrt","getStyles","primaryColor","position","isLeft","includes","isTop","widget","top","bottom","left","right","zIndex","fontFamily","buttonContainer","button","width","height","borderRadius","background","color","border","cursor","boxShadow","display","alignItems","justifyContent","transition","unreadBadge","minWidth","fontSize","fontWeight","padding","boxSizing","flexDirection","overflow","windowOpen","maxWidth","maxHeight","header","flexShrink","headerTitle","headerActions","gap","headerLinkButton","opacity","headerButton","lineHeight","messages","flex","overflowY","message","animation","messageCustomer","alignSelf","messageAgent","messageAuthor","marginBottom","messageContent","wordWrap","whiteSpace","messageContentCustomer","borderBottomRightRadius","messageContentAgent","borderBottomLeftRadius","messageTime","marginTop","borderTop","borderBottom","textAlign","inputContainer","input","resize","outline","fieldSizing","sendButton","identificationForm","formTitle","formDescription","recoverFooter","recoverFooterLink","textDecoration","formField","formLabel","formInput","formInputError","borderColor","formError","formSubmitButton","formOptional","restoreRequestSuccess","ticketListContainer","ticketList","ticketItem","ticketItemUnread","ticketItemContent","ticketItemArrow","ticketItemHeader","ticketPreview","textOverflow","ticketPreviewUnread","ticketUnreadBadge","ticketMeta","ticketTime","ticketStatus","textTransform","letterSpacing","newConversationButton","margin","ticketListLoading","loadingSpinner","ticketListEmpty","emptyStateIcon","emptyStateTitle","emptyStateDescription","newConversationButtonLarge","fetchPreviousButton","backButton","marginRight","headerWithBack","OpenChatButton","_ref","handleToggleOpen","unreadCount","styles","displayCount","_jsx","style","children","_jsxs","onClick","onMouseEnter","e","currentTarget","transform","onMouseLeave","viewBox","fill","xmlns","d","CloseChatButton","handleClose","formatRelativeTime","isoString","date","diffMs","getTime","diffMins","diffHours","diffDays","toLocaleDateString","truncateText","maxLength","substring","TicketListItem","status","ticket","hasUnread","unread_count","statusLabel","toUpperCase","handleClick","onKeyDown","preventDefault","role","tabIndex","last_message","trim","last_message_at","created_at","stroke","strokeWidth","points","LoadingState","EmptyState","_ref2","onNewConversation","onOpenRestoreRequest","TicketListView","_ref3","tickets","isLoading","onSelectTicket","sort","a","dateA","map","x1","y1","x2","y2","IdentificationFormView","formName","formEmail","formEmailError","onNameChange","onEmailChange","onSubmit","title","identificationFormTitle","description","identificationFormDescription","showNameField","collectName","type","onInput","placeholder","autoComplete","requireEmail","RestoreRequestView","restoreEmail","restoreEmailError","restoreRequestLoading","disabled","t","u","SendMessageButton","inputValue","handleSendMessage","strokeLinejoin","o","f","c","n","__b","__r","diffed","l","__c","m","unmount","s","__","__h","__H","push","j","shift","__P","z","B","__e","__v","__k","__m","__N","requestAnimationFrame","w","some","filter","k","clearTimeout","cancelAnimationFrame","setTimeout","sanitizeUrl","url","trimmedUrl","normalizedForCheck","toLowerCase","startsWith","lowerUrl","MAX_DEPTH","renderNode","node","depth","_node$content","marks","element","_Fragment","mark","fontStyle","code","_mark$attrs","href","attrs","safeUrl","target","rel","referrerPolicy","link","renderTextWithMarks","content","child","index","_node$content2","codeText","codeBlock","_node$attrs","_node$attrs2","src","alt","image","onError","paddingLeft","borderLeft","_node$attrs3","rawLevel","min","max","RichContent","richContent","isCustomer","C","useMemo","overflowX","wordBreak","doc","isValidTipTapDoc","rendered","lines","split","line","Fragment","renderPlainText","MessageBubble","author_type","messageStyle","contentStyle","author_name","rich_content","MessagesView","placeholderText","onInputChange","onSendMessage","messagesEndRef","inputRef","ref","rows","ConversationsWidget","Component","props","_this","super","_messagesEndRef","_inputRef","_handleToggleOpen","setState","prevState","_handleClose","_handleSelectTicket","_handleNewConversation","_handleBackToTickets","onBackToTickets","_handleOpenRestoreRequest","_prevState$userTraits","view","onViewChange","_handleCloseRestoreRequest","returnView","hasMultipleTickets","_handleInputChange","_handleKeyPress","shiftKey","_handleSendMessage","_handleFormNameChange","_handleFormEmailChange","_handleRestoreEmailChange","_handleFormSubmit","onIdentify","_validateEmail","nextView","_handleRestoreRequestSubmit","_asyncToGenerator","onRequestRestoreLink","_x","apply","trimmedMessage","userMessage","toISOString","is_private","initialUserTraits","initialView","_needsIdentification","isUserIdentified","initialState","initialTickets","ticketsLoading","componentDidMount","greetingText","_addGreetingMessage","componentDidUpdate","_prevProps","_scrollToBottom","onStateChange","_focusInput","greetingMessage","scrollIntoView","behavior","focus","test","addMessages","existingIds","Set","newMessages","has","show","hide","getUserTraits","setUserIdentified","setUnreadCount","count","updateTickets","setView","getView","setTicketsLoading","loading","clearMessages","addGreeting","_renderIdentificationForm","_renderBackButton","_renderTicketList","_renderMessages","el","_renderRestoreRequestView","_getTitle","_renderViewContent","render","widgetPosition","windowStyle","showBackButton","showRecoverFooter","breaker","each","iterator","thisArg","isNull","isNullish","eachArray","FormData","isFormData","pair","entries","formDataToQuery","formdata","arg_separator","use_val","use_key","tph_arr","val","encodeURIComponent","isFile","join","RESTORE_QUERY_PARAM","getRestoreTokenFromUrl","_window$location2","search","URLSearchParams","get","clearRestoreTokenFromUrl","_window$history","history","replaceState","URL","searchParams","delete","newUrl","pathname","hash","WIDGET_CONTAINER_ID","_activeManager","ConversationsManager","_widgetRef","_containerElement","_currentTicketId","_pollIntervalId","_lastMessageTimestamp","_isPollingMessages","_isPollingTickets","_unsubscribeIdentifyListener","_unreadCount","_widgetState","_isWidgetRendered","_hasProcessedRestoreToken","_initializeWidgetPromise","_currentView","_tickets","_hasMultipleTickets","_handleIdentify","_persistence","capture","hasName","hasEmail","_handleRequestRestoreLink","response","requestRestoreLink","_this$_widgetRef","sendMessage","_pollMessages","_x2","_handleStateChange","_markMessagesAsRead","_loadMessages","_pollTickets","_loadTickets","_poll","_handleViewChange","from","to","_ref6","_this$_widgetRef2","_this$_widgetRef3","_switchToTicketIfNeeded","_isWidgetOpen","_x3","_this$_widgetRef4","_this$_widgetRef5","_this$_widgetRef6","_this$_widgetRef7","_config","_widgetSessionId","_isWidgetEnabled","widgetEnabled","_isDomainAllowed","domains","_window$location","currentHostname","hostname","domain","allowedHostname","extractHostname","pattern","endsWith","isCurrentDomainAllowed","isWidgetEnabled","isDomainAllowed","_initialize","newTicket","_this2","isNewTicket","Promise","resolve","reject","_this2$_posthog$persi","distinctId","get_distinct_id","personProperties","$name","$email","payload","widget_session_id","distinct_id","ticket_id","capturedSessionId","get_session_id","session_id","replayUrl","get_session_replay_url","withTimestamp","timestampLookBack","currentUrl","session_context","session_replay_url","current_url","_send_request","requestRouter","endpointFor","method","headers","callback","statusCode","_response$json","_response$json2","errorMsg","json","detail","forced","messageLength","getMessages","after","_this3","targetTicketId","queryParams","limit","_response$json3","_response$json4","markAsRead","_this4","_response$json5","_response$json6","restoreToken","_restoreFromTokenWithRetry","catch","finally","_completeInitialization","hasExistingTicket","domainAllowed","_initializeWidget","_setupIdentifyListener","_this5","_restoreFromToken","_this6","_data$migrated_ticket","restore_token","_response$json7","_response$json8","_response$json9","migrated_ticket_ids","_doInitializeWidget","_this7","_getInitialUserTraits","_determineInitialView","_renderWidget","ticketCount","hasUserTraits","_startPolling","_this$_posthog$persis","posthogName","posthogEmail","savedTraits","_this8","_this8$_widgetRef","_this9","_this9$_widgetRef","_this9$_widgetRef2","lastMessage","_this0","_this0$_widgetRef","_this0$_widgetRef2","getTickets","results","totalUnread","reduce","sum","_this1","setInterval","_stopPolling","clearInterval","on","event","_this$_widgetRef8","remove","isVisible","_this10","_options$limit","_options$offset","String","offset","_response$json0","_response$json1","_this11","_window$location3","normalizedEmail","request_url","ok","_response$json10","_response$json11","_response$json12","restoreFromToken","_this12","normalizedToken","restoreFromUrlToken","_this13","getCurrentTicketId","getWidgetSessionId","destroy","reset","container","getElementById","body","createElement","appendChild","_isIdentified","initConversations","hasConfig","hasPosthog","__PosthogExtensions__"],"mappings":"6iBACO,0BAiBMA,EAAgC,CAAA,EAChCC,EAAY,GACZC,EACZ,6PALmB,QAAA,eAAA,SAAA,4BAAA,mCAAA,SAAA,2HAAA,oCAAA,qCAAA,oBAAA,8DAAA,8BAAA,gBAAA,kCAAA,+BAAA,oBAAA,uZAfQ,aAeR,OAAA,kBAfQ,yMAeR,6HAAA,kCAAA,SAAA,qBAXQ,2NAWR,0JAAA,OAAA,iDAAA,8FAAA,oDAAA,MAAA,gDATG,IASH,SAAA,0EAXQ,qDAAA,cAWR,0BAAA,oBATG,gQASH,4CAAA,yFAAA,aATG,YASH,qGAAA,iCATG,4FASH,mBAAA,khBAJS,0PAIT,sDAAA,kKAAA,0LAAA,KAbU,iBAFF,yWAeR,gCAAA,sJAAA,kCAAA,sDAAA,sEAAA,yCAAA,0FAAA,iRAAA,iEAAA,yXAAA,mEAAA,wEAAA,qBAAA,8FANM,2CAMN,wBAAA,QAAA,oCAbU,qEAaV,+GAAA,0GAbU,wTAaV,8IAJS,yCAEC,2CADC,gCAGX,gHAAA,cAAA,YAAA,gHAAA,QAAA,8EAAA,wQAAA,2VAHW,+DAGX,iEAAA,mCACK,0FAAA,wIADL,8JAAA,SAAA,yGAAA,kQAAA,wNAAA,sGAAA,SAAA,kCAAA,uCAAA,qJAAA,sFAAA,yJAAA,kIAAA,oWCdpB,IAAMC,EAAgBC,MAAMC,QACtBC,EAAWC,OAAOC,UAClBC,EAA4BH,EAASI,eACrCC,EAAsBL,EAASM,SAC/BP,EAAUF,GAAiB,SAASU,GACtC,MAAO,mBAAqBF,EAAoBG,KAAKD,EACzD,EAWME,EAAeC,QAAI,IAAWA,EAK9BC,EAAYD,GAAI,mBAAqBL,EAAoBG,KAAKE,IAAMA,GAAMA,ECc1EE,EAAkE,oBAAXC,OAAyBA,YAASC,EAuOzFC,EAA8D,oBAAfC,WAA6BA,WAAaJ,EAG3E,oBAATK,OACLF,EAAeE,KAAOF,GAER,oBAATG,OACLH,EAAeG,KAAO,WAAa,GAGlC,IACMC,EADarB,MAAMI,UACQkB,QAG3BC,EAAkB,MAANN,OAAM,EAANA,EAAQM,UACpBC,GAAiB,MAANP,OAAM,EAANA,EAAQO,SACF,MAANP,GAAAA,EAAQQ,SACL,MAANR,GAAAA,EAAQS,YAEzBT,GAAAA,EAAQU,gBAAkB,oBAAqB,IAAIV,EAAOU,gBAAmBV,EAAOU,eACnD,MAANV,GAAAA,EAAQW,gBACL,MAATL,GAAAA,EAAWM,UAC7B,IAAMC,GAAqChB,QAAAA,EAAQ,CAAA,ECpRpDiB,GAAgB,SAACC,EAAcC,GAAkE,IAAhEC,aAAEA,QAAmC,IAAAD,EAAG,CAAA,EAAEA,EACvEE,EAA0B,CAC5BC,EAAM,SAACC,GACH,GACItB,IACiBe,GAAiBQ,eAAiBJ,KAClDvB,EAAYI,EAAOwB,UACpBxB,EAAOwB,QACT,CAME,IALA,IAAMC,GACF,uBAAwBzB,EAAOwB,QAAQF,GAChCtB,EAAOwB,QAAQF,GAAmC,mBACnDtB,EAAOwB,QAAQF,IAEzBI,EAAAC,UAAAC,OAZmCC,MAAI5C,MAAAyC,EAAA,EAAAA,OAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAJD,EAAIC,EAAA,GAAAH,UAAAG,GAavCL,EAAWR,KAAWY,EAC1B,CACJ,EAEAE,KAAM,WAAoB,IAAA,IAAAC,EAAAL,UAAAC,OAAhBC,EAAI,IAAA5C,MAAA+C,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJJ,EAAII,GAAAN,UAAAM,GACVb,EAAOC,EAAK,SAAUQ,EAC1B,EAEAK,KAAM,WAAoB,IAAA,IAAAC,EAAAR,UAAAC,OAAhBC,EAAI,IAAA5C,MAAAkD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJP,EAAIO,GAAAT,UAAAS,GACVhB,EAAOC,EAAK,UAAWQ,EAC3B,EAEAQ,MAAO,WAAoB,IAAA,IAAAC,EAAAX,UAAAC,OAAhBC,EAAI,IAAA5C,MAAAqD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJV,EAAIU,GAAAZ,UAAAY,GACXnB,EAAOC,EAAK,WAAYQ,EAC5B,EAEAW,SAAU,WAAoB,IAAA,IAAAC,EAAAd,UAAAC,OAAhBC,EAAI,IAAA5C,MAAAwD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJb,EAAIa,GAAAf,UAAAe,GAGdlB,QAAQa,MAAMpB,KAAWY,EAC7B,EAEAc,qBAAuBC,IACnBxB,EAAOiB,MAAK,8CAA+CO,EAAa,EAG5EC,aAAcA,CAACC,EAA0BC,IACrC/B,GAAiBC,EAAM,IAAI6B,EAAoBC,IAEvD,OAAO3B,CACX,EAIayB,GAFS7B,GAAc,gBAED6B,aCjD9BG,KAAKC,QACND,KAAKC,MAAQ,SAAUnE,GACnB,OAAOA,EAAI,EAAIkE,KAAKE,KAAKpE,GAAKkE,KAAKG,MAAMrE,EAC7C,GAICsE,OAAOC,YACRD,OAAOC,UAAY,SAAUC,GACzB,OAAOxD,EAASwD,IAAUC,SAASD,IAAUN,KAAKG,MAAMG,KAAWA,CACvE,GAGJ,IAAME,GAAS,mBAGR,MAAMC,GAETC,WAAAA,CAAqBC,GACjB,GAD8CC,KAA7BD,MAAAA,EACI,KAAjBA,EAAM/B,OACN,MAAM,IAAIiC,UAAU,qBAE5B,CAUA,mBAAOC,CAAaC,EAAkBC,EAAeC,EAAiBC,GAClE,IACKd,OAAOC,UAAUU,KACjBX,OAAOC,UAAUW,KACjBZ,OAAOC,UAAUY,KACjBb,OAAOC,UAAUa,IAClBH,EAAW,GACXC,EAAQ,GACRC,EAAU,GACVC,EAAU,GACVH,EAAW,gBACXC,EAAQ,MACRC,EAAU,YACVC,EAAU,WAEV,MAAM,IAAIC,WAAW,uBAGzB,IAAMR,EAAQ,IAAIS,WAAW,IAiB7B,OAhBAT,EAAM,GAAKI,EAAQf,KAAAqB,IAAG,EAAK,IAC3BV,EAAM,GAAKI,EAAQf,KAAAqB,IAAG,EAAK,IAC3BV,EAAM,GAAKI,EAAQf,KAAAqB,IAAG,EAAK,IAC3BV,EAAM,GAAKI,EAAQf,KAAAqB,IAAG,EAAK,IAC3BV,EAAM,GAAKI,EAAQf,KAAAqB,IAAG,EAAK,GAC3BV,EAAM,GAAKI,EACXJ,EAAM,GAAK,IAAQK,IAAU,EAC7BL,EAAM,GAAKK,EACXL,EAAM,GAAK,IAAQM,IAAY,GAC/BN,EAAM,GAAKM,IAAY,GACvBN,EAAM,IAAMM,IAAY,EACxBN,EAAM,IAAMM,EACZN,EAAM,IAAMO,IAAY,GACxBP,EAAM,IAAMO,IAAY,GACxBP,EAAM,IAAMO,IAAY,EACxBP,EAAM,IAAMO,EACL,IAAIT,GAAKE,EACpB,CAGAlE,QAAAA,GAEI,IADA,IAAI6E,EAAO,GACFC,EAAI,EAAGA,EAAIX,KAAKD,MAAM/B,OAAQ2C,IACnCD,EAAOA,EAAOd,GAAOgB,OAAOZ,KAAKD,MAAMY,KAAO,GAAKf,GAAOgB,OAAuB,GAAhBZ,KAAKD,MAAMY,IAClE,IAANA,GAAiB,IAANA,GAAiB,IAANA,GAAiB,IAANA,IACjCD,GAAQ,KAIhB,GAAoB,KAAhBA,EAAK1C,OAGL,MAAM,IAAI6C,MAAM,gCAEpB,OAAOH,CACX,CAGAI,KAAAA,GACI,OAAO,IAAIjB,GAAKG,KAAKD,MAAMgB,MAAM,GACrC,CAGAC,MAAAA,CAAOC,GACH,OAAiC,IAA1BjB,KAAKkB,UAAUD,EAC1B,CAMAC,SAAAA,CAAUD,GACN,IAAK,IAAIN,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAMQ,EAAOnB,KAAKD,MAAMY,GAAKM,EAAMlB,MAAMY,GACzC,GAAa,IAATQ,EACA,OAAO/B,KAAKgC,KAAKD,EAEzB,CACA,OAAO,CACX,EAIJ,MAAME,GAAYvB,WAAAA,GAAAE,KACNsB,EAAa,EAACtB,KACduB,EAAW,EAACvB,KACHwB,EAAU,IAAIC,EAAe,CAY9CC,QAAAA,GACI,IAAMhC,EAAQM,KAAK2B,kBACnB,GAAK3F,EAAY0D,GAEV,CAEHM,KAAKsB,EAAa,EAClB,IAAMM,EAAkB5B,KAAK2B,kBAC7B,GAAI3F,EAAY4F,GACZ,MAAM,IAAIf,MAAM,iDAEpB,OAAOe,CACX,CATI,OAAOlC,CAUf,CAWAiC,eAAAA,GACI,IAGME,EAAKC,KAAKC,MAChB,GAAIF,EAAK7B,KAAKsB,EACVtB,KAAKsB,EAAaO,EAClB7B,KAAKgC,QACF,MAAIH,EANgB,IAMU7B,KAAKsB,GAUtC,OARAtB,KAAKuB,IACDvB,KAAKuB,EAVO,gBAYZvB,KAAKsB,IACLtB,KAAKgC,IAKb,CAEA,OAAOnC,GAAKK,aACRF,KAAKsB,EACLlC,KAAKC,MAAMW,KAAKuB,EAAQnC,KAAAqB,IAAG,EAAK,KAChCT,KAAKuB,EAAYnC,KAAAqB,IAAA,EAAK,IAAK,EAC3BT,KAAKwB,EAAQS,aAErB,CAGQD,CAAAA,GACJhC,KAAKuB,EAAuC,KAA5BvB,KAAKwB,EAAQS,cAAoD,KAA5BjC,KAAKwB,EAAQS,aACtE,EAOJ,IAmCIC,GAnCAC,GAAyEC,IAGzE,GAAoC,oBAAzBC,sBAAwCA,qBAC/C,MAAM,IAAIxB,MAAM,6CAGpB,IAAK,IAAIF,EAAI,EAAGA,EAAIyB,EAAOpE,OAAQ2C,IAC/ByB,EAAOzB,GAA4C,MAAvCvB,KAAKC,MAAsB,MAAhBD,KAAKkD,UAAkClD,KAAKC,MAAsB,MAAhBD,KAAKkD,UAElF,OAAOF,CAAM,EAIbhG,IAAWJ,EAAYI,EAAOmG,SAAWA,OAAOJ,kBAChDA,GAAmBC,GAAWG,OAAOJ,gBAAgBC,IAQzD,MAAMX,GAAc3B,WAAAA,GAAAE,KACCwC,EAAU,IAAIC,YAAY,GAAEzC,KACrC0C,EAAUC,GAAQ,CAC1BV,UAAAA,GAKI,OAJIjC,KAAK0C,GAAW1C,KAAKwC,EAAQxE,SAC7BmE,GAAgBnC,KAAKwC,GACrBxC,KAAK0C,EAAU,GAEZ1C,KAAKwC,EAAQxC,KAAK0C,IAC7B,EAWG,IAGDE,GAAYA,KAAaV,KAAqBA,GAAmB,IAAIb,KAAgBK,WCvPrFlE,GAASyB,GAAa,8BAItB4D,GAA2B,mCAC3BC,GAAmB,2BACnBC,GAAsB,8BACtBC,GAAqB,6BA4BpB,MAAMC,GAITnD,WAAAA,CAA6BoD,GAAmBlD,KAHxCmD,EAAwC,KAAInD,KAGvBkD,SAAAA,EACzBlD,KAAKoD,EApBb,SAAoBC,GAAiC,IAAAC,EAC3CC,EAAsB,OAAjBD,EAAGD,EAAQG,aAAM,EAAdF,EAAgBC,MAC9B,OAAOA,EAAQ,WAAaA,EAAQ,IACxC,CAiB2BE,CAAWP,GAC9BlD,KAAK0D,GACT,CAUAC,0BAAAA,GAAqC,IAAAC,EACjC,GAAI5D,KAAKmD,EACL,OAAOnD,KAAKmD,EAGhB,IAAIU,EAAwB,OAAfD,EAAG5D,KAAK8D,UAAO,EAAZF,EAAcG,gBAQ9B,OANKF,IACDA,EDwLwBjB,KAAY/G,WCvLpCmE,KAAKgE,EAAO,CAAED,gBAAiBF,KAGnC7D,KAAKmD,EAAyBU,EACvBA,CACX,CAKAI,kBAAAA,CAAmBC,GACflE,KAAKmD,EAAyBe,EAC9B,IAAMC,EAAOnE,KAAK8D,KAAW,CAAA,EAC7B9D,KAAKgE,EAAMI,KAAMD,EAAI,CAAEJ,gBAAiBG,IAC5C,CAMAG,oBAAAA,GACIrE,KAAKmD,EAAyB,KAC9B,IAAMgB,EAAOnE,KAAK8D,IACdK,WACOA,EAAKJ,gBACZ/D,KAAKgE,EAAOG,GAEpB,CAEAG,YAAAA,CAAaC,GACT,IAAMJ,EAAOnE,KAAK8D,KAAW,CAAA,EAC7B9D,KAAKgE,EAAMI,KAAMD,EAAI,CAAEI,aAC3B,CAEAC,YAAAA,GAA8B,IAAAC,EAC1B,OAAmB,OAAZA,EAAAzE,KAAK8D,UAAO,EAAZW,EAAcF,WAAY,IACrC,CAEAG,aAAAA,GACI,IAAMP,EAAOnE,KAAK8D,IACdK,WACOA,EAAKI,SACZvE,KAAKgE,EAAOG,GAEpB,CAEAQ,eAAAA,CAAgBC,GACZ,IAAMT,EAAOnE,KAAK8D,KAAW,CAAA,EAC7B9D,KAAKgE,EAAMI,KAAMD,EAAI,CAAEU,YAAaD,IACxC,CAEAE,eAAAA,GAA4C,IAAAC,EAClCH,EAAoB,OAAfG,EAAG/E,KAAK8D,UAAO,EAAZiB,EAAcF,YAC5B,MAAiB,SAAVD,GAA8B,WAAVA,EAAqBA,EAAQ,IAC5D,CAEAI,cAAAA,CAAeC,GACX,IAAMd,EAAOnE,KAAK8D,KAAW,CAAA,EAC7B9D,KAAKgE,EAAMI,KAAMD,EAAI,CAAEe,WAAYD,IACvC,CAEAE,cAAAA,GAA4C,IAAAC,EAClCH,EAAqB,OAAfG,EAAGpF,KAAK8D,UAAO,EAAZsB,EAAcF,WAC7B,OAAOD,IAAWA,EAAOI,MAAQJ,EAAOK,OAASL,EAAS,IAC9D,CAEAM,eAAAA,GACI,IAAMpB,EAAOnE,KAAK8D,IACdK,WACOA,EAAKe,WACZlF,KAAKgE,EAAOG,GAEpB,CAEAqB,QAAAA,GAEI,GADAxF,KAAKmD,EAAyB,KAC1BnD,KAAKoD,EACL,IAAI,IAAAqC,EACM,MAANrJ,GAAoB,OAAdqJ,EAANrJ,EAAQsJ,eAARD,EAAsBE,WAAW3F,KAAKoD,EAC1C,CAAE,MAAAwC,GACEpI,GAAOiB,MAAM,qCACjB,CAER,CAEQqF,CAAAA,GACJ,IAAK9D,KAAKoD,EACN,OAAO,KAEX,IAAI,IAAAyC,EACMC,EAAY,MAAN1J,GAAoB,OAAdyJ,EAANzJ,EAAQsJ,mBAAY,EAApBG,EAAsBE,QAAQ/F,KAAKoD,GAC/C,OAAO0C,EAAOE,KAAKC,MAAMH,GAAoC,IACjE,CAAE,MAAAI,GACE,OAAO,IACX,CACJ,CAEQlC,CAAAA,CAAOG,GACX,GAAKnE,KAAKoD,EAGV,IAAI,IAAA+C,EACM,MAAN/J,GAAoB,OAAd+J,EAAN/J,EAAQsJ,eAARS,EAAsBC,QAAQpG,KAAKoD,EAAa4C,KAAKK,UAAUlC,GACnE,CAAE,MAAO1F,GACLjB,GAAOiB,MAAM,kCAAmCA,EACpD,CACJ,CAOQiF,CAAAA,GAAsC,IAAA4C,EAC1C,GAAKtG,KAAKoD,IAA2B,OAAhBkD,EAAItG,KAAK8D,OAALwC,EAAcvC,iBAIvC,IACI,IAAMwC,EAAcvG,KAAKkD,SAASqD,YAClC,IAAKA,GAAqC,MAAtBA,EAAYC,YAAZD,EAAYC,aAC5B,OAGJ,IAAMzC,EAAkBwC,EAAYE,aAAa5D,IACjD,IAAKkB,EAAiB,CAElB,IAAM2C,EAAgB1G,KAAK2G,IAK3B,YAJID,IACA1G,KAAKgE,EAAO0C,GACZlJ,GAAOW,KAAK,sDAGpB,CAEA,IAAMgG,EAAiC,CAAEJ,mBAEnCQ,EAAWgC,EAAYE,aAAa3D,IACtCyB,IACAJ,EAAKI,SAAWA,GAGpB,IAAMM,EAAc0B,EAAYE,aAAa1D,IACzB,SAAhB8B,GAA0C,WAAhBA,IAC1BV,EAAKU,YAAcA,GAGvB,IAAMK,EAAaqB,EAAYE,aAAazD,IACxCkC,IACAf,EAAKe,WAAaA,GAGtBlF,KAAKgE,EAAOG,GAEZoC,EAAYK,WAAW/D,IACvB0D,EAAYK,WAAW9D,IACvByD,EAAYK,WAAW7D,IACvBwD,EAAYK,WAAW5D,IAEvBxF,GAAOW,KAAK,mDAChB,CAAE,MAAOM,GACLjB,GAAOiB,MAAM,2CAA4CA,EAC7D,CACJ,CAMQkI,CAAAA,GACJ,IAAI,IAAAE,EAAAC,EACMvD,EAA4B,OAAvBsD,EAAG7G,KAAKkD,SAASM,aAAM,EAApBqD,EAAsBtD,MACpC,IAAKA,EACD,OAAO,KAEX,IAAMwD,EAAO/G,KAAKkD,SAASM,OAAewD,iBACpC,MAAShH,KAAKkD,SAASM,OAAewD,iBACtC,MAAQzD,EAAQ,WAEhBuC,EAAY,MAAN1J,UAAM0K,EAAN1K,EAAQsJ,qBAARoB,EAAsBf,QAAQgB,GAC1C,IAAKjB,EACD,OAAO,KAGX,IAAMmB,EAASjB,KAAKC,MAAMH,GACpB/B,QAAkBkD,SAAAA,EAASpE,IACjC,GAA+B,iBAApBkB,IAAiCA,EACxC,OAAO,KAGX,IAAMI,EAAiC,CAAEJ,mBAEnCQ,QAAW0C,SAAAA,EAASnE,IACtByB,IACAJ,EAAKI,SAAWA,GAGpB,IAAMM,QAAcoC,SAAAA,EAASlE,IACT,SAAhB8B,GAA0C,WAAhBA,IAC1BV,EAAKU,YAAcA,GAGvB,IAAMK,QAAa+B,SAAAA,EAASjE,IAK5B,OAJIkC,IACAf,EAAKe,WAAaA,GAGff,CACX,CAAE,MAAA+C,GACE,OAAO,IACX,CACJ,EC7QJ,SAASC,GAAqBC,GAC1B,IAAMC,EAAMD,EAASE,QAAQ,KAAM,IAC7BC,EAAyB,IAAfF,EAAIrJ,OAAeqJ,EAAI,GAAKA,EAAI,GAAKA,EAAI,GAAKA,EAAI,GAAKA,EAAI,GAAKA,EAAI,GAAKA,EAEnFG,EAAIC,SAASF,EAAQxG,MAAM,EAAG,GAAI,IAClC2G,EAAID,SAASF,EAAQxG,MAAM,EAAG,GAAI,IAClC4G,EAAIF,SAASF,EAAQxG,MAAM,EAAG,GAAI,IAIxC,OADY3B,KAAKwI,KAAcJ,EAAIA,EAAb,KAA2BE,EAAIA,EAAb,KAA2BC,EAAIA,EAAb,MAC7C,MAAQ,UAAY,OACrC,CAEO,IAAME,GAAY,SAACC,EAAsBC,QAAwB,IAAxBA,IAAAA,EAA2B,gBACvE,IAAMC,EAASD,EAASE,SAAS,QAC3BC,EAAQH,EAASE,SAAS,OAEhC,MAAO,CACHE,OAAM/D,EAAA,CACF2D,SAAU,SACNG,EAAQ,CAAEE,IAAK,QAAW,CAAEC,OAAQ,QACpCL,EAAS,CAAEM,KAAM,QAAW,CAAEC,MAAO,QAAQ,CACjDC,OCmFyB,WDlFzBC,WACI,mGAERC,gBAAiB,CACbX,SAAU,YAEdY,OAAQ,CACJC,MAAO,OACPC,OAAQ,OACRC,aAAc,MACdC,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5BmB,OAAQ,OACRC,OAAQ,UACRC,UAAW,iCACXC,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChBC,WAAY,qDAEhBC,YAAWpF,EAAA,CACP2D,SAAU,YACNG,EAAQ,CAAEG,OAAQ,QAAW,CAAED,IAAK,QACpCJ,EAAS,CAAEM,KAAM,QAAW,CAAEC,MAAO,QAAQ,CACjDkB,SAAU,OACVZ,OAAQ,OACRC,aAAc,OACdC,WAAY,UACZC,MAAO,QACPU,SAAU,OACVC,WAAY,IACZP,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChBM,QAAS,QACTT,UAAW,+BACXF,OAAQ,kBACRY,UAAW,eAEfzN,OAAMgI,EAAA,CACF2D,SAAU,YACNG,EAAQ,CAAEE,IAAK,GAAM,CAAEC,OAAQ,GAC/BL,EAAS,CAAEM,KAAM,GAAM,CAAEC,MAAO,GAAG,CACvCQ,WAAY,QACZD,aAAc,OACdK,UAAW,sEACXC,QAAS,OACTU,cAAe,SACfC,SAAU,SACVR,WAAY,wCAEZN,OAAQ,SAEZe,WAAY,CACRpB,MAAO,QACPqB,SAAU,qBACVpB,OAAQ,QACRqB,UAAW,uBAEfC,OAAQ,CACJpB,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5B8B,QAAS,WACTR,QAAS,OACTE,eAAgB,gBAChBD,WAAY,SACZe,WAAY,GAEhBC,YAAa,CACTV,WAAY,IACZD,SAAU,QAEdY,cAAe,CACXlB,QAAS,OACTmB,IAAK,MACLlB,WAAY,UAEhBmB,iBAAkB,CACdzB,WAAY,cACZE,OAAQ,OACRD,MAAO7B,GAAqBW,GAC5BoB,OAAQ,UACRU,QAAS,UACTF,SAAU,OACVZ,aAAc,MACd2B,QAAS,IAEbC,aAAc,CACV3B,WAAY,cACZE,OAAQ,OACRD,MAAO7B,GAAqBW,GAC5BoB,OAAQ,UACRU,QAAS,UACTF,SAAU,OACViB,WAAY,EACZ7B,aAAc,MACdS,WAAY,2BACZkB,QAAS,IAEbG,SAAU,CACNC,KAAM,EACNC,UAAW,OACXlB,QAAS,OACTR,QAAS,OACTU,cAAe,SACfS,IAAK,MACLxB,WAAY,SAEhBgC,QAAS,CACL3B,QAAS,OACTU,cAAe,SACfG,SAAU,MACVe,UAAW,wBAEfC,gBAAiB,CACbC,UAAW,WACX7B,WAAY,YAEhB8B,aAAc,CACVD,UAAW,aACX7B,WAAY,cAEhB+B,cAAe,CACX1B,SAAU,OACVV,MAAO,UACPqC,aAAc,MACd1B,WAAY,KAEhB2B,eAAgB,CACZ1B,QAAS,WACTd,aAAc,MACdY,SAAU,OACViB,WAAY,IACZY,SAAU,aACVC,WAAY,YAEhBC,uBAAwB,CACpB1C,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5B4D,wBAAyB,OAE7BC,oBAAqB,CACjB5C,WAAY,QACZC,MAAO,UACPC,OAAQ,sBACR2C,uBAAwB,OAE5BC,YAAa,CACTnC,SAAU,OACVV,MAAO,UACP8C,UAAW,MACXrB,QAAS,IAEbhM,MAAO,CACHmL,QAAS,YACTb,WAAY,UACZC,MAAO,UACPU,SAAU,OACVqC,UAAW,oBACXC,aAAc,oBACdC,UAAW,SACXtC,WAAY,KAEhBuC,eAAgB,CACZtC,QAAS,WACTb,WAAY,QACZgD,UAAW,oBACX3C,QAAS,OACTmB,IAAK,MACLlB,WAAY,SACZe,WAAY,GAEhB+B,MAAO,CACHtB,KAAM,EACNX,UAAW,QACXR,SAAU,OACV0C,OAAQ,WACR3D,WAAY,UACZkC,WAAY,IACZ3B,MAAO,UACPD,WAAY,QACZE,OAAQ,OACRoD,QAAS,OACT9C,WAAY,uDACZH,QAAS,OACTC,WAAY,SACZiD,YAAa,WAEjBC,WAAY,CACR3D,MAAO,OACPC,OAAQ,OACRC,aAAc,OACdC,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5BmB,OAAQ,OACRC,OAAQ,UACRE,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChBC,WAAY,oBACZJ,UAAW,+BACXQ,WAAY,IACZS,WAAY,GAGhBoC,mBAAoB,CAChB3B,KAAM,EACNzB,QAAS,OACTU,cAAe,SACfF,QAAS,OACTb,WAAY,UACZ+B,UAAW,QAEf2B,UAAW,CACP/C,SAAU,OACVC,WAAY,IACZX,MAAO,UACPqC,aAAc,OAElBqB,gBAAiB,CACbhD,SAAU,OACVV,MAAO,UACPqC,aAAc,OACdV,WAAY,KAEhBgC,cAAe,CACX/C,QAAS,YACTmC,UAAW,oBACXrC,SAAU,OACVV,MAAO,UACP2B,WAAY,IACZP,WAAY,EACZ6B,UAAW,UAEfW,kBAAmB,CACf7D,WAAY,OACZE,OAAQ,OACRW,QAAS,EACTZ,MAAO,UACPE,OAAQ,UACRQ,SAAU,OACVjB,WAAY,UACZoE,eAAgB,aAEpBC,UAAW,CACPzB,aAAc,QAElB0B,UAAW,CACP3D,QAAS,QACTM,SAAU,OACVC,WAAY,IACZX,MAAO,UACPqC,aAAc,OAElB2B,UAAW,CACPpE,MAAO,OACPgB,QAAS,YACTX,OAAQ,oBACRH,aAAc,MACdY,SAAU,OACVjB,WAAY,UACZO,MAAO,UACPD,WAAY,QACZQ,WAAY,uDACZM,UAAW,cAEfoD,eAAgB,CACZC,YAAa,WAEjBC,UAAW,CACPzD,SAAU,OACVV,MAAO,UACP8C,UAAW,OAEfsB,iBAAkB,CACdxE,MAAO,OACPgB,QAAS,YACTd,aAAc,MACdC,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5BmB,OAAQ,OACRC,OAAQ,UACRQ,SAAU,OACVC,WAAY,IACZJ,WAAY,oBACZuC,UAAW,OAEfuB,aAAc,CACV3D,SAAU,OACVV,MAAO,UACPW,WAAY,KAEhB2D,sBAAuB,CACnBxB,UAAW,OACXpC,SAAU,OACVV,MAAO,UACPD,WAAY,UACZE,OAAQ,oBACRH,aAAc,MACdc,QAAS,YACTe,WAAY,KAGhB4C,oBAAqB,CACjB1C,KAAM,EACNzB,QAAS,OACTU,cAAe,SACff,WAAY,QACZ+B,UAAW,QAEf0C,WAAY,CACR3C,KAAM,EACNC,UAAW,QAEf2C,WAAY,CACR7D,QAAS,YACToC,aAAc,oBACd9C,OAAQ,UACRK,WAAY,4BACZR,WAAY,QACZK,QAAS,OACTC,WAAY,SACZkB,IAAK,QAETmD,iBAAkB,CACd3E,WAAY,WAEhB4E,kBAAmB,CACfvE,QAAS,OACTU,cAAe,SACfS,IAAK,MACLM,KAAM,EACNpB,SAAU,GAEdmE,gBAAiB,CACb5E,MAAO,UACPoB,WAAY,EACZhB,QAAS,OACTC,WAAY,UAEhBwE,iBAAkB,CACdzE,QAAS,OACTE,eAAgB,gBAChBD,WAAY,aACZkB,IAAK,OAETuD,cAAe,CACXpE,SAAU,OACVV,MAAO,UACP2B,WAAY,IACZE,KAAM,EACNd,SAAU,SACVgE,aAAc,WACdvC,WAAY,UAEhBwC,oBAAqB,CACjBtE,SAAU,OACVV,MAAO,UACP2B,WAAY,IACZE,KAAM,EACNd,SAAU,SACVgE,aAAc,WACdvC,WAAY,SACZ7B,WAAY,KAEhBsE,kBAAmB,CACfxE,SAAU,OACVZ,OAAQ,OACRC,aAAc,MACdC,WAAY,UACZC,MAAO,QACPU,SAAU,OACVC,WAAY,IACZP,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChBM,QAAS,QACTQ,WAAY,GAEhB8D,WAAY,CACR9E,QAAS,OACTC,WAAY,SACZkB,IAAK,OAET4D,WAAY,CACRzE,SAAU,OACVV,MAAO,WAEXoF,aAAc,CACV1E,SAAU,OACVV,MAAO,UACPD,WAAY,UACZa,QAAS,UACTd,aAAc,MACduF,cAAe,YACfC,cAAe,SAEnBC,sBAAuB,CACnBnF,QAAS,OACTC,WAAY,SACZC,eAAgB,SAChBkF,OAAQ,YACR5E,QAAS,YACTd,aAAc,MACdC,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5BmB,OAAQ,OACRC,OAAQ,UACRQ,SAAU,OACVC,WAAY,IACZJ,WAAY,qBAGhBkF,kBAAmB,CACf5D,KAAM,EACNzB,QAAS,OACTU,cAAe,SACfT,WAAY,SACZC,eAAgB,SAChBiB,IAAK,OACLvB,MAAO,UACPU,SAAU,QAEdgF,eAAgB,CACZ9F,MAAO,OACPC,OAAQ,OACRI,OAAQ,oBACR8C,uBAAwBjE,EACxBgB,aAAc,MACdkC,UAAW,6BAGf2D,gBAAiB,CACb9D,KAAM,EACNzB,QAAS,OACTU,cAAe,SACfT,WAAY,SACZC,eAAgB,SAChBM,QAAS,YACTqC,UAAW,UAEf2C,eAAgB,CACZ5F,MAAO,UACPqC,aAAc,QAElBwD,gBAAiB,CACbnF,SAAU,OACVC,WAAY,IACZX,MAAO,UACPqC,aAAc,OAElByD,sBAAuB,CACnBpF,SAAU,OACVV,MAAO,UACP2B,WAAY,IACZU,aAAc,QAElB0D,2BAA4B,CACxBnF,QAAS,YACTd,aAAc,MACdC,WAAYjB,EACZkB,MAAO7B,GAAqBW,GAC5BmB,OAAQ,OACRC,OAAQ,UACRQ,SAAU,OACVC,WAAY,IACZJ,WAAY,qBAEhByF,oBAAqB,CACjBlD,UAAW,OACX/C,WAAY,cACZE,OAAQ,OACRD,MAAOlB,EACPoB,OAAQ,UACRQ,SAAU,OACVmD,eAAgB,YAChBpC,QAAS,GAGbwE,WAAY,CACRlG,WAAY,cACZE,OAAQ,OACRD,MAAO7B,GAAqBW,GAC5BoB,OAAQ,UACRU,QAAS,UACTsF,YAAa,MACbxF,SAAU,OACViB,WAAY,EACZ7B,aAAc,MACdS,WAAY,2BACZkB,QAAS,GACTrB,QAAS,OACTC,WAAY,SACZC,eAAgB,UAGpB6F,eAAgB,CACZ/F,QAAS,OACTC,WAAY,UAGxB,qWE3gBO,IAAM+F,GAAiBC,IAKH,IALIvH,aAC3BA,EAAYC,SACZA,EAAW,eAAcuH,iBACzBA,EAAgBC,YAChBA,EAAc,GACIF,EACZG,EAAS3H,GAAUC,EAAcC,GACjC0H,EAAeF,EAAc,GAAK,MAAQA,EAAY1T,WAE5D,OACI6T,GAAA,MAAA,CAAKC,MAAOH,EAAOrH,OAAOyH,SACtBC,GAAA,MAAA,CAAKF,MAAOH,EAAO9G,gBAAgBkH,UAC/BF,GAAA,SAAA,CACIC,MAAOH,EAAO7G,OACdmH,QAASR,EACT,aAAYC,EAAc,EAAC,cAAiBA,aAAwB,YACpEQ,aAAeC,IACXA,EAAEC,cAAcN,MAAMO,UAAY,cAClCF,EAAEC,cAAcN,MAAMxG,UAAY,+BAA+B,EAErEgH,aAAeH,IACXA,EAAEC,cAAcN,MAAMO,UAAY,WAClCF,EAAEC,cAAcN,MAAMxG,UAAY,gCAAgC,EACpEyG,SAEFF,GAAA,MAAA,CAAK9G,MAAM,KAAKC,OAAO,KAAKuH,QAAQ,YAAYC,KAAK,OAAOC,MAAM,6BAA4BV,SAC1FF,GAAA,OAAA,CACIa,EAAE,gKACFF,KAAK,qBAIhBd,EAAc,GAAKG,GAAA,MAAA,CAAKC,MAAOH,EAAOhG,YAAYoG,SAAEH,QAEvD,ECrCDe,GAAkBnB,IAAyD,IAAxDvH,aAAEA,EAAY2I,YAAEA,GAAmCpB,EAE/E,OACIK,GAAA,SAAA,CACIC,MAHO9H,GAAUC,GAGH4C,aACdoF,QAASW,EACT,aAAW,QACXV,aAAeC,IACXA,EAAEC,cAAcN,MAAM5G,WAAa,4BACnCiH,EAAEC,cAAcN,MAAMlF,QAAU,GAAG,EAEvC0F,aAAeH,IACXA,EAAEC,cAAcN,MAAM5G,WAAa,cACnCiH,EAAEC,cAAcN,MAAMlF,QAAU,KAAK,EACvCmF,SACL,KAEQ,ECrBV,SAASc,GAAmBC,GAC/B,IAAKA,EACD,MAAO,GAGX,IAAMC,EAAO,IAAI9O,KAAK6O,GAEhBE,GADM,IAAI/O,MACGgP,UAAYF,EAAKE,UAC9BC,EAAW3R,KAAKG,MAAMsR,EAAS,KAC/BG,EAAY5R,KAAKG,MAAMwR,EAAW,IAClCE,EAAW7R,KAAKG,MAAMyR,EAAY,IAExC,OAAID,EAAW,EACJ,WACAA,EAAW,GACRA,EAAQ,QACXC,EAAY,GACTA,EAAS,QACC,IAAbC,EACA,YACAA,EAAW,EACRA,EAAQ,QAEXL,EAAKM,oBAEpB,CAKO,SAASC,GAAazQ,EAA0B0Q,GACnD,OAAK1Q,EAGDA,EAAK1C,QAAUoT,EACR1Q,EAEJA,EAAK2Q,UAAU,EAAGD,EAAY,GAAK,MAL/B,iBAMf,CCdO,IAAME,GAAyDjC,IAAiC,IAX/EkC,ED+BM7Q,GCpByC8Q,OAAEA,EAAMhC,OAAEA,EAAMM,QAAEA,GAAST,EACxFoC,GAAaD,EAAOE,cAAgB,GAAK,EACzCC,EAZS,aADKJ,EAaeC,EAAOD,QAX/B,UAGJA,EAAO3Q,OAAO,GAAGgR,cAAgBL,EAAOxQ,MAAM,GAU/C8Q,EAAcA,KAChB/B,EAAQ0B,EAAOtN,GAAG,EAQtB,OACI2L,GAAA,MAAA,CACIF,MAPOvL,EAAA,CAAA,EACRoL,EAAO/B,WACNgE,EAAYjC,EAAO9B,iBAAmB,IAMtCoC,QAAS+B,EACTC,UAAY9B,IACM,UAAVA,EAAEjJ,KAA6B,MAAViJ,EAAEjJ,MACvBiJ,EAAE+B,iBACFF,IACJ,EAEJG,KAAK,SACLC,SAAU,EAAErC,UAEZC,GAAA,MAAA,CAAKF,MAAOH,EAAO7B,kBAAkBiC,UACjCC,GAAA,MAAA,CAAKF,MAAOH,EAAO3B,iBAAiB+B,UAChCF,GAAA,OAAA,CAAMC,MAAO8B,EAAYjC,EAAOxB,oBAAsBwB,EAAO1B,cAAc8B,SACtEuB,IDTKzQ,ECSsB8Q,EAAOU,aDRlDxR,EAKDA,EAEK4G,QAAQ,kBAAmB,IAE3BA,QAAQ,aAAc,MAEtBA,QAAQ,0BAA2B,IAEnCA,QAAQ,yBAA0B,MAElCA,QAAQ,eAAgB,IAExBA,QAAQ,UAAW,IAEnBA,QAAQ,mBAAoB,IAE5BA,QAAQ,mBAAoB,IAC5BA,QAAQ,mBAAoB,IAE5BA,QAAQ,mBAAoB,MAC5BA,QAAQ,eAAgB,MACxBA,QAAQ,eAAgB,MACxBA,QAAQ,aAAc,MAEtBA,QAAQ,eAAgB,MAExBA,QAAQ,WAAY,IACpBA,QAAQ,QAAS,IAEjBA,QAAQ,UAAW,MAEnB6K,OAnCE,ICO2D,MAErDV,GAAa/B,GAAA,OAAA,CAAMC,MAAOH,EAAOvB,kBAAkB2B,SAAE4B,EAAOE,kBAEjE7B,GAAA,MAAA,CAAKF,MAAOH,EAAOtB,WAAW0B,UAC1BF,GAAA,OAAA,CAAMC,MAAOH,EAAOrB,WAAWyB,SAC1Bc,GAAmBc,EAAOY,iBAAmBZ,EAAOa,cAEzD3C,GAAA,OAAA,CAAMC,MAAOH,EAAOpB,aAAawB,SAAE+B,UAI3CjC,GAAA,MAAA,CAAKC,MAAOH,EAAO5B,gBAAgBgC,SAC/BF,GAAA,MAAA,CAAK9G,MAAM,KAAKC,OAAO,KAAKuH,QAAQ,YAAYC,KAAK,OAAOiC,OAAO,eAAeC,YAAY,IAAG3C,SAC7FF,GAAA,WAAA,CAAU8C,OAAO,yBAGvB,ECvDRC,GAA4EpD,IAAA,IAACG,OAAEA,GAAQH,EAAA,OACzFQ,GAAA,MAAA,CAAKF,MAAOH,EAAOf,kBAAkBmB,UACjCF,GAAA,MAAA,CAAKC,MAAOH,EAAOd,iBACnBgB,GAAA,OAAA,CAAAE,SAAM,+BACJ,EAMJ8C,GAIDC,IAAA,IAACnD,OAAEA,EAAMoD,kBAAEA,EAAiBC,qBAAEA,GAAsBF,EAAA,OACrD9C,GAAA,MAAA,CAAKF,MAAOH,EAAOb,gBAAgBiB,UAC/BF,GAAA,MAAA,CAAKC,MAAOH,EAAOZ,eAAegB,SAC9BF,GAAA,MAAA,CAAK9G,MAAM,KAAKC,OAAO,KAAKuH,QAAQ,YAAYC,KAAK,OAAOiC,OAAO,eAAeC,YAAY,MAAK3C,SAC/FF,GAAA,OAAA,CAAMa,EAAE,sEAGhBb,GAAA,MAAA,CAAKC,MAAOH,EAAOX,gBAAgBe,SAAC,yBACpCF,GAAA,MAAA,CAAKC,MAAOH,EAAOV,sBAAsBc,SAAC,wDAC1CF,GAAA,SAAA,CACIC,MAAOH,EAAOT,2BACde,QAAS8C,EACT7C,aAAeC,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,KAAK,EAEzC0F,aAAeH,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,GAAG,EACrCmF,SACL,yBAGDF,GAAA,SAAA,CACIC,MAAOH,EAAOR,oBACdc,QAAS+C,EACT9C,aAAeC,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,KAAK,EAEzC0F,aAAeH,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,GAAG,EACrCmF,SACL,mCAGC,EAMGkD,GAAyDC,IAOhE,IAPiEC,QACnEA,EAAOC,UACPA,EAASzD,OACTA,EAAM0D,eACNA,EAAcN,kBACdA,EAAiBC,qBACjBA,GACHE,EAEG,OAAIE,GAAgC,IAAnBD,EAAQhV,OACd0R,GAAC+C,GAAY,CAACjD,OAAQA,IAIV,IAAnBwD,EAAQhV,OAEJ0R,GAACgD,GAAU,CACPlD,OAAQA,EACRoD,kBAAmBA,EACnBC,qBAAsBA,IAO9BhD,GAAA,MAAA,CAAKF,MAAOH,EAAOjC,oBAAoBqC,UAEnCF,GAAA,MAAA,CAAKC,MAAOH,EAAOhC,WAAWoC,SACzB,IAAIoD,GACAG,MAAK,CAACC,EAAGzL,KACN,IAAM0L,EAAQ,IAAIvR,KAAKsR,EAAEhB,iBAAmBgB,EAAEf,YAAYvB,UAE1D,OADc,IAAIhP,KAAK6F,EAAEyK,iBAAmBzK,EAAE0K,YAAYvB,UAC3CuC,CAAK,IAEvBC,KAAK9B,GACF9B,GAAC4B,GAAc,CAEXE,OAAQA,EACRhC,OAAQA,EACRM,QAASoD,GAHD1B,EAAOtN,GAAE,KAAIsN,EAAOY,iBAAmBZ,EAAOa,YAAU,IAAIb,EAAOE,kBAS3F7B,GAAA,SAAA,CACIF,MAAOH,EAAOjB,sBACduB,QAAS8C,EACT7C,aAAeC,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,KAAK,EAEzC0F,aAAeH,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,GAAG,EACrCmF,UAEFC,GAAA,MAAA,CACIjH,MAAM,KACNC,OAAO,KACPuH,QAAQ,YACRC,KAAK,OACLiC,OAAO,eACPC,YAAY,IACZ5C,MAAO,CAAET,YAAa,OAAQU,UAE9BF,GAAA,OAAA,CAAM6D,GAAG,KAAKC,GAAG,IAAIC,GAAG,KAAKC,GAAG,OAChChE,GAAA,OAAA,CAAM6D,GAAG,IAAIC,GAAG,KAAKC,GAAG,KAAKC,GAAG,UAC9B,wBAGR,EC7HP,SAASC,GAAsBtE,GASN,IATO7L,OACnCA,EAAMgM,OACNA,EAAMoE,SACNA,EAAQC,UACRA,EAASC,eACTA,EAAcC,aACdA,EAAYC,cACZA,EAAaC,SACbA,GAC0B5E,EACpB6E,EAAQ1Q,EAAO2Q,yBAA2B,qBAC1CC,EAAc5Q,EAAO6Q,+BAAiC,yDACtDC,GAAuC,IAAvB9Q,EAAO+Q,YAE7B,OACI1E,GAAA,MAAA,CAAKF,MAAOH,EAAOhD,mBAAmBoD,UAClCF,GAAA,MAAA,CAAKC,MAAOH,EAAO/C,UAAUmD,SAAEsE,IAC/BxE,GAAA,MAAA,CAAKC,MAAOH,EAAO9C,gBAAgBkD,SAAEwE,IAErCvE,GAAA,OAAA,CAAMoE,SAAUA,EAASrE,SAAA,CACpB0E,GACGzE,GAAA,MAAA,CAAKF,MAAOH,EAAO1C,UAAU8C,UACzBC,GAAA,QAAA,CAAOF,MAAOH,EAAOzC,UAAU6C,SAAA,CAAC,QACvBF,GAAA,OAAA,CAAMC,MAAOH,EAAOnC,aAAauC,SAAC,kBAE3CF,GAAA,QAAA,CACI8E,KAAK,OACL7E,MAAOH,EAAOxC,UACdtN,MAAOkU,EACPa,QAASV,EACTW,YAAY,YACZC,aAAa,YAKzB9E,GAAA,MAAA,CAAKF,MAAOH,EAAO1C,UAAU8C,UACzBC,GAAA,QAAA,CAAOF,MAAOH,EAAOzC,UAAU6C,SAAA,CAAC,UACpBpM,EAAOoR,cAAgBlF,GAAA,OAAA,CAAMC,MAAOH,EAAOnC,aAAauC,SAAC,kBAErEF,GAAA,QAAA,CACI8E,KAAK,QACL7E,MAAKvL,EAAA,CAAA,EACEoL,EAAOxC,UACN8G,EAAiBtE,EAAOvC,eAAiB,IAEjDvN,MAAOmU,EACPY,QAAST,EACTU,YAAY,kBACZC,aAAa,UAEhBb,GAAkBpE,GAAA,MAAA,CAAKC,MAAOH,EAAOrC,UAAUyC,SAAEkE,OAGtDpE,GAAA,SAAA,CACI8E,KAAK,SACL7E,MAAOH,EAAOpC,iBACd2C,aAAeC,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,KAAK,EAEzC0F,aAAeH,IACXA,EAAEC,cAAcN,MAAMlF,QAAU,GAAG,EACrCmF,SACL,oBAMjB,CCvEO,SAASiF,GAAkBxF,GAQN,IAROG,OAC/BA,EAAMsF,aACNA,EAAYC,kBACZA,EAAiBC,sBACjBA,EAAqB1H,sBACrBA,EAAqB0G,cACrBA,EAAaC,SACbA,GACsB5E,EACtB,OACIQ,GAAA,MAAA,CAAKF,MAAOH,EAAOhD,mBAAmBoD,UAClCF,GAAA,MAAA,CAAKC,MAAOH,EAAO/C,UAAUmD,SAAC,0BAC9BF,GAAA,MAAA,CAAKC,MAAOH,EAAO9C,gBAAgBkD,SAAC,+KAKpCC,GAAA,OAAA,CAAMoE,SAAUA,EAASrE,UACrBC,GAAA,MAAA,CAAKF,MAAOH,EAAO1C,UAAU8C,UACzBF,GAAA,QAAA,CAAOC,MAAOH,EAAOzC,UAAU6C,SAAC,UAChCF,GAAA,QAAA,CACI8E,KAAK,QACL7E,MAAKvL,EAAA,CAAA,EACEoL,EAAOxC,UACN+H,EAAoBvF,EAAOvC,eAAiB,IAEpDvN,MAAOoV,EACPL,QAAST,EACTU,YAAY,kBACZC,aAAa,QACbM,SAAUD,IAEbD,GAAqBrF,GAAA,MAAA,CAAKC,MAAOH,EAAOrC,UAAUyC,SAAEmF,OAGzDrF,GAAA,SAAA,CAAQ8E,KAAK,SAAS7E,MAAOH,EAAOpC,iBAAkB6H,SAAUD,EAAsBpF,SACjFoF,EAAwB,aAAe,yBAI/C1H,GACGoC,GAAA,MAAA,CAAKC,MAAOH,EAAOlC,sBAAsBsC,SAAC,sFAM1D,CCpDO,ICNHsF,GAGA1N,GAGA2N,GAsBAxU,GDtBSyU,GAAoB/F,IAKH,IALIvH,aAC9BA,EAAYuN,WACZA,EAAUpC,UACVA,EAASqC,kBACTA,GACqBjG,EAErB,OACIK,GAAA,SAAA,CACIC,MAAKvL,EAAA,GAHEyD,GAAUC,GAIHyE,WAAU,CACpB9B,SAAU4K,EAAWlD,QAAUc,EAAY,GAAM,EACjD/J,QAASmM,EAAWlD,QAAUc,EAAY,cAAgB,YAE9DnD,QAASwF,EACTL,UAAWI,EAAWlD,QAAUc,EAChC,aAAW,eACXlD,aAAeC,IACNA,EAAEC,cAAcgF,WACjBjF,EAAEC,cAAcN,MAAMO,UAAY,cAClCF,EAAEC,cAAcN,MAAMxG,UAAY,+BACtC,EAEJgH,aAAeH,IACXA,EAAEC,cAAcN,MAAMO,UAAY,WAClCF,EAAEC,cAAcN,MAAMxG,UAAY,8BAA8B,EAClEyG,SAEFF,GAAA,MAAA,CAAK9G,MAAM,KAAKC,OAAO,KAAKuH,QAAQ,YAAYC,KAAK,OAAOC,MAAM,6BAA4BV,SAC1FF,GAAA,OAAA,CACIa,EAAE,8BACFF,KAAK,eACLiC,OAAO,eACPC,YAAY,IACZgD,eAAe,aAGlB,EClCbC,GAAc,EAGdC,GAAoB,GAGlBC,GAAuDC,EAEzD3F,GAAgB0F,GAAOE,IACvBxC,GAAkBsC,GAAOG,IACzB3a,GAAewa,GAAQI,OACvBC,GAAYL,GAAOM,IACnBC,GAAmBP,GAAQQ,QAC3BC,GAAUT,GAAOU,GAiHrB,SAASnb,GAAa0a,EAAOT,GACxBQ,GAAOW,KACVX,GAAOW,IAAO7O,GAAkBmO,EAAOH,IAAeN,GAEvDM,GAAc,EAOd,IAAML,EACL3N,GAAgB8O,MACf9O,GAAgB8O,IAAW,CAC3BF,GAAO,GACPC,IAAiB,KAOnB,OAJIV,GAASR,EAAKiB,GAAOpY,QACxBmX,EAAKiB,GAAOG,KAAK,CAAA,GAGXpB,EAAKiB,GAAOT,EACpB,CA8RA,SAASa,KAER,IADA,IAAIb,EACIA,EAAYF,GAAkBgB,SACrC,GAAKd,EAASe,KAAgBf,EAASW,IACvC,IACCX,EAASW,IAAAD,IAAyB1Z,QAAQga,IAC1ChB,EAASW,IAAAD,IAAyB1Z,QAAQia,IAC1CjB,EAASW,IAAAD,IAA2B,EAIrC,OAHSnB,GACRS,EAASW,IAAAD,IAA2B,GACpCX,GAAOmB,IAAa3B,EAAGS,EAASmB,IACjC,CAEF,CA1aApB,GAAOE,IAAS,SAAAD,GACfnO,GAAmB,KACfwI,IAAeA,GAAc2F,EAClC,EAEAD,GAAOU,GAAS,SAACT,EAAOT,GACnBS,GAAST,EAAS6B,KAAc7B,EAAS6B,IAAAC,MAC5CrB,EAAKqB,IAAS9B,EAAS6B,IAAAC,KAGpBb,IAASA,GAAQR,EAAOT,EAC7B,EAGAQ,GAAOG,IAAW,SAAAF,GACbvC,IAAiBA,GAAgBuC,GAGrCT,GAAe,EAEf,IAAMvU,GAHN6G,GAAmBmO,EAAKK,KAGMM,IAC1B3V,IACCwU,KAAsB3N,IACzB7G,EAAK0V,IAAmB,GACxB7O,GAAgB6O,IAAoB,GACpC1V,EAAKyV,GAAOzZ,SAAQ,SAAAgZ,GACfA,EAAQsB,MACXtB,EAAQS,GAAUT,EAAQsB,KAE3BtB,EAASR,EAAeQ,EAAQsB,UACjC,MAEAtW,EAAK0V,IAAiB1Z,QAAQga,IAC9BhW,EAAK0V,IAAiB1Z,QAAQia,IAC9BjW,EAAK0V,IAAmB,GACxBnB,GAAe,IAGjBC,GAAoB3N,EACrB,EAGAkO,GAAQI,OAAS,SAAAH,GACZza,IAAcA,GAAaya,GAE/B,IAAMT,EAAIS,EAAKK,IACXd,GAAKA,EAACoB,MACLpB,EAACoB,IAAAD,IAAyBrY,SAgaR,IAha2ByX,GAAkBc,KAAKrB,IAga7CvU,KAAY+U,GAAQwB,yBAC/CvW,GAAU+U,GAAQwB,wBACNC,IAAgBX,KAja5BtB,EAACoB,IAAAF,GAAezZ,SAAQ,SAAAgZ,GACnBA,EAASR,IACZQ,EAAQW,IAASX,EAASR,GAE3BQ,EAASR,QACV,KAEDA,GAAoB3N,GAAmB,IACxC,EAIAkO,GAAOM,IAAW,SAACL,EAAOT,GACzBA,EAAYkC,MAAK,SAAAzB,GAChB,IACCA,EAASU,IAAkB1Z,QAAQga,IACnChB,EAASU,IAAoBV,EAASU,IAAkBgB,QAAO,SAAA1B,GAAE,OAChEA,EAAES,IAAUQ,GAAajB,EAAU,GAQrC,OANSnO,GACR0N,EAAYkC,MAAK,SAAAzB,GACZA,EAACU,MAAmBV,EAACU,IAAoB,GAC9C,IACAnB,EAAc,GACdQ,GAAOmB,IAAarP,EAAGmO,EAASmB,IACjC,CACD,IAEIf,IAAWA,GAAUJ,EAAOT,EACjC,EAGAQ,GAAQQ,QAAU,SAAAP,GACbM,IAAkBA,GAAiBN,GAEvC,IAEKT,EAFC1N,EAAImO,EAAKK,IACXxO,GAAKA,EAAC8O,MAET9O,EAAC8O,IAAAF,GAAezZ,SAAQ,SAAAgZ,GACvB,IACCgB,GAAchB,EAGf,OAFSA,GACRT,EAAaS,CACd,CACD,IACAnO,EAAC8O,SAAA,EACGpB,GAAYQ,GAAOmB,IAAa3B,EAAY1N,EAACsP,KAEnD,EA4UA,IAAIQ,GAA0C,mBAAzBJ,sBAYrB,SAASC,GAAexB,GACvB,IAOIT,EAPE1N,EAAO,WACZ+P,aAAapC,GACTmC,IAASE,qBAAqBtC,GAClCuC,WAAW9B,EACZ,EACMR,EAAUsC,WAAWjQ,EAlcR,IAqcf8P,KACHpC,EAAMgC,sBAAsB1P,GAE9B,CAqBA,SAASmP,GAAchB,GAGtB,IAAMT,EAAO1N,GACT2N,EAAUQ,EAAIK,IACI,mBAAXb,IACVQ,EAAIK,SAAA,EACJb,KAGD3N,GAAmB0N,CACpB,CAOA,SAAS0B,GAAajB,GAGrB,IAAMT,EAAO1N,GACbmO,EAAIK,IAAYL,EAAIS,KACpB5O,GAAmB0N,CACpB,CCvfA,SAASwC,GAAYC,GACjB,GAAKA,GAAsB,iBAARA,EAAnB,CAOA,IACMC,EADaD,EAAIrQ,QAAQ,sCAAuC,IACxC6K,OAC9B,GAAKyF,EAAL,CAMA,IAAMC,EAAqBD,EAAWtQ,QAAQ,OAAQ,IAAIwQ,cAG1D,KACID,EAAmBE,WAAW,gBAC9BF,EAAmBE,WAAW,cAC9BF,EAAmBE,WAAW,UAC9BF,EAAmBE,WAAW,UAQ9BH,EAAWG,WAAW,OAA1B,CAGA,GACIH,EAAWG,WAAW,MACtBH,EAAWG,WAAW,OACtBH,EAAWG,WAAW,QACtBH,EAAWG,WAAW,KAEtB,OAAOH,EAIX,IAAMI,EAAWJ,EAAWE,cAC5B,OACIE,EAASD,WAAW,YACpBC,EAASD,WAAW,aACpBC,EAASD,WAAW,YACpBC,EAASD,WAAW,QAEbH,OANX,CAZA,CArBA,CATA,CAoDJ,CAGA,IAAMK,GAAY,GAsGlB,SAASC,GACLC,EACA3I,EACA4I,EACArR,GACyB,IAAAsR,EAEzB,GAAID,EAAQH,GACR,OAAO,KAIX,GAAkB,SAAdE,EAAK3D,OAAoBxY,EAAYmc,EAAKzX,MAC1C,OAvER,SACIA,EACA4X,EACA9I,EACAzI,GAEA,IAAKuR,GAA0B,IAAjBA,EAAMta,OAChB,OAAO0R,GAAA,OAAA,CAAAE,SAAiBlP,GAANqG,GAItB,IAAIwR,EAA8B7I,GAAA8I,EAAA,CAAA5I,SAAGlP,IAErC,IAAK,IAAM+X,KAAQH,EACf,OAAQG,EAAKjE,MACT,IAAK,OACD+D,EAAU7I,GAAA,SAAA,CAAQC,MAAO,CAAEhG,WAAY,KAAMiG,SAAE2I,IAC/C,MACJ,IAAK,SACDA,EAAU7I,GAAA,KAAA,CAAIC,MAAO,CAAE+I,UAAW,UAAW9I,SAAE2I,IAC/C,MACJ,IAAK,YACDA,EAAU7I,GAAA,IAAA,CAAGC,MAAO,CAAE9C,eAAgB,aAAc+C,SAAE2I,IACtD,MACJ,IAAK,SACDA,EAAU7I,GAAA,IAAA,CAAGC,MAAO,CAAE9C,eAAgB,gBAAiB+C,SAAE2I,IACzD,MACJ,IAAK,OACDA,EAAU7I,GAAA,OAAA,CAAMC,MAAOH,EAAOmJ,KAAK/I,SAAE2I,IACrC,MACJ,IAAK,OAAQ,IAAAK,EACHC,EAAiB,OAAbD,EAAGH,EAAKK,YAAK,EAAVF,EAAYC,KACnBE,EAA0B,iBAATF,EAAoBnB,GAAYmB,QAAQxc,EAC3D0c,IACAR,EACI7I,GAAA,IAAA,CACImJ,KAAME,EACNC,OAAO,SACPC,IAAI,sBACJC,eAAe,cACfvJ,MAAOH,EAAO2J,KAAKvJ,SAElB2I,KAUzB,OAAO7I,GAAA,OAAA,CAAAE,SAAiB2I,GAANxR,EACtB,CAkBeqS,CAAoBjB,EAAKzX,KAAMyX,EAAKG,MAAO9I,EAAQzI,GAI9D,IAAM6I,GAAuB,OAAZyI,EAAAF,EAAKkB,cAAO,EAAZhB,EAAc/E,KAAI,CAACgG,EAAOC,IAAUrB,GAAWoB,EAAO9J,EAAQ4I,EAAQ,EAAMrR,EAAG,IAAIwS,OAAa,GAEjH,OAAQpB,EAAK3D,MACT,IAAK,MACD,OAAO9E,GAAA8I,EAAA,CAAA5I,SAAGA,IAEd,IAAK,YACD,OACIF,GAAA,IAAA,CAAaC,MAAO,CAAEnB,OAAQ,aAAcoB,SACvCA,EAAS5R,OAAS,EAAI4R,EAAWF,GAAA,KAAA,CAAA,IAD9B3I,GAKhB,IAAK,YACD,OAAO2I,GAAA,KAAA,CAAA,EAAS3I,GAEpB,IAAK,YAAa,IAAAyS,EAERC,GAAuB,OAAZD,EAAArB,EAAKkB,UAAY,OAALG,EAAZA,EAAe,SAAE,EAAjBA,EAAmB9Y,OAAQ,GAC5C,OACIgP,GAAA,MAAA,CAAeC,MAAOH,EAAOkK,UAAU9J,SACnCF,GAAA,OAAA,CAAAE,SAAO6J,KADD1S,GAMlB,IAAK,QAAS,IAAA4S,EAAAC,EACJC,EAAgB,OAAbF,EAAGxB,EAAKW,YAAK,EAAVa,EAAYE,IAClBC,EAAgB,OAAbF,EAAGzB,EAAKW,YAAK,EAAVc,EAAYE,IAClBf,EAAyB,iBAARc,EAAmBnC,GAAYmC,QAAOxd,EAC7D,OAAK0c,EAIDrJ,GAAA,MAAA,CAEImK,IAAKd,EACLe,IAAoB,iBAARA,EAAmBA,EAAM,GACrCnK,MAAOH,EAAOuK,MACdC,QAAUhK,IACJA,EAAEgJ,OAA4BrJ,MAAMvG,QAAU,MAAM,GALrDrC,GAJF,KAef,IAAK,aACD,OACI2I,GAAA,KAAA,CAAcC,MAAO,CAAEnB,OAAQ,QAASyL,YAAa,QAASrK,SACzDA,GADI7I,GAKjB,IAAK,cACD,OACI2I,GAAA,KAAA,CAAcC,MAAO,CAAEnB,OAAQ,QAASyL,YAAa,QAASrK,SACzDA,GADI7I,GAKjB,IAAK,WACD,OACI2I,GAAA,KAAA,CAAcC,MAAO,CAAEnB,OAAQ,SAAUoB,SACpCA,GADI7I,GAKjB,IAAK,aACD,OACI2I,GAAA,aAAA,CAEIC,MAAO,CACHnB,OAAQ,QACRyL,YAAa,OACbC,WAAY,oBACZlR,MAAO,WACT4G,SAEDA,GARI7I,GAYjB,IAAK,UAAW,IAAAoT,EACNC,EAAqB,OAAbD,EAAGhC,EAAKW,YAAK,EAAVqB,EAAYzc,MACvBA,EAAQxB,EAASke,GAAYA,EAAW,EAE9C,OACI1K,GAFY,IAAOtQ,KAAKib,IAAIjb,KAAKkb,IAAI5c,EAAO,GAAI,GAErC,CAAWiS,MAAO,CAAEnB,OAAQ,gBAAiBoB,SACnDA,GADY7I,GAMzB,IAAK,iBACD,OAAO2I,GAAA,KAAA,CAAcC,MAAO,CAAEnB,OAAQ,SAAUvF,OAAQ,OAAQ8C,UAAW,sBAA3DhF,GAEpB,QAEI,OAAI6I,EAAS5R,OAAS,EACX0R,GAAA,OAAA,CAAAE,SAAiBA,GAAN7I,GAEf,KAEnB,CAyCO,SAASwT,GAAWlL,GAAuE,IAAtEmL,YAAEA,EAAWnB,QAAEA,EAAOoB,WAAEA,EAAU3S,aAAEA,GAAgCuH,EACtFG,EDLM,SAAQmG,EAASnO,GAEhC,IAAM2N,EAAQla,GAAaia,KAAgB,GAO3C,OAwLD,SAAqBS,EAAST,GAC7B,OACES,GACDA,EAAQ3X,SAAWkX,EAAQlX,QAC3BkX,EAAQkC,MAAK,SAAClC,EAAK1N,GAAU,OAAA0N,IAAQS,EAAQnO,EAAM,GAErD,CApMKkT,CAAYvF,EAAKmB,IAAQ9O,KAC5B2N,EAAKiB,GAAUT,IACfR,EAAKmB,IAAS9O,EACd2N,EAAKkB,IAAYV,GAGXR,EAAKiB,EACb,CCLmBuE,EAAQ,IAtQ3B,SAAmBF,EAAqB3S,GACpC,MAAO,CACH6Q,KAAM,CACFlQ,WAAY,yFACZiB,SAAU,QACVE,QAAS,UACTd,aAAc,MACdC,WAAY0R,EAAa,2BAA6B,uBAE1Df,UAAW,CACPjR,WAAY,yFACZiB,SAAU,SACVE,QAAS,WACTd,aAAc,MACdC,WAAY0R,EAAa,4BAA8B,UACvDG,UAAW,OACXpP,WAAY,WACZD,SAAU,aACVsP,UAAW,aACXrM,OAAQ,QACRpF,QAAS,QACTuB,WAAY,IACZ1B,OAAQwR,EAAa,OAAS,qBAElCtB,KAAM,CACFnQ,MAAOyR,EAAa,QAAU3S,EAC9B+E,eAAgB,aAEpBkN,MAAO,CACH9P,SAAU,OACVnB,aAAc,MACdgD,UAAW,MACXT,aAAc,MACdjC,QAAS,SAGrB,CAkOiCvB,CAAU4S,EAAY3S,IAAe,CAAC2S,EAAY3S,IAG/E,GAAI0S,EACA,IACI,GA1CZ,SAA0BM,GACtB,IAAKA,GAAsB,iBAARA,EACf,OAAO,EAEX,IAAMvK,EAAIuK,EACV,MAAkB,QAAXvK,EAAEiE,OAAmBxY,EAAYuU,EAAE8I,UAAY/d,EAAQiV,EAAE8I,SACpE,CAoCgB0B,CAAiBP,GAAc,CAC/B,IAAMQ,EAAW9C,GAAWsC,EAAahL,EAAQ,EAAG,QACpD,GAAIwL,EACA,OAAOA,CAEf,CACJ,CAAE,MAAApV,GACE,CAKR,OA3CJ,SAAyBlF,GACrB,IAAKA,EACD,OAAOgP,GAAA8I,EAAA,IAEX,IAAMyC,EAAQva,EAAKwa,MAAM,MACzB,OACIxL,GAAA8I,EAAA,CAAA5I,SACKqL,EAAM3H,KAAI,CAAC6H,EAAM5B,IACd1J,GAACuL,EAAQ,CAAAxL,SAAA,CACJuL,EACA5B,EAAQ0B,EAAMjd,OAAS,GAAK0R,cAFlB6J,MAO/B,CA4BW8B,CAAgBhC,EAC3B,CCzVA,SAASiC,GAAajM,GAQnB,IARoBtE,QACnBA,EAAOyE,OACPA,EAAM1H,aACNA,GAKHuH,EACSoL,EAAqC,aAAxB1P,EAAQwQ,YACrBC,EAAYpX,EAAA,CAAA,EACXoL,EAAOzE,QACN0P,EAAajL,EAAOvE,gBAAkBuE,EAAOrE,cAE/CsQ,EAAYrX,EAAA,CAAA,EACXoL,EAAOlE,eACNmP,EAAajL,EAAO/D,uBAAyB+D,EAAO7D,qBAG5D,OACIkE,GAAA,MAAA,CAAsBF,MAAO6L,EAAa5L,SAAA,EACpC6K,GAAc1P,EAAQ2Q,aAAehM,GAAA,MAAA,CAAKC,MAAOH,EAAOpE,cAAcwE,SAAE7E,EAAQ2Q,cAClFhM,GAAA,MAAA,CAAKC,MAAO8L,EAAa7L,SACrBF,GAAC6K,GAAW,CACRC,YAAazP,EAAQ4Q,aACrBtC,QAAStO,EAAQsO,QACjBoB,WAAYA,EACZ3S,aAAcA,MAGtB4H,GAAA,MAAA,CAAKC,MAAOH,EAAO3D,YAAY+D,SAAEc,GAAmB3F,EAAQsH,gBAVtDtH,EAAQ7G,GAa1B,CAEO,SAAS0X,GAAYjJ,GAaN,IAbOnD,OACzBA,EAAM1H,aACNA,EAAY+T,gBACZA,EAAejR,SACfA,EAAQyK,WACRA,EAAUpC,UACVA,EAASxU,MACTA,EAAKqd,cACLA,EAAahK,UACbA,EAASiK,cACTA,EAAaC,eACbA,EAAcC,SACdA,GACgBtJ,EAChB,OACI9C,GAAA2I,EAAA,CAAA5I,UACIC,GAAA,MAAA,CAAKF,MAAOH,EAAO5E,SAASgF,SAAA,CACvBhF,EAAS0I,KAAKvI,GACX2E,GAAC4L,GAAa,CAAkBvQ,QAASA,EAASyE,OAAQA,EAAQ1H,aAAcA,GAA5DiD,EAAQ7G,MAEhCwL,GAAA,MAAA,CAAKwM,IAAKF,OAGbvd,GAASiR,GAAA,MAAA,CAAKC,MAAOH,EAAO/Q,MAAMmR,SAAEnR,IAErCoR,GAAA,MAAA,CAAKF,MAAOH,EAAOtD,eAAe0D,UAC9BF,GAAA,WAAA,CACIwM,IAAKD,EACLtM,MAAOH,EAAOrD,MACduI,YAAamH,EACbnc,MAAO2V,EACPZ,QAASqH,EACThK,UAAWA,EACXqK,KAAM,EACNlH,SAAUhC,IAEdvD,GAAC0F,GAAiB,CACdtN,aAAcA,EACduN,WAAYA,EACZpC,UAAWA,EACXqC,kBAAmByG,SAKvC,CCpFA,IAAMve,GAASyB,GAAa,yBA8CrB,MAAMmd,WAA4BC,EAIrCvc,WAAAA,CAAYwc,GAAoB,IAAAC,EAC5BC,MAAMF,GAAMC,EAAAvc,KAAAA,KAJRyc,EAAyC,KAAIzc,KAC7C0c,EAAwC,KAAI1c,KA8G5C2c,EAAoB,KACxB3c,KAAK4c,UAAUC,IAAS,CACpBjY,MAA2B,SAApBiY,EAAUjY,MAAmB,SAAW,UAChD,EACN5E,KAEO8c,EAAe,KACnB9c,KAAK4c,SAAS,CAAEhY,MAAO,UAAW,EACrC5E,KAEO+c,EAAuBxY,IACvBvE,KAAKsc,MAAMpJ,gBACXlT,KAAKsc,MAAMpJ,eAAe3O,EAC9B,EACHvE,KAEOgd,EAAyB,KACzBhd,KAAKsc,MAAM1J,mBACX5S,KAAKsc,MAAM1J,mBACf,EACH5S,KAEOid,EAAuB,KACvBjd,KAAKsc,MAAMY,iBACXld,KAAKsc,MAAMY,iBACf,EACHld,KAEOmd,EAA4B,KAChCnd,KAAK4c,UAAUC,IAAS,IAAAO,EAAA,MAAM,CAC1BC,KAAM,kBACNvI,aAAc+H,EAAU/H,eAAoC,OAAxBsI,EAAIP,EAAU3X,iBAAU,EAApBkY,EAAsB9X,QAAS,GACvEyP,kBAAmB,KACnBzH,uBAAuB,EAC1B,IACGtN,KAAKsc,MAAMgB,cACXtd,KAAKsc,MAAMgB,aAAa,kBAC5B,EACHtd,KAEOud,EAA6B,KACjC,IAAMC,EAAaxd,KAAK4E,MAAM6Y,mBAAqB,UAAY,WAC/Dzd,KAAK4c,SAAS,CAAES,KAAMG,EAAYzI,kBAAmB,KAAMzH,uBAAuB,IAC9EtN,KAAKsc,MAAMgB,cACXtd,KAAKsc,MAAMgB,aAAaE,EAC5B,EACHxd,KAEO0d,EAAsB1N,IAC1B,IAAMgJ,EAAShJ,EAAEgJ,OACjBhZ,KAAK4c,SAAS,CAAEvH,WAAY2D,EAAOtZ,OAAQ,EAC9CM,KAEO2d,EAAmB3N,IACT,UAAVA,EAAEjJ,KAAoBiJ,EAAE4N,WACxB5N,EAAE+B,iBACF/R,KAAK6d,IACT,EAGJ7d,KACQ8d,EAAyB9N,IAC7B,IAAMgJ,EAAShJ,EAAEgJ,OACjBhZ,KAAK4c,SAAS,CAAEhJ,SAAUoF,EAAOtZ,OAAQ,EAC5CM,KAEO+d,EAA0B/N,IAC9B,IAAMgJ,EAAShJ,EAAEgJ,OACjBhZ,KAAK4c,SAAS,CAAE/I,UAAWmF,EAAOtZ,MAAOoU,eAAgB,MAAO,EACnE9T,KAEOge,EAA6BhO,IACjC,IAAMgJ,EAAShJ,EAAEgJ,OACjBhZ,KAAK4c,SAAS,CACV9H,aAAckE,EAAOtZ,MACrBqV,kBAAmB,KACnBzH,uBAAuB,GACzB,EACLtN,KAQOie,EAAqBjO,IACzBA,EAAE+B,iBAEF,IAAM8B,UAAEA,EAASD,SAAEA,GAAa5T,KAAK4E,OAC/BpB,OAAEA,EAAM0a,WAAEA,GAAele,KAAKsc,MAGpC,IAAI9Y,EAAOoR,cAAiBf,EAAU1B,OAKtC,IAAI0B,EAAU1B,QAAWnS,KAAKme,EAAetK,EAAU1B,QAAvD,CAMA,IAAMlN,EAA6B,CAAA,EAC/B2O,EAASzB,SACTlN,EAAOI,KAAOuO,EAASzB,QAEvB0B,EAAU1B,SACVlN,EAAOK,MAAQuO,EAAU1B,QAI7B,IAAMiM,EAAWpe,KAAK4E,MAAM6Y,mBAAqB,UAAY,WAG7Dzd,KAAK4c,SAAS,CACV1X,WAAYD,EACZoY,KAAMe,IAGNF,GACAA,EAAWjZ,GAGXjF,KAAKsc,MAAMgB,cACXtd,KAAKsc,MAAMgB,aAAac,EAzB5B,MAFIpe,KAAK4c,SAAS,CAAE9I,eAAgB,4CALhC9T,KAAK4c,SAAS,CAAE9I,eAAgB,qBAiCpC,EACH9T,KAEOqe,EAA2B,WAAA,IAAAhP,EAAAiP,GAAG,UAAOtO,GAGzC,GAFAA,EAAE+B,iBAEGwK,EAAKD,MAAMiC,qBAAhB,CAIA,IAAMjZ,EAAQiX,EAAK3X,MAAMkQ,aAAa3C,OACtC,GAAK7M,EAKL,GAAKiX,EAAK4B,EAAe7Y,GAAzB,CAKAiX,EAAKK,SAAS,CACV5H,uBAAuB,EACvBD,kBAAmB,OAGvB,UACUwH,EAAKD,MAAMiC,qBAAqBjZ,GACtCiX,EAAKK,SAAS,CACV5H,uBAAuB,EACvB1H,uBAAuB,GAE/B,CAAE,MAAO7O,GACLjB,GAAOiB,MAAM,iCAAkCA,GAC/C8d,EAAKK,SAAS,CACV5H,uBAAuB,EACvBD,kBAAmBtW,aAAiBoC,MAAQpC,EAAMsM,QAAU,kCAEpE,CAnBA,MAFIwR,EAAKK,SAAS,CAAE7H,kBAAmB,4CALnCwH,EAAKK,SAAS,CAAE7H,kBAAmB,qBAJvC,CA+BJ,IAAC,OAAA,SAAAyJ,GAAA,OAAAnP,EAAAoP,MAAAze,KAAAjC,UAAA,CAAA,CApCkC,GAoClCiC,KAEO6d,EAAkBS,GAAG,YACzB,IAAMjJ,WAAEA,GAAekH,EAAK3X,MACtB8Z,EAAiBrJ,EAAWlD,OAElC,GAAKuM,EAAL,CAKA,IAAMC,EAAuB,CACzBza,GAAE,QAAUpC,KAAKC,MACjBsX,QAASqF,EACTnD,YAAa,WACbG,YAAa,MACbrJ,YAAY,IAAIvQ,MAAO8c,cACvBC,YAAY,GAGhBtC,EAAKK,SAAS,CACVhS,SAAU,IAAI2R,EAAK3X,MAAMgG,SAAU+T,GACnCtJ,WAAY,GACZpC,WAAW,EACXxU,MAAO,OAGX,UACU8d,EAAKD,MAAMP,cAAc2C,GAE/BnC,EAAKK,SAAS,CAAE3J,WAAW,GAC/B,CAAE,MAAOxU,GACLjB,GAAOiB,MAAM,yBAA0BA,GACvC8d,EAAKK,UAAUC,IAAS,CACpB5J,WAAW,EACXxU,MAAOA,aAAiBoC,MAAQpC,EAAMsM,QAAU,yBAChDH,SAAUiS,EAAUjS,SAASyM,QAAQpB,GAAMA,EAAE/R,KAAOya,EAAYza,QAExE,CA9BA,CA+BJ,IArTI,IAAMgB,EAAaoX,EAAMwC,mBAAqB,KAIxCC,EAHsB/e,KAAKgf,EAAqB1C,EAAM9Y,OAAQ0B,EAAYoX,EAAM2C,kBAG5C,iBAAmB3C,EAAMyC,aAAe,WAElF/e,KAAK4E,MAAQ,CACTA,MAAO0X,EAAM4C,cAAgB,SAC7B7B,KAAM0B,EACNnU,SAAU,GACVoI,QAASsJ,EAAM6C,gBAAkB,GACjCC,gBAAgB,EAChB/J,WAAY,GACZpC,WAAW,EACXxU,MAAO,KACPmV,UAAoB,MAAV1O,OAAU,EAAVA,EAAYG,OAAQ,GAC9BwO,WAAqB,MAAV3O,OAAU,EAAVA,EAAYI,QAAS,GAChCwO,eAAgB,KAChB5O,aACAqK,YAAa,EACbkO,mBAAoBnB,EAAMmB,qBAAsB,EAChD3I,cAAwB,MAAV5P,OAAU,EAAVA,EAAYI,QAAS,GACnCyP,kBAAmB,KACnBC,uBAAuB,EACvB1H,uBAAuB,EAE/B,CAKQ0R,CAAAA,CACJxb,EACAyB,EACAga,GAIA,OAAIA,MAKCzb,EAAOoR,eAKF,MAAN3P,IAAAA,EAAQK,OAKhB,CAEA+Z,iBAAAA,GAE4B,aAApBrf,KAAK4E,MAAMyY,MAAsD,IAA/Brd,KAAK4E,MAAMgG,SAAS5M,QAAgBgC,KAAKsc,MAAM9Y,OAAO8b,cACxFtf,KAAKuf,GAEb,CAEAC,kBAAAA,CAAmBC,EAAyB5C,GAEpC7c,KAAK4E,MAAMgG,SAAS5M,SAAW6e,EAAUjS,SAAS5M,QAClDgC,KAAK0f,IAIL1f,KAAK4E,MAAMA,QAAUiY,EAAUjY,OAAS5E,KAAKsc,MAAMqD,eACnD3f,KAAKsc,MAAMqD,cAAc3f,KAAK4E,MAAMA,OAIf,SAArB5E,KAAK4E,MAAMA,OAAwC,SAApBiY,EAAUjY,QACzC5E,KAAK4f,KACL5f,KAAK0f,IAEb,CAEQH,CAAAA,GACJ,IAAMM,EAA2B,CAC7B3b,GAAI,WACJmV,QAASrZ,KAAKsc,MAAM9Y,OAAO8b,cAAgB,uBAC3C/D,YAAa,KACbG,YAAa,UACbrJ,YAAY,IAAIvQ,MAAO8c,cACvBC,YAAY,GAEhB7e,KAAK4c,SAAS,CAAEhS,SAAU,CAACiV,IAC/B,CAEQH,CAAAA,GACA1f,KAAKyc,GACLzc,KAAKyc,EAAgBqD,eAAe,CAAEC,SAAU,UAExD,CAEQH,EAAAA,GACA5f,KAAK0c,GACL1c,KAAK0c,EAAUsD,OAEvB,CAkFQ7B,CAAAA,CAAe7Y,GAGnB,MADmB,6BACD2a,KAAK3a,EAC3B,CA8HA4a,WAAAA,CAAYtV,GACR5K,KAAK4c,UAAUC,IAEX,IAAMsD,EAAc,IAAIC,IAAIvD,EAAUjS,SAAS0I,KAAK2C,GAAMA,EAAE/R,MACtDmc,EAAczV,EAASyM,QAAQpB,IAAOkK,EAAYG,IAAIrK,EAAE/R,MAE9D,OAAImc,EAAYriB,OAAS,EACd,CACH4M,SAAU,IAAIiS,EAAUjS,YAAayV,IAGtC,IAAI,GAEnB,CAKAE,IAAAA,GACIvgB,KAAK4c,SAAS,CAAEhY,MAAO,QAC3B,CAKA4b,IAAAA,GACIxgB,KAAK4c,SAAS,CAAEhY,MAAO,UAC3B,CAKA6b,aAAAA,GACI,OAAOzgB,KAAK4E,MAAMM,UACtB,CAMAwb,iBAAAA,GACI,GAAwB,mBAApB1gB,KAAK4E,MAAMyY,KAA2B,CACtC,IAAMe,EAAWpe,KAAK4E,MAAM6Y,mBAAqB,UAAY,WAC7Dzd,KAAK4c,SAAS,CAAES,KAAMe,IAClBpe,KAAKsc,MAAMgB,cACXtd,KAAKsc,MAAMgB,aAAac,EAEhC,CACJ,CAKAuC,cAAAA,CAAeC,GACX5gB,KAAK4c,SAAS,CAAErN,YAAaqR,GACjC,CAKAC,aAAAA,CAAc7N,GACVhT,KAAK4c,SAAS,CACV5J,UACAoM,gBAAgB,EAChB3B,mBAAoBzK,EAAQhV,OAAS,GAE7C,CAKA8iB,OAAAA,CAAQzD,GACJrd,KAAK4c,SAAS,CAAES,SACZrd,KAAKsc,MAAMgB,cACXtd,KAAKsc,MAAMgB,aAAaD,EAEhC,CAKA0D,OAAAA,GACI,OAAO/gB,KAAK4E,MAAMyY,IACtB,CAKA2D,iBAAAA,CAAkBC,GACdjhB,KAAK4c,SAAS,CAAEwC,eAAgB6B,GACpC,CAMAC,aAAAA,CAAcC,QAAoB,IAApBA,IAAAA,GAAuB,GACjCnhB,KAAK4c,SAAS,CAAEhS,SAAU,KAAM,KACxBuW,GAAenhB,KAAKsc,MAAM9Y,OAAO8b,cACjCtf,KAAKuf,GACT,GAER,CAEQ6B,EAAAA,CAA0B5R,GAC9B,OACIE,GAACiE,GAAsB,CACnBnQ,OAAQxD,KAAKsc,MAAM9Y,OACnBgM,OAAQA,EACRoE,SAAU5T,KAAK4E,MAAMgP,SACrBC,UAAW7T,KAAK4E,MAAMiP,UACtBC,eAAgB9T,KAAK4E,MAAMkP,eAC3BC,aAAc/T,KAAK8d,EACnB9J,cAAehU,KAAK+d,EACpB9J,SAAUjU,KAAKie,GAG3B,CAEQoD,EAAAA,CAAkB7R,GACtB,IAAMM,EACkB,oBAApB9P,KAAK4E,MAAMyY,KAA6Brd,KAAKud,EAA6Bvd,KAAKid,EACnF,OACIvN,GAAA,SAAA,CAAQC,MAAOH,EAAOP,WAAYa,QAASA,EAAS,aAAW,wBAAuBF,SAClFF,GAAA,MAAA,CAAK9G,MAAM,KAAKC,OAAO,KAAKuH,QAAQ,YAAYC,KAAK,OAAOiC,OAAO,eAAeC,YAAY,IAAG3C,SAC7FF,GAAA,WAAA,CAAU8C,OAAO,uBAIjC,CAEQ8O,EAAAA,CAAkB9R,GACtB,IAAMwD,QAAEA,EAAOoM,eAAEA,GAAmBpf,KAAK4E,MAEzC,OACI8K,GAACoD,GAAc,CACXE,QAASA,EACTC,UAAWmM,EACX5P,OAAQA,EACR0D,eAAgBlT,KAAK+c,EACrBnK,kBAAmB5S,KAAKgd,EACxBnK,qBAAsB7S,KAAKmd,GAGvC,CAEQoE,EAAAA,CAAgB/R,EAAsC1H,EAAsB+T,GAChF,OACInM,GAACkM,GAAY,CACTpM,OAAQA,EACR1H,aAAcA,EACd+T,gBAAiBA,EACjBjR,SAAU5K,KAAK4E,MAAMgG,SACrByK,WAAYrV,KAAK4E,MAAMyQ,WACvBpC,UAAWjT,KAAK4E,MAAMqO,UACtBxU,MAAOuB,KAAK4E,MAAMnG,MAClBqd,cAAe9b,KAAK0d,EACpB5L,UAAW9R,KAAK2d,EAChB5B,cAAe/b,KAAK6d,EACpB7B,eAAiBwF,IACbxhB,KAAKyc,EAAkB+E,CAAE,EAE7BvF,SAAWuF,IACPxhB,KAAK0c,EAAY8E,CAAE,GAInC,CAEQC,EAAAA,CAA0BjS,GAC9B,OACIE,GAACmF,GAAkB,CACfrF,OAAQA,EACRsF,aAAc9U,KAAK4E,MAAMkQ,aACzBC,kBAAmB/U,KAAK4E,MAAMmQ,kBAC9BC,sBAAuBhV,KAAK4E,MAAMoQ,sBAClC1H,sBAAuBtN,KAAK4E,MAAM0I,sBAClC0G,cAAehU,KAAKge,EACpB/J,SAAUjU,KAAKqe,GAG3B,CAKQqD,EAAAA,CAAUrE,GACd,OAAQA,GACJ,IAAK,UACD,MAAO,gBACX,IAAK,kBACD,MAAO,wBACX,IAAK,iBAEL,IAAK,WACD,MAAO,eAEnB,CAKQsE,EAAAA,CACJnS,EACA1H,EACA+T,GAEA,OAAQ7b,KAAK4E,MAAMyY,MACf,IAAK,iBACD,OAAOrd,KAAKohB,GAA0B5R,GAC1C,IAAK,kBACD,OAAOxP,KAAKyhB,GAA0BjS,GAC1C,IAAK,UACD,OAAOxP,KAAKshB,GAAkB9R,GAClC,IAAK,WACD,OAAOxP,KAAKuhB,GAAgB/R,EAAQ1H,EAAc+T,GAE9D,CAEA+F,MAAAA,GACI,IAAMpe,OAAEA,GAAWxD,KAAKsc,OAClB1X,MAAEA,EAAKyY,KAAEA,GAASrd,KAAK4E,MACvBkD,EAAetE,EAAOwF,OAAS,UAC/B6Y,EAAiBre,EAAOqe,gBAAkB,eAC1ChG,EAAkBrY,EAAOqY,iBAAmB,uBAC5CrM,EAAS3H,GAAUC,EAAc+Z,GAGvC,GAAc,WAAVjd,EACA,OACI8K,GAACN,GAAc,CACXtH,aAAcA,EACdC,SAAU8Z,EACVvS,iBAAkBtP,KAAK2c,EACvBpN,YAAavP,KAAK4E,MAAM2K,cAMpC,IAAMuS,EAAW1d,EAAA,CAAA,EACVoL,EAAOpT,OACPoT,EAAOxF,YAIR+X,EAA2B,aAAT1E,GAAuBrd,KAAK4E,MAAM6Y,oBAAgC,oBAATJ,EAG3E2E,EAA6B,YAAT3E,GAA+B,aAATA,EAEhD,OACI3N,GAAA,MAAA,CAAKC,MAAOH,EAAOrH,OAAOyH,SACtBC,GAAA,MAAA,CAAKF,MAAOmS,EAAYlS,UACpBC,GAAA,MAAA,CAAKF,MAAOH,EAAOrF,OAAOyF,UACtBC,GAAA,MAAA,CAAKF,MAAOoS,EAAiBvS,EAAOL,eAAiBK,EAAOnF,YAAYuF,SAAA,CACnEmS,GAAkB/hB,KAAKqhB,GAAkB7R,GAC1CE,GAAA,OAAA,CAAMC,MAAOH,EAAOnF,YAAYuF,SAAE5P,KAAK0hB,GAAUrE,QAErD3N,GAAA,MAAA,CAAKC,MAAOH,EAAOlF,cAAcsF,SAC7BF,GAACc,GAAe,CAAC1I,aAAcA,EAAc2I,YAAazQ,KAAK8c,SAItE9c,KAAK2hB,GAAmBnS,EAAQ1H,EAAc+T,GAE9CmG,GACGnS,GAAA,MAAA,CAAKF,MAAOH,EAAO7C,cAAciD,SAAA,CAAC,mCACG,IACjCF,GAAA,SAAA,CACI8E,KAAK,SACL7E,MAAOH,EAAO5C,kBACdkD,QAAS9P,KAAKmd,EAA0BvN,SAC3C,6BAQzB,ECvpBJ,IAAMqS,GAAmB,CAAA,EAyBlB,SAASC,GAAKpmB,EAAUqmB,EAAoDC,GAC/E,InBRenmB,IAAID,EAAYC,IADnBA,IAAI,OAASA,EACYomB,CAAOpmB,GmBQxCqmB,CAAUxmB,GAAd,CAGA,GAAIR,EAAQQ,GACR,OA5BD,SACHA,EACAqmB,EACAC,GAEA,GAAI9mB,EAAQQ,GACR,GAAIY,GAAiBZ,EAAIa,UAAYD,EACjCZ,EAAIa,QAAQwlB,EAAUC,QACnB,GAAI,WAAYtmB,GAAOA,EAAIkC,UAAYlC,EAAIkC,OAC9C,IAAK,IAAI2C,EAAI,EAAGoV,EAAIja,EAAIkC,OAAQ2C,EAAIoV,EAAGpV,IACnC,GAAIA,KAAK7E,GAAOqmB,EAASpmB,KAAKqmB,EAAStmB,EAAI6E,GAAIA,KAAOshB,GAClD,MAKpB,CAYeM,CAAUzmB,EAAKqmB,EAAUC,GAEpC,GnBVgBnmB,IAAIA,aAAaumB,SmBU7BC,CAAW3mB,IACX,IAAK,IAAM4mB,KAAQ5mB,EAAI6mB,UACnB,GAAIR,EAASpmB,KAAKqmB,EAASM,EAAK,GAAIA,EAAK,MAAQT,GAC7C,YAKZ,IAAK,IAAMlb,KAAOjL,EACd,GAAIH,EAAeI,KAAKD,EAAKiL,IACrBob,EAASpmB,KAAKqmB,EAAStmB,EAAIiL,GAAMA,KAASkb,GAC1C,MAfZ,CAmBJ,CC5BO,IAAMW,GAAkB,SAAUC,EAA0CC,GAC/E,IAAIC,EACAC,OAFwF,IAAbF,IAAAA,EAAgB,KAG/F,IAAMG,EAAoB,GAa1B,OAXAf,GAAKW,GAAU,SAAUK,EAAgCnc,GAEjD/K,EAAYknB,IAAQlnB,EAAY+K,IAAgB,cAARA,IAI5Cgc,EAAUI,mBpBPFlnB,IAAIA,aAAaQ,KoBOI2mB,CAAOF,GAAOA,EAAI7d,KAAO6d,EAAIrnB,YAC1DmnB,EAAUG,mBAAmBpc,GAC7Bkc,EAAQA,EAAQjlB,QAAUglB,EAAU,IAAMD,EAC9C,IAEOE,EAAQI,KAAKP,EACxB,ECtCMtlB,GAASyB,GAAa,0BAEfqkB,GAAsB,kBA0C5B,SAASC,KAAwC,IAAAC,EACpD,GAAW,MAANpnB,GAAgB,OAAVonB,EAANpnB,EAAQU,YAAR0mB,EAAkBC,OACnB,OAAO,KAGX,IAEI,IACMlgB,EADS,IAAImgB,gBAAgBtnB,EAAOU,SAAS2mB,QAC9BE,IAAIL,IACzB,OAAY,MAAL/f,OAAK,EAALA,EAAO4O,SAAU,IAC5B,CAAE,MAAO1T,GAEL,OADAjB,GAAOc,KAAK,yCAA0CG,GAC/C,IACX,CACJ,CAEO,SAASmlB,KAAiC,IAAAC,EAC7C,GAAW,MAANznB,GAAAA,EAAQU,gBAAaV,UAAMynB,EAANznB,EAAQ0nB,UAARD,EAAiBE,aAI3C,IAEI,IAAMpM,EAAM,IAAIqM,IAAI5nB,EAAOU,SAAS+b,MACpClB,EAAIsM,aAAaC,OAAOZ,IACxB,IAAMa,EAAM,GAAMxM,EAAIyM,SAAWzM,EAAI8L,OAAS9L,EAAI0M,KAClDjoB,EAAO0nB,QAAQC,aAAa3nB,EAAO0nB,QAAQlf,MAAO,GAAIuf,EAC1D,CAAE,MAAO1lB,GACLjB,GAAOc,KAAK,yCAA0CG,EAC1D,CACJ,CCjDA,IAAMjB,GAASyB,GAAa,0BAEtBqlB,GAAsB,oCAQxBC,GAA8C,KAE3C,MAAMC,GA0BT1kB,WAAAA,CACI0D,EACiBN,GACnB,IAAAqZ,EAAAvc,KAAAA,KA1BMykB,GAAyC,KAAIzkB,KAC7C0kB,GAA2C,KAAI1kB,KAC/C2kB,GAAkC,KAAI3kB,KACtC4kB,GAAiC,KAAI5kB,KACrC6kB,GAAuC,KAAI7kB,KAC3C8kB,IAA8B,EAAK9kB,KACnC+kB,IAA6B,EAAK/kB,KAClCglB,GAAoD,KAAIhlB,KACxDilB,GAAuB,EAACjlB,KAMxBklB,GAAyC,SAAQllB,KACjDmlB,IAA6B,EAAKnlB,KAClColB,IAAqC,EAAKplB,KAC1CqlB,GAAiD,KACzDrlB,KACQslB,GAA2B,WAAUtlB,KACrCulB,GAAqB,GAAEvlB,KACvBwlB,IAA+B,EAifvCxlB,KAGQylB,GAAmBxgB,IAEvBjF,KAAK0lB,GAAa1gB,eAAeC,GAGjCjF,KAAKkD,SAASyiB,QAAQ,iCAAkC,CACpDC,UAAW3gB,EAAOI,KAClBwgB,WAAY5gB,EAAOK,OACrB,EACLtF,KAEO8lB,GAAyB,WAAA,IAAAzW,EAAAiP,GAAG,UAAOhZ,GACvC,IAAMygB,QAAiBxJ,EAAKyJ,mBAAmB1gB,GAI/C,OAHAiX,EAAKrZ,SAASyiB,QAAQ,wCAAyC,CAC3DE,WAAYvgB,IAETygB,CACX,IAAC,OAAA,SAAAvH,GAAA,OAAAnP,EAAAoP,MAAAze,KAAAjC,UAAA,CAAA,CANgC,GAQjCiC,KAGQ6d,EAAkB,WAAA,IAAAlL,EAAA2L,GAAG,UAAOvT,GAAmC,IAAAkb,EAE7D/gB,GAA4B,OAAf+gB,EAAA1J,EAAKkI,SAAU,EAAfwB,EAAiBxF,uBAAmBpkB,EAEvD,UAEUkgB,EAAK2J,YAAYnb,EAAS7F,GAGhCuS,YAAW,IAAM8E,EAAK4J,MAAiB,IAC3C,CAAE,MAAO1nB,GAEL,MADAjB,GAAOiB,MAAM,yBAA0BA,GACjCA,CACV,CACJ,IAAC,OAAA,SAAA2nB,GAAA,OAAAzT,EAAA8L,MAAAze,KAAAjC,UAAA,CAAA,CAdyB,GAgB1BiC,KAGQqmB,GAAsBzhB,IAC1B5E,KAAKklB,GAAetgB,EACpBpH,GAAOW,KAAK,uBAAwB,CAAEyG,QAAOyY,KAAMrd,KAAKslB,KAExDtlB,KAAKkD,SAASyiB,QAAQ,sCAAuC,CACzD/gB,MAAOA,EACPyY,KAAMrd,KAAKslB,GACX/gB,SAAUvE,KAAK2kB,KAGnB3kB,KAAK0lB,GAAa/gB,gBAAgBC,GAGpB,SAAVA,GAC0B,aAAtB5E,KAAKslB,IAA+BtlB,KAAKilB,GAAe,GAAKjlB,KAAK2kB,IAClE3kB,KAAKsmB,IAEb,EA2DJtmB,KAGQmmB,GAAa7H,GAAG,YACpB,IAAI/B,EAAKuI,IAAuBvI,EAAKoI,GAArC,CAIApI,EAAKuI,IAAqB,EAC1B,UACUvI,EAAKgK,IACf,CAAC,QACGhK,EAAKuI,IAAqB,CAC9B,CAPA,CAQJ,IAEA9kB,KAGQwmB,GAAYlI,GAAG,YACnB,IAAI/B,EAAKwI,GAAT,CAIAxI,EAAKwI,IAAoB,EACzB,UACUxI,EAAKkK,IACf,CAAC,QACGlK,EAAKwI,IAAoB,CAC7B,CAPA,CAQJ,IAuBA/kB,KAGQ0mB,GAAKpI,GAAG,YACc,oBAAtB/B,EAAK+I,KAIiB,aAAtB/I,EAAK+I,SACC/I,EAAK4J,WAEL5J,EAAKiK,KAEnB,IAEAxmB,KAGQ2mB,GAAqBtJ,IACzB7f,GAAOW,KAAK,eAAgB,CAAEyoB,KAAM5mB,KAAKslB,GAAcuB,GAAIxJ,IAC3Drd,KAAKslB,GAAejI,CAAI,EAG5Brd,KAGQ+c,EAAmB,WAAA,IAAA+J,EAAAxI,GAAG,UAAO/Z,GAAoC,IAAAwiB,EAAAC,EAErEzK,EAAK0K,GAAwB1iB,GAG7BgY,EAAKsI,GAAwB,YAC7BkC,EAAAxK,EAAKkI,KAALsC,EAAiB7F,gBAGjB3E,EAAK+I,GAAe,WACL,OAAf0B,EAAAzK,EAAKkI,KAALuC,EAAiBlG,QAAQ,kBAGnBvE,EAAKgK,KAGPhK,EAAK2K,MAAmB3K,EAAK0I,GAAe,GAC5C1I,EAAK+J,IAEb,IAAC,OAAA,SAAAa,GAAA,OAAAL,EAAArI,MAAAze,KAAAjC,UAAA,CAAA,CAnB0B,GAqB3BiC,KAGQgd,EAAyB,KAAY,IAAAoK,EAAAC,EACzC7pB,GAAOW,KAAK,8BAGZ6B,KAAK2kB,GAAmB,KACxB3kB,KAAK0lB,GAAahhB,gBAGlB1E,KAAK6kB,GAAwB,KAG7B7kB,KAAKslB,GAAe,WACL,OAAf8B,EAAApnB,KAAKykB,KAAL2C,EAAiBtG,QAAQ,YAGV,OAAfuG,EAAArnB,KAAKykB,KAAL4C,EAAiBnG,eAAc,EAAK,EAGxClhB,KAGQid,EAAoBqB,GAAG,YAA2B,IAAAgJ,EAAAC,EACtD/pB,GAAOW,KAAK,6BAGZoe,EAAK+I,GAAe,UACL,OAAfgC,EAAA/K,EAAKkI,KAAL6C,EAAiBxG,QAAQ,WAGV,OAAfyG,EAAAhL,EAAKkI,KAAL8C,EAAiBvG,mBAAkB,SAC7BzE,EAAKkK,KAGXlK,EAAKrZ,SAASyiB,QAAQ,iCAC1B,IAAC3lB,KA9uBoBkD,SAAAA,EAEjBlD,KAAKwnB,GAAUhkB,EACfxD,KAAK0lB,GAAe,IAAIziB,GAAyBC,GAEjDlD,KAAKynB,GAAmBznB,KAAK0lB,GAAa/hB,6BAG1C3D,KAAK0nB,IAA4C,IAAzBlkB,EAAOmkB,cAC/B3nB,KAAK4nB,GDvDN,SAAgCC,GAAwC,IAAAC,EAC3E,IAAKD,GAA8B,IAAnBA,EAAQ7pB,OACpB,OAAO,EAGX,IAAM+pB,EAAwB,MAAN3rB,GAAgB,OAAV0rB,EAAN1rB,EAAQU,eAAQ,EAAhBgrB,EAAkBE,SAC1C,OAAKD,GAIEF,EAAQzQ,MAAM6Q,IACjB,IAAMC,EAvBd,SAAyBD,GACrB,IAAID,EAAWC,EAAO3gB,QAAQ,eAAgB,IAE9C,OADA0gB,EAAWA,EAAS9M,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,KACxC,IACvB,CAmBgCiN,CAAgBF,GACxC,IAAKC,EACD,OAAO,EAGX,GAAIA,EAAgBnQ,WAAW,MAAO,CAClC,IAAMqQ,EAAUF,EAAgBnnB,MAAM,GACtC,OAAOgnB,EAAgBM,SAAQ,IAAKD,IAAcL,IAAoBK,CAC1E,CAEA,OAAOL,IAAoBG,CAAe,GAElD,CCgCgCI,CAAuB9kB,EAAOqkB,SAEtDrqB,GAAOW,KAAK,mCAAoC,CAC5CqF,SACAO,gBAAiB/D,KAAKynB,GACtBc,gBAAiBvoB,KAAK0nB,GACtBc,gBAAiBxoB,KAAK4nB,KAG1B5nB,KAAKyoB,IACT,CAWMvC,WAAAA,CACFnb,EACA7F,EACAwjB,GAC4B,IAAAC,EAAA3oB,KAAA,OAAAse,GAAA,YAI5B,IAAM/Z,EAAWmkB,EAAY,KAAOC,EAAKhE,GAGnCiE,GAAerkB,EAEfhB,EAAQolB,EAAKnB,GAAQjkB,MAG3B,OAAO,IAAIslB,SAAQ,CAACC,EAASC,KAAW,IAAAC,EAC9BC,EAAaN,EAAKzlB,SAASgmB,kBAC3BC,UAAmBH,EAAAL,EAAKzlB,SAASqD,oBAAdyiB,EAA2B1M,QAAS,CAAA,EAKvDjX,GAAiB,MAAVH,OAAU,EAAVA,EAAYG,OAAQ8jB,EAAiBC,OAASD,EAAiB9jB,MAAQ,KAC9EC,GAAkB,MAAVJ,OAAU,EAAVA,EAAYI,QAAS6jB,EAAiBE,QAAUF,EAAiB7jB,OAAS,KAElFgkB,EAAuC,CACzCC,kBAAmBZ,EAAKlB,GAExB+B,YAAaP,EACble,QAASA,EAAQoH,OACjBlN,OAAQ,CACJI,OACAC,SAEJmkB,UAAWllB,GAGf,IAAI,IAAAujB,EAEM4B,EAAoBf,EAAKzlB,SAASymB,iBACpCD,IACAJ,EAAQM,WAAaF,GAIzB,IAAMG,EAAYlB,EAAKzlB,SAAS4mB,uBAAuB,CACnDC,eAAe,EACfC,kBAAmB,KAIjBC,EAAarB,QAAcxsB,GAAgB,OAAV0rB,EAAN1rB,EAAQU,eAAQ,EAAhBgrB,EAAkBjP,UAAOxc,GAEtDwtB,GAAaI,KACbX,EAAQY,gBAAkB,CACtBC,mBAAoBN,QAAaxtB,EACjC+tB,YAAaH,QAAc5tB,GAGvC,CAAE,MAAOoC,GAELjB,GAAOc,KAAK,oCAAqCG,EACrD,CAEAkqB,EAAKzlB,SAASmnB,cAAc,CACxB1S,IAAKgR,EAAKzlB,SAASonB,cAAcC,YAAY,MAAO,wCACpDC,OAAQ,OACRrmB,KAAMmlB,EACNmB,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAAb,CAKA,GAA4B,MAAxB5E,EAAS4E,YAA8C,MAAxB5E,EAAS4E,WAAoB,CAAA,IAAAC,EAAAC,EACtDC,GAAwB,OAAbF,EAAA7E,EAASgF,WAAI,EAAbH,EAAeI,iBAAMH,EAAI9E,EAASgF,aAATF,EAAe9f,UAAW,yBAGpE,OAFAvN,GAAOiB,MAAM,yBAA0B,CAAE8S,OAAQwU,EAAS4E,kBAC1D5B,EAAO,IAAIloB,MAAMiqB,GAErB,CAEA,GAAK/E,EAASgF,KAAd,CAKA,IAAM5mB,EAAO4hB,EAASgF,KAIlBnC,GAAezkB,EAAKslB,YACpBd,EAAKhE,GAAmBxgB,EAAKslB,UAC7Bd,EAAKjD,GAAaphB,aAAaH,EAAKslB,WACpCjsB,GAAOW,KAAK,qBAAsB,CAC9BoG,SAAUJ,EAAKslB,UACfwB,QAAsB,IAAdvC,KAKhBC,EAAKzlB,SAASyiB,QAAQ,8BAA+B,CACjDphB,SAAUJ,EAAKslB,UACfb,YAAaA,EACbsC,cAAengB,EAAQ/M,SAI3B2qB,EAAK9D,GAAwB1gB,EAAKkO,WAElCyW,EAAQ3kB,EAzBR,MAFI4kB,EAAO,IAAIloB,MAAM,gCAVrB,MAFIkoB,EAAO,IAAIloB,MAAM,uDAuCR,GAEnB,GACJ,GAhH0Byd,EAiHhC,CAMQ2I,EAAAA,CAAwB1iB,GACxBA,GAAYA,IAAavE,KAAK2kB,KAC9B3kB,KAAK2kB,GAAmBpgB,EACxBvE,KAAK0lB,GAAaphB,aAAaC,GAE/BvE,KAAK6kB,GAAwB,KAErC,CAGMsG,WAAAA,CAAY5mB,EAAmB6mB,GAA8C,IAAAC,EAAArrB,KAAA,OAAAse,GAAA,YAE/E,IAAMgN,EAAiB/mB,GAAY8mB,EAAK1G,GAExC,IAAK2G,EACD,MAAM,IAAIzqB,MAAM,oDAIpBwqB,EAAKpE,GAAwB1iB,GAE7B,IAAMhB,EAAQ8nB,EAAK7D,GAAQjkB,MAG3B,OAAO,IAAIslB,SAAQ,CAACC,EAASC,KAGzB,IAAMwC,EAAsC,CACxChC,kBAAmB8B,EAAK5D,GACxB+D,MAAO,MAGPJ,IACAG,EAAYH,MAAQA,GAGxBC,EAAKnoB,SAASmnB,cAAc,CACxB1S,IAAK0T,EAAKnoB,SAASonB,cAAcC,YAC7B,+CACyCe,EAAc,IAAI1I,GAAgB2I,IAE/Ef,OAAQ,MACRC,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAAb,CAKA,GAA4B,MAAxB5E,EAAS4E,WAAoB,CAAA,IAAAc,EAAAC,EACvBZ,GAAwB,OAAbW,EAAA1F,EAASgF,WAAI,EAAbU,EAAeT,iBAAMU,EAAI3F,EAASgF,aAATW,EAAe3gB,UAAW,2BAGpE,OAFAvN,GAAOiB,MAAM,2BAA4B,CAAE8S,OAAQwU,EAAS4E,kBAC5D5B,EAAO,IAAIloB,MAAMiqB,GAErB,CAEA,GAAK/E,EAASgF,KAAd,CAKA,IAAM5mB,EAAO4hB,EAASgF,KACtBjC,EAAQ3kB,EAHR,MAFI4kB,EAAO,IAAIloB,MAAM,gCAVrB,MAFIkoB,EAAO,IAAIloB,MAAM,uDAiBR,GAEnB,GACJ,GAzD6Eyd,EA0DnF,CAGMqN,UAAAA,CAAWpnB,GAAgD,IAAAqnB,EAAA5rB,KAAA,OAAAse,GAAA,YAE7D,IAAMgN,EAAiB/mB,GAAYqnB,EAAKjH,GAExC,IAAK2G,EACD,MAAM,IAAIzqB,MAAM,oDAIpB+qB,EAAK3E,GAAwB1iB,GAE7B,IAAMhB,EAAQqoB,EAAKpE,GAAQjkB,MAK3B,OAHA/F,GAAOW,KAAK,2BAA4B,CAAEoG,SAAU+mB,IAG7C,IAAIzC,SAAQ,CAACC,EAASC,KACzB6C,EAAK1oB,SAASmnB,cAAc,CACxB1S,IAAKiU,EAAK1oB,SAASonB,cAAcC,YAC7B,MAAK,yCACoCe,WAE7Cd,OAAQ,OACRrmB,KAAM,CACFolB,kBAAmBqC,EAAKnE,IAE5BgD,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAAb,CAKA,GAA4B,MAAxB5E,EAAS4E,WAAoB,CAAA,IAAAkB,EAAAC,EACvBhB,GACW,OAAbe,EAAA9F,EAASgF,WAAI,EAAbc,EAAeb,iBAAMc,EAAI/F,EAASgF,aAATe,EAAe/gB,UAAW,kCAGvD,OAFAvN,GAAOiB,MAAM,kCAAmC,CAAE8S,OAAQwU,EAAS4E,kBACnE5B,EAAO,IAAIloB,MAAMiqB,GAErB,CAEA,GAAK/E,EAASgF,KAAd,CAKA,IAAM5mB,EAAO4hB,EAASgF,KACtBjC,EAAQ3kB,EAHR,MAFI4kB,EAAO,IAAIloB,MAAM,gCAXrB,MAFIkoB,EAAO,IAAIloB,MAAM,uDAkBR,GAEnB,GACJ,GApD2Dyd,EAqDjE,CAOQmK,EAAAA,GACJ,GAAK5rB,IAAaT,EAAlB,CAKA,IAAM2vB,EAAexI,KACrB,GAAIwI,IAAiB/rB,KAAKolB,GAiBtB,OAhBAplB,KAAKolB,IAA4B,EAKjCxB,KACAnM,WAAWmM,GAA0B,QAErC5jB,KAAKgsB,GAA2BD,GAC3BE,OAAOxtB,IACJjB,GAAOc,KAAK,iDAAkDG,EAAM,IAEvEytB,SAAQ,KACLtI,KACA5jB,KAAKmsB,IAAyB,IAK1CnsB,KAAKmsB,IAvBL,MAFI3uB,GAAOW,KAAK,gEA0BpB,CAEQguB,EAAAA,GACJnsB,KAAKolB,IAA4B,EAGjCplB,KAAK2kB,GAAmB3kB,KAAK0lB,GAAalhB,eAC1ChH,GAAOW,KAAK,gCAAiC,CAAEoG,SAAUvE,KAAK2kB,KAG9D3kB,KAAKkD,SAASyiB,QAAQ,wBAAyB,CAC3CyG,oBAAqBpsB,KAAK2kB,GAC1BgD,cAAe3nB,KAAK0nB,GACpB2E,cAAersB,KAAK4nB,KAIpB5nB,KAAK0nB,IAAoB1nB,KAAK4nB,GAC9B5nB,KAAKssB,KAEL9uB,GAAOW,KAAK,sBAAuB,CAC/BwpB,cAAe3nB,KAAK0nB,GACpB2E,cAAersB,KAAK4nB,KAK5B5nB,KAAKusB,IACT,CAEcP,EAAAA,CAA2BD,GAAyD,IAAAS,EAAAxsB,KAAA,OAAAse,GAAA,YAC9F,IACI,aAAakO,EAAKC,GAAkBV,EACxC,CAAE,MAAOttB,GAEL,OADAjB,GAAOc,KAAK,+CAAgDG,SAC/C+tB,EAAKC,GAAkBV,EACxC,CAAC,GAN6FzN,EAOlG,CAEcmO,EAAAA,CAAkBV,GAAyD,IAAAW,EAAA1sB,KAAA,OAAAse,GAAA,YAAA,IAAAkF,EAAAmJ,EAC/EppB,EAAQmpB,EAAKlF,GAAQjkB,MAErB+lB,EAAmC,CACrCsD,cAAeb,EACfxC,kBAAmBmD,EAAKjF,GACxB+B,YAAakD,EAAKxpB,SAASgmB,kBAC3BkB,YAAmB,MAANhuB,GAAgB,OAAVonB,EAANpnB,EAAQU,eAAQ,EAAhB0mB,EAAkB3K,MAI7B1U,QAAa,IAAI0kB,SAAkC,CAACC,EAASC,KAC/D2D,EAAKxpB,SAASmnB,cAAc,CACxB1S,IAAK+U,EAAKxpB,SAASonB,cAAcC,YAAY,MAhZ3B,wCAiZlBC,OAAQ,OACRrmB,KAAMmlB,EACNmB,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAKb,GAA4B,MAAxB5E,EAAS4E,WAUR5E,EAASgF,KAKdjC,EAAQ/C,EAASgF,MAJbhC,EAAO,IAAIloB,MAAM,qCAXrB,CAAiC,IAAAgsB,EAAAC,EAAAC,EACvBjC,GACW,OAAb+B,EAAA9G,EAASgF,WAAI,EAAb8B,EAAepuB,SACF,OADOquB,EACpB/G,EAASgF,WAAI,EAAb+B,EAAe9B,UACF,OADQ+B,EACrBhH,EAASgF,WAAI,EAAbgC,EAAehiB,UACf,kCACJge,EAAO,IAAIloB,MAAMiqB,GAErB,MAZI/B,EAAO,IAAIloB,MAAM,uDAmB6B,GAExD,IAGN,MAAoB,YAAhBsD,EAAKoN,QACL/T,GAAOW,KAAK,iCAAkC,CAAEoT,OAAQpN,EAAKoN,OAAQoH,KAAMxU,EAAKwU,OACzExU,IAGXuoB,EAAK7H,GAAwB,KAC7B6H,EAAKzH,GAAe,EAGhB9gB,EAAKolB,oBACLmD,EAAKjF,GAAmBtjB,EAAKolB,kBAC7BmD,EAAKhH,GAAazhB,mBAAmBE,EAAKolB,oBAGlB,OAA5BoD,EAAIxoB,EAAK6oB,sBAALL,EAA0B3uB,QAC1B0uB,EAAK/H,GAAmBxgB,EAAK6oB,oBAAoB,GACjDN,EAAKhH,GAAaphB,aAAaooB,EAAK/H,IAE/B+H,EAAKvG,KACLuG,EAAKlG,OAEVkG,EAAK/H,GAAmB,KACxB+H,EAAKhH,GAAahhB,iBAGfP,EAAI,GAtE0Ema,EAuEzF,CAMQgO,EAAAA,GACJ,OAAItsB,KAAKmlB,GACE0D,QAAQC,WAEf9oB,KAAKqlB,KAGTrlB,KAAKqlB,GAA2BrlB,KAAKitB,MAF1BjtB,KAAKqlB,GAIpB,CAEc4H,EAAAA,GAAqC,IAAAC,EAAAltB,KAAA,OAAAse,GAAA,YAC/C,IACMY,EAAwD,SAD3CgO,EAAKxH,GAAa5gB,kBACkC,OAAS,SAChFooB,EAAKhI,GAAehG,EAGpB,IAAMJ,EAAoBoO,EAAKC,MAGvB9P,KAAM0B,EAAW/L,QAAEA,SAAkBka,EAAKE,KAClDF,EAAK5H,GAAevG,EAGpBmO,EAAKG,GAAcnO,EAAcJ,EAAmBC,EAAa/L,GACjEka,EAAK/H,IAAoB,EAEzB+H,EAAKhqB,SAASyiB,QAAQ,+BAAgC,CAClDyG,oBAAqBc,EAAKvI,GAC1BzF,aAAcA,EACdH,YAAaA,EACbuO,YAAata,EAAQhV,OACrBuvB,gBAAiBzO,IAIrBoO,EAAKM,IAAe,GAzB2BlP,EA0BnD,CAKQ6O,EAAAA,GAAmD,IAAAM,EAEjDtE,UAAmBsE,OAAKvqB,SAASqD,oBAAdknB,EAA2BnR,QAAS,CAAA,EACvDoR,EAAcvE,EAAiBC,OAASD,EAAiB9jB,KACzDsoB,EAAexE,EAAiBE,QAAUF,EAAiB7jB,MAGjE,GAAIooB,GAAeC,EACf,MAAO,CACHtoB,KAAMqoB,QAAerxB,EACrBiJ,MAAOqoB,QAAgBtxB,GAK/B,IAAMuxB,EAAc5tB,KAAK0lB,GAAavgB,iBACtC,OAAIyoB,IAAgBA,EAAYvoB,MAAQuoB,EAAYtoB,OACzCsoB,EAGJ,IACX,CAqEctH,EAAAA,GAAqC,IAAAuH,EAAA7tB,KAAA,OAAAse,GAAA,YAC/C,GAAKuP,EAAKlJ,GAIV,IAAI,IAAAmJ,EACM/H,QAAiB8H,EAAKlC,WAAWkC,EAAKlJ,IAC5CkJ,EAAK5I,GAAec,EAASrU,aAEd,OAAfoc,EAAAD,EAAKpJ,KAALqJ,EAAiBnN,eAAe,GAChCnjB,GAAOW,KAAK,0BAA2B,CAAEoR,YAAawW,EAASrU,cACnE,CAAE,MAAOjT,GACLjB,GAAOiB,MAAM,kCAAmCA,EACpD,CAAC,GAb8C6f,EAcnD,CAKciI,EAAAA,GAA+B,IAAAwH,EAAA/tB,KAAA,OAAAse,GAAA,YACzC,GAAKyP,EAAKpJ,GAIV,IACI,IAGqCqJ,EAH/BjI,QAAiBgI,EAAK5C,YAAY4C,EAAKpJ,GAAkBoJ,EAAKlJ,SAAyBxoB,GAG7F,GAAIH,EAAS6pB,EAASrU,cAClBqc,EAAK9I,GAAec,EAASrU,aACd,OAAfsc,EAAAD,EAAKtJ,KAALuJ,EAAiBrN,eAAeoF,EAASrU,cAGrCqU,EAASrU,aAAe,GAAKqc,EAAK7G,MAClC6G,EAAKzH,KAIb,GAAIP,EAASnb,SAAS5M,OAAS,EAAG,CAAA,IAAAiwB,EACf,OAAfA,EAAAF,EAAKtJ,KAALwJ,EAAiB/N,YAAY6F,EAASnb,UAEtC,IAAMsjB,EAAcnI,EAASnb,SAASmb,EAASnb,SAAS5M,OAAS,GACjE+vB,EAAKlJ,GAAwBqJ,EAAY7b,UAC7C,CACJ,CAAE,MAAO5T,GACLjB,GAAOiB,MAAM,0BAA2BA,EAC5C,CAAC,GA3BwC6f,EA4B7C,CAEQ4I,EAAAA,GACJ,MAA6B,SAAtBlnB,KAAKklB,EAChB,CAqCcuB,EAAAA,GAA8B,IAAA0H,EAAAnuB,KAAA,OAAAse,GAAA,YACxC,IAAI,IAAA8P,EAAAC,EACMtI,QAAiBoI,EAAKG,aAC5BH,EAAK5I,GAAWQ,EAASwI,QACzBJ,EAAK3I,GAAsBO,EAASwI,QAAQvwB,OAAS,EACtC,OAAfowB,EAAAD,EAAK1J,KAAL2J,EAAiBvN,cAAckF,EAASwI,SAGxC,IAAMC,EAAczI,EAASwI,QAAQE,QAAO,CAACC,EAAKxZ,IAAMwZ,GAAOxZ,EAAExD,cAAgB,IAAI,GACrFyc,EAAKlJ,GAAeuJ,EACL,OAAfH,EAAAF,EAAK1J,KAAL4J,EAAiB1N,eAAe6N,GAEhChxB,GAAOW,KAAK,iBAAkB,CAAEyiB,MAAOmF,EAASwI,QAAQvwB,OAAQwwB,eACpE,CAAE,MAAO/vB,GACLjB,GAAOiB,MAAM,yBAA0BA,EAC3C,CAAC,GAfuC6f,EAgB5C,CA2Fc8O,EAAAA,GAA0E,IAAAuB,EAAA3uB,KAAA,OAAAse,GAAA,YACpF,IACI,IAAMyH,QAAiB4I,EAAKL,aAC5BK,EAAKpJ,GAAWQ,EAASwI,QACzBI,EAAKnJ,GAAsBO,EAASwI,QAAQvwB,OAAS,EAGrD,IAAMwwB,EAAczI,EAASwI,QAAQE,QAAO,CAACC,EAAKxZ,IAAMwZ,GAAOxZ,EAAExD,cAAgB,IAAI,GAIrF,OAHAid,EAAK1J,GAAeuJ,EAGhBzI,EAASwI,QAAQvwB,QAAU,EACpB,CAAEqf,KAAM,UAAWrK,QAAS+S,EAASwI,UAIhB,IAA5BxI,EAASwI,QAAQvwB,SACjB2wB,EAAKhK,GAAmBoB,EAASwI,QAAQ,GAAGrqB,GAC5CyqB,EAAKjJ,GAAaphB,aAAayhB,EAASwI,QAAQ,GAAGrqB,KAGhD,CAAEmZ,KAAM,WAAYrK,QAAS+S,EAASwI,SACjD,CAAE,MAAO9vB,GAEL,OADAjB,GAAOiB,MAAM,mCAAoCA,GAC1C,CAAE4e,KAAM,WAAYrK,QAAS,GACxC,CAAC,GAzBmFsL,EA0BxF,CAKQkP,EAAAA,GACAxtB,KAAK4kB,KAKT5kB,KAAK0mB,KAGL1mB,KAAK4kB,SAAkBxoB,SAAAA,EAAQwyB,aAAY,KACvC5uB,KAAK0mB,IAAO,GAj0BC,KAo0BjBlpB,GAAOW,KAAK,kBAAmB,CAAEkf,KAAMrd,KAAKslB,KAChD,CAKQuJ,EAAAA,GACA7uB,KAAK4kB,KACC,MAANxoB,GAAAA,EAAQ0yB,cAAc9uB,KAAK4kB,IAC3B5kB,KAAK4kB,GAAkB,KACvBpnB,GAAOW,KAAK,gCAEpB,CAOQouB,EAAAA,GACJvsB,KAAKglB,GAA+BhlB,KAAKkD,SAAS6rB,GAAG,iBAAkBC,IAClC,IAAAC,EAAb,cAAhBD,EAAMA,eAENC,OAAKxK,KAALwK,EAAiBvO,oBACrB,GAER,CAOAH,IAAAA,GAESvgB,KAAK4nB,GAML5nB,KAAKmlB,IACNnlB,KAAKssB,KANL9uB,GAAOc,KAAK,oDAQpB,CAMAkiB,IAAAA,GAEIxgB,KAAK6uB,KAED7uB,KAAK0kB,KACL9C,EAAO,KAAM5hB,KAAK0kB,IAClB1kB,KAAK0kB,GAAkBwK,SACvBlvB,KAAK0kB,GAAoB,MAE7B1kB,KAAKykB,GAAa,KAClBzkB,KAAKmlB,IAAoB,EACzBnlB,KAAKqlB,GAA2B,KAGhCrlB,KAAK6kB,GAAwB,IACjC,CAKAsK,SAAAA,GACI,OAAOnvB,KAAKmlB,EAChB,CAGMmJ,UAAAA,CAAWnvB,GAA0D,IAAAiwB,EAAApvB,KAAA,OAAAse,GAAA,YAAA,IAAA+Q,EAAAC,EACjE/rB,EAAQ6rB,EAAK5H,GAAQjkB,MAErBgoB,EAAsC,CACxChC,kBAAmB6F,EAAK3H,GACxB+D,MAAO+D,eAAMF,EAAQ,MAAPlwB,OAAO,EAAPA,EAASqsB,aAAK,IAAA6D,EAAAA,EAAI,IAChCG,OAAQD,OAAsB,QAAhBD,EAAQ,MAAPnwB,OAAO,EAAPA,EAASqwB,cAAM,IAAAF,EAAAA,EAAI,IAQtC,OALW,MAAPnwB,GAAAA,EAASoS,SACTga,EAAYha,OAASpS,EAAQoS,QAI1B,IAAIsX,SAAQ,CAACC,EAASC,KACzBqG,EAAKlsB,SAASmnB,cAAc,CACxB1S,IAAKyX,EAAKlsB,SAASonB,cAAcC,YAC7B,MAAK,wCACmC3H,GAAgB2I,IAE5Df,OAAQ,MACRC,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAAb,CAKA,GAA4B,MAAxB5E,EAAS4E,WAAoB,CAAA,IAAA8E,EAAAC,EACvB5E,GAAwB,OAAb2E,EAAA1J,EAASgF,WAAI,EAAb0E,EAAezE,iBAAM0E,EAAI3J,EAASgF,aAAT2E,EAAe3kB,UAAW,0BAGpE,OAFAvN,GAAOiB,MAAM,0BAA2B,CAAE8S,OAAQwU,EAAS4E,kBAC3D5B,EAAO,IAAIloB,MAAMiqB,GAErB,CAEA,GAAK/E,EAASgF,KAAd,CAKA,IAAM5mB,EAAO4hB,EAASgF,KACtBjC,EAAQ3kB,EAHR,MAFI4kB,EAAO,IAAIloB,MAAM,gCAVrB,MAFIkoB,EAAO,IAAIloB,MAAM,uDAiBR,GAEnB,GACJ,GA9CqEyd,EA+C3E,CAEM0H,kBAAAA,CAAmB1gB,GAAoD,IAAAqqB,EAAA3vB,KAAA,OAAAse,GAAA,YAAA,IAAAsR,EACnEC,EAAkBvqB,EAAM6M,OAAO2F,cACrC,IAAK+X,EACD,MAAM,IAAIhvB,MAAM,qBAGpB,IAAM0C,EAAQosB,EAAKnI,GAAQjkB,MACrB+lB,EAAqC,CACvChkB,MAAOuqB,EACPC,aAAmB,MAAN1zB,GAAgB,OAAVwzB,EAANxzB,EAAQU,eAAQ,EAAhB8yB,EAAkB/W,OAAQ,IAI3C,OAAO,IAAIgQ,SAAQ,CAACC,EAASC,KACzB4G,EAAKzsB,SAASmnB,cAAc,CACxB1S,IAAKgY,EAAKzsB,SAASonB,cAAcC,YAAY,MA78B5B,gDA88BjBC,OAAQ,OACRrmB,KAAMmlB,EACNmB,QAAS,CACL,wBAAyBlnB,GAE7BmnB,SAAW3E,IACP,GAA4B,MAAxBA,EAAS4E,WAKb,GAA4B,MAAxB5E,EAAS4E,WAUb7B,EAAQ,CAAEiH,IAAI,QAVd,CAAiC,IAAAC,EAAAC,EAAAC,EACvBpF,GACW,OAAbkF,EAAAjK,EAASgF,WAAI,EAAbiF,EAAevxB,SACF,OADOwxB,EACpBlK,EAASgF,WAAI,EAAbkF,EAAejF,UACF,OADQkF,EACrBnK,EAASgF,WAAI,EAAbmF,EAAenlB,UACf,iCACJge,EAAO,IAAIloB,MAAMiqB,GAErB,MAZI/B,EAAO,IAAIloB,MAAM,uDAcA,GAE3B,GACJ,GAxCuEyd,EAyC7E,CAEM6R,gBAAAA,CAAiBpE,GAAyD,IAAAqE,EAAApwB,KAAA,OAAAse,GAAA,YAC5E,IAAM+R,EAAkBtE,EAAa5Z,OACrC,IAAKke,EACD,MAAM,IAAIxvB,MAAM,6BAEpB,IACI,aAAauvB,EAAKpE,GAA2BqE,EACjD,CAAC,QACGzM,IACJ,CAAC,GAT2EtF,EAUhF,CAEMgS,mBAAAA,GAAgE,IAAAC,EAAAvwB,KAAA,OAAAse,GAAA,YAClE,IAAMyN,EAAexI,KACrB,IAAKwI,EACD,OAAO,KAGX,IACI,aAAawE,EAAKJ,iBAAiBpE,EACvC,CAAC,QACGnI,IACJ,CAAC,GAViEtF,EAWtE,CAMAkS,kBAAAA,GACI,OAAOxwB,KAAK2kB,EAChB,CAMA8L,kBAAAA,GACI,OAAOzwB,KAAKynB,EAChB,CAKAiJ,OAAAA,GACI1wB,KAAK6uB,KAGD7uB,KAAKglB,KACLhlB,KAAKglB,KACLhlB,KAAKglB,GAA+B,MAGpChlB,KAAK0kB,KACL9C,EAAO,KAAM5hB,KAAK0kB,IAClB1kB,KAAK0kB,GAAkBwK,SACvBlvB,KAAK0kB,GAAoB,MAG7B1kB,KAAKykB,GAAa,KAEdF,KAAmBvkB,OACnBukB,GAAiB,MAErB/mB,GAAOW,KAAK,mBAChB,CAMAwyB,KAAAA,GAEI3wB,KAAK0lB,GAAalgB,WAGlBxF,KAAK2kB,GAAmB,KACxB3kB,KAAK6kB,GAAwB,KAC7B7kB,KAAKilB,GAAe,EAGpBjlB,KAAK0wB,UAELlzB,GAAOW,KAAK,sBAChB,CAKQkvB,EAAAA,CACJnO,EACAJ,EACAC,EACAI,GAEA,QAHuB,IAAvBJ,IAAAA,EAA0B,iBACF,IAAxBI,IAAAA,EAA2B,IAEtBtiB,GAAL,CAMA,IAAI+zB,EAAY/zB,GAASg0B,eAAevM,IACxC,IAAKsM,EAAW,CACZ,IAAK/zB,GAASi0B,KAEV,YADAtzB,GAAOW,KAAK,uEAGhByyB,EAAY/zB,GAASk0B,cAAc,QACzB7sB,GAAKogB,GACfznB,GAASi0B,KAAKE,YAAYJ,EAC9B,CACA5wB,KAAK0kB,GAAoBkM,EAGzBhP,EACIlS,GAAC0M,GAAmB,CAChBF,IAAMA,IACFlc,KAAKykB,GAAavI,CAAG,EAEzB1Y,OAAQxD,KAAKwnB,GACbtI,aAAcA,EACdJ,kBAAmBA,EACnBG,iBAAkBjf,KAAKkD,SAAS+tB,gBAChClS,YAAaA,EACbI,eAAgBA,EAChB1B,mBAAoBzd,KAAKwlB,GACzBzJ,cAAe/b,KAAK6d,EACpB8B,cAAe3f,KAAKqmB,GACpBnI,WAAYle,KAAKylB,GACjBlH,qBAAsBve,KAAK8lB,GAC3B5S,eAAgBlT,KAAK+c,EACrBnK,kBAAmB5S,KAAKgd,EACxBE,gBAAiBld,KAAKid,EACtBK,aAActd,KAAK2mB,KAEvBiK,EArCJ,MAFIpzB,GAAOW,KAAK,4DAyCpB,EAWG,SAAS+yB,GAAkB1tB,EAAmCH,GACjE,OAAIkhB,IACA/mB,GAAOW,KAAK,0DACLomB,KAGX/mB,GAAOW,KAAK,2BAA4B,CAAEgzB,YAAa3tB,EAAQ4tB,aAAc/tB,IAC7EkhB,GAAiB,IAAIC,GAAqBhhB,EAAQH,GAEtD,CCpqCAlG,GAAiBk0B,sBAAwBl0B,GAAiBk0B,uBAAyB,CAAA,EACnFl0B,GAAiBk0B,sBAAsBH,kBAAoBA","x_google_ignoreList":[0,16]}