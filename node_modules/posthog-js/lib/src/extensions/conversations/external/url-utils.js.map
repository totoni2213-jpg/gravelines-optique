{"version":3,"file":"url-utils.js","sourceRoot":"","sources":["../../../../../src/extensions/conversations/external/url-utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { createLogger } from '../../../utils/logger'\nimport { window } from '../../../utils/globals'\n\nconst logger = createLogger('[ConversationsManager]')\n\nexport const RESTORE_QUERY_PARAM = 'ph_conv_restore'\n\n/**\n * Extract hostname from a domain string (handles URLs and plain hostnames)\n */\nfunction extractHostname(domain: string): string | null {\n    let hostname = domain.replace(/^https?:\\/\\//, '')\n    hostname = hostname.split('/')[0].split('?')[0].split(':')[0]\n    return hostname || null\n}\n\n/**\n * Check if the current domain matches the allowed domains list.\n * Returns true if:\n * - domains is empty or not present (no restriction)\n * - current hostname matches any allowed domain\n */\nexport function isCurrentDomainAllowed(domains: string[] | undefined): boolean {\n    if (!domains || domains.length === 0) {\n        return true\n    }\n\n    const currentHostname = window?.location?.hostname\n    if (!currentHostname) {\n        return true\n    }\n\n    return domains.some((domain) => {\n        const allowedHostname = extractHostname(domain)\n        if (!allowedHostname) {\n            return false\n        }\n\n        if (allowedHostname.startsWith('*.')) {\n            const pattern = allowedHostname.slice(2)\n            return currentHostname.endsWith(`.${pattern}`) || currentHostname === pattern\n        }\n\n        return currentHostname === allowedHostname\n    })\n}\n\nexport function getRestoreTokenFromUrl(): string | null {\n    if (!window?.location?.search) {\n        return null\n    }\n\n    try {\n        // eslint-disable-next-line compat/compat\n        const params = new URLSearchParams(window.location.search)\n        const token = params.get(RESTORE_QUERY_PARAM)\n        return token?.trim() || null\n    } catch (error) {\n        logger.warn('Failed to parse restore token from URL', error)\n        return null\n    }\n}\n\nexport function clearRestoreTokenFromUrl(): void {\n    if (!window?.location || !window?.history?.replaceState) {\n        return\n    }\n\n    try {\n        // eslint-disable-next-line compat/compat\n        const url = new URL(window.location.href)\n        url.searchParams.delete(RESTORE_QUERY_PARAM)\n        const newUrl = `${url.pathname}${url.search}${url.hash}`\n        window.history.replaceState(window.history.state, '', newUrl)\n    } catch (error) {\n        logger.warn('Failed to clear restore token from URL', error)\n    }\n}\n"]}