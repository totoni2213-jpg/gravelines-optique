{"version":3,"file":"ProductTourSurveyStepInner.js","sourceRoot":"","sources":["../../../../../src/extensions/product-tours/components/ProductTourSurveyStepInner.tsx"],"names":[],"mappings":"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","sourcesContent":["import { h } from 'preact'\nimport { useState, useRef, useEffect } from 'preact/hooks'\nimport { ProductTourStep, ProductTourAppearance, ProductTourSurveyQuestion } from '../../../posthog-product-tours-types'\nimport { cancelSVG, IconPosthogLogo } from '../../surveys/icons'\nimport {\n    dissatisfiedEmoji,\n    neutralEmoji,\n    satisfiedEmoji,\n    veryDissatisfiedEmoji,\n    verySatisfiedEmoji,\n} from '../../surveys/icons'\n\nexport interface ProductTourSurveyStepInnerProps {\n    step: ProductTourStep\n    appearance?: ProductTourAppearance\n    stepIndex: number\n    totalSteps: number\n    onPrevious?: () => void\n    onSubmit?: (response: string | number | null) => void\n    onDismiss?: () => void\n}\n\nconst threeScaleEmojis = [dissatisfiedEmoji, neutralEmoji, satisfiedEmoji]\nconst fiveScaleEmojis = [veryDissatisfiedEmoji, dissatisfiedEmoji, neutralEmoji, satisfiedEmoji, verySatisfiedEmoji]\n\nfunction getScaleNumbers(scale: number): number[] {\n    switch (scale) {\n        case 5:\n            return [1, 2, 3, 4, 5]\n        case 10:\n            return [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n        default:\n            return [1, 2, 3, 4, 5]\n    }\n}\n\nfunction OpenTextInput({\n    value,\n    onChange,\n    onSubmit,\n    isInteractive,\n}: {\n    value: string\n    onChange: (text: string) => void\n    onSubmit?: () => void\n    isInteractive: boolean\n}): h.JSX.Element {\n    const inputRef = useRef<HTMLTextAreaElement>(null)\n\n    useEffect(() => {\n        if (isInteractive) {\n            setTimeout(() => inputRef.current?.focus(), 100)\n        }\n    }, [isInteractive])\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Enter' && e.metaKey && isInteractive) {\n            e.preventDefault()\n            onSubmit?.()\n        }\n    }\n\n    return (\n        <textarea\n            ref={inputRef}\n            class=\"ph-tour-survey-textarea\"\n            rows={3}\n            placeholder=\"Your feedback (optional)...\"\n            value={value}\n            onInput={(e) => onChange((e.target as HTMLTextAreaElement).value)}\n            onKeyDown={handleKeyDown}\n            disabled={!isInteractive}\n            style={isInteractive ? undefined : { cursor: 'default' }}\n        />\n    )\n}\n\nfunction RatingInput({\n    survey,\n    onSubmit,\n    isInteractive,\n}: {\n    survey: ProductTourSurveyQuestion\n    onSubmit?: (rating: number) => void\n    isInteractive: boolean\n}): h.JSX.Element {\n    const [selectedRating, setSelectedRating] = useState<number | null>(null)\n    const display = survey.display || 'emoji'\n    const scale = survey.scale || 5\n\n    const handleSelect = (rating: number) => {\n        if (!isInteractive) {\n            return\n        }\n        setSelectedRating(rating)\n        // Auto-submit on selection for ratings\n        onSubmit?.(rating)\n    }\n\n    if (display === 'emoji') {\n        const emojis = scale === 3 ? threeScaleEmojis : fiveScaleEmojis\n        return (\n            <div class=\"ph-tour-survey-rating-container\">\n                <div class=\"ph-tour-survey-rating-emoji\">\n                    {emojis.map((emoji, idx) => {\n                        const rating = idx + 1\n                        const isActive = selectedRating === rating\n                        return (\n                            <button\n                                key={idx}\n                                type=\"button\"\n                                class={`ph-tour-survey-emoji-button ${isActive ? 'ph-tour-survey-emoji-button--active' : ''}`}\n                                onClick={() => handleSelect(rating)}\n                                style={isInteractive ? undefined : { cursor: 'default' }}\n                                aria-label={`Rate ${rating}`}\n                            >\n                                {emoji}\n                            </button>\n                        )\n                    })}\n                </div>\n                {(survey.lowerBoundLabel || survey.upperBoundLabel) && (\n                    <div class=\"ph-tour-survey-rating-labels\">\n                        <span>{survey.lowerBoundLabel}</span>\n                        <span>{survey.upperBoundLabel}</span>\n                    </div>\n                )}\n            </div>\n        )\n    }\n\n    // Number display\n    const numbers = getScaleNumbers(scale)\n    return (\n        <div class=\"ph-tour-survey-rating-container\">\n            <div\n                class=\"ph-tour-survey-rating-numbers\"\n                style={{ gridTemplateColumns: `repeat(${numbers.length}, minmax(0, 1fr))` }}\n            >\n                {numbers.map((num) => {\n                    const isActive = selectedRating === num\n                    return (\n                        <button\n                            key={num}\n                            type=\"button\"\n                            class={`ph-tour-survey-number-button ${isActive ? 'ph-tour-survey-number-button--active' : ''}`}\n                            onClick={() => handleSelect(num)}\n                            style={isInteractive ? undefined : { cursor: 'default' }}\n                            aria-label={`Rate ${num}`}\n                        >\n                            {num}\n                        </button>\n                    )\n                })}\n            </div>\n            {(survey.lowerBoundLabel || survey.upperBoundLabel) && (\n                <div class=\"ph-tour-survey-rating-labels\">\n                    <span>{survey.lowerBoundLabel}</span>\n                    <span>{survey.upperBoundLabel}</span>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport function ProductTourSurveyStepInner({\n    step,\n    appearance,\n    stepIndex,\n    totalSteps,\n    onPrevious,\n    onSubmit,\n    onDismiss,\n}: ProductTourSurveyStepInnerProps): h.JSX.Element {\n    const [textValue, setTextValue] = useState('')\n    const survey = step.survey\n    const whiteLabel = appearance?.whiteLabel ?? false\n    const isFirstStep = stepIndex === 0\n    const isOpenText = survey?.type === 'open'\n\n    const isInteractive = !!(onPrevious || onSubmit || onDismiss)\n    const cursorStyle = isInteractive ? undefined : { cursor: 'default' }\n\n    const handleTextSubmit = () => {\n        onSubmit?.(textValue.trim() || null)\n    }\n\n    if (!survey) {\n        return <div />\n    }\n\n    return (\n        <>\n            <button class=\"ph-tour-dismiss\" onClick={onDismiss} aria-label=\"Close survey\" style={cursorStyle}>\n                {cancelSVG()}\n            </button>\n\n            <div class=\"ph-tour-survey-question\">{survey.questionText}</div>\n\n            {isOpenText ? (\n                <OpenTextInput\n                    value={textValue}\n                    onChange={setTextValue}\n                    onSubmit={handleTextSubmit}\n                    isInteractive={isInteractive}\n                />\n            ) : (\n                <RatingInput survey={survey} onSubmit={onSubmit} isInteractive={isInteractive} />\n            )}\n\n            <div class=\"ph-tour-footer\">\n                <span class=\"ph-tour-progress\">\n                    {stepIndex + 1} of {totalSteps}\n                </span>\n\n                <div class=\"ph-tour-buttons\">\n                    {!isFirstStep && (\n                        <button\n                            class=\"ph-tour-button ph-tour-button--secondary\"\n                            onClick={onPrevious}\n                            style={cursorStyle}\n                        >\n                            {survey.backButtonText || 'Back'}\n                        </button>\n                    )}\n                    {isOpenText && (\n                        <button\n                            class=\"ph-tour-button ph-tour-button--primary\"\n                            onClick={handleTextSubmit}\n                            style={cursorStyle}\n                        >\n                            {survey.submitButtonText || 'Submit'}\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            {!whiteLabel && (\n                <a\n                    href={isInteractive ? 'https://posthog.com/product-tours' : undefined}\n                    target={isInteractive ? '_blank' : undefined}\n                    rel={isInteractive ? 'noopener noreferrer' : undefined}\n                    class=\"ph-tour-branding\"\n                    style={isInteractive ? undefined : { cursor: 'default', pointerEvents: 'none' }}\n                >\n                    Survey by {IconPosthogLogo}\n                </a>\n            )}\n        </>\n    )\n}\n"]}