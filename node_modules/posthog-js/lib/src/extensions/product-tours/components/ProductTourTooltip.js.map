{"version":3,"file":"ProductTourTooltip.js","sourceRoot":"","sources":["../../../../../src/extensions/product-tours/components/ProductTourTooltip.tsx"],"names":[],"mappings":"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","sourcesContent":["import { h } from 'preact'\nimport { useEffect, useLayoutEffect, useState, useCallback, useRef } from 'preact/hooks'\nimport {\n    ProductTour,\n    ProductTourStep,\n    ProductTourDismissReason,\n    ProductTourStepButton,\n} from '../../../posthog-product-tours-types'\nimport { isUndefined, SurveyPosition } from '@posthog/core'\nimport {\n    calculateTooltipPosition,\n    getSpotlightStyle,\n    TooltipPosition,\n    TooltipDimensions,\n    PositionResult,\n    findStepElement,\n    hasElementTarget,\n} from '../product-tours-utils'\nimport { getPopoverPosition } from '../../surveys/surveys-extension-utils'\nimport { addEventListener } from '../../../utils'\nimport { window as _window } from '../../../utils/globals'\nimport { ProductTourTooltipInner } from './ProductTourTooltipInner'\nimport { ProductTourSurveyStepInner } from './ProductTourSurveyStepInner'\n\nconst window = _window as Window & typeof globalThis\n\ntype TransitionState = 'entering' | 'visible' | 'exiting'\n\nexport interface ProductTourTooltipProps {\n    tour: ProductTour\n    step: ProductTourStep\n    stepIndex: number\n    totalSteps: number\n    targetElement: HTMLElement | null\n    onNext: () => void\n    onPrevious: () => void\n    onDismiss: (reason: ProductTourDismissReason) => void\n    onSurveySubmit?: (response: string | number | null) => void\n    onButtonClick?: (button: ProductTourStepButton) => void\n}\n\nfunction getOppositePosition(position: TooltipPosition): TooltipPosition {\n    const opposites: Record<TooltipPosition, TooltipPosition> = {\n        top: 'bottom',\n        bottom: 'top',\n        left: 'right',\n        right: 'left',\n    }\n    return opposites[position]\n}\n\nfunction scrollToElement(element: HTMLElement, resolve: () => void): void {\n    const initialRect = element.getBoundingClientRect()\n    const viewportHeight = window.innerHeight\n    const viewportWidth = window.innerWidth\n\n    const safeMarginY = viewportHeight / 6\n    const safeMarginX = viewportWidth / 6\n\n    const isInSafeZone =\n        initialRect.top >= safeMarginY &&\n        initialRect.bottom <= viewportHeight - safeMarginY &&\n        initialRect.left >= safeMarginX &&\n        initialRect.right <= viewportWidth - safeMarginX\n\n    if (isInSafeZone) {\n        resolve()\n        return\n    }\n\n    element.scrollIntoView({ behavior: 'smooth', block: 'center' })\n\n    let lastTop = initialRect.top\n    let stableCount = 0\n    let resolved = false\n\n    const checkStability = () => {\n        if (resolved) return\n\n        const currentRect = element.getBoundingClientRect()\n        if (Math.abs(currentRect.top - lastTop) < 1) {\n            stableCount++\n            if (stableCount >= 3) {\n                resolved = true\n                resolve()\n                return\n            }\n        } else {\n            stableCount = 0\n        }\n        lastTop = currentRect.top\n        setTimeout(checkStability, 50)\n    }\n\n    setTimeout(checkStability, 30)\n\n    setTimeout(() => {\n        if (!resolved) {\n            resolved = true\n            resolve()\n        }\n    }, 500)\n}\n\nconst TRANSITION_DURATION = 150\n\nexport function ProductTourTooltip({\n    tour,\n    step,\n    stepIndex,\n    totalSteps,\n    targetElement,\n    onNext,\n    onPrevious,\n    onDismiss,\n    onSurveySubmit,\n    onButtonClick,\n}: ProductTourTooltipProps): h.JSX.Element {\n    const [transitionState, setTransitionState] = useState<TransitionState>('entering')\n    const [position, setPosition] = useState<PositionResult | null>(null)\n    const [spotlightStyle, setSpotlightStyle] = useState<ReturnType<typeof getSpotlightStyle> | null>(null)\n    const [isMeasured, setIsMeasured] = useState(false)\n\n    const [displayedStep, setDisplayedStep] = useState(step)\n    const [displayedStepIndex, setDisplayedStepIndex] = useState(stepIndex)\n\n    const tooltipRef = useRef<HTMLDivElement>(null)\n    const previousStepRef = useRef(stepIndex)\n    const isTransitioningRef = useRef(false)\n    const resolvedElementRef = useRef<HTMLElement | null>(targetElement)\n\n    // Steps without element targeting use screen positioning\n    const isScreenPositioned = !hasElementTarget(displayedStep) || displayedStep.type === 'survey'\n\n    useLayoutEffect(() => {\n        resolvedElementRef.current = targetElement\n    }, [targetElement])\n\n    const updatePosition = useCallback(() => {\n        const element = resolvedElementRef.current\n        if (!element || !tooltipRef.current) return\n\n        const tooltipRect = tooltipRef.current.getBoundingClientRect()\n        const tooltipDimensions: TooltipDimensions = {\n            width: tooltipRect.width,\n            height: tooltipRect.height,\n        }\n\n        const targetRect = element.getBoundingClientRect()\n        setPosition(calculateTooltipPosition(targetRect, tooltipDimensions))\n        setSpotlightStyle(getSpotlightStyle(targetRect))\n        setIsMeasured(true)\n    }, [])\n\n    useLayoutEffect(() => {\n        if (!isScreenPositioned && !isMeasured && tooltipRef.current && targetElement) {\n            updatePosition()\n        }\n    }, [isScreenPositioned, isMeasured, targetElement, updatePosition])\n\n    useEffect(() => {\n        const currentStepIndex = stepIndex\n        const isStepChange = previousStepRef.current !== stepIndex\n\n        const finishEntering = () => {\n            if (previousStepRef.current !== currentStepIndex) return\n            setTransitionState('visible')\n            isTransitioningRef.current = false\n        }\n\n        const enterStep = () => {\n            // Only scroll/position for steps with element targeting\n            if (resolvedElementRef.current && hasElementTarget(step)) {\n                if (!resolvedElementRef.current.isConnected) {\n                    resolvedElementRef.current = findStepElement(step).element\n                }\n\n                if (resolvedElementRef.current) {\n                    scrollToElement(resolvedElementRef.current, () => {\n                        if (previousStepRef.current !== currentStepIndex) return\n                        updatePosition()\n                        setTimeout(finishEntering, 50)\n                    })\n                    return\n                }\n            }\n\n            setTimeout(finishEntering, 50)\n        }\n\n        if (!isStepChange) {\n            previousStepRef.current = stepIndex\n            isTransitioningRef.current = true\n            enterStep()\n            return\n        }\n\n        previousStepRef.current = stepIndex\n        isTransitioningRef.current = true\n        setTransitionState('exiting')\n\n        setTimeout(() => {\n            if (previousStepRef.current !== currentStepIndex) return\n\n            // Reset position for element-targeted steps to prevent flash at old position\n            if (hasElementTarget(step)) {\n                setPosition(null)\n                setSpotlightStyle(null)\n                setIsMeasured(false)\n            }\n\n            setDisplayedStep(step)\n            setDisplayedStepIndex(stepIndex)\n            setTransitionState('entering')\n\n            enterStep()\n        }, TRANSITION_DURATION)\n    }, [targetElement, stepIndex, step, updatePosition])\n\n    useEffect(() => {\n        if (transitionState !== 'visible' || isScreenPositioned) return\n\n        const handleUpdate = () => {\n            if (!isTransitioningRef.current) {\n                updatePosition()\n            }\n        }\n\n        addEventListener(window, 'scroll', handleUpdate as EventListener, { capture: true })\n        addEventListener(window, 'resize', handleUpdate as EventListener)\n\n        return () => {\n            window?.removeEventListener('scroll', handleUpdate, true)\n            window?.removeEventListener('resize', handleUpdate)\n        }\n    }, [updatePosition, transitionState, isScreenPositioned])\n\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                onDismiss('escape_key')\n            }\n        }\n        addEventListener(window, 'keydown', handleKeyDown as EventListener)\n        return () => {\n            window?.removeEventListener('keydown', handleKeyDown)\n        }\n    }, [onDismiss])\n\n    const handleOverlayClick = (e: MouseEvent) => {\n        e.stopPropagation()\n        onDismiss('user_clicked_outside')\n    }\n\n    const handleTooltipClick = (e: MouseEvent) => {\n        e.stopPropagation()\n    }\n\n    const handleSpotlightClick = (e: MouseEvent) => {\n        e.stopPropagation()\n        if (resolvedElementRef.current) {\n            resolvedElementRef.current.click()\n        }\n        onNext()\n    }\n\n    const isVisible = transitionState === 'visible'\n    const isSurvey = displayedStep.type === 'survey'\n\n    // For element steps, position is ready once we've measured and calculated\n    const isPositionReady = isScreenPositioned || isMeasured\n\n    const basePosition = { top: 'auto', right: 'auto', bottom: 'auto', left: 'auto', transform: 'none' }\n\n    // surveys default to bottom: 0, and PT should not, so this is a little clunky\n    const getModalPosition = () => {\n        const pos = getPopoverPosition(undefined, displayedStep.modalPosition ?? SurveyPosition.MiddleCenter)\n        if (!('top' in pos) && !('bottom' in pos)) {\n            return { ...pos, bottom: '30px' }\n        }\n        return pos\n    }\n\n    const getElementPositionStyle = (): Record<string, string> => {\n        if (!position) {\n            return {}\n        }\n\n        const isHorizontal = position.position === 'left' || position.position === 'right'\n\n        return {\n            top: !isUndefined(position.top) ? `${position.top}px` : 'auto',\n            bottom: !isUndefined(position.bottom) ? `${position.bottom}px` : 'auto',\n            left: !isUndefined(position.left) ? `${position.left}px` : 'auto',\n            right: !isUndefined(position.right) ? `${position.right}px` : 'auto',\n            transform: isHorizontal ? 'translateY(-50%)' : 'translateX(-50%)',\n        }\n    }\n\n    const tooltipStyle = {\n        ...(displayedStep.maxWidth && {\n            width: `min(${displayedStep.maxWidth}px, calc(100vw - 16px))`,\n            maxWidth: `min(${displayedStep.maxWidth}px, calc(100vw - 16px))`,\n        }),\n        ...(isScreenPositioned\n            ? {\n                  ...basePosition,\n                  ...getModalPosition(),\n              }\n            : getElementPositionStyle()),\n    }\n\n    return (\n        <div class=\"ph-tour-container\">\n            {tour.appearance?.dismissOnClickOutside !== false && (\n                <div class=\"ph-tour-click-overlay\" onClick={handleOverlayClick} />\n            )}\n\n            {/* Modal overlay - visible for non-element steps */}\n            <div\n                class=\"ph-tour-modal-overlay\"\n                style={{\n                    opacity: isScreenPositioned && isVisible ? 1 : 0,\n                    transition: `opacity ${TRANSITION_DURATION}ms ease-out`,\n                    pointerEvents: 'none',\n                }}\n            />\n\n            {/* Spotlight - visible for element steps */}\n            <div\n                class=\"ph-tour-spotlight\"\n                style={{\n                    ...(isVisible && isPositionReady && spotlightStyle\n                        ? spotlightStyle\n                        : { top: '50%', left: '50%', width: '0px', height: '0px' }),\n                    opacity: !isScreenPositioned && isVisible && isPositionReady ? 1 : 0,\n                    transition: `opacity ${TRANSITION_DURATION}ms ease-out`,\n                    ...(displayedStep.progressionTrigger === 'click' &&\n                        !isScreenPositioned && {\n                            pointerEvents: 'auto',\n                            cursor: 'pointer',\n                        }),\n                }}\n                onClick={\n                    displayedStep.progressionTrigger === 'click' && !isScreenPositioned\n                        ? handleSpotlightClick\n                        : undefined\n                }\n            />\n\n            <div\n                ref={tooltipRef}\n                class={`ph-tour-tooltip ${isScreenPositioned ? 'ph-tour-tooltip--modal' : ''} ${isSurvey ? 'ph-tour-survey-step' : ''}`}\n                style={{\n                    ...tooltipStyle,\n                    opacity: isVisible && isPositionReady ? 1 : 0,\n                    transition: `opacity ${TRANSITION_DURATION}ms ease-out`,\n                }}\n                onClick={handleTooltipClick}\n            >\n                {!isScreenPositioned && position && (\n                    <div\n                        class={`ph-tour-arrow ph-tour-arrow--${getOppositePosition(position.position)}`}\n                        style={\n                            position.arrowOffset !== 0\n                                ? { '--ph-tour-arrow-offset': `${position.arrowOffset}px` }\n                                : undefined\n                        }\n                    />\n                )}\n\n                {isSurvey ? (\n                    <ProductTourSurveyStepInner\n                        step={displayedStep}\n                        appearance={tour.appearance}\n                        stepIndex={displayedStepIndex}\n                        totalSteps={totalSteps}\n                        onSubmit={onSurveySubmit}\n                        onPrevious={onPrevious}\n                        onDismiss={() => onDismiss('user_clicked_skip')}\n                    />\n                ) : (\n                    <ProductTourTooltipInner\n                        step={displayedStep}\n                        appearance={tour.appearance}\n                        stepIndex={displayedStepIndex}\n                        totalSteps={totalSteps}\n                        onNext={onNext}\n                        onPrevious={onPrevious}\n                        onDismiss={() => onDismiss('user_clicked_skip')}\n                        onButtonClick={onButtonClick}\n                    />\n                )}\n            </div>\n        </div>\n    )\n}\n"]}