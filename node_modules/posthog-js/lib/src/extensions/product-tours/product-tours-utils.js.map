{"version":3,"file":"product-tours-utils.js","sourceRoot":"","sources":["../../../../src/extensions/product-tours/product-tours-utils.ts"],"names":[],"mappings":"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","sourcesContent":["import DOMPurify from 'dompurify'\n\nimport {\n    JSONContent,\n    ProductTourAppearance,\n    ProductTourSelectorError,\n    ProductTourStep,\n    DEFAULT_PRODUCT_TOUR_APPEARANCE,\n} from '../../posthog-product-tours-types'\nimport { findElement } from './element-inference'\nimport { prepareStylesheet } from '../utils/stylesheet-loader'\nimport { document as _document, window as _window } from '../../utils/globals'\nimport { getFontFamily, getContrastingTextColor, hexToRgba } from '../surveys/surveys-extension-utils'\nimport { createLogger } from '../../utils/logger'\n\nimport productTourStyles from './product-tour.css'\nimport { isUndefined } from '@posthog/core'\n\nconst logger = createLogger('[Product Tours]')\n\nconst document = _document as Document\nconst window = _window as Window & typeof globalThis\n\nexport function getProductTourStylesheet(): HTMLStyleElement | null {\n    const stylesheet = prepareStylesheet(document, typeof productTourStyles === 'string' ? productTourStyles : '')\n    stylesheet?.setAttribute('data-ph-product-tour-style', 'true')\n    return stylesheet\n}\n\nexport interface ElementFindResult {\n    element: HTMLElement | null\n    error: ProductTourSelectorError | null\n    matchCount: number\n}\n\nexport function hasElementTarget(step: ProductTourStep): boolean {\n    if (step.useManualSelector) {\n        return !!step.selector\n    }\n    return !!step.inferenceData\n}\n\nexport function findElementBySelector(selector: string): ElementFindResult {\n    try {\n        const elements = document.querySelectorAll(selector)\n\n        if (elements.length === 0) {\n            return { element: null, error: 'not_found', matchCount: 0 }\n        }\n\n        const element = elements[0] as HTMLElement\n\n        if (!isElementVisible(element)) {\n            return { element: null, error: 'not_visible', matchCount: elements.length }\n        }\n\n        if (elements.length > 1) {\n            return { element, error: 'multiple_matches', matchCount: elements.length }\n        }\n\n        return { element, error: null, matchCount: 1 }\n    } catch {\n        return { element: null, error: 'not_found', matchCount: 0 }\n    }\n}\n\n/**\n * Find element for a step based on its lookup mode.\n * Default: use inference. If useManualSelector is true: use CSS selector.\n */\nexport function findStepElement(step: ProductTourStep): ElementFindResult {\n    const useManualSelector = step.useManualSelector ?? false\n\n    if (useManualSelector) {\n        if (!step.selector) {\n            return { element: null, error: 'not_found', matchCount: 0 }\n        }\n        return findElementBySelector(step.selector)\n    }\n\n    if (!step.inferenceData) {\n        return { element: null, error: 'not_found', matchCount: 0 }\n    }\n\n    const element = findElement(step.inferenceData)\n    return element ? { element, error: null, matchCount: 1 } : { element: null, error: 'not_found', matchCount: 0 }\n}\n\nexport function isElementVisible(element: HTMLElement): boolean {\n    const style = window.getComputedStyle(element)\n\n    if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {\n        return false\n    }\n\n    const rect = element.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) {\n        return false\n    }\n\n    return true\n}\n\nexport function getElementMetadata(element: HTMLElement): {\n    tag: string\n    id: string | undefined\n    classes: string | undefined\n    text: string | undefined\n} {\n    return {\n        tag: element.tagName,\n        id: element.id || undefined,\n        classes: element.className || undefined,\n        text: element.innerText?.slice(0, 100) || undefined,\n    }\n}\n\nexport type TooltipPosition = 'top' | 'bottom' | 'left' | 'right'\n\nexport interface PositionResult {\n    position: TooltipPosition\n    top?: number\n    bottom?: number\n    left?: number\n    right?: number\n    arrowOffset: number // pixels from center (positive = right/down)\n}\n\nconst TOOLTIP_MARGIN = 12\nconst VIEWPORT_PADDING = 8\n\nfunction clampToViewport(\n    value: number,\n    dimension: number,\n    viewportDimension: number\n): { clamped: number; offset: number } {\n    const min = VIEWPORT_PADDING + dimension / 2\n    const max = viewportDimension - VIEWPORT_PADDING - dimension / 2\n    const clamped = Math.max(min, Math.min(max, value))\n    return { clamped, offset: value - clamped }\n}\n\nexport interface TooltipDimensions {\n    width: number\n    height: number\n}\n\nexport function calculateTooltipPosition(targetRect: DOMRect, tooltipDimensions: TooltipDimensions): PositionResult {\n    const viewportWidth = window.innerWidth\n    const viewportHeight = window.innerHeight\n\n    const { width, height } = tooltipDimensions\n    const spaceAbove = targetRect.top\n    const spaceBelow = viewportHeight - targetRect.bottom\n    const spaceLeft = targetRect.left\n    const spaceRight = viewportWidth - targetRect.right\n\n    const targetCenterY = targetRect.top + targetRect.height / 2\n    const targetCenterX = targetRect.left + targetRect.width / 2\n\n    if (spaceRight >= width + TOOLTIP_MARGIN) {\n        // right of element\n        const left = targetRect.right + TOOLTIP_MARGIN\n        const { clamped: top, offset: arrowOffset } = clampToViewport(targetCenterY, height, viewportHeight)\n        return { position: 'right', top, left, arrowOffset }\n    }\n    if (spaceLeft >= width + TOOLTIP_MARGIN) {\n        // left of element\n        const right = viewportWidth - targetRect.left + TOOLTIP_MARGIN\n        const { clamped: top, offset: arrowOffset } = clampToViewport(targetCenterY, height, viewportHeight)\n        return { position: 'left', top, right, arrowOffset }\n    }\n    if (spaceAbove >= height + TOOLTIP_MARGIN && spaceBelow < height + TOOLTIP_MARGIN) {\n        // above element\n        const bottom = viewportHeight - targetRect.top + TOOLTIP_MARGIN\n        const { clamped: left, offset: arrowOffset } = clampToViewport(targetCenterX, width, viewportWidth)\n        return { position: 'top', bottom, left, arrowOffset }\n    }\n\n    // default: below element\n    const top = targetRect.bottom + TOOLTIP_MARGIN\n    const { clamped: left, offset: arrowOffset } = clampToViewport(targetCenterX, width, viewportWidth)\n    return { position: 'bottom', top, left, arrowOffset }\n}\n\nexport function getSpotlightStyle(targetRect: DOMRect, padding: number = 8): Record<string, string> {\n    return {\n        top: `${targetRect.top - padding}px`,\n        left: `${targetRect.left - padding}px`,\n        width: `${targetRect.width + padding * 2}px`,\n        height: `${targetRect.height + padding * 2}px`,\n    }\n}\n\nexport function addProductTourCSSVariablesToElement(element: HTMLElement, appearance?: ProductTourAppearance): void {\n    const merged = { ...DEFAULT_PRODUCT_TOUR_APPEARANCE, ...appearance }\n    const style = element.style\n\n    // User-customizable variables\n    style.setProperty('--ph-tour-background-color', merged.backgroundColor)\n    style.setProperty('--ph-tour-text-color', merged.textColor)\n    style.setProperty('--ph-tour-button-color', merged.buttonColor)\n    style.setProperty('--ph-tour-border-radius', `${merged.borderRadius}px`)\n    style.setProperty('--ph-tour-button-border-radius', `${merged.buttonBorderRadius}px`)\n    style.setProperty('--ph-tour-border-color', merged.borderColor)\n    style.setProperty('--ph-tour-font-family', getFontFamily(merged.fontFamily))\n\n    // Derived colors\n    style.setProperty('--ph-tour-text-secondary-color', hexToRgba(merged.textColor, 0.6))\n    style.setProperty('--ph-tour-branding-text-color', getContrastingTextColor(merged.backgroundColor))\n    style.setProperty('--ph-tour-button-text-color', getContrastingTextColor(merged.buttonColor))\n    style.setProperty('--ph-tour-box-shadow', merged.boxShadow)\n    style.setProperty('--ph-tour-overlay-color', merged.showOverlay ? 'rgba(0, 0, 0, 0.5)' : 'transparent')\n    style.setProperty('--ph-tour-z-index', String(merged.zIndex))\n\n    // Internal styling variables (not customizable)\n    style.setProperty('--ph-tour-button-secondary-color', 'transparent')\n    style.setProperty('--ph-tour-button-secondary-text-color', merged.textColor)\n    style.setProperty('--ph-tour-max-width', '320px')\n    style.setProperty('--ph-tour-padding', '16px')\n}\n\nexport function renderTipTapContent(content: any): string {\n    if (!content) {\n        return ''\n    }\n\n    if (typeof content === 'string') {\n        return escapeHtml(content)\n    }\n\n    if (content.type === 'text') {\n        let text = escapeHtml(content.text || '')\n\n        if (content.marks) {\n            for (const mark of content.marks) {\n                switch (mark.type) {\n                    case 'bold':\n                        text = `<strong>${text}</strong>`\n                        break\n                    case 'italic':\n                        text = `<em>${text}</em>`\n                        break\n                    case 'underline':\n                        text = `<u>${text}</u>`\n                        break\n                    case 'strike':\n                        text = `<s>${text}</s>`\n                        break\n                }\n            }\n        }\n\n        return text\n    }\n\n    const children = content.content?.map(renderTipTapContent).join('') || ''\n\n    switch (content.type) {\n        case 'doc':\n            return children\n        case 'paragraph':\n            return `<p>${children}</p>`\n        case 'heading': {\n            const level = content.attrs?.level || 1\n            return `<h${level}>${children}</h${level}>`\n        }\n        case 'bulletList':\n            return `<ul>${children}</ul>`\n        case 'orderedList':\n            return `<ol>${children}</ol>`\n        case 'listItem':\n            return `<li>${children}</li>`\n        case 'hardBreak':\n            return '<br>'\n        default:\n            return children\n    }\n}\n\nexport function normalizeUrl(url: string): string {\n    return url.endsWith('/') ? url.slice(0, -1) : url\n}\n\nfunction escapeHtml(text: string): string {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n}\n\nexport function resolveStepTranslation(step: ProductTourStep, lang: string | null): ProductTourStep {\n    if (!lang || !step.translations) {\n        return step\n    }\n\n    const translations = step.translations\n\n    // exact match (en-US === en-US), then base match (en-US falls back to en)\n    const t = translations[lang] ?? translations[lang.split('-')[0]]\n\n    if (!t) {\n        logger.info(`No matching translation for \"${lang}\" in step ${step.id}, using default`)\n        return step\n    }\n\n    const resolved = { ...step }\n\n    if (!isUndefined(t.content)) {\n        resolved.content = t.content\n    }\n\n    if (!isUndefined(t.contentHtml)) {\n        resolved.contentHtml = t.contentHtml\n    }\n\n    if (t.buttons && resolved.buttons) {\n        resolved.buttons = {\n            primary: resolved.buttons.primary && { ...resolved.buttons.primary, ...t.buttons.primary },\n            secondary: resolved.buttons.secondary && { ...resolved.buttons.secondary, ...t.buttons.secondary },\n        }\n    }\n\n    if (t.survey && resolved.survey) {\n        resolved.survey = { ...resolved.survey, ...t.survey }\n    }\n\n    return resolved\n}\n\nexport function getStepImageUrls(step: ProductTourStep): string[] {\n    const urls: string[] = []\n    function walk(node: JSONContent) {\n        if (node.type === 'image' && node.attrs?.src) {\n            urls.push(node.attrs.src)\n        }\n        node.content?.forEach(walk)\n    }\n    if (step.content) {\n        walk(step.content)\n    }\n    return urls\n}\n\nexport function getStepHtml(step: ProductTourStep): string {\n    if (step.contentHtml) {\n        return DOMPurify.sanitize(step.contentHtml, {\n            ADD_TAGS: ['iframe'],\n            ADD_ATTR: ['allowfullscreen', 'frameborder', 'referrerpolicy'],\n        })\n    }\n\n    // backwards compat, will be deprecated\n    return renderTipTapContent(step.content)\n}\n"]}