---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import marquesData from '../data/marques.json';

const brands = marquesData.marques;

// Three copies for seamless infinite loop
const marqueeItems = [...brands, ...brands, ...brands];

// Only keep categories that actually have brands
const usedCats = marquesData.categories.filter(c =>
  brands.some((b: { category: string }) => b.category === c)
);
const categories = ['Toutes', ...usedCats];

// Count per category
const countByCat: Record<string, number> = {};
categories.forEach(c => {
  countByCat[c] = c === 'Toutes' ? brands.length : brands.filter((b: { category: string }) => b.category === c).length;
});
---

<Layout
  title="Nos Marques | Opticien Ã  Montivilliers â€” Gravelines Optique"
  description="30+ marques de lunettes : Ray-Ban, Lafont, David Beckham, IKKS enfants. Essayage gratuit en boutique chez votre opticien Ã  Montivilliers."
>
  <Header />

  <!-- â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="pt-32 pb-20 bg-dark text-white relative overflow-hidden">
    <div class="absolute inset-0 opacity-[0.04]">
      <div class="absolute inset-0" style="background-image: radial-gradient(circle at 2px 2px, #C9A961 1px, transparent 0); background-size: 40px 40px;"></div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="text-gold text-xs tracking-widest uppercase font-medium mb-4">Notre sÃ©lection</div>
      <h1 class="font-serif text-5xl sm:text-6xl text-white mb-6">
        {brands.length}+ Marques <em class="text-gold">d'Exception</em>
      </h1>
      <p class="text-white/60 text-lg max-w-2xl mx-auto">
        Des crÃ©ateurs indÃ©pendants aux grandes maisons, nous sÃ©lectionnons avec exigence
        chaque marque pour vous offrir le meilleur de l'optique.
      </p>
    </div>
  </section>

  <!-- â”€â”€â”€ MARQUEE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="marquee-section overflow-hidden bg-dark">
    <div class="h-px bg-gradient-to-r from-transparent via-gold/40 to-transparent"></div>
    <div class="marquee-wrap py-8">
      <div class="marquee-track">
        {marqueeItems.map((brand: { logo: string; name: string }) => (
          <div class="marquee-item">
            <img
              src={brand.logo}
              alt={brand.name}
              loading="lazy"
              onerror="this.parentElement.style.display='none'"
            />
          </div>
        ))}
      </div>
    </div>
    <div class="h-px bg-gradient-to-r from-transparent via-gold/40 to-transparent"></div>
  </div>

  <!-- â”€â”€â”€ BRANDS SHOWCASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="py-20 bg-cream">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Category filter -->
      <div class="flex flex-wrap gap-2 mb-14 reveal">
        {categories.map((cat) => (
          <button
            data-filter={cat}
            class={`filter-btn flex-shrink-0 flex items-center gap-2 px-4 py-2 text-xs font-medium rounded-full border transition-all duration-200 tracking-wide whitespace-nowrap
              ${cat === 'Toutes'
                ? 'bg-dark text-white border-dark active'
                : 'border-dark/15 text-dark/50 hover:border-dark hover:text-dark'
              }`}
          >
            {cat}
            <span class="text-[10px] font-bold opacity-60">{countByCat[cat]}</span>
          </button>
        ))}
      </div>

      <!-- Brands Grid -->
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" id="brands-grid">
        {brands.map((brand: { name: string; logo: string; category: string; featured: boolean }, i: number) => (
          <div
            class="brand-card reveal group"
            data-category={brand.category}
            style={`transition-delay: ${(i % 15) * 35}ms`}
          >
            <div class="logo-frame">
              <img
                src={brand.logo}
                alt={`Logo ${brand.name}`}
                loading="lazy"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
              />
              <div class="logo-fallback" style="display:none">
                <span>{brand.name[0]}</span>
              </div>
            </div>
            <div class="card-info">
              <div class="brand-name">{brand.name}</div>
              <div class="brand-cat">{brand.category}</div>
            </div>
            {brand.featured && <div class="featured-dot"></div>}
          </div>
        ))}
      </div>

      <div id="empty-state" class="hidden text-center py-20 text-dark/30">
        <div class="text-5xl mb-4">ğŸ”</div>
        <p>Aucune marque dans cette catÃ©gorie.</p>
      </div>

    </div>
  </section>

  <!-- â”€â”€â”€ CTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="py-28 bg-dark text-white relative overflow-hidden">
    <div class="absolute inset-0 opacity-[0.03]"
      style="background-image: radial-gradient(circle at 1.5px 1.5px, #C9A961 1px, transparent 0); background-size: 36px 36px;">
    </div>
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold/30 to-transparent"></div>
    <div class="relative max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="text-gold text-xs tracking-widest uppercase font-medium mb-5">Sans rendez-vous</div>
      <h2 class="font-serif text-5xl sm:text-6xl text-white mb-6 leading-tight">
        Essayage gratuit<br/><em class="text-gold">en boutique</em>
      </h2>
      <div class="w-12 h-px bg-gradient-to-r from-transparent via-gold to-transparent mx-auto mb-8"></div>
      <p class="text-white/40 text-base mb-10 max-w-sm mx-auto leading-relaxed">
        Venez essayer toutes nos montures. Notre Ã©quipe vous conseille selon votre
        morphologie, votre style et votre correction.
      </p>
      <a
        href="/contact"
        class="inline-flex items-center gap-3 bg-gold hover:bg-gold-dark text-dark font-bold px-10 py-4 rounded-sm transition-all duration-200 text-sm tracking-widest uppercase hover:scale-[1.02]"
      >
        Voir les horaires
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
        </svg>
      </a>
    </div>
  </section>

  <Footer />
</Layout>

<style>
  /* â”€â”€ MARQUEE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .marquee-wrap { overflow: hidden; position: relative; }

  /* Fade masks on edges */
  .marquee-wrap::before,
  .marquee-wrap::after {
    content: '';
    position: absolute;
    top: 0; bottom: 0;
    width: 140px;
    z-index: 2;
    pointer-events: none;
  }
  .marquee-wrap::before { left: 0; background: linear-gradient(to right, #0a0a0a, transparent); }
  .marquee-wrap::after  { right: 0; background: linear-gradient(to left, #0a0a0a, transparent); }

  .marquee-track {
    display: flex;
    align-items: center;
    animation: marquee-scroll 50s linear infinite;
    width: max-content;
  }

  .marquee-section:hover .marquee-track {
    animation-play-state: paused;
  }

  .marquee-item {
    flex-shrink: 0;
    padding: 0 3.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .marquee-item img {
    height: 52px;
    max-width: 140px;
    object-fit: contain;
    filter: brightness(0) invert(1);
    opacity: 0.65;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  .marquee-item:hover img { opacity: 1; }

  @keyframes marquee-scroll {
    from { transform: translateX(0); }
    to   { transform: translateX(-33.333%); }
  }

  /* â”€â”€ FILTER PILLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .filter-pills::-webkit-scrollbar { display: none; }
  .filter-pills { -ms-overflow-style: none; scrollbar-width: none; }

  .filter-btn.active {
    background: #C9A961;
    color: #080808;
    border-color: #C9A961;
    font-weight: 700;
  }
  .filter-btn.active span {
    background: rgba(8,8,8,0.18);
    color: #080808;
  }

  /* â”€â”€ BRAND CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .brand-card {
    position: relative;
    background: #fff;
    border: 1px solid #e8e4df;
    border-radius: 4px;
    padding: 24px 16px 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    overflow: hidden;
    transition: transform 0.3s cubic-bezier(.22,1,.36,1),
                border-color 0.3s ease,
                box-shadow 0.3s ease;
  }

  .brand-card:hover {
    transform: translateY(-4px);
    border-color: rgba(201,169,97,0.5);
    box-shadow: 0 12px 40px rgba(0,0,0,0.1), 0 0 0 1px rgba(201,169,97,0.15);
  }

  /* Logo area â€” logos in full color on white */
  .logo-frame {
    width: 100%;
    aspect-ratio: 3/2;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
  }

  .logo-frame img {
    max-height: 56px;
    max-width: 100%;
    object-fit: contain;
    transition: transform 0.3s cubic-bezier(.22,1,.36,1);
  }

  .brand-card:hover .logo-frame img {
    transform: scale(1.07);
  }

  .logo-fallback {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: 700;
    color: #999;
    font-family: serif;
  }

  /* Card info */
  .card-info { text-align: center; width: 100%; }

  .brand-name {
    font-size: 12.5px;
    font-weight: 600;
    color: #1a202c;
    letter-spacing: 0.01em;
    line-height: 1.3;
    margin-bottom: 4px;
    transition: color 0.2s;
  }
  .brand-card:hover .brand-name { color: #0a0a0a; }

  .brand-cat {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #C9A961;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  .brand-card:hover .brand-cat { opacity: 1; }

  /* Featured dot */
  .featured-dot {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 5px;
    height: 5px;
    background: #C9A961;
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(201,169,97,0.7);
  }
</style>

<script>
  // â”€â”€ FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const filterBtns = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
  const brandCards = document.querySelectorAll<HTMLElement>('.brand-card');
  const emptyState = document.getElementById('empty-state');

  filterBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter') || 'Toutes';

      filterBtns.forEach(b => {
        b.classList.remove('bg-dark', 'text-white', 'border-dark', 'active');
        b.classList.add('border-dark/15', 'text-dark/50');
      });
      btn.classList.add('bg-dark', 'text-white', 'border-dark', 'active');
      btn.classList.remove('border-dark/15', 'text-dark/50');

      let visible = 0;
      brandCards.forEach((card) => {
        const category = card.getAttribute('data-category');
        const show = filter === 'Toutes' || category === filter;
        if (show) {
          card.style.display = 'flex';
          card.style.transitionDelay = `${(visible % 15) * 35}ms`;
          visible++;
        } else {
          card.style.display = 'none';
        }
      });

      if (emptyState) emptyState.classList.toggle('hidden', visible > 0);
    });
  });
</script>
